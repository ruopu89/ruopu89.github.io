<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="ruopu&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ruopu&#39;s blog">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ruopu&#39;s blog">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ruopu's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-TW">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ruopu's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切換導航欄">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首頁</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />標籤</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分類</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />歸檔</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜尋</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜尋..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/18/python基础学习-装饰器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/18/python基础学习-装饰器/" itemprop="url">
                  python基础学习-装饰器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-18 17:41:29" itemprop="dateCreated datePublished" datetime="2019-11-18T17:41:29+08:00">2019-11-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-11-19 18:13:26" itemprop="dateModified" datetime="2019-11-19T18:13:26+08:00">2019-11-19</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><ul>
<li>需求<ul>
<li>一个加法函数，想增强它的功能，能够输出被调用过以及调用的参数信息</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">增加信息输出功能</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    print(<span class="string">"call add,x+y"</span>)   <span class="comment"># 日志输出到控制台</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面的加法函数是完成了需求，但是有以下的缺点：</span></span><br><span class="line"><span class="comment"># 打印语句的耦合太高</span></span><br><span class="line"><span class="comment"># 加法函数属于业务功能，而输出信息的功能，属于非业务功能代码，不该放在业务函数加法中</span></span><br></pre></td></tr></table></figure>
<ul>
<li>做到了业务功能分离，但是fn函数调用传参是个问题</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">    print(<span class="string">'begin'</span>)   <span class="comment"># 增强的输出</span></span><br><span class="line">    x = fn(<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">    print(<span class="string">'end'</span>)   <span class="comment"># 增加的功能</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">print(logger(add))</span><br></pre></td></tr></table></figure>
<ul>
<li>解决了传参的问题，进一步改变</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn,*args,**kwargs)</span>:</span></span><br><span class="line">    print(<span class="string">'begin'</span>)</span><br><span class="line">    x = fn(*args,**kwargs)</span><br><span class="line">    print(<span class="string">'end'</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">print(logger(add,<span class="number">5</span>,y=<span class="number">60</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>柯里化</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'begin'</span>)</span><br><span class="line">        x = fn(*args,**kwargs)</span><br><span class="line">        print(<span class="string">'end'</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">print(logger(add)(<span class="number">5</span>,y=<span class="number">50</span>))</span><br><span class="line"><span class="comment"># 换一种写法</span></span><br><span class="line">add = logger(add)</span><br><span class="line">print(add(x=<span class="number">5</span>,y=<span class="number">10</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>装饰器语法糖</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'begin'</span>)</span><br><span class="line">        x = fn(*args,**kwargs)</span><br><span class="line">        print(<span class="string">'end'</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger  # 等价于add = logger(add)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add(<span class="number">45</span>,<span class="number">40</span>))</span><br><span class="line"><span class="comment"># @logger是什么？这就是装饰器语法</span></span><br></pre></td></tr></table></figure>
<ul>
<li>装饰器（无参）<ul>
<li>它是一个函数</li>
<li>函数作为它的形参</li>
<li>返回值也是一个函数</li>
<li>可以使用@functionname方式，简化调用</li>
</ul>
</li>
<li>装饰器和高阶函数<ul>
<li>装饰器是高阶函数，但装饰器是对传入函数的功能的装饰（功能增强）</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># before功能增强</span></span><br><span class="line">        print(<span class="string">"args=&#123;&#125;,kwargs=&#123;&#125;"</span>.format(args,kwargs))</span><br><span class="line">        start = datetime.datetime.now()</span><br><span class="line">        ret = fn(*args,**kwargs)</span><br><span class="line">        <span class="comment"># after功能增强</span></span><br><span class="line">        duration = datetime.datetime.now() - start</span><br><span class="line">        print(<span class="string">"function &#123;&#125; to ok &#123;&#125;s"</span>.format(fn.__name__,duration.total_seconds()))</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> wrap</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger  # 相当于 add = logger(add)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    print(<span class="string">"=====call add====="</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add(<span class="number">4</span>,y=<span class="number">7</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>怎么理解装饰器</li>
</ul>
<p><img src="/images/python装饰器/装饰器1.png" alt=""></p>
<p><img src="/images/python装饰器/装饰器2.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y,file)</span>:</span></span><br><span class="line">    print(<span class="string">"call &#123;&#125;,&#123;&#125;+&#123;&#125;"</span>.format(add.__name__,x,y),file=file)  </span><br><span class="line"><span class="comment"># 双下划线是函数的特殊属性，__name__可以获取函数的名称，file是print()的选项，可以输出到外面，如果要灵</span></span><br><span class="line"><span class="comment"># 活设置参数，应该把参数写到上面定义add函数的地方，print中前一个file是形参，后一个file是传进来的参数</span></span><br><span class="line">    <span class="keyword">return</span> x+y</span><br><span class="line">add(<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"><span class="comment"># 通过嵌套函数可以实现用外部函数将里面的函数包起来</span></span><br><span class="line">输出：</span><br><span class="line">call add,<span class="number">4</span>+<span class="number">5</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line">=======================================================================================</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add2</span><span class="params">(x,y,z)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x+y+z</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add3</span><span class="params">(x,y,*args,z)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x+y+z</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn,*args,**kwargs)</span>:</span>  <span class="comment"># 这里用了两个可变参数</span></span><br><span class="line">    print(<span class="string">'before'</span>)</span><br><span class="line">    ret = fn(*args,**kwargs)   <span class="comment"># 这里用的是解参数</span></span><br><span class="line">    print(<span class="string">'after'</span>)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">print(logger(add2,<span class="number">4</span>,x=<span class="number">5</span>,y=<span class="number">6</span>))   </span><br><span class="line"><span class="comment"># 这里调用的时候，logger中fn对应的是add2，*args对应的是4,**kwargs对应的是x=5，y=6。当调用fn()函数</span></span><br><span class="line"><span class="comment"># 时，会将*args等于4，**kwargs等于x=5,y=6代入到add2()函数中，这时，x为4，y为5，z为6，但顺序不一定</span></span><br><span class="line"><span class="comment"># 是这样排列的。最后返回x+y+z的值，并赋值给ret并结束</span></span><br><span class="line">print(logger(add3,<span class="number">4</span>,z=<span class="number">5</span>,y=<span class="number">6</span>))</span><br><span class="line">输出：</span><br><span class="line">before</span><br><span class="line">after</span><br><span class="line"><span class="number">15</span></span><br><span class="line">before</span><br><span class="line">after</span><br><span class="line"><span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_logger</span><span class="params">(*args,**kwargs)</span>:</span>   </span><br><span class="line"><span class="comment"># 这里定义的参数是根据外层要调用的函数来设计的，如外层的add1到add3函数，这里这样定义都可以满足外层函数</span></span><br><span class="line"><span class="comment"># 的要求。</span></span><br><span class="line"><span class="comment"># 柯里化就是把第一个参数拿到外面来，之后的参数放到内层函数中去，因为是嵌套函数，里边的函数要能被用到，总</span></span><br><span class="line"><span class="comment"># 要返回一个值，上面返回的是内层函数的一个引用，这里就返回了_logger</span></span><br><span class="line">        print(<span class="string">'before'</span>)</span><br><span class="line">        ret = fn(*args,**kwargs)   </span><br><span class="line">        <span class="comment"># 这里用的是解参数。这里一定要写成这样，不能在这里用return，不然下面就不执行了</span></span><br><span class="line">        print(<span class="string">'after'</span>)</span><br><span class="line">        <span class="keyword">return</span> ret   <span class="comment"># 被包装函数也应该返回，不然会破坏原函数，原函数本来有返回的。</span></span><br><span class="line">    <span class="keyword">return</span> _logger </span><br><span class="line"><span class="comment"># 这个_logger函数叫包装函数，里面的fn函数叫被包装函数，这一句非常重要，一定要有返回值，一定返回内层函数</span></span><br><span class="line"><span class="comment"># 的引用。我们这里对原函数没有任何侵入式</span></span><br><span class="line"><span class="comment"># foo = logger(add1)</span></span><br><span class="line"><span class="comment"># print(foo(4,5))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># logger(add1)(40,30)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add1 = logger(add1)   </span></span><br><span class="line"><span class="comment"># fn是自由变量，里面引用是成为闭包，这个变量被留下来了。python提供了一种简单的方式，@logger，如下</span></span><br><span class="line"><span class="meta">@logger  # 装饰器函数，add1 = logger(add1)，这里add1被覆盖掉了，之后再调用add1就相当于调用内层函数_logger，_logger中的fn函数才是真正进行运算的。_logger函数就相当于add1函数的增加版，即实现了add1</span></span><br><span class="line"><span class="comment"># 函数的功能，还增加了其他功能。把函数加上@后，就会把其下面的函数当作参数传入加@的函数中，再次调用add1</span></span><br><span class="line"><span class="comment"># 时，执行的实际是logger函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">add1(<span class="number">4</span>,<span class="number">100</span>)</span><br><span class="line">输出：</span><br><span class="line">before</span><br><span class="line">after</span><br><span class="line"><span class="number">104</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果换成下面的写法，它的本质是，返回了内层函数_logger，_logger中的fn并没有丢，通过闭包把这个外部变</span></span><br><span class="line"><span class="comment"># 量保存下来了，当真正调用add1时，实际上调用的是内层函数_logger，调用内层函数_logger时，这个fn还在，</span></span><br><span class="line"><span class="comment"># 它保存在自由变量里，这个fn才是真正被包装的函数，也就是最原始的那个函数，现在的add1已经被覆盖掉了，所</span></span><br><span class="line"><span class="comment"># 以print()中的add1已经是内层函数了，传参被_logger函数的参数接收了，接收后放在fn函数中，这就是保存下</span></span><br><span class="line"><span class="comment"># 来的自由变量，指向的是外部的add1函数</span></span><br><span class="line">add1 = logger(add1)   </span><br><span class="line">print(add1(x=<span class="number">5</span>,y=<span class="number">10</span>))</span><br><span class="line"><span class="comment"># 装饰器是一种语法糖，对上面两行代码的代替。用@logger代替add1 = logger(add1)，而且logger函数应该写</span></span><br><span class="line"><span class="comment"># 在@logger前面，不然@logger会提示不认识logger函数。这里必须先定义logger函数，之后定义装饰器函数</span></span><br><span class="line"><span class="comment"># @logger，最后定义add1函数</span></span><br><span class="line"><span class="meta">@ logger   # 装饰器只接收到add1函数的标识符，并不包括参数，参数由内层函数_logger管</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span><span class="params">(x,y)</span>:</span>   <span class="comment"># 这里是原始的add1函数标识符</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">print(add1(<span class="number">45</span>,<span class="number">40</span>))   <span class="comment"># 这里调用的是被装饰器函数修改过的add1函数，指的是内层函数的一个引用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器函数主机是为了装饰，但函数功能增强，必免侵入式</span></span><br></pre></td></tr></table></figure>
<ul>
<li>副作用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">        <span class="string">'I am wrapper'</span></span><br><span class="line">        print(<span class="string">'begin'</span>)</span><br><span class="line">        x = fn(*args,**kwargs)</span><br><span class="line">        print(<span class="string">'end'</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger  # add = logger(add)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="string">'''This is a function for add'''</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(<span class="string">"name=&#123;&#125;,doc=&#123;&#125;"</span>.format(add.__name__,add.__doc__))</span><br><span class="line"><span class="comment"># 原函数对象的属性都被替换了，而使用装饰器，我们的需求是查看被封装函数的属性，如何解决？</span></span><br></pre></td></tr></table></figure>
<ul>
<li>提供一个函数，被封装函数属性 ==copy==&gt;包装函数属性</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># def copy_properties(src,dst):</span></span><br><span class="line"><span class="comment">#     dst.__name__ = src.__name__</span></span><br><span class="line"><span class="comment">#     dst.__doc__ = src.__doc__</span></span><br><span class="line"><span class="comment">#     dst.__qualname__ = src.__qualname__</span></span><br><span class="line"><span class="comment"># 把上面的代码改为装饰器，如下：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copy_properties</span><span class="params">(src)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_copy</span><span class="params">(dst)</span>:</span></span><br><span class="line">        dst.__name__ = src.__name__</span><br><span class="line">        dst.__doc__ = src.__doc__</span><br><span class="line">        dst.__qualname__ = src.__qualname__   </span><br><span class="line">        <span class="keyword">return</span> dst </span><br><span class="line">    <span class="keyword">return</span> _copy</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn)</span>:</span> </span><br><span class="line"><span class="meta">    @copy_properties(fn)  # wrapper = copy_properties(fn)(wrapper)</span></span><br><span class="line"><span class="comment"># 这里先不看@符号，copy_properties(fn)这个函数调用中的fn参数会被传到copy_properties函数中当作</span></span><br><span class="line"><span class="comment"># src参数，下面的add会被当作fn从logger传进来，这时add就变成copy_properties的src参数了，这里返回</span></span><br><span class="line"><span class="comment"># 的就是_copy这个内层函数了。当copy_properties(fn)加了@后，就相当于@_copy，即使是同一个函数对象，</span></span><br><span class="line"><span class="comment"># 不同次调用，里面的结果都不一样，因为_copy是嵌入在内层的函数，在外部是不可见的，所以要用函数调用返回</span></span><br><span class="line"><span class="comment"># 回来，相当于@copy_properties.wrapper = @_copy，@_copy要将其下面的函数的名字当作参数传入，这样就</span></span><br><span class="line"><span class="comment"># 成了_copy(logger.wrapper)，也就是说logger中的wrapper函数要作为参数传到_copy中去，它会把@下面的</span></span><br><span class="line"><span class="comment"># wrapper覆盖一次，_copy(wrapper)返回什么，在_copy中就应该返回什么，也就是说_copy一定要有返回值，</span></span><br><span class="line"><span class="comment"># 而不能是None，如果是None，那么下面的wrapper函数也就无法执行了，_copy(wrapper)的返回值还要赋值给</span></span><br><span class="line"><span class="comment"># wrapper，_copy(wrapper)的值就是它自己，也就是dst。使用装饰器时，有几层就要return几层。</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line"><span class="comment"># 柯里化就是把第一个参数拿到外面来，之后的参数放到内层函数中去，因为是嵌套函数，里边的函数要能被用到，总</span></span><br><span class="line"><span class="comment"># 要返回一个值，这里返回的是内层函数的一个引用，这里就返回了wrapper</span></span><br><span class="line">        <span class="string">'''This is a wrapper'''</span></span><br><span class="line">        print(<span class="string">'before'</span>)</span><br><span class="line">        ret = fn(*args,**kwargs)   <span class="comment"># 这里用的是解参数。这里一定要写成这样，不能在这里用return，不然下面就不执行了</span></span><br><span class="line">        print(<span class="string">'after'</span>)</span><br><span class="line">        <span class="keyword">return</span> ret   <span class="comment"># 被包装函数也应该返回，不然会破坏原函数，原函数本来有返回的。</span></span><br><span class="line"><span class="comment">#     copy_properties(fn,_logger)   </span></span><br><span class="line"><span class="comment">#  这是一个普通函数调用，与wrapper函数没关系。这一句放在这里时，已经有了wrapper和fn函数另外，这一句一</span></span><br><span class="line"><span class="comment"># 定要放在return _logger前。这个return就是装饰器@logger干的事情，这个装饰器相当于有一个函数调用，调</span></span><br><span class="line"><span class="comment"># 用时给logger传一个实参，fn就是add，def _logger是定义，什么都不用动，因为还没有调用它，这里指外部还</span></span><br><span class="line"><span class="comment"># 没有调用过logger函数，如print(logger(add1(39,23)))这样。这时执行copy_properties函数，将fn的属</span></span><br><span class="line"><span class="comment"># 性复制给_logger，那么当使用help或用__name__或__doc__时，就会显示add函数的属性了</span></span><br><span class="line">    <span class="keyword">return</span> _logger</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger   # 加入装饰器后，看一下add.__name和add.__doc__是不是还是add。结果显示是_logger，但我们想看的是add的帮助文档</span></span><br><span class="line"><span class="comment"># 这里本身也不应该改变原函数的帮助文档。所以要添加一个copy_properties函数，并在logger函数中调用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="string">'This is a function'</span>  <span class="comment"># 文档字符串，必须放在函数后的第一行，如果有多行，要用三引号</span></span><br><span class="line">    ret = x + y</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="comment"># add(4,100)</span></span><br><span class="line">print(add.__name__,add.__doc__,add.__qualname__,sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment"># print(help(add))</span></span><br><span class="line"><span class="comment"># help本身就是在调用__name__和__doc__这些东西</span></span><br><span class="line"><span class="comment"># __qualname__与add没有关系，这个打印的叫限定名</span></span><br><span class="line">print(<span class="string">"name=&#123;&#125;,doc=&#123;&#125;"</span>.format(add.__name__,add.__doc__))</span><br></pre></td></tr></table></figure>
<ul>
<li>通过<code>copy_properties</code>函数将被包装函数的属性覆盖掉包装函数</li>
<li>凡是被装饰的函数都需要复制这些属性，这个函数很通用</li>
<li>可以将复制属性的函数构建成装饰器函数，带参装饰器</li>
</ul>
<h3 id="带参装饰器"><a href="#带参装饰器" class="headerlink" title="带参装饰器"></a>带参装饰器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取函数的执行时长，对超过阈值的函数记录一下</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(duration)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_logger</span><span class="params">(fn)</span>:</span></span><br><span class="line"><span class="meta">        @copy_properties(fn)   # wrapper = wrapper(fn)(wrapper)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">            start = datetime.datetime.now()</span><br><span class="line">            ret = fn(*args,**kwargs)</span><br><span class="line">            delta = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">            print(<span class="string">'so slow'</span>) <span class="keyword">if</span> delta &gt; duration <span class="keyword">else</span> print(<span class="string">'so fast'</span>)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> _logger</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger(5)  # add = logger(5)(add)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add(<span class="number">5</span>,<span class="number">6</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>带参装饰器<ul>
<li>它是一个函数</li>
<li>函数作为它的形参</li>
<li>返回值是一个不带参的装饰器函数</li>
<li>使用@functionname(参数列表)方式调用</li>
<li>可以看做在装饰器外层又加了一层函数</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将记录的功能提取出来，这样就可以通过外部提供的函数来灵活的控制输出</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(duration,func=lambda name,duration:print<span class="params">(<span class="string">'&#123;&#125; took &#123;&#125;s'</span>.format<span class="params">(name,duration)</span>)</span>)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_logger</span><span class="params">(fn)</span>:</span></span><br><span class="line"><span class="meta">        @copy_properties(fn)   # wrapper = wrapper(fn)(wrapper)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">            start = datetime.datetime.now()</span><br><span class="line">            ret = fn(*args,**kwargs)</span><br><span class="line">            delta = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">            <span class="keyword">if</span> delta &gt; duration:</span><br><span class="line">                func(fn.__name__,duration)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> _logger</span><br></pre></td></tr></table></figure>
<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取函数的执行时长，对超过阈值的函数记录一下</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(t)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">            start = datetime.datetime.now()</span><br><span class="line">            ret = fn(*args,**kwargs)</span><br><span class="line">            duration = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">            <span class="keyword">if</span> duration &gt; t:</span><br><span class="line">                print(<span class="string">"function &#123;&#125; took &#123;&#125;s."</span>.format(fn.__name__,duration))</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> wrap</span><br><span class="line">    <span class="keyword">return</span> _logger</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger(3)   # add = logger(50)(add)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    print(<span class="string">"=====call add====="</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add(<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带参装饰器最多三层</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(t1,t2)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">            start = datetime.datetime.now()</span><br><span class="line">            ret = fn(*args,**kwargs)</span><br><span class="line">            duration = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">            <span class="keyword">if</span> duration &gt; t1 <span class="keyword">and</span> duration &lt; t2:</span><br><span class="line">                print(<span class="string">"function &#123;&#125; took &#123;&#125;s."</span>.format(fn.__name__,duration))</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> wrap</span><br><span class="line">    <span class="keyword">return</span> _logger</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger(3,5)   # add = logger(50)(add)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    print(<span class="string">"=====call add====="</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add(<span class="number">5</span>,<span class="number">6</span>)) </span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@logger  # 这里等价于add1 = logger(add1)，加了@实际就是把其下面的函数拿来做参数转入这个加了@函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add1</span><span class="params">(x,y)</span>:</span>  <span class="comment"># 这样做完，add1就变成了上面的logger函数中的return 10了</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add1)</span><br><span class="line"><span class="comment"># 这里借用了装饰器的语法，但并没有对函数进行装饰</span></span><br></pre></td></tr></table></figure>
<h3 id="文档字符串"><a href="#文档字符串" class="headerlink" title="文档字符串"></a>文档字符串</h3><ul>
<li>python的文档<ul>
<li>python是文档字符串Documentation Strings</li>
<li>在函数语句块的第一行，且习惯是多行的文本，所以多使用三引号</li>
<li>惯例是首字母大写，第一行写概述，空一行，第三行写详细描述</li>
<li>可以使用特殊属性<code>__doc__</code>访问这个文档</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="string">"""This is a function of addition"""</span></span><br><span class="line">    a = x + y</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(<span class="string">"name=&#123;&#125;\ndoc=&#123;&#125;"</span>.format(add.__name__,add.__doc__))</span><br><span class="line">print(help(add))</span><br></pre></td></tr></table></figure>
<h3 id="functools模块"><a href="#functools模块" class="headerlink" title="functools模块"></a>functools模块</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">- functools.update_wrapper(wrapper,wrapped,assigned=WRAPPER_ASSIGNMENTS,updated=WRAPPER_UPDATES)</span><br><span class="line">- 类似copy_properties功能</span><br><span class="line">- wrapper：包装函数、被更新者，wrapped：被包装函数、数据源</span><br><span class="line">- 元组WRAPPER_ASSIGNMENTS中是要被覆盖的属性</span><br><span class="line">- <span class="string">'__module__'</span>，<span class="string">'__name__'</span>，<span class="string">'__qualname__'</span>，<span class="string">'__doc__'</span>，<span class="string">'__annotations__'</span></span><br><span class="line">- 表示模块名、名称、限定名、文档、参数详解</span><br><span class="line">- 元组WRAPPER_UPDATES中是要被更新的属性，__dict__属性字典</span><br><span class="line">- 增加一个__wrapped__属性，保留着wrapped函数</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> datetime,time,functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(duration,func=lambda name,duration:print<span class="params">(<span class="string">'&#123;&#125; took &#123;&#125;s'</span>.format<span class="params">(name,duration)</span>)</span>)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_logger</span><span class="params">(fn)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">            start = datetime.datetime.now()</span><br><span class="line">            ret = fn(*args,**kwargs)</span><br><span class="line">            delta = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">            <span class="keyword">if</span> delta &gt; duration:</span><br><span class="line">                func(fn.__name__,duration)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> functools.update_wrapper(wrapper,fn)</span><br><span class="line">    <span class="keyword">return</span> _logger</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger(5)   # add = logger(5)(add)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add(<span class="number">5</span>,<span class="number">6</span>),add.__name__,add.__wrapped__,add.__dict__,sep=<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">- @functools.wraps(wrapped,assigned=WRAPPER_ASSIGNMENTS,updated=WRAPPER_UPDATES)</span><br><span class="line">- 类似copy_properties功能</span><br><span class="line">- wrapped被包装函数</span><br><span class="line">- 元组WRAPPER_ASSIGNMENTS中是要被覆盖的属性</span><br><span class="line">- <span class="string">'__module__'</span>，<span class="string">'__name__'</span>，<span class="string">'__qualname__'</span>，<span class="string">'__doc__'</span>，<span class="string">'__annotations__'</span></span><br><span class="line">- 表示模块名、名称、限定名、文档、参数详解</span><br><span class="line">- 元组WRAPPER_UPDATES中是要被更新的属性，__dict__属性字典</span><br><span class="line">- 增加一个__wrapped__属性，保留着wrapped函数</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> datetime,time,functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logger</span><span class="params">(duration,func=lambda name,duration:print<span class="params">(<span class="string">'&#123;&#125; took &#123;&#125;s'</span>.format<span class="params">(name,duration)</span>)</span>)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_logger</span><span class="params">(fn)</span>:</span></span><br><span class="line"><span class="meta">        @functools.wraps(fn)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kwargs)</span>:</span></span><br><span class="line">            start = datetime.datetime.now()</span><br><span class="line">            ret = fn(*args,**kwargs)</span><br><span class="line">            delta = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">            <span class="keyword">if</span> delta &gt; duration:</span><br><span class="line">                func(fn.__name__,duration)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> _logger</span><br><span class="line"></span><br><span class="line"><span class="meta">@logger(5)   # add = logger(5)(add)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add(<span class="number">5</span>,<span class="number">6</span>),add.__name__,add.__wrapped__,add.__dict__,sep=<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/18/python基础学习-高阶函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/18/python基础学习-高阶函数/" itemprop="url">
                  python基础学习-高阶函数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-18 13:58:23" itemprop="dateCreated datePublished" datetime="2019-11-18T13:58:23+08:00">2019-11-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-11-19 08:36:50" itemprop="dateModified" datetime="2019-11-19T08:36:50+08:00">2019-11-19</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><ul>
<li>First Class Object<ul>
<li>函数在Python中是一等公民</li>
<li>函数也是对象，可调用的对象</li>
<li>函数可以作为普通变量、参数、返回值等等</li>
</ul>
</li>
<li><p>高阶函数</p>
<ul>
<li>数学概念<code>y=g(f(x))</code></li>
<li>在数学和计算机科学中，高阶函数应当是至少满足下面一个条件的函数<ul>
<li>接受一个或多个函数作为参数</li>
<li>输出一个函数</li>
</ul>
</li>
</ul>
</li>
<li><p>计数器</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">(base)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">(step=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> base</span><br><span class="line"><span class="comment"># 这里因为base是自由变量，在inc函数中 base += step是在重新赋值，所以要加上nonlocal，让inc函数向上一级且不是global环境找base函数</span></span><br><span class="line">        base += step</span><br><span class="line">        <span class="keyword">return</span> base</span><br><span class="line">    <span class="keyword">return</span> inc</span><br><span class="line"></span><br><span class="line">foo = counter(<span class="number">10</span>)</span><br><span class="line">foo1 = counter(<span class="number">10</span>)</span><br><span class="line">foo == foo1</span><br><span class="line">输出：</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line"><span class="comment"># 内存分为堆和栈，在堆内存中做对象的创建，栈是相对有限的空间，堆比栈大一些，但堆里是乱的(实际没这么乱，</span></span><br><span class="line"><span class="comment"># 只是这样理解)，所以虚拟机才要回收走。我们在堆上创建两个对象foo和foo1，这两个对象都是inc创建出来的，</span></span><br><span class="line"><span class="comment"># 这都是因为调用 counter()之后，inc又赋值给了foo和foo1，foo和foo1变量实际不在这，所以看到foo和foo1</span></span><br><span class="line"><span class="comment"># 的地址不一样。当第一次调用counter()时，counter会压栈，counter的参数也压栈，压栈后要创建一段栈帧，</span></span><br><span class="line"><span class="comment"># 创建栈帧后，里面要创建临时对象。这个对象就是inc，inc要把它的函数体执行完才能把inc赋值给foo，因为执行</span></span><br><span class="line"><span class="comment"># 完inc最后要return，那么return后，从return base以上就全部消失了，因为栈里要清空，之后就要以把函数</span></span><br><span class="line"><span class="comment"># 的return值赋给foo了。foo1的过程是一样的，但foo1是inc在堆里重新创建的对象，所以foo和foo1是两个完全</span></span><br><span class="line"><span class="comment"># 不一样的对象。因为两个对象foo和foo1在堆中没有消亡，所以两个指向对象的函数inc在堆中也没有消亡。</span></span><br><span class="line">id(foo)</span><br><span class="line">输出：<span class="number">140341302380608</span></span><br><span class="line">id(foo1)</span><br><span class="line">输出：<span class="number">140341302381832</span></span><br></pre></td></tr></table></figure>
<ul>
<li>分析<ul>
<li>函数counter是不是一个高阶函数</li>
<li>上面代码有没有什么问题？怎么改进</li>
<li>如何调用完成计数功能</li>
<li><code>foo = counter(10)</code>和<code>foo1 = counter(10)</code>，请问foo和foo1相等吗？</li>
</ul>
</li>
</ul>
<h3 id="自定义sort函数"><a href="#自定义sort函数" class="headerlink" title="自定义sort函数"></a>自定义sort函数</h3><ul>
<li>排序问题<ul>
<li>依照内建函数sorted，请自行实现一个sort函数（不使用内建函数），能够为列表元素排序</li>
</ul>
</li>
<li>思路<ul>
<li>内建函数sorted函数是返回一个新的列表，可以设置升序或降序，可以设置一个排序的函数。自定义的sort函数也要实现这个功能</li>
<li>新建一个列表，遍历原列表，和新列表的值依次比较决定如何插入到新列表中</li>
</ul>
</li>
<li>思考<ul>
<li>sorted函数的实现原理，扩展到map、filter函数的实现原理</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sort函数实现。下面实现的什么排序？还能怎么改变</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">(iterable)</span>:</span></span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">for</span> i,y <span class="keyword">in</span> enumerate(ret):   </span><br><span class="line">        <span class="comment"># 使用enumerate是为了给列表中的元素添加上索引，以方便下面比较。比较会将iterable中的数字与所</span></span><br><span class="line">        <span class="comment"># 有ret列表中的数字比较，比较一次就进行一次下面的操作，当每轮全部比较完时，iterable中的数字也</span></span><br><span class="line">        <span class="comment"># 就找到了在ret列表中应该放的确切位置</span></span><br><span class="line">            <span class="keyword">if</span> x &gt; y:   <span class="comment"># 找到大的就地插入。如果换成x &lt; y呢，函数什么意思呢？</span></span><br><span class="line">                ret.insert(i,x)   <span class="comment"># 降序</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:   <span class="comment"># 不大于，说明是最小的，尾部追加</span></span><br><span class="line">                ret.append(x)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"><span class="comment"># 开始这里是没有函数的，但我们认为if x &gt; y: 可以利用函数把它变成更加灵活的表现形式，要把它抽象出来，可</span></span><br><span class="line"><span class="comment"># 以先写成一个if三元的形式，然后把它抽象成一个内部的函数，之后再把它变成一个外部函数，变成外部函数后要把</span></span><br><span class="line"><span class="comment"># 它的形参和本地变量去掉，变成一个通用的函数。函数的封装要通用，它尽量不要直接引用外部的变量，除了在嵌套</span></span><br><span class="line"><span class="comment"># 函数中使用闭包的时候。写函数的原则是，外部变量都应该不是通过可见性来访问的，而是通过传参的方式传递给你</span></span><br><span class="line"><span class="comment"># 的。核心的逻辑，如果是可变的，把它提取出去，作为参数传递进来，因为函数是一等公民</span></span><br><span class="line">print(sort([<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># sort函数实现。用一个参数控制顺序</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">(iterable,reverse=False)</span>:</span></span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">for</span> i,y <span class="keyword">in</span> enumerate(ret):</span><br><span class="line">            flag = x &gt; y <span class="keyword">if</span> reverse <span class="keyword">else</span> x &lt; y</span><br><span class="line">            <span class="keyword">if</span> flag:   <span class="comment"># 是否能进一步改进</span></span><br><span class="line">                ret.insert(i,x)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ret.append(x)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">print(sort([<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># sort函数实现。下面实现的什么排序？还能怎么改变</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">(iterable,key=kambda a,b:a&gt;b)</span>:</span></span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">for</span> i,y <span class="keyword">in</span> enumerate(ret):</span><br><span class="line">            <span class="keyword">if</span> key(x,y):   <span class="comment"># 函数的返回值是bool</span></span><br><span class="line">                ret.insert(i,x)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ret.append(x)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">print(sort([<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># sort函数实现</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">(iterable,reverse=False,key=lambda x,y:x&lt;y)</span>:</span></span><br><span class="line">    ret = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">for</span> i,y <span class="keyword">in</span> enumerate(ret):</span><br><span class="line">            flag = key(x,y) <span class="keyword">if</span> <span class="keyword">not</span> reverse <span class="keyword">else</span> <span class="keyword">not</span> key(x,y)</span><br><span class="line">            <span class="keyword">if</span> flag:</span><br><span class="line">                ret.insert(i,x)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ret.append(x)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">print(sort([<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>]))</span><br></pre></td></tr></table></figure>
<h3 id="内建函数-高阶函数"><a href="#内建函数-高阶函数" class="headerlink" title="内建函数-高阶函数"></a>内建函数-高阶函数</h3><ul>
<li><code>sorted(iterable[,key][,reverse])</code><ul>
<li>排序</li>
<li>返回一个新的列表，对一个可迭代对象的所有元素排序，排序规则为key定义的函数，reverse表示是否排序翻转</li>
<li><code>sorted(lst,key=lambda x:6-x)</code>   返回新列表</li>
<li><code>list.sort(key=lambda x:6-x)</code>   就地修改</li>
</ul>
</li>
<li><code>filter(function,iterable)</code>-&gt;<code>filter object</code><ul>
<li>过滤数据</li>
<li>过滤可迭代对象的元素，返回一个迭代器</li>
<li>function一个具有一个参数的函数，返回bool</li>
<li>例如，过滤出数列中能被3整除的数字<ul>
<li><code>list(filter(lambda x:x%3 == 0,[1,9,55,150,-3,78,28,123]))</code></li>
<li>因为x%3 == 0是一个逻辑表达式，那一定会返回True或False，这个表达式的值就是return值，所以这里返回的是一个bool类型。把x%3 == 0可以改为0或True，效果是怎样的？</li>
</ul>
</li>
</ul>
</li>
<li><code>map(func,*iterables)</code> -&gt; <code>map object</code><ul>
<li>映射</li>
<li>对多个可迭代对象的元素按照指定的函数进行映射，返回一个迭代器<ul>
<li><code>list(map(lambda x:2*x+1,range(5)))</code></li>
<li><code>dict(map(lambda x:(x%5,x),range(500)))</code><ul>
<li>只会显示下面5个信息是因为通过key过滤掉重复数据了?</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="柯里化-Currying"><a href="#柯里化-Currying" class="headerlink" title="柯里化 Currying"></a>柯里化 Currying</h3><ul>
<li>柯里化<ul>
<li>指的是将原来接受两个参数的函数变成新的接受一个参数的函数的过程。新的函数返回一个以原有第二个参数为参数的函数</li>
<li><code>z = f(x,y)</code>转换成<code>z = f(x)(y)</code>的形式</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 举例：将加法函数柯里化</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"><span class="comment"># 转换如下：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_add</span><span class="params">(y)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    <span class="keyword">return</span> _add   <span class="comment"># 这里应该返回一个函数</span></span><br><span class="line">add(<span class="number">5</span>)(<span class="number">6</span>)</span><br><span class="line"><span class="comment"># 通过嵌套数就可以把函数转换成柯里化函数</span></span><br><span class="line"><span class="comment"># 我们需要将add(4,5) ==&gt; add(4)(5) ==&gt; func(5) ==&gt; func=add(4)</span></span><br><span class="line">foo = add(<span class="number">4</span>)</span><br><span class="line">print(foo(<span class="number">5</span>))</span><br><span class="line"><span class="comment"># 等价于下面的写法</span></span><br><span class="line">pinrt(add(<span class="number">4</span>)(<span class="number">5</span>))</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/15/ngrok简单配置与使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/15/ngrok简单配置与使用/" itemprop="url">
                  ngrok简单配置与使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-15 17:08:50 / 修改時間：17:41:28" itemprop="dateCreated datePublished" datetime="2019-11-15T17:08:50+08:00">2019-11-15</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/网络/" itemprop="url" rel="index"><span itemprop="name">网络</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>​    ngrok是一个内网穿透的解决方案，它可以使你通过公网服务器连接到你本地的服务器</p>
<h3 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--------------</span><br><span class="line">   公网服务器</span><br><span class="line">--------------</span><br><span class="line">yum install -y gcc git mercurial bzr subversion golang golang-pkg-windows-amd64 golang-pkg-windows-386</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装所需包</span></span><br><span class="line">git clone https://github.com/inconshreveable/ngrok.git</span><br><span class="line"><span class="meta">#</span><span class="bash"> 克隆到本地</span></span><br></pre></td></tr></table></figure>
<h3 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cd ngrok</span><br><span class="line">mkdir cert</span><br><span class="line">cd cert</span><br><span class="line">export NGROK_DOMAIN="abc.com"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里的域名就是你要访问的域名，需要在互联网可以解析到</span></span><br><span class="line">openssl genrsa -out rootCA.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key rootCA.key -subj "/CN=$NGROK_DOMAIN" -days 5000 -out rootCA.pem</span><br><span class="line">openssl genrsa -out device.key 2048</span><br><span class="line">openssl req -new -key device.key -subj "/CN=$NGROK_DOMAIN" -out device.csr</span><br><span class="line">openssl x509 -req -in device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成密钥</span></span><br><span class="line">cp rootCA.pem ../assets/client/tls/ngrokroot.crt </span><br><span class="line">cp device.crt ../assets/server/tls/snakeoil.crt </span><br><span class="line">cp device.key ../assets/server/tls/snakeoil.key </span><br><span class="line"><span class="meta">#</span><span class="bash"> 将密钥复制到指定位置</span></span><br><span class="line">cd ..</span><br><span class="line">GOOS=linux GOARCH=amd64 make release-server</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成服务端包</span></span><br><span class="line">GOOS=linux GOARCH=amd64 make release-client</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成linux客户端名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> windows客户端</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> GOOS=windows GOARCH=amd64 make release-client</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> GOOS=windows GOARCH=386 make release-client</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MacOS客户端</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> GOOS=darwin GOARCH=amd64 make release-client</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> GOOS=darwin GOARCH=386 make release-client</span></span><br><span class="line">./bin/ngrokd -domain="$NGROK_DOMAIN" -httpAddr=":28080" -httpsAddr=":28443" -tunnelAddr=":24443"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定端口并启动ngrok服务，如果不指定端口，http默认端口80，https默认端口443，tunnel默认端口4443，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tunnel端口是服务端与客户端联系的端口</span></span><br></pre></td></tr></table></figure>
<h3 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">登录服务器下载上面生成的客户端包，因为使用的是ubuntu客户端，所以下载ngrok包就可以了</span><br><span class="line">vim ngrok.cfg                                                                   </span><br><span class="line">server_addr: "abc.com:24443"</span><br><span class="line">trust_host_root_certs: false</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加一个ngrok的配置文件，注意这个文件是yaml文件，所以对格式要求很严格。冒号与后面引号之间是有空格的。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置的配置文件可以放在家目录，叫.ngrok</span></span><br><span class="line">./ngrok -config ngrok.cfg -proto=tcp 22</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这样可以启动客户端，这里用-config指定了配置文件，本地与服务器都使用tcp协议，本地监听22端口，服务器会</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 监听一个随机端口，本地要监听哪个端口，要取决于要连接的服务监听的端口，如这里要使用ssh服务，输出如下：</span></span><br><span class="line">ngrok                                                                                    </span><br><span class="line">Tunnel Status                 online   # 这里要变成online才是正常，开始是connecting</span><br><span class="line">Version                       1.7/1.7</span><br><span class="line">Forwarding                    tcp://abc.com:38139 -&gt; 127.0.0.1:22</span><br><span class="line">Web Interface                 127.0.0.1:4040</span><br><span class="line"><span class="meta">#</span><span class="bash"> Conn                        1</span></span><br><span class="line">Avg Conn Time                 24193.12ms                                               </span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里有一个问题，当连接成功后，域名是没有前缀的。所有添加域名解析时，就直接解析域名即可。使用这种方法可</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以添加不同的端口映射到本地，如3389端口。但这里的问题是，服务器一端打开的随机端口，所以每次都需要手动修</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 改安全组的配置，放开指定端口</span></span><br><span class="line"></span><br><span class="line">./ngrok -subdomain ngrok -config=./ngrok.cfg</span><br><span class="line"><span class="meta">#</span><span class="bash"> -subdomain指定域名的前缀，如域名是abc.com，那么连接后就是ngrok.abc.com，这样启动客户端后要监听80</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 端口。这里如果加了域名前缀，那么在添加域名解析时，就要在添加A记录时，添加一个泛域名解析，如*.ngrok</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/14/python基础学习-生成器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/14/python基础学习-生成器/" itemprop="url">
                  python基础学习-生成器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-14 11:26:56 / 修改時間：14:58:55" itemprop="dateCreated datePublished" datetime="2019-11-14T11:26:56+08:00">2019-11-14</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><ul>
<li>生成器 generator ***<ul>
<li>生成器指的是生成器对象，可以由生成器表达式得到，也可以使用yield关键字得到一个生成器函数，调用这个函数得到一个生成器对象</li>
</ul>
</li>
<li>生成器函数<ul>
<li>函数体中包含yield语句的函数就是生成器函数，返回生成器对象</li>
<li>生成器对象，是一个可迭代对象，是一个迭代器。迭代器一定是一个可迭代对象，但可迭代对象不一定是迭代器</li>
<li>生成器对象，是延迟计算、惰性求值的</li>
<li>包含yield语句的生成器函数生成<strong><em>生成器对象</em></strong>的时候，<strong><em>生成器函数的函数体不会立即执行</em></strong></li>
<li>next(generator)会从函数的当前位置向后执行到之后碰到的第一个yield语句，会弹出值，并暂停函数执行</li>
<li>再次调用next函数，和上一条一样的处理过程</li>
<li>没有多余的yield语句能被执行，继续调用next函数，会抛出StopIteration异常</li>
<li>通过生成器表达式或生成器函数就可以得到一个生成器对象或简称生成器</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line">print(type(inc))   <span class="comment"># 返回函数类型，因为inc是标识符</span></span><br><span class="line">print(type(inc()))   <span class="comment"># 返回值是generator类型，是生成器对象</span></span><br><span class="line"></span><br><span class="line">x = inc()</span><br><span class="line">print(type(x))</span><br><span class="line">print(next(x))</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> x:</span><br><span class="line">    print(m,<span class="string">'*'</span>)</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> x:  <span class="comment"># 不会进入这里执行</span></span><br><span class="line">    print(m,<span class="string">'**'</span>)</span><br><span class="line">输出：</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">function</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">generator</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">generator</span>'&gt;</span></span><br><span class="line"><span class="class">0</span></span><br><span class="line"><span class="class">1 *</span></span><br><span class="line"><span class="class">2 *</span></span><br><span class="line"><span class="class">3 *</span></span><br><span class="line"><span class="class">4 *</span></span><br><span class="line"><span class="class"># 普通的函数调用<span class="title">fn</span><span class="params">()</span>，函数会立即执行完毕，因为用的是<span class="title">return</span>语句，但是生成器函数可以使用<span class="title">next</span>函数多次执行</span></span><br><span class="line"><span class="class"># 生成器函数等价于生成器表达式，只不过生成器函数可以更加的复杂。</span></span><br><span class="line"><span class="class"></span></span><br><span class="line">y = (i for i in range(5))</span><br><span class="line">print(type(y))</span><br><span class="line">print(type(y))</span><br><span class="line">print(type(y))</span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'line 1'</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    print(<span class="string">'line 2'</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    print(<span class="string">'line 3'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>    <span class="comment"># 生成器内一般不会加return语句</span></span><br><span class="line"></span><br><span class="line">next(gen())  <span class="comment"># line 1 遇到yield暂停，之后跳到下一句next(gen())执行</span></span><br><span class="line"><span class="comment"># 有yiele语句就会是一个生成器，这里调用一次这个gen()函数，就会返回一个生成器对象，生成器对象要拨一下转</span></span><br><span class="line"><span class="comment"># 一下，转到第一次遇到yield的时候，会返回1给next()，但我们不关心，print函数第一次返回line 1。</span></span><br><span class="line"><span class="comment"># 遇到yield语句就要暂停一下，yield语句就是拨一下转一下，是next函数在拨它，执行到第一次碰到yield为止。</span></span><br><span class="line"><span class="comment"># 所以第一次返回line 1，这个返回值我们是可以拿到的。(***return会终止当前函数执行，yield不会终止当前</span></span><br><span class="line"><span class="comment"># 函数执行，而是暂停到yield，这个暂停很特别，一般地如果一个函数没有执行完是不能执行下一句的。但这里没有</span></span><br><span class="line"><span class="comment"># 执行完gen()函数，而直接跳到了下一个gen()函数去执行了。***)yield有让出的意思，这里yield就让出了函</span></span><br><span class="line"><span class="comment"># 数，让出了当前的控制，给下一个语句，这里就是让给下一个next(gen())执行，让出给谁并不重要。所以执行第</span></span><br><span class="line"><span class="comment"># 二次gen()又生成了一个生成器，之后又重新开始执行，这是一个新的gen()函数调用，所以还是返回line 1。函</span></span><br><span class="line"><span class="comment"># 数随着调用的结束而消亡了，所以第二次调用会重新开始。</span></span><br><span class="line">next(gen())  <span class="comment"># line 1 </span></span><br><span class="line">g = gen()  <span class="comment"># 这里是第三次生成一个生成器对象并赋给了变量g</span></span><br><span class="line">print(next(g)) </span><br><span class="line"><span class="comment"># line 1   # 执行到这里先打印一个line 1，然后 yield返回一个1，这回next(g)是拨同一个生成器对象了，</span></span><br><span class="line"><span class="comment"># 因为用print包裹起来了，所以还会打印一个1，</span></span><br><span class="line"><span class="comment"># print </span></span><br><span class="line">print(next(g)) <span class="comment"># line 2  # 这里是又拨了g函数一下，所以找下一个yield，先打印line 2，再打印2</span></span><br><span class="line">print(next(g))  <span class="comment"># StopIteration  这里先打印一个line 3，之后没有yield了，而且我们使用了next</span></span><br><span class="line"><span class="comment"># 函数调用，next函数是找下一个yield的，也就是找下一个生成器对象的值的，而不是找return的，因为找不到</span></span><br><span class="line"><span class="comment"># yield，所以返回StopIteration。最后一句也不会执行了。如果注释这一行就不会报错了，因为next是找下一个</span></span><br><span class="line"><span class="comment"># yield的，但没有了，这里会抛异常，但我们给了一个缺省值'End'，所以打印‘End'，而不会抛异常</span></span><br><span class="line">print(next(g, <span class="string">'End'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个生成器函数中，可以有多个yield表达式或return语句，碰到return，这个函数就结束了，但生成器对象还</span></span><br><span class="line"><span class="comment"># 在，因为引用还在，但每一次next都是要找到下一个yield</span></span><br><span class="line"><span class="comment"># 这里为什么用next()调用就会重新调用函数，一直返回line 1，而用print(next())就会在函数中继续向下执</span></span><br><span class="line"><span class="comment"># 行？这与g = gen()有关系，这一句是将gen()函数调用的值都赋给了g，而且是一个generator类型，用next()</span></span><br><span class="line"><span class="comment"># 一直取g的下一个值，所以会显示line 1 1 line 2 2。如果用print(next(gen()))，这一样会一直显示line 1</span></span><br><span class="line">- 在生成器函数中，使用多个<span class="keyword">yield</span>语句，执行一次后会暂停执行，把<span class="keyword">yield</span>表达式的值返回</span><br><span class="line">- 再次执行会执行到下一个<span class="keyword">yield</span>语句</span><br><span class="line">- <span class="keyword">return</span>语句依然可以终止函数运行，但<span class="keyword">return</span>语句的返回值不能被获取到</span><br><span class="line">- <span class="keyword">return</span>会导致无法继续获取下一个值，抛出StopIteration异常</span><br><span class="line">- 如果函数没有显示的<span class="keyword">return</span>语句，如果生成器函数执行到结尾，一样会抛出StopIteration异常</span><br></pre></td></tr></table></figure>
<h3 id="生成器应用"><a href="#生成器应用" class="headerlink" title="生成器应用"></a>生成器应用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 无限循环</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> next(c)</span><br><span class="line">c = counter()</span><br><span class="line">print(inc(c))</span><br><span class="line">print(inc(c))</span><br><span class="line">输出：</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">()</span>:</span></span><br><span class="line">    c = counter()</span><br><span class="line">    <span class="keyword">return</span> next(c)</span><br><span class="line"></span><br><span class="line">print(inc())</span><br><span class="line">print(inc())</span><br><span class="line">print(inc())</span><br><span class="line">输出：</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="comment"># 执行了三次print(inc())，因为每次都创建一个生成器对象inc()，所以并不是同一个生成器对象，所以打印三次1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计数器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line">    c = counter()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">lambda</span>:next(c)   <span class="comment"># c对于lambda来讲是自由变量，这里是一个闭包</span></span><br><span class="line">foo = inc()</span><br><span class="line">print(foo())</span><br><span class="line">print(foo())</span><br><span class="line"><span class="comment"># inc()函数调用的返回值是lambda:next(c)，lambda:next(c)不是生成器而只是拨了一下c，</span></span><br><span class="line"><span class="comment"># lambda:next(c)是一个新的函数，新的函数中并没有yield语句。counter()才是生成器函数。c是生成器对象，</span></span><br><span class="line"><span class="comment"># 我们在lambda函数中拨它，所以foo只是lambda函数的引用值，之后再调用 foo()函数，这相当于在拨c，所以这里输出1和2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># lambda表达式是匿名函数</span></span><br><span class="line"><span class="comment"># return返回的是一个匿名函数</span></span><br><span class="line"><span class="comment"># 等价于下面的代码</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">()</span>:</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line">   c = counter()</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">_inc</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> next(c)</span><br><span class="line">   <span class="keyword">return</span> _inc</span><br><span class="line"><span class="comment"># 上面三行相当于之前的lambda:next(c)</span></span><br><span class="line">foo = inc()</span><br><span class="line">print(foo())</span><br><span class="line">print(foo())</span><br><span class="line">print(foo())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理递归问题</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">0</span> </span><br><span class="line">    y = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> y</span><br><span class="line">        x,y = y,x+y</span><br><span class="line">        </span><br><span class="line">foo = fib()</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    print(next(foo))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    next(foo)</span><br><span class="line">print(next(foo))    </span><br><span class="line"><span class="comment"># 等价于下面的代码</span></span><br><span class="line">pre = <span class="number">0</span></span><br><span class="line">cur = <span class="number">1</span>  <span class="comment"># No1</span></span><br><span class="line">print(pre,cur,end=<span class="string">' '</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recursion</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib1</span><span class="params">(n,pre=<span class="number">0</span>,cur=<span class="number">1</span>)</span>:</span></span><br><span class="line">    pre,cur = cur,pre+cur</span><br><span class="line">    print(cur,end=<span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    fib1(n<span class="number">-1</span>,pre,cur)</span><br></pre></td></tr></table></figure>
<ul>
<li>协程 coroutine<ul>
<li>生成器的高级用法</li>
<li>比进程、线程轻量级</li>
<li>是在用户空间调度函数的一种实现</li>
<li>Python3 asyncio就是协程实现，已经加入到标准库</li>
<li>Python3.5 使用 async、await关键字直接原生支持协程</li>
<li>协程调度器实现思路<ul>
<li>有2个生成器A、B</li>
<li>next(A)后，A执行到了yield语句暂停，然后去执行next(B)，B执行到yield语句也暂停，然后再次调用 next(A)，再调用next(B)，周而复始，就实现了调度的效果</li>
<li>可以引入调度的策略来实现切换的方式</li>
</ul>
</li>
<li>协程是一种非抢占式调度</li>
</ul>
</li>
</ul>
<h3 id="yield-from"><a href="#yield-from" class="headerlink" title="yield from"></a>yield from</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">        <span class="keyword">yield</span> x</span><br><span class="line">        </span><br><span class="line">foo = inc()</span><br><span class="line">print(next(foo))</span><br><span class="line">print(next(foo))</span><br><span class="line">print(next(foo))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等价于下面的代码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> range(<span class="number">1000</span>)</span><br><span class="line">    <span class="comment"># 这一种代码相当于上面的for循环的两句代码</span></span><br><span class="line">foo = inc()</span><br><span class="line">print(next(foo))</span><br><span class="line">print(next(foo))</span><br><span class="line">print(next(foo))</span><br></pre></td></tr></table></figure>
<ul>
<li><p>yield from是Python3出现的新的语法</p>
</li>
<li><p>yield from iterable 是 for item in iterable: yield item 形式的讲法糖</p>
<ul>
<li>从可迭代对象中一个个拿元素</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">counter</span><span class="params">(n)</span>:</span>   <span class="comment"># 生成器、迭代器</span></span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> range(n):</span><br><span class="line">		<span class="keyword">yield</span> x</span><br><span class="line">          </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">inc</span><span class="params">(n)</span>:</span></span><br><span class="line">		<span class="keyword">yield</span> <span class="keyword">from</span> counter(n)</span><br><span class="line">          </span><br><span class="line">foo = inc(<span class="number">10</span>)</span><br><span class="line">print(next(foo))</span><br><span class="line">print(next(foo))</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/13/python基础学习-匿名函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/13/python基础学习-匿名函数/" itemprop="url">
                  python基础学习-匿名函数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-13 13:50:23" itemprop="dateCreated datePublished" datetime="2019-11-13T13:50:23+08:00">2019-11-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-11-15 08:46:05" itemprop="dateModified" datetime="2019-11-15T08:46:05+08:00">2019-11-15</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><ul>
<li>匿名，即没有名字</li>
<li>匿名函数，即没有名字的函数<ul>
<li>没有名字如何定义</li>
<li>没有名字如何调用</li>
<li>如果能调用，如何使用</li>
</ul>
</li>
<li>python借助Lambda表达式构建匿名函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：<span class="keyword">lambda</span> 参数列表: 表达式</span><br><span class="line"><span class="keyword">lambda</span> x:x**<span class="number">2</span></span><br><span class="line">(<span class="keyword">lambda</span> x:x**<span class="number">2</span>)(<span class="number">4</span>)  <span class="comment"># 调用</span></span><br><span class="line">输出：<span class="number">16</span></span><br><span class="line">foo = <span class="keyword">lambda</span> x,y:(x+y)**<span class="number">2</span>  <span class="comment"># 不推荐这么用</span></span><br><span class="line">foo(<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x,y)</span>:</span>  <span class="comment"># 建议使用普通函数</span></span><br><span class="line">    <span class="keyword">return</span>(x+y)**<span class="number">2</span></span><br><span class="line">foo(<span class="number">2</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>使用lambda关键字来定义匿名函数</li>
<li>参数列表不需要小括号</li>
<li>冒号是用来分割参数列表和表达式的</li>
<li>不需要使用return，表达式的值，就是匿名函数返回值</li>
<li>lambda表达式(匿名函数)只能写在一行上，被称为单行函数</li>
<li>用途<ul>
<li>在高阶函数传参时，使用lambda表达式，往往能简化代码</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">lst = [<span class="number">1</span>]</span><br><span class="line"><span class="comment"># lst.sort?</span></span><br><span class="line"><span class="comment"># key=None,reverse=False</span></span><br><span class="line">lst.sort(key=str)</span><br><span class="line">lst.append(<span class="string">'a'</span>)</span><br><span class="line"><span class="comment"># lst.sort()</span></span><br><span class="line"><span class="comment"># 没办法比较，因为类型不一样，需要统一类型</span></span><br><span class="line">lst.sort(key=str)   <span class="comment"># 送进去一个函数，和lambda函数一样，都是送进去函数</span></span><br><span class="line">lst.append(<span class="number">2</span>)</span><br><span class="line">lst.sort(key=str)   <span class="comment"># 这里key就是向进传函数的</span></span><br><span class="line">lst </span><br><span class="line"></span><br><span class="line">print((<span class="keyword">lambda</span> :<span class="number">0</span>)())</span><br><span class="line"><span class="comment"># 上面一句相当于</span></span><br><span class="line"><span class="comment"># def fn():</span></span><br><span class="line"><span class="comment">#     return 0</span></span><br><span class="line">print((<span class="keyword">lambda</span> x,y=<span class="number">3</span>:x+y)(<span class="number">5</span>))</span><br><span class="line">print((<span class="keyword">lambda</span> x,y=<span class="number">3</span>:x+y)(<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line">输出：<span class="number">11</span></span><br><span class="line">print((<span class="keyword">lambda</span> x,*,y=<span class="number">30</span>:x+y)(<span class="number">5</span>))</span><br><span class="line">输出：<span class="number">35</span></span><br><span class="line">print((<span class="keyword">lambda</span> x,*,y=<span class="number">30</span>:x+y)(<span class="number">5</span>,y=<span class="number">10</span>))</span><br><span class="line">输出：<span class="number">15</span></span><br><span class="line">print((<span class="keyword">lambda</span> *args:(x <span class="keyword">for</span> x <span class="keyword">in</span> args))(*range(<span class="number">5</span>)))</span><br><span class="line">输出：&lt;generator object &lt;<span class="keyword">lambda</span>&gt;.&lt;locals&gt;.&lt;genexpr&gt; at <span class="number">0x7f056cf7c138</span>&gt;</span><br><span class="line">print((<span class="keyword">lambda</span> *args:[x+<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> args])(*range(<span class="number">5</span>)))</span><br><span class="line">输出：[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">print((<span class="keyword">lambda</span> *args:&#123;x+<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> args&#125;)(*range(<span class="number">5</span>)))</span><br><span class="line">输出：&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br><span class="line">[x <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="keyword">lambda</span> *args:map(<span class="keyword">lambda</span> x:x+<span class="number">1</span>,args))(*range(<span class="number">5</span>))]  <span class="comment"># 高阶函数</span></span><br><span class="line">标准输出：Out:[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">[x <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="keyword">lambda</span> *args:map(<span class="keyword">lambda</span> x:(x+<span class="number">1</span>,args),args))(*range(<span class="number">5</span>))]</span><br><span class="line">标准输出：</span><br><span class="line">Out:[(<span class="number">1</span>, (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)),</span><br><span class="line"> 	 (<span class="number">2</span>, (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)),</span><br><span class="line"> 	 (<span class="number">3</span>, (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)),</span><br><span class="line"> 	 (<span class="number">4</span>, (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)),</span><br><span class="line"> 	 (<span class="number">5</span>, (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))]</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/13/python基础练习-递归函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/13/python基础练习-递归函数/" itemprop="url">
                  python基础练习-递归函数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-13 09:48:30" itemprop="dateCreated datePublished" datetime="2019-11-13T09:48:30+08:00">2019-11-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-11-15 09:13:51" itemprop="dateModified" datetime="2019-11-15T09:13:51+08:00">2019-11-15</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>求n的阶乘</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> num * func(num<span class="number">-1</span>)</span><br><span class="line">    <span class="comment"># 这是阶乘的关键，也是公式，就是总是自已乘以比自己小1的数</span></span><br><span class="line"></span><br><span class="line">func(<span class="number">5</span>)</span><br><span class="line"><span class="comment"># 执行过程是，进入函数后，直接到num * func(num-1)这一行。代入数字就是5*func(4)，func(4)再进入函</span></span><br><span class="line"><span class="comment"># 数，返回4*fun(3)，之后是3*func(2)，2*func(1)，再进入函数时，num等于1了，所以返回1。把1代入</span></span><br><span class="line"><span class="comment"># 2*func(1)，也就是2*1=2，再向上返回到3×func(2)，因为之前func(2)已经返回了2，所以这里是3*2=6，再</span></span><br><span class="line"><span class="comment"># 向上返回，代入后是4*6=24，再向上，5*24=120，这样阶乘的结果就出来了。返回条件是当条件满足时返回一个</span></span><br><span class="line"><span class="comment"># 值，之后依次向前返回并计算</span></span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(n,mu1 = <span class="number">1</span>)</span>:</span></span><br><span class="line">    mu1 *= n   </span><br><span class="line"><span class="comment"># 当前乘以当前值就完了，如果调用时n给了2，那么这里就是1*2。这里又重新给mu1赋了值，那么这时mu1就是2了</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:   <span class="comment"># 这是边界条件</span></span><br><span class="line">        <span class="keyword">return</span> mu1</span><br><span class="line">    <span class="keyword">return</span> factorial(n<span class="number">-1</span>,mu1)   </span><br><span class="line"><span class="comment"># 调用自己，这时n-1=1，mu1=2，这样再进入函数时，mul=2*1=2，n等于1,满足了条件，就会返回mu1的2</span></span><br><span class="line"></span><br><span class="line">factorial(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fac</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> n * fac(n<span class="number">-1</span>)</span><br><span class="line">fac(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fac1</span><span class="params">(n,p = <span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    p *= n</span><br><span class="line">    print(p)</span><br><span class="line">    fac1(n<span class="number">-1</span>,p)</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line">fac1(<span class="number">5</span>)</span><br><span class="line">输出：</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">60</span></span><br><span class="line"><span class="number">120</span></span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fac2</span><span class="params">(n, p = None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> p <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        p = [<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> p[<span class="number">0</span>]</span><br><span class="line">    p[<span class="number">0</span>] *= n</span><br><span class="line">    print(p[<span class="number">0</span>])</span><br><span class="line">    fac2(n<span class="number">-1</span>,p)</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">n =<span class="number">5</span></span><br><span class="line">print(fac2(n))</span><br><span class="line">输出：</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">60</span></span><br><span class="line"><span class="number">120</span></span><br><span class="line">[<span class="number">120</span>]</span><br><span class="line"><span class="comment"># fac函数性能最好，因为时间复杂度是相同的，fac最简单</span></span><br></pre></td></tr></table></figure>
<ul>
<li>将一个数逆序放入列表中，例如1234 -&gt; [4,3,2,1]</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把1234改为4321</span></span><br><span class="line">data = str(<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reversal</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> data[x] + reversal(x<span class="number">-1</span>)   </span><br><span class="line"><span class="comment"># 这是一个字符串连接，最后一次return出去。这个return才是我们可以拿到的值，上面的return是拿不到的</span></span><br><span class="line">    </span><br><span class="line">print(reversal(len(data)<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(n,lst=None)</span>:</span>  <span class="comment"># lst=None应该改为一个[]</span></span><br><span class="line">    <span class="keyword">if</span> lst <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        lst = []</span><br><span class="line">        </span><br><span class="line">    lst.append(n%<span class="number">10</span>)   <span class="comment"># 这里可以用divmod函数，可以拿到商和模两个数</span></span><br><span class="line">    <span class="keyword">if</span> n//<span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> lst</span><br><span class="line">    <span class="keyword">return</span> reverse(n//<span class="number">10</span>,lst)</span><br><span class="line"></span><br><span class="line">reverse(<span class="number">12345</span>)</span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line">data = str(<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">revert</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> data[x] + revert(x<span class="number">-1</span>)</span><br><span class="line">print(revert(len(data)<span class="number">-1</span>))</span><br><span class="line">输出：</span><br><span class="line"><span class="number">4321</span></span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">revert</span><span class="params">(n,lst=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> lst <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        lst = []</span><br><span class="line">        </span><br><span class="line">    x,y = divmod(n,<span class="number">10</span>)</span><br><span class="line">    lst.append(y)</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> lst</span><br><span class="line">    <span class="keyword">return</span> revert(x,lst)</span><br><span class="line"></span><br><span class="line">revert(<span class="number">12345</span>)</span><br><span class="line">输出：</span><br><span class="line">[<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line">num = <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">revert</span><span class="params">(num,target=[])</span>:</span>  <span class="comment"># 这里的target不是关键字参数，而是位置参数</span></span><br><span class="line">    <span class="keyword">if</span> num:  <span class="comment"># 表示当num为空时，是false，就不满足条件了</span></span><br><span class="line">        target.append(num[len(num)<span class="number">-1</span>])  <span class="comment"># target.append(num[-1:])  因为使用了切片，所以有一个copy的过程</span></span><br><span class="line">        revert(num[:len(num)<span class="number">-1</span>])</span><br><span class="line">    <span class="keyword">return</span> target   <span class="comment"># 里面return多少次都没有关系。我们只关心最外层的return出的内容</span></span><br><span class="line"></span><br><span class="line">print(revert(str(num)))</span><br><span class="line">输出：</span><br><span class="line">[<span class="string">'4'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>, <span class="string">'1'</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li>解决猴子吃桃问题。猴子第一天摘下若干个桃子，当即吃了一半，还不过瘾，又多吃了一个。第二天早上又将剩下的桃子吃掉一半，又多吃了一个。以后每天早上都吃了前一天剩下的一半零一个。到第10天早上想吃时，只剩下一个桃子了。求第一天共摘多少个桃子</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发现公式：(后一天的桃子数量+1) * 2 = 前一天的桃子数量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">peach</span><span class="params">(day=<span class="number">9</span>,sum=<span class="number">1</span>)</span>:</span></span><br><span class="line">    sum=<span class="number">2</span>*(sum+<span class="number">1</span>)</span><br><span class="line">    day-=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> day==<span class="number">0</span>:   <span class="comment"># 要循环10次，所以这里要到0</span></span><br><span class="line">        <span class="keyword">return</span> sum</span><br><span class="line">    <span class="keyword">return</span> peach(day,sum)</span><br><span class="line">print(peach())</span><br><span class="line">输出：</span><br><span class="line"><span class="number">1534</span></span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">monkey</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * monkey(n - <span class="number">1</span>) + <span class="number">2</span></span><br><span class="line"></span><br><span class="line">peach = monkey(<span class="number">10</span>)</span><br><span class="line">print(peach)</span><br><span class="line">输出：</span><br><span class="line"><span class="number">1534</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>,<span class="number">0</span>,<span class="number">-1</span>):   </span><br><span class="line">    <span class="comment"># 这里的range()一定要写成这种形式，不然会超出递归最大深度，主要因为这里如果是0就会成为列循环</span></span><br><span class="line">    print(_,<span class="string">"-&gt;"</span>,monkey(_))</span><br><span class="line">输出：</span><br><span class="line">10 -&gt; 1534</span><br><span class="line">9 -&gt; 766</span><br><span class="line">8 -&gt; 382</span><br><span class="line">7 -&gt; 190</span><br><span class="line">6 -&gt; 94</span><br><span class="line">5 -&gt; 46</span><br><span class="line">4 -&gt; 22</span><br><span class="line">3 -&gt; 10</span><br><span class="line">2 -&gt; 4</span><br><span class="line">1 -&gt; 1</span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">peach</span><span class="params">(days=<span class="number">10</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> days == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> (peach(days<span class="number">-1</span>)+<span class="number">1</span>)*<span class="number">2</span></span><br><span class="line"></span><br><span class="line">print(peach())</span><br><span class="line"><span class="comment"># 注意这里必须是10，因为return(peach(days-1)+1)*2立即拿不到结果，必须通过再一次进入函数时判断是不是</span></span><br><span class="line"><span class="comment"># 到了最后一天。也就是当前使用的值是由下一次函数调用得到，所以要执行10次函数调用</span></span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">peach</span><span class="params">(days=<span class="number">1</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> days == <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> (peach(days+<span class="number">1</span>)+<span class="number">1</span>)*<span class="number">2</span></span><br><span class="line"></span><br><span class="line">print(peach())</span><br></pre></td></tr></table></figure>
<ul>
<li>递归调用对比</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment"># Fib Seq</span></span><br><span class="line">start = datetime.datetime.now()</span><br><span class="line">pre = <span class="number">0</span></span><br><span class="line">cur = <span class="number">1</span> <span class="comment"># No1</span></span><br><span class="line">print(pre, cur, end=<span class="string">' '</span>)</span><br><span class="line">n = <span class="number">35</span></span><br><span class="line"><span class="comment"># loop</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-1</span>):</span><br><span class="line">    pre, cur = cur, pre + cur</span><br><span class="line">    print(cur, end=<span class="string">' '</span>)</span><br><span class="line">delta = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">print(delta)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fib Seq</span></span><br><span class="line">start = datetime.datetime.now()</span><br><span class="line">pre = <span class="number">0</span></span><br><span class="line">cur = <span class="number">1</span> <span class="comment"># No1</span></span><br><span class="line">print(pre, cur, end=<span class="string">' '</span>)</span><br><span class="line"><span class="comment"># recursion</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib1</span><span class="params">(n, pre=<span class="number">0</span>,cur=<span class="number">1</span>)</span>:</span></span><br><span class="line">    pre, cur = cur, pre + cur</span><br><span class="line">    print(cur, end=<span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    fib1(n<span class="number">-1</span>, pre, cur)</span><br><span class="line"></span><br><span class="line">fib1(n)</span><br><span class="line">delta = (datetime.datetime.now() - start</span><br><span class="line">         ).total_seconds()</span><br><span class="line">print(delta)</span><br><span class="line"></span><br><span class="line">start = datetime.datetime.now()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib2</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> fib2(n<span class="number">-1</span>) + fib2(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">    print(fib2(i), end=<span class="string">' '</span>)</span><br><span class="line">delta = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">print(delta)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/12/python基础学习-递归函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/12/python基础学习-递归函数/" itemprop="url">
                  python基础学习-递归函数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-12 18:04:35" itemprop="dateCreated datePublished" datetime="2019-11-12T18:04:35+08:00">2019-11-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-11-14 10:14:09" itemprop="dateModified" datetime="2019-11-14T10:14:09+08:00">2019-11-14</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="函数执行流程"><a href="#函数执行流程" class="headerlink" title="函数执行流程"></a>函数执行流程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://pythontutor.com/visualize.html#mode=edit</span></span><br><span class="line"><span class="comment"># 建议自己想像函数执行流程，先不要去上面的网站上看</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo1</span><span class="params">(b,b1=<span class="number">3</span>)</span>:</span></span><br><span class="line">    print(<span class="string">"foo1 called"</span>,b,b1)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo2</span><span class="params">(c)</span>:</span></span><br><span class="line">    foo3(c)</span><br><span class="line">    print(<span class="string">"foo2 called"</span>,c)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo3</span><span class="params">(d)</span>:</span></span><br><span class="line">    print(<span class="string">"foo3 called"</span>,d)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"main called"</span>)</span><br><span class="line">    foo1(<span class="number">100</span>,<span class="number">101</span>)</span><br><span class="line">    foo2(<span class="number">200</span>)</span><br><span class="line">    print(<span class="string">"main ending"</span>)</span><br><span class="line">    </span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<p><img src="/images/python递归函数/函数执行流程1.png" alt=""></p>
<ul>
<li>全局帧中生成foo1、foo2、foo3、main函数对象</li>
<li>main函数调用</li>
<li>main中查找内建函数print压栈，将常量字符串压栈，调用函数，弹出栈顶</li>
<li>main中全局查找函数foo1压栈，将常量100、101压栈，调用函数foo1，创建栈帧。print函数压栈，字符串和变量b、b1压栈，调用函数，弹出栈顶，返回值</li>
<li>main中全局查找foo2函数压栈，将常量200压栈，调用foo2，创建栈帧。foo3函数压栈，变量c引用压栈，调用foo3，创建栈帧。foo3完成print函数调用后返回。foo2恢复调用，执行print后，返回值。main中foo2调用结束弹出栈顶。main继续执行print函数调用，弹出栈顶。main函数返回。</li>
<li>内存中分栈和堆，对函数来讲，它有一个栈，栈就是落盘子，只能从上面拿。栈是一个内存区域，它一直不停在被使用。它是一个先进后出，后进先出的。谁在压栈，谁就在使用内存，内存中的其他数据会先保存起来，保存起来以后给它压下去，之后再把print()压在它上面。这里指PPT中的代码def main(): print(“main called”)一段。这样当前就是print环境了，然后将字符常量也压到栈里。调用函数就是print()真的要执行了，它会把print()栈内的所有数据依次拿出来执行，执行完以后，栈上的数据就依次拿完了，它刚压进去的数据就消耗完了，这时print就可以弹出了，print一弹出，之前有为main保存的数据，依次再加载起来。main函数就可以继续执行了。之后在main中查找foo1并压栈，将常量100、101压栈。要依次用掉函数内的数据。在栈内要创建一段，这一段叫帧，因为在栈上，所以叫栈帧。函数的执行过程就是压栈与弹出的过程</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字节码不是重点，当对语言掌握的很好了，写程序没问题了，再来了解字节码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo1</span><span class="params">(b, b1=<span class="number">3</span>)</span>:</span></span><br><span class="line">    print(<span class="string">"foo1 called"</span>, b, b1)</span><br><span class="line">    foo2(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo2</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># foo1字节码</span></span><br><span class="line"><span class="number">4</span>          <span class="number">0</span> LOAD_GLOBAL             <span class="number">0</span> (<span class="keyword">print</span>)</span><br><span class="line">           <span class="number">3</span> LOAD_CONST              <span class="number">1</span> (<span class="string">'foo1 called)</span></span><br><span class="line"><span class="string">           6 LOAD_FAST               0 (b)</span></span><br><span class="line"><span class="string">           9 LOAD_FAST               1 (b1)</span></span><br><span class="line"><span class="string">          12 CALL_FUNCTION           3 (1 positional, 0 keyword pair)</span></span><br><span class="line"><span class="string">          函数调用，调用完成后，弹出所有函数参数，函数本身关闭堆栈，并推送返回值</span></span><br><span class="line"><span class="string">          15 POP_TOP  # 删除顶部(TOS)项目</span></span><br><span class="line"><span class="string">          </span></span><br><span class="line"><span class="string">5         16 LOAD_GLOBAL             1 (foo2)</span></span><br><span class="line"><span class="string">          19 LOAD_CONST              2 (2)</span></span><br><span class="line"><span class="string">          22 CALL_FUNCTION           1 (1 positional, 0 keyword pair)</span></span><br><span class="line"><span class="string">          25 POP_TOP           </span></span><br><span class="line"><span class="string">          26 LOAD_CONST              0 (None)   # 这两行是foo1的返回值，None这个空值是一个常量，所以是LOAD_CONST</span></span><br><span class="line"><span class="string">          29 RETURN_VALUE</span></span><br><span class="line"><span class="string"># python中所有函数都有返回值</span></span><br></pre></td></tr></table></figure>
<h3 id="递归Recursion"><a href="#递归Recursion" class="headerlink" title="递归Recursion"></a>递归Recursion</h3><ul>
<li>函数直接或者间接调用自身就是递归</li>
<li>递归需要有边界条件、递归前进段、递归返回段</li>
<li>递归一定要有边界条件</li>
<li>当边界条件不满足的时候，递归前进</li>
<li><p>当边界条件满足的时候，递归返回</p>
</li>
<li><p>斐波那契数列 Fibonacci number: 1,1,2,3,5,8,13,21,34,55,89,144, …</p>
</li>
<li>如果设F(n) 为该数列的第n项，那么这句话可以写成如下形式：F(n)=F(n-1)+F(n-2)</li>
<li>F(0)=0，F(1)=1，F(n)=F(n-1)+F(n-2)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pre = <span class="number">0</span></span><br><span class="line">cur = <span class="number">1</span> </span><br><span class="line">print(pre, cur, end=<span class="string">' '</span>)</span><br><span class="line">n = <span class="number">4</span></span><br><span class="line"><span class="comment"># loop</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-1</span>):</span><br><span class="line">    pre,cur = cur,pre + cur</span><br><span class="line">    print(cur,end=<span class="string">' '</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 递归解决斐波那契数列</span></span><br><span class="line"><span class="comment"># F(0)=0, F(1)=1, F(n)=F(n-1)+F(n-2)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> fib(n<span class="number">-1</span>)+fib(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    print(fib(i),end=<span class="string">''</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 把4代入，就是fib(3)+fib(2)，fib(3)要再次压栈，这时就又进fib这个函数了，这时要调用fib(2)+fib(1)</span></span><br><span class="line"><span class="comment"># fib(2)不小于2,所以还要调用一次fib(1)。fib(1)就是边界，因为小于2，这时就会执行return了，之前都不会</span></span><br><span class="line"><span class="comment"># return。这里的fib(3)+fib(2)会分别执行fib(3)和fib(2)，也就是执行2次</span></span><br><span class="line"><span class="comment"># 而且这个递归的效率非常低，因为压栈太多</span></span><br></pre></td></tr></table></figure>
<ul>
<li>递归要求<ul>
<li>递归一定要有退出条件，递归调用一定要执行到这个退出条件。没有退出条件的递归调用 ，就是无限调用 </li>
<li>递归调用 的深度不宜过深<ul>
<li>Python对递归调用的深度做了限制，以保护解释器</li>
<li>超过递归深度限制，抛出RecursionError: maxinum recursion depth exceeded 超出最大深度</li>
<li>sys.getrecursionlimit()</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用pycharm测试</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo1</span><span class="params">(b,b1=<span class="number">3</span>)</span>:</span></span><br><span class="line">    foo1(b)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># foo1(3)</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">print(sys.getrecursionlimit())</span><br><span class="line"><span class="comment"># 视频中是1000,超过这个值就会报错，这是一种保护机制</span></span><br><span class="line">sys.setrecursionlimit(<span class="number">1000</span>)</span><br><span class="line"><span class="comment"># 修改递归的层数，太消耗内存了</span></span><br></pre></td></tr></table></figure>
<h3 id="递归的性能"><a href="#递归的性能" class="headerlink" title="递归的性能"></a>递归的性能</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for 循环</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">start = datetime.datetime.now()</span><br><span class="line">pre = <span class="number">0</span></span><br><span class="line">cur = <span class="number">1</span> <span class="comment"># No1</span></span><br><span class="line">print(pre, cur, end=<span class="string">' '</span>)</span><br><span class="line">n = <span class="number">35</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n<span class="number">-1</span>):</span><br><span class="line">pre, cur = cur, pre + cur</span><br><span class="line">	print(cur, end=<span class="string">' '</span>)</span><br><span class="line">	delta = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">print(delta)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 递归</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line">n = <span class="number">35</span></span><br><span class="line">start = datetime.datetime.now()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> n &lt; <span class="number">2</span> <span class="keyword">else</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">	print(fib(i), end=<span class="string">' '</span>)</span><br><span class="line">delta = (datetime.datetime.now() - start).total_seconds()</span><br><span class="line">print(delta)</span><br></pre></td></tr></table></figure>
<ul>
<li>循环稍微复杂一些，但是只要不是死循环，可以多次迭代直至算出结果</li>
<li>fib函数代码极简易懂，但是只能获取到最外层的函数调用，内部递归结果都是中间结果。而且给定一个n都要进行近2n次递归，深度越深，效率越低。为了获取斐波那契数列需要外面再套一个n次的循环，效率就更低了</li>
<li>递归还有深度限制，如果递归复杂，函数反复压栈，栈内存很快就溢出了</li>
<li>思考：这个极简的递归代码能否提高性能？</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 斐波寻契数列的改进</span></span><br><span class="line">pre = <span class="number">0</span></span><br><span class="line">cur = <span class="number">1</span></span><br><span class="line">print(pre, cur, end=<span class="string">' '</span>)  <span class="comment"># 这里打印的是最前面的0和1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n, pre=<span class="number">0</span>, cur =<span class="number">1</span>)</span>:</span></span><br><span class="line">    pre, cur = cur, pre + cur</span><br><span class="line">    print(cur, end=<span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span>:   <span class="comment"># 这是最外层的条件，当满足条件时执行一次return。n是计数的，</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    fib(n<span class="number">-1</span>, pre, cur)   </span><br><span class="line">    <span class="comment"># 这一句后隐含有return，每次都会执行return。我们不关心这个，因为我们要的是上面print的值</span></span><br><span class="line">    <span class="comment"># 上一次的结果，作为下一次的参数传进来</span></span><br><span class="line">fib(<span class="number">5</span>)</span><br><span class="line">- 改进</span><br><span class="line">	- 左边的fib函数和循环的思想类似</span><br><span class="line">    - 参数n是边界条件，用n来计数</span><br><span class="line">    - 上一次的计算结果直接作为函数的实参</span><br><span class="line">    - 效率很高</span><br><span class="line">    - 和循环比较，性能相近。所以并不是说递归一定效率代下。但是递归有深度限制</span><br><span class="line">- 对比一下三个fib函数的性能</span><br></pre></td></tr></table></figure>
<ul>
<li>间接递归</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo1</span><span class="params">()</span>:</span></span><br><span class="line">    foo2()</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo2</span><span class="params">()</span>:</span></span><br><span class="line">    foo1()</span><br><span class="line">    </span><br><span class="line">foo1()</span><br><span class="line">- 间接递归，是通过别的函数调用了函数自身。但是如果构成了循环递归调用是非常危险的，但是往往这种情况在代码</span><br><span class="line">复杂的情况下，还是可能发生这种调用。要用代码的规范来避免这种递归调用的发生</span><br></pre></td></tr></table></figure>
<h3 id="递归总结"><a href="#递归总结" class="headerlink" title="递归总结"></a>递归总结</h3><ul>
<li>递归是一种很自然的表达，符合逻辑思维</li>
<li>递归相对运行效率低，每一次调用函数都要开辟栈帧</li>
<li>递归有深度限制，如果递归层次太深，函数反复压栈，栈内存很快就溢出了</li>
<li>如果是有限次数的递归，可以使用递归调用，或者使用循环代替，循环代码稍微复杂一些，但是只要不是死循环，可以多次迭代直至算出结果</li>
<li>绝大多数递归，都可以使用循环实现</li>
<li>即使递归代码很简洁，但是能不用则不用递归</li>
<li>个人感觉，递归最重要的有三点。一是定义时，函数的参数就是变量，它一直在变化，所以可以向下执行。二是找到公式，也就是函数要完成的功能，如何不断的用一个公式递归自己，这可以通过要实现的功能来发现其中的规律。三是返回，实际就是告诉函数到什么地方就可以一级一级地向上返回值了，这个也可以从要实现的功能中找到，看功能到什么时候就可以结束。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/12/python基础学习-树/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/12/python基础学习-树/" itemprop="url">
                  python基础学习-树
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-12 10:35:16" itemprop="dateCreated datePublished" datetime="2019-11-12T10:35:16+08:00">2019-11-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-11-13 09:39:22" itemprop="dateModified" datetime="2019-11-13T09:39:22+08:00">2019-11-13</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="树的概念"><a href="#树的概念" class="headerlink" title="树的概念"></a>树的概念</h3><ul>
<li>非线性结构，每个元素可以有多个前驱和后继</li>
<li>树是n(n&gt;0)个元素的集合<ul>
<li>n = 0时，称为空树</li>
<li>树只有一个特殊的没有前驱的元素，称为树的根root</li>
<li>树中除了根结点外，其余元素只能有一个前驱，可以有零个或多个后继</li>
</ul>
</li>
<li>递归定义<ul>
<li>树T是n(n&gt;=0)个元素的集合。n=0时，称为空树</li>
<li>有且只有一个特殊元素根，剩余元素都可以被划分为m个互不相交的集合T1、T2、T3、…、Tm，而每一个集合都是树，称为T的子树Subtree</li>
<li>子树也有自己的根</li>
</ul>
</li>
<li>结点：树中的数据元素</li>
<li>结点的度degree：结点拥有的子树的数目称为度，记作d(v)。</li>
<li>叶子结点：结点的度不为0，称为非终端结点或分支结点</li>
<li>分支：结点之间的关系</li>
<li>内部结点：除根结点外的分支结点，当然也不包括叶子结点</li>
<li>树的度是树内各结点的度的最大值。D结点度最大为3，树的度数就是3</li>
</ul>
<p><img src="/images/python树/树的概念1.png" alt=""></p>
<ul>
<li>孩子(儿子Child)结点：结点的子树的根结点称为该结点的孩子</li>
<li>双亲(父Parent)结点：一个结点是它各子树的根结点的双亲</li>
<li>兄弟(Sibling)结点：具有相同双亲结点的结点</li>
<li>祖先结点：从根结点到该结点所经分支上所有的结点。A、B、D都是G的祖先结点</li>
<li>子孙结点：结点的所有子树上的结点都称为该结点的子孙。B的子孙是D、G、H、I</li>
<li>结点的层次(Level)：根节点为第一层，根的孩子为第二层，以此类推，记作L(v)</li>
<li>树的深度(高度Depth)：树的层次的最大值。上图的树深度为4</li>
<li>堂兄弟：双亲在同一层的结点</li>
<li>有序树：结点的子树是有顺序的(兄弟有大小，有先后次序)，不能交换。</li>
<li>无序树：结点的子树是有无序的，可以交换</li>
<li>路径：树中的k个结点n1、n2、…、nk，满足ni是n(i+1)的双亲，称为n1到nk的一条路径。就是一条线串下来的，前一个都是后一个的父(前驱)结点。</li>
<li>路径长度=路径上结点数-1，也是分支数</li>
<li>森林：m(m&gt;=0)棵不相交的树的集合<ul>
<li>对于结点而言，其子树的集合就是森林。A结点的2棵子树的集合就是森林</li>
</ul>
</li>
<li>树的特点<ul>
<li>唯一的根</li>
<li>子树不相交</li>
<li>除了根以外，每个元素只能有一个前驱，可以有零个或多个后继</li>
<li>根结点没有双亲结点(前驱)，叶子结点没有孩子结点(后继)</li>
<li>vi是vj的双亲，则L(vi) = L(vj) - 1，也就是说双亲比孩子结点的层次小1</li>
</ul>
</li>
<li>堂兄弟的双亲是兄弟关系吗？</li>
</ul>
<h3 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h3><ul>
<li>每个结点最多两棵子树<ul>
<li>二叉树不存在度数大于2的结点</li>
</ul>
</li>
<li>它是有序树，左子树、右子树是顺序的，不能交换次序</li>
<li>即使某个结点只有一棵子树，也要确定它是左子树还是右子树</li>
<li>二叉树的五种基本形态<ul>
<li>空二叉树</li>
<li>只有一个根结点</li>
<li>根结点只有左子树</li>
<li>根结点只有右子树</li>
<li>根结点有左子树和右子树</li>
</ul>
</li>
</ul>
<h3 id="斜树"><a href="#斜树" class="headerlink" title="斜树"></a>斜树</h3><ul>
<li>左斜树，所有结点都只有左子树</li>
<li>右斜树，所有结点都只有右子树</li>
</ul>
<p><img src="/images/python树/斜树1.png" alt=""></p>
<h3 id="满二叉树"><a href="#满二叉树" class="headerlink" title="满二叉树"></a>满二叉树</h3><ul>
<li>一棵二叉树的所有分支结点都存在左子树和右子树，并且所有叶子结点只存在在最下面一层。</li>
<li>同样深度二叉树中，满二叉树结点最多。</li>
<li>k为深度(1&lt;=k&lt;=n)，则结点总数为2^k-1</li>
<li>如下图，一个深度为4的15个结点的满二叉树</li>
</ul>
<p><img src="/images/python树/满二叉树1.png" alt=""></p>
<h3 id="完全二叉树-Complete-Binary-Tree"><a href="#完全二叉树-Complete-Binary-Tree" class="headerlink" title="完全二叉树 Complete Binary Tree"></a>完全二叉树 Complete Binary Tree</h3><ul>
<li>若二叉树的深度为k，二叉树的层数从1到k-1层的结点数都达到了最大个数，在第k层的所有结点都集中在最左边，这就是完全二叉树</li>
<li>完全二叉树由满二叉树引出</li>
<li>满二叉树一定是完全二叉树，但完全二叉树不是满二叉树</li>
<li>k为深度(1&lt;=k&lt;=n)，则结点总数最大值为2^k-1，当达到最大值的时候就是满二叉树</li>
<li>举例，完全二叉树，最下一层的叶子结点都连续的集中在左边</li>
</ul>
<p><img src="/images/python树/完全二叉树1.png" alt=""></p>
<ul>
<li>举例，完全二叉树，最下一层的叶子结点都连续的集中在左边</li>
</ul>
<p><img src="/images/python树/完全二叉树2.png" alt=""></p>
<ul>
<li>举例，完全二叉树，最下一层的叶子结点都连续的集中在左边</li>
</ul>
<p><img src="/images/python树/完全二叉树3.png" alt=""></p>
<ul>
<li>举例，<strong><em>不是完全二叉树</em></strong></li>
</ul>
<p><img src="/images/python树/完全二叉树4.png" alt=""></p>
<h3 id="二叉树性质"><a href="#二叉树性质" class="headerlink" title="二叉树性质"></a>二叉树性质</h3><ul>
<li>性质1<ul>
<li>在二叉树的第i层上至多有2^(i-1)个结点(i&gt;=1)</li>
</ul>
</li>
<li>性质2<ul>
<li>深度为k的二叉树，至多有2^k-1个结点(k&gt;=1)</li>
<li>一层 2-1=1</li>
<li>二层4-1=1+2=3</li>
<li>三层 8-1=1+2+4=7</li>
</ul>
</li>
<li>性质3<ul>
<li>对任何一棵二叉树T，如果其终端结点数为n0，度数为2的结点为n2，则有n0=n2+1</li>
<li>换句话说，就是叶子结点数-1就等于度数为2的结点数</li>
<li>证明：<ul>
<li>总结点数为n=n0+n1+n2，n1为度数为1的结点总数。</li>
<li>一棵树的分支数为n-1，因为除了根结点外，其余结点都有一个分支，即n0+n1+n2-1</li>
<li>分支数还等于n0<em>0+n1</em>1+n2<em>2，n2是2分支结点所以乘以2,2</em>n2+n1</li>
<li>可行2*n2+n1=n0+n1+n2-1 =&gt; n2 = n0-1</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/python树/二叉树性质1.png" alt=""></p>
<ul>
<li><p>其他性质</p>
<ul>
<li>高度为k的二叉树，至少有k个结点</li>
<li>含有n(n&gt;=1)的结点的二叉树高度至多为n。和上句一个意思</li>
<li>含有n(n&gt;=1)的结点的二叉树的高度至多为n，最小为math.ceil(log2(n+1))，不小于对数值的最小整数，向上取整<ul>
<li>假设高度为h，2^h-1=n=&gt;h=log2(n+1)，层次数是取整。如果是8个结点，3.1699就要向上取整为4,为4层。</li>
</ul>
</li>
</ul>
</li>
<li><p>性质4</p>
<ul>
<li>具有n个结点的完全二叉树的深度为int(log2n)+1或者math.ceil(log2(n+1))</li>
</ul>
</li>
</ul>
<p><img src="/images/python树/二叉树性质2.png" alt=""></p>
<ul>
<li>性质5<ul>
<li>如果有一棵n个结点的完全二叉树(深度为性质4)，结点按照层序编号，如下图</li>
<li>如果i=1，则结点i是二叉树的根，无双新；如果i&gt;1，则其双亲是int(i/2)，向下取整。就是子结点的编号整除2得到的就是父结点的编号。父结点如果是i，那么左孩子结点就是2i，右孩子结点就是2i+1</li>
<li>如果2i&gt;n，则结点i无左孩子，即结点i为叶子结点；否则其左孩子结点存在编号为2i</li>
<li>如果2i+1&gt;n，则结点i无右孩子，注意这里并不能说明结点i没有左孩子；否则右孩子结点存在编号为2i+1</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/11/python算法-插入排序/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/11/python算法-插入排序/" itemprop="url">
                  python算法-插入排序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-11 08:19:40 / 修改時間：09:59:30" itemprop="dateCreated datePublished" datetime="2019-11-11T08:19:40+08:00">2019-11-11</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="直接插入排序-Direct-Insertion-Sort"><a href="#直接插入排序-Direct-Insertion-Sort" class="headerlink" title="直接插入排序 Direct Insertion Sort"></a>直接插入排序 Direct Insertion Sort</h3><ul>
<li>直接插入排序原理<ul>
<li>在未排序序列中，构建一个子排序序列,直至全部数据排序完成</li>
<li>将待排序的数，插入到<strong><em>已经排序</em></strong>的序列中合适的位置</li>
<li>增加一个哨兵，放入待比较值，让它和后面已经排好序的序列比较，找到合适的插入点</li>
</ul>
</li>
</ul>
<p><img src="/media/shouyu/C64CC89B4CC8879F/works/GitHub/ruopu89.github.io/themes/hexo-theme-next/source/images/python插入排序/插入排序1.png" alt=""></p>
<ul>
<li><p>初始的0及下面开头的红色数字为哨兵，即待插入值</p>
</li>
<li><p>从第二个数字开始排序，即9</p>
</li>
<li><p>第一趟，哨兵是9，用1和哨兵比较，1小，哨兵插入，本轮比较结束</p>
</li>
<li><p>第二趟，哨兵是8，用9和哨兵比较大于哨兵，9向右移，1和哨兵比较，1小，哨兵插入本轮比较结束</p>
</li>
<li><p>以此类推，直至把最后一个数字放到哨兵并比较，插入完成</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">m_list = [[<span class="number">1</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>],[<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>]]</span><br><span class="line">nums = [<span class="number">0</span>] + m_list[<span class="number">0</span>]    <span class="comment"># nums为[0,1,9,8,5,6,7,4,3,2]</span></span><br><span class="line"><span class="comment"># print(nums)</span></span><br><span class="line">sentinel,*origin = nums   <span class="comment"># 哨兵位，待比较数字。sentinel为0，origin为[1,9,8,5,6,7,4,3,2]</span></span><br><span class="line"><span class="comment"># print(sentinel)</span></span><br><span class="line"><span class="comment"># print(origin)</span></span><br><span class="line">count_swap = <span class="number">0</span>   <span class="comment"># 计算每轮循环中，与哨兵位比较后要交换的次数</span></span><br><span class="line">count_iter = <span class="number">0</span>   <span class="comment"># 计算从第二个数字到最后一个数字，一共要循环的资源</span></span><br><span class="line">length = len(nums)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,length):   <span class="comment"># 从第二个数字开始</span></span><br><span class="line">    nums[<span class="number">0</span>] = nums[i]    </span><br><span class="line"><span class="comment"># 放置哨兵，把比较的数字赋值给第一个数字，第一个数字就是哨兵位。如第一次就是把9放到哨兵位。这里的哨兵是在按列表中的数字不停顺序变化的，</span></span><br><span class="line"><span class="comment"># ，第一次是9，之后是8,5,6，一直到最后，如果要比较的数字比哨兵位的数字小，就不动，如果比哨兵位的数字大，就向右移</span></span><br><span class="line">    j = i - <span class="number">1</span>    <span class="comment"># 得出要比较数字的索引位置，下面就要用1和9比较</span></span><br><span class="line">    count_iter += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> nums[j] &gt; nums[<span class="number">0</span>]:    <span class="comment"># 大数右移，找到插入位置。如果要比较的数字比哨兵位的数字大</span></span><br><span class="line">        <span class="keyword">while</span> nums[j] &gt; nums[<span class="number">0</span>]:</span><br><span class="line">            nums[j+<span class="number">1</span>] = nums[j]    <span class="comment"># 依次右移</span></span><br><span class="line">            j -= <span class="number">1</span></span><br><span class="line"><span class="comment"># 如果索引j比哨兵位的数字大，就把索引j向后移一个位置，之后把索引j减1，再进行同样的比较。当8是哨兵位时，9与8比较，因为比8大，就会把9</span></span><br><span class="line"><span class="comment"># 的索引向后移动，之后再用1和哨兵位的8比较，1小于8,那么执行下面的哨兵插入，这时正好插入到了之前9的位置</span></span><br><span class="line">            count_swap += <span class="number">1</span></span><br><span class="line">        nums[j+<span class="number">1</span>] = nums[<span class="number">0</span>]    <span class="comment"># 将哨兵插入，注意插入在右侧要+1</span></span><br><span class="line">print(nums, count_swap, count_iter)</span><br><span class="line">输出：</span><br><span class="line">[<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>] <span class="number">25</span> <span class="number">8</span></span><br><span class="line"><span class="comment"># 可以看到最后一个数字2在哨兵位上。</span></span><br></pre></td></tr></table></figure>
<ul>
<li>增加一个哨兵位，每轮比较将待比较数放入</li>
<li>哨兵依次和待比较数的前一个数据比较，大数向右移动，找到哨兵中值的插入位置</li>
<li>每一轮结束后，得到一个从开始到待比较数位置的一个有序序列</li>
<li>最好情况，正好是升序排列，比较迭代n-1次</li>
<li>最差情况，正好是降序排列，比较迭代1,2,…,n-1即n(n-1)/2</li>
<li>使用两层嵌套循环，时间复杂度O(n^2)</li>
<li>稳定排序算法</li>
<li>使用在小规模数据比较</li>
<li>优化<ul>
<li>如果比较操作耗时大的话，可以采用二分查找来提高效率，即二分查找插入排序</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/08/python基础练习-函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/08/python基础练习-函数/" itemprop="url">
                  python基础练习-函数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-11-08 08:23:10 / 修改時間：17:12:03" itemprop="dateCreated datePublished" datetime="2019-11-08T08:23:10+08:00">2019-11-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>编写一个函数，能够接受至少2个参数，返回最小值和最大值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">double_values</span><span class="params">(*nums)</span>:</span></span><br><span class="line">    print(nums)</span><br><span class="line">    <span class="keyword">return</span> max(nums), min(nums)</span><br><span class="line"></span><br><span class="line">print(*double_values(*[random.randint(<span class="number">10</span>,<span class="number">20</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]))</span><br><span class="line"><span class="comment"># 这里调用double_values()时给的参数使用了参数解构，并且使用了列表解析式，</span></span><br><span class="line"><span class="comment"># random.randint(10,20)表示返回10到20之间的随机整数，后面的for循环表示执行10次，这将组成一个列表，</span></span><br><span class="line"><span class="comment"># 然后用参数解构挨个给double_balues函数。double_values前面的星号也是参数解构，打印时会将</span></span><br><span class="line"><span class="comment"># double_values中得到的最大最小值分开打印，不然会按元组形式打印在一起</span></span><br><span class="line"><span class="comment"># 这里的print()还有一个隐含的强制类型转换，并数字转换为字符串再打印</span></span><br><span class="line">输出：</span><br><span class="line">(<span class="number">11</span>, <span class="number">10</span>, <span class="number">16</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">13</span>)</span><br><span class="line"><span class="number">16</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>
<ul>
<li>编写一个函数，接受一个参数n，n为正整数，左右两种打印方式。要求数字必须对齐</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上三角</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(n)</span>:</span></span><br><span class="line">    tail = <span class="string">" "</span>.join([str(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(n,<span class="number">0</span>,<span class="number">-1</span>)])</span><br><span class="line"><span class="comment"># 这一行算的是最下面一行的值，不管有几位数，知道最后一行就可以知道上面的行的字符串长度了join用于字符串连</span></span><br><span class="line"><span class="comment"># 接，以" "为分隔符，列表解析式将n到0倒序传给i，再将i依次转换为字符串，最后就是要以倒序排列一个字符串，如12 11 ... 1 </span></span><br><span class="line">    width = len(tail)</span><br><span class="line"><span class="comment"># 计算tail的长度</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,n):  <span class="comment"># 因为这里到第n行，所以最后还要再打印一次tail行的值</span></span><br><span class="line">        print(<span class="string">"&#123;:&gt;&#123;&#125;&#125;"</span>.format(<span class="string">" "</span>.join([str(j) <span class="keyword">for</span> j <span class="keyword">in</span> range(i,<span class="number">0</span>,<span class="number">-1</span>)]),width))</span><br><span class="line"><span class="comment"># &#123;:&gt;&#123;&#125;&#125;中&gt;表示右对齐，里面的&#123;&#125;表示这一行的宽度，format()里，逗号前面的部分就是要打印的部分，width表</span></span><br><span class="line"><span class="comment"># 示这一行的宽度，宽度是不会变的。只是打印都向右对齐就可以了</span></span><br><span class="line">    print(tail)</span><br><span class="line">show(<span class="number">12</span>)</span><br><span class="line">输出：</span><br><span class="line">                         <span class="number">1</span></span><br><span class="line">                       <span class="number">2</span> <span class="number">1</span></span><br><span class="line">                     <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">                   <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">                 <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">               <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">             <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">           <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">         <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">      <span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">   <span class="number">11</span> <span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">12</span> <span class="number">11</span> <span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下三角</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showtail</span><span class="params">(n)</span>:</span></span><br><span class="line">    tail = <span class="string">" "</span>.join([str(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(n,<span class="number">0</span>,<span class="number">-1</span>)])   <span class="comment"># 计算出第一行的值</span></span><br><span class="line">    print(tail)   <span class="comment"># 把第一行的值打印出来</span></span><br><span class="line">    <span class="comment"># 无需再次生成列表</span></span><br><span class="line"><span class="comment">#     print(len(tail))   # 查看tail一共有多少个元素</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(tail)):    </span><br><span class="line"><span class="comment"># 这里计算出第一行的长度，之后以此为基础。第一行的长度是23，这表示空格也算为一个元素。另外，双数的算两个元素</span></span><br><span class="line"><span class="comment">#         print(i)   # 加入此行可以更明显地看出i的值执行到哪就满足了下面的条件</span></span><br><span class="line">        <span class="keyword">if</span> tail[i] == <span class="string">' '</span>:   </span><br><span class="line"><span class="comment"># 从11开始算，第一个1的索引是0，第二个1的索引是1,第三个空格的索引是2,这时满足条件</span></span><br><span class="line">            print(<span class="string">' '</span>*i,tail[i+<span class="number">1</span>:])</span><br><span class="line"><span class="comment"># 当上面满足时，这里用空格乘在上面的i，这样就形成了从第二行开始，每行前面要打印的空格，再加上tail中i+1索引处到最后的值。这样就凑出了</span></span><br><span class="line"><span class="comment"># 一行的值。另外，tail[i+1:]是一个列表切片操作，这是一个copy方法，所以对性能有一些影响，如果打印10000的话可能会引起垃圾回收</span></span><br><span class="line">showtail(<span class="number">11</span>)</span><br><span class="line">输出：</span><br><span class="line"><span class="number">11</span> <span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">   <span class="number">10</span> <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">      <span class="number">9</span> <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line">        <span class="number">8</span> <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line">          <span class="number">7</span> <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line">            <span class="number">6</span> <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line">              <span class="number">5</span> <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="number">15</span></span><br><span class="line">                <span class="number">4</span> <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">17</span></span><br><span class="line">                  <span class="number">3</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">19</span></span><br><span class="line">                    <span class="number">2</span> <span class="number">1</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">21</span></span><br><span class="line">                      <span class="number">1</span></span><br><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一頁"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ruopu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">173</span>
                    <span class="site-state-item-name">文章</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">分類</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">133</span>
                    <span class="site-state-item-name">標籤</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruopu</span>

  

  

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_pv">
    本站总访问量: <span id="busuanzi_value_site_pv"></span>次
  </span>
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.0</div>





        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="訪客總數">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="總瀏覽次數">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
