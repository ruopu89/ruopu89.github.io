<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="CPU查看1234567891011[root@test ~]# cat /proc/cpuinfo |grep &quot;physical id&quot;|sort|uniq|wc -l1# 查看物理cpu个数[root@test ~]# cat /proc/cpuinfo |grep &quot;cpu cores&quot;|wc -l                       2# 查看每个物理cpu中的核心数[root@">
<meta name="keywords" content="性能监控">
<meta property="og:type" content="article">
<meta property="og:title" content="linux性能监控命令">
<meta property="og:url" content="http://yoursite.com/2019/01/15/linux性能监控命令/index.html">
<meta property="og:site_name" content="ruopu&#39;s blog">
<meta property="og:description" content="CPU查看1234567891011[root@test ~]# cat /proc/cpuinfo |grep &quot;physical id&quot;|sort|uniq|wc -l1# 查看物理cpu个数[root@test ~]# cat /proc/cpuinfo |grep &quot;cpu cores&quot;|wc -l                       2# 查看每个物理cpu中的核心数[root@">
<meta property="og:locale" content="zh-TW">
<meta property="og:updated_time" content="2019-01-16T16:04:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="linux性能监控命令">
<meta name="twitter:description" content="CPU查看1234567891011[root@test ~]# cat /proc/cpuinfo |grep &quot;physical id&quot;|sort|uniq|wc -l1# 查看物理cpu个数[root@test ~]# cat /proc/cpuinfo |grep &quot;cpu cores&quot;|wc -l                       2# 查看每个物理cpu中的核心数[root@">






  <link rel="canonical" href="http://yoursite.com/2019/01/15/linux性能监控命令/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>linux性能监控命令 | ruopu's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-TW">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ruopu's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切換導航欄">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首頁</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />標籤</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分類</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />歸檔</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜尋</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜尋..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/15/linux性能监控命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">linux性能监控命令
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-01-15 17:08:59" itemprop="dateCreated datePublished" datetime="2019-01-15T17:08:59+08:00">2019-01-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-01-17 00:04:07" itemprop="dateModified" datetime="2019-01-17T00:04:07+08:00">2019-01-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/基础/" itemprop="url" rel="index"><span itemprop="name">基础</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="CPU查看"><a href="#CPU查看" class="headerlink" title="CPU查看"></a>CPU查看</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# cat /proc/cpuinfo |grep "physical id"|sort|uniq|wc -l</span><br><span class="line">1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看物理cpu个数</span></span><br><span class="line">[root@test ~]# cat /proc/cpuinfo |grep "cpu cores"|wc -l                       </span><br><span class="line">2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看每个物理cpu中的核心数</span></span><br><span class="line">[root@test ~]# cat /proc/cpuinfo |grep "processor"|wc -l             </span><br><span class="line">2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 逻辑cpu的个数。物理cpu个数*核数=逻辑cpu个数（不支持超线程技术的情况下）</span></span><br><span class="line">[root@test ~]# lscpu</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此命令也可查询上述信息</span></span><br></pre></td></tr></table></figure>
<h3 id="内存查看"><a href="#内存查看" class="headerlink" title="内存查看"></a>内存查看</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# free -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           976M        127M        510M         55M        338M        625M</span><br><span class="line">Swap:          2.0G          0B        2.0G</span><br><span class="line"><span class="meta">#</span><span class="bash"> total：内存总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used：已经使用的内存数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> free：空闲内存数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> shared：多个进程共享的内存总额</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - buffers/cache：(已用)的内存数，即used-buffers-cached(CentOS6)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> + buffers/cache：(可用)的内存数，即free+buffers+cached(CentOS6)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Buffer Cache用于针对磁盘块的读写；</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Page Cache用于针对文件inode的读写，这些Cache能有效地缩短I/O系统调用的时间。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对操作系统来说free/used是系统可用/占用的内存；</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对应用程序来说-/+ buffers/cache是可用/占用内存,因为buffers/cache很快就会被使用。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 经验公式：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 应用程序可用内存/系统物理内存&gt;70%，表示系统内存资源非常充足，不影响系统性能;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 应用程序可用内存/系统物理内存&lt;20%，表示系统内存资源紧缺，需要增加系统内存;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 20%&lt;应用程序可用内存/系统物理内存&lt;70%，表示系统内存资源基本能满足应用需求，暂时不影响系统性能</span></span><br></pre></td></tr></table></figure>
<h3 id="磁盘查看"><a href="#磁盘查看" class="headerlink" title="磁盘查看"></a>磁盘查看</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# fdisk -l</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看硬盘及分区信息</span></span><br><span class="line">[root@test ~]# df -h</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看文件系统的磁盘空间占用情况</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# du -sh /etc</span><br><span class="line">35M     /etc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看linux系统中某目录的大小</span></span><br></pre></td></tr></table></figure>
<h3 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# lsmod</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看系统已载入的相关模块</span></span><br><span class="line">[root@test ~]# lspci</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看pci设置</span></span><br><span class="line">[root@test ~]# uname -a</span><br><span class="line">Linux test 3.10.0-693.el7.x86_64 #1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看内核版本号等信息，也可以使用-r选项，只显示内核信息</span></span><br><span class="line">[root@test ~]# file /lib/systemd/systemd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看系统是32位还是64位的</span></span><br><span class="line">[root@test ~]# cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看发行版</span></span><br></pre></td></tr></table></figure>
<h3 id="uptime命令"><a href="#uptime命令" class="headerlink" title="uptime命令"></a>uptime命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# uptime </span><br><span class="line"> 21:14:43 up 1 min,  1 user,  load average: 0.05, 0.03, 0.01</span><br><span class="line"><span class="meta"> #</span><span class="bash"> load average三值大小一般不能大于系统CPU的个数。系统有8个CPU,如load average三值长期大于8，说明CPU很繁忙，负载很高，可能会影响系统性能。如load average输出值小于CPU个数，则表示CPU有空闲时间片，比如本例中的输出，CPU是非常空闲的</span></span><br></pre></td></tr></table></figure>
<h3 id="PS命令"><a href="#PS命令" class="headerlink" title="PS命令"></a>PS命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">用途</span><br><span class="line">显示进程的状态。</span><br><span class="line"></span><br><span class="line">语法</span><br><span class="line">ps [options] [--help]</span><br><span class="line"></span><br><span class="line">参数</span><br><span class="line">-A 列出所有的行程</span><br><span class="line">-w 显示加宽可以显示较多的资讯</span><br><span class="line">au 显示较详细的资讯</span><br><span class="line">aux 显示所有包含其他使用者的行程，也可使用-ef参数</span><br><span class="line"></span><br><span class="line">* au(x) 输出格式 :</span><br><span class="line">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND</span><br><span class="line">USER: 进程拥有者</span><br><span class="line">PID: pid</span><br><span class="line"><span class="meta">%</span><span class="bash">CPU: 占用的 CPU 使用率</span></span><br><span class="line"><span class="meta">%</span><span class="bash">MEM: 占用的内存使用率</span></span><br><span class="line">VSZ: 占用的虚拟内存大小</span><br><span class="line">RSS: 占用的内存大小</span><br><span class="line">TTY: 终端的次要装置号码 (minor device number of tty)</span><br><span class="line">STAT: 此进程的状态:</span><br><span class="line">D: 不可中断的</span><br><span class="line">R: 正在执行中</span><br><span class="line">S: 静止状态</span><br><span class="line">T: 暂停执行</span><br><span class="line">Z: 不存在但暂时无法消除</span><br><span class="line">W: 没有足够的内存分页可分配</span><br><span class="line">&lt;: 高优先级的进程</span><br><span class="line">N: 低优先级的进程</span><br><span class="line">L: 有内存分页分配并锁在内存内 (实时系统或A I/O)</span><br><span class="line">START: 进程开始时间</span><br><span class="line">TIME: 执行的时间</span><br><span class="line">COMMAND:所执行的指令</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@test ~]# ps -A</span><br><span class="line">   PID TTY          TIME CMD</span><br><span class="line">     1 ?        00:00:02 systemd</span><br><span class="line">     2 ?        00:00:00 kthreadd</span><br><span class="line">     3 ?        00:00:00 ksoftirqd/0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示进程信息</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# ps -u root</span><br><span class="line">   PID TTY          TIME CMD</span><br><span class="line">     1 ?        00:00:02 systemd</span><br><span class="line">     2 ?        00:00:00 kthreadd</span><br><span class="line">     3 ?        00:00:00 ksoftirqd/0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示root用户的进程信息</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# ps -ef</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 10:02 ?        00:00:02 /usr/lib/systemd/systemd --switched-root --s</span><br><span class="line">root          2      0  0 10:02 ?        00:00:00 [kthreadd]</span><br><span class="line">root          3      2  0 10:02 ?        00:00:00 [ksoftirqd/0]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示所有命令，连带命令行</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# ps axo user,comm,pid,psr,pcpu</span><br><span class="line">USER     COMMAND            PID PSR %CPU</span><br><span class="line">root     systemd              1   1  0.0</span><br><span class="line">root     kthreadd             2   0  0.0</span><br><span class="line">root     ksoftirqd/0          3   0  0.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个命令是查看进程的名称、PID以及CPU的占用率。psr表示绑定内核线程的处理器（如果有）的逻辑处理器号。 对一个进程来说，如果它的线程全都绑定到同一处理器上，那么显示该字段。pcpu表示CPU的占用率。comm表示进程名称。pid表示进程的ID号</span></span><br></pre></td></tr></table></figure>
<h3 id="top命令"><a href="#top命令" class="headerlink" title="top命令"></a>top命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">用途</span><br><span class="line">用于实时显示 process 的动态。</span><br><span class="line"></span><br><span class="line">语法</span><br><span class="line">top [-] [d delay] [c] [S] [s] [i] [n] [b]</span><br><span class="line"></span><br><span class="line">参数</span><br><span class="line">d : 改变显示的更新速度，或在交互式指令列( interactive command)按 s</span><br><span class="line">c : 切换显示模式，共有两种模式，一是只显示执行程序的名称，另一种是显示完整的路径与名称</span><br><span class="line">S : 累积模式，会将己完成或消失的子行程 ( dead child process ) 的 CPU time 累积起来</span><br><span class="line">s : 安全模式，将交互式指令取消, 避免潜在的危机</span><br><span class="line">i : 不显示任何闲置 (idle) 或无用 (zombie) 的进程</span><br><span class="line">n : 更新的次数，完成后将会退出 top</span><br><span class="line">b : 批次模式，搭配 "n" 参数一起使用，可以用来将 top 的结果输出到文件内</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@test ~]# top</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示进程信息</span></span><br><span class="line">top - 17:44:23 up  7:42,  4 users,  load average: 0.02, 0.02, 0.05</span><br><span class="line">Tasks: 110 total,   1 running, 109 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta">%</span><span class="bash">Cpu(s):  0.0 us,  0.5 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.2 si,  0.0 st</span></span><br><span class="line">KiB Mem :   999720 total,   522516 free,   131076 used,   346128 buff/cache</span><br><span class="line">KiB Swap:  2097148 total,  2097148 free,        0 used.   640836 avail Mem </span><br><span class="line"></span><br><span class="line">   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                 </span><br><span class="line">   893 root      20   0  549.2m  18.2m   5.7m S   0.3  1.9   0:03.52 /usr/bin/python -Es /us+</span><br><span class="line">   </span><br><span class="line">* 统计信息区</span><br><span class="line">前五行是系统整体的统计信息。第一行是任务队列信息，同 uptime 命令的执行结果。其内容如下：</span><br><span class="line">01:06:48：当前时间</span><br><span class="line">up 1:22：系统运行时间，格式为时:分</span><br><span class="line">1 user：当前登录用户数</span><br><span class="line">load average: 0.06, 0.60, 0.48：系统负载，即任务队列的平均长度。三个数值分别为 1分钟、5分钟、15分钟前到现在的平均值。</span><br><span class="line">第二、三行为进程和CPU的信息。当有多个CPU时，这些内容可能会超过两行。内容如下：</span><br><span class="line">Tasks: 29 total：进程总数</span><br><span class="line">1 running：正在运行的进程数</span><br><span class="line">28 sleeping：睡眠的进程数</span><br><span class="line">0 stopped：停止的进程数</span><br><span class="line">0 zombie：僵尸进程数</span><br><span class="line">Cpu(s): 0.3% us：用户空间占用CPU百分比</span><br><span class="line">1.0% sy： 内核空间占用CPU百分比</span><br><span class="line">0.0% ni：用户进程空间内改变过优先级的进程占用CPU百分比</span><br><span class="line">98.7% id：空闲CPU百分比</span><br><span class="line">0.0% wa：等待输入输出的CPU时间百分比</span><br><span class="line">0.0% hi</span><br><span class="line">0.0% si</span><br><span class="line">最后两行为内存信息。内容如下：</span><br><span class="line">Mem: 191272k total：物理内存总量</span><br><span class="line">173656k used：使用的物理内存总量</span><br><span class="line">17616k free：空闲内存总量</span><br><span class="line">22052k buffers：用作内核缓存的内存量</span><br><span class="line">Swap: 192772k total：交换区总量</span><br><span class="line">0k used：使用的交换区总量</span><br><span class="line">192772k free：空闲交换区总量</span><br><span class="line">123988k cached：缓冲的交换区总量。</span><br><span class="line"><span class="meta">#</span><span class="bash"> 内存中的内容被换出到交换区，而后又被换入到内存，但使用过的交换区尚未被覆盖，该数值即为这些内容已存在于内存中的交换区的大小。相应的内存再次被换出时可不必再对交换区写入。</span></span><br><span class="line"></span><br><span class="line">* 进程信息区</span><br><span class="line">统计信息区域的下方显示了各个进程的详细信息。</span><br><span class="line">PID：进程id</span><br><span class="line">PPID：父进程id</span><br><span class="line">RUSER Real user name</span><br><span class="line">UID：进程所有者的用户id</span><br><span class="line">USER：进程所有者的用户名</span><br><span class="line">GROUP：进程所有者的组名</span><br><span class="line">TTY：启动进程的终端名。不是从终端启动的进程则显示为 ?</span><br><span class="line">PR：优先级</span><br><span class="line">NI：nice值。负值表示高优先级，正值表示低优先级</span><br><span class="line">P：最后使用的CPU，仅在多CPU环境下有意义</span><br><span class="line"><span class="meta">%</span><span class="bash">CPU：上次更新到现在的CPU时间占用百分比</span></span><br><span class="line">TIME：进程使用的CPU时间总计，单位秒</span><br><span class="line">TIME+：进程使用的CPU时间总计，单位1/100秒</span><br><span class="line"><span class="meta">%</span><span class="bash">MEM：进程使用的物理内存百分比</span></span><br><span class="line">VIRT：进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES</span><br><span class="line">SWAP：进程使用的虚拟内存中，被换出的大小，单位kb。</span><br><span class="line">RES：进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA</span><br><span class="line">CODE：可执行代码占用的物理内存大小，单位kb</span><br><span class="line">DATA：可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb</span><br><span class="line">SHR：共享内存大小，单位kb</span><br><span class="line">nFLT：页面错误次数</span><br><span class="line">nDRT：最后一次写入到现在，被修改过的页面数。</span><br><span class="line">S：进程状态。</span><br><span class="line">    D=不可中断的睡眠状态</span><br><span class="line">    R=运行</span><br><span class="line">    S=睡眠</span><br><span class="line">    T=跟踪/停止</span><br><span class="line">    Z=僵尸进程</span><br><span class="line">COMMAND：命令名/命令行</span><br><span class="line">WCHAN：若该进程在睡眠，则显示睡眠中的系统函数名</span><br><span class="line">Flags：任务标志</span><br><span class="line"></span><br><span class="line">* 更改显示内容</span><br><span class="line">通过 f 键可以选择显示的内容。按 f 键之后会显示列的列表，按 a-z 即可显示或隐藏对应的列，最后按回车键确定。</span><br><span class="line">按 o 键可以改变列的显示顺序。按小写的 a-z 可以将相应的列向右移动，而大写的 A-Z 可以将相应的列向左移动。最后按回车键确定。</span><br><span class="line">按大写的 F 或 O 键，然后按 a-z 可以将进程按照相应的列进行排序。而大写的 R 键可以将当前的排序倒转。</span><br><span class="line"></span><br><span class="line">* 交互命令</span><br><span class="line">h或者?：显示帮助画面，给出一些简短的命令总结说明。</span><br><span class="line">k：终止一个进程。系统将提示用户输入需要终止的进程PID，以及需要发送给该进程什么样的信号。一般的终止进程可以使用15信号；如果不能正常结束那就使用信号9强制结束该进程。默认值是信号15。在安全模式中此命令被屏蔽。</span><br><span class="line">i：忽略闲置和僵死进程。这是一个开关式命令。</span><br><span class="line">q：退出程序。</span><br><span class="line">r ：重新安排一个进程的优先级别。系统提示用户输入需要改变的进程PID以及需要设置的进程优先级值。输入一个正值将使优先级降低，反之则可以使该进程拥有更高的优先权。默认值是10。</span><br><span class="line">S：切换到累计模式。</span><br><span class="line">s：改变两次刷新之间的延迟时间。系统将提示用户输入新的时间，单位为s。如果有小数，就换算成m s。输入0值则系统将不断刷新，默认值是5 s。需要注意的是如果设置太小的时间，很可能会引起不断刷新，从而根本来不及看清显示的情况，而且系统负载也会大大增加。</span><br><span class="line">f或者F：从当前显示中添加或者删除项目。</span><br><span class="line">o或者O：改变显示项目的顺序。</span><br><span class="line">l：切换显示平均负载和启动时间信息。</span><br><span class="line">m：切换显示内存信息。</span><br><span class="line">t：切换显示进程和CPU状态信息。</span><br><span class="line">c：切换显示命令名称和完整命令行。</span><br><span class="line">M：根据驻留内存大小进行排序。</span><br><span class="line">P：根据CPU使用百分比大小进行排序。</span><br><span class="line">T：根据时间/累计时间进行排序。</span><br><span class="line">W：将当前设置写入~/.toprc文件中。</span><br><span class="line">1：查看CPU数量</span><br><span class="line"></span><br><span class="line">[root@test ~]# top -c</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示完整命令</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# top -b</span><br><span class="line"><span class="meta">#</span><span class="bash"> 以批处理模式显示程序信息</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# top -S</span><br><span class="line"><span class="meta">#</span><span class="bash"> 以累积模式显示程序信息</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# top -n 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置信息更新次数，这里会更新两次后终止更新显示</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# top -d 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置信息更新时间，这条命令更新周期为3秒</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# top -p 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示指定的进程信息</span></span><br></pre></td></tr></table></figure>
<h3 id="iostat命令"><a href="#iostat命令" class="headerlink" title="iostat命令"></a>iostat命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">用法：iostat [ 选项 ] [ &lt;时间间隔&gt; [ &lt;次数&gt; ]]</span><br><span class="line">常用选项说明：</span><br><span class="line">-c：只显示系统CPU统计信息，即单独输出avg-cpu结果，不包括device结果</span><br><span class="line">-d：单独输出Device结果，不包括cpu结果</span><br><span class="line">-k/-m：输出结果以kB/mB为单位，而不是以扇区数为单位</span><br><span class="line">-x：输出更详细的io设备统计信息</span><br><span class="line">interval/count：每次输出间隔时间，count表示输出次数，不带count表示循环输出</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用此命令需要安装sysstat包</span></span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@test ~]# iostat</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从系统开机到当前执行时刻的统计信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> avg-cpu: 总体cpu使用情况统计信息，对于多核cpu，这里为所有cpu的平均值。重点关注iowait值，表示CPU用于等待io请求的完成时间。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Device：各磁盘设备的IO统计信息。各列含义如下：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Device：以sdX形式显示的设备名称</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tps： 每秒进程下发的IO读、写请求数量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> KB_read/s：每秒从驱动器读入的数据量，单位为K。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> KB_wrtn/s：每秒从驱动器写入的数据量，单位为K。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> KB_read：读入数据总量，单位为K。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> KB_wrtn：写入数据总量，单位为K。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  重点关注参数：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> iowait% 表示CPU等待IO时间占整个CPU周期的百分比，如果iowait值超过50%，或者明显大于%system、%user以及%idle，表示IO可能存在问题。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> avgqu-sz 表示磁盘IO队列长度，即IO等待个数。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> await 表示每次IO请求等待时间，包括等待时间和处理时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> svctm 表示每次IO请求处理的时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %util 表示磁盘忙碌情况，一般该值超过80%表示该磁盘可能处于繁忙状态。</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# ll /dev/centos/</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 16 21:13 root -&gt; ../dm-0</span><br><span class="line">lrwxrwxrwx 1 root root 7 Jan 16 21:13 swap -&gt; ../dm-1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以使用此命令查看dm-*对应的分区名称</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# iostat -x -k -d 1 2</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</span><br><span class="line">sda               0.00     0.02    0.62    0.12    12.85     1.85    40.04     0.00    0.32    0.28    0.55   0.16   0.01</span><br><span class="line">dm-0              0.00     0.00    0.34    0.13    11.44     1.58    55.41     0.00    0.52    0.46    0.65   0.21   0.01</span><br><span class="line">dm-1              0.00     0.00    0.01    0.00     0.30     0.00    47.40     0.00    0.13    0.13    0.00   0.06   0.00</span><br><span class="line"><span class="meta">#</span><span class="bash"> 每隔1秒输出磁盘IO的详细信息，总共采样2次</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rrqm/s：每秒对该设备的读请求被合并次数，文件系统会对读取同块(block)的请求进行合并</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wrqm/s：每秒对该设备的写请求被合并次数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> r/s：每秒完成的读次数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> w/s：每秒完成的写次数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rkB/s：每秒读数据量(kB为单位)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wkB/s：每秒写数据量(kB为单位)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> avgrq-sz：平均每次IO操作的数据量(扇区数为单位)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> avgqu-sz：平均等待处理的IO请求队列长度</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> await：平均每次IO请求等待时间(包括等待时间和处理时间，毫秒为单位)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> svctm：平均每次IO请求的处理时间(毫秒为单位)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %util：采用周期内用于IO操作的时间比率，即IO队列非空的时间比率</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# iostat -x 1 5</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看硬盘的I/O性能。每隔一秒显示一次，显示5次。如果%util接近100%,说明产生的I/O请求太多，I/O系统已经满负荷，该磁盘可能存在瓶颈。如果idle小于70%，I/O的压力就比较大了，说明读取进程中有较多的<span class="built_in">wait</span>。</span></span><br></pre></td></tr></table></figure>
<h3 id="vmstat命令"><a href="#vmstat命令" class="headerlink" title="vmstat命令"></a>vmstat命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# vmstat 2 2</span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> 1  0      0 766596   2108 116392    0    0   334    36  144  191  0  1 98  0  0</span><br><span class="line"> 0  0      0 766596   2108 116392    0    0     0     0  180  148  0  0 100  0  0</span><br><span class="line"><span class="meta"> #</span><span class="bash"> 显示系统各种资源之间相关性能简要信息，主要看CPU负载情况。2表示每个两秒采集一次服务器状态，2表示只采集两次。也可以只使用vmstat 2命令，每2秒显示一次，一直监控</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> r：表示运行队列(就是说多少个进程真的分配到CPU)，我测试的服务器目前CPU比较空闲，没什么程序在跑，当这个值超过了CPU数目，就会出现CPU瓶颈了。这个也和top的负载有关系，一般负载超过了3就比较高，超过了5就高，超过了10就不正常了，服务器的状态很危险。top的负载类似每秒的运行队列。如果运行队列过大，表示你的CPU很繁忙，一般会造成CPU使用率很高。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> b：表示阻塞的进程,这个不多说，进程阻塞，大家懂的。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> swpd：虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> free：空闲的物理内存的大小，我的机器内存总共8G，剩余3415M。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> buff：Linux/Unix系统是用来存储，目录里面有什么内容，权限等的缓存，我本机大概占用300多M</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cache：cache直接用来记忆我们打开的文件,给文件做缓冲，我本机大概占用300多M(这里是Linux/Unix的聪明之处，把空闲的物理内存的一部分拿来做文件和目录的缓存，是为了提高 程序执行的性能，当程序使用内存时，buffer/cached会很快地被使用。)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> si：每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。我的机器内存充裕，一切正常。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> so：每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bi：块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小是1024byte，我本机上没什么IO操作，所以一直是0，但是我曾在处理拷贝大量数据(2-3T)的机器上看过可以达到140000/s，磁盘写入速度差不多140M每秒</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bo：块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span>：每秒CPU的中断次数，包括时间中断</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cs：每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> us：用户CPU时间，我曾经在一个做加密解密很频繁的服务器上，可以看到us接近100,r运行队列达到80(机器在做压力测试，性能表现不佳)。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sy：系统CPU时间，如果太高，表示系统调用时间长，例如是IO操作频繁。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> id：空闲 CPU时间，一般来说，id + us + sy = 100,一般我认为id是空闲CPU使用率，us是用户CPU使用率，sy是系统CPU使用率。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> si、so的值长期不为0，表示系统内存不足。需增加系统内存。</span></span><br></pre></td></tr></table></figure>
<h3 id="sar命令"><a href="#sar命令" class="headerlink" title="sar命令"></a>sar命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><span class="line"> sar（System ActivityReporter系统活动情况报告）是目前Linux上最为全面的系统性能分析工具之一，可以从多方面对系统的活动进行报告，包括：文件的读写情况、系统调用的使用情况、磁盘I/O、CPU效率、内存使用状况、进程活动及IPC有关的活动等，sar命令由sysstat安装包安装</span><br><span class="line"></span><br><span class="line">用法: sar [ 选项 ] [ &lt;时间间隔&gt; [ &lt;次数&gt; ] ]</span><br><span class="line">选项:</span><br><span class="line">-A：所有报告的总和</span><br><span class="line">-b：显示I/O和传递速率的统计信息</span><br><span class="line">-B：显示换页状态</span><br><span class="line">-d：输出每一块磁盘的使用信息</span><br><span class="line">-e：设置显示报告的结束时间</span><br><span class="line">-f：从制定的文件读取报告</span><br><span class="line">-i：设置状态信息刷新的间隔时间</span><br><span class="line">-P：报告每个CPU的状态</span><br><span class="line">-R：显示内存状态</span><br><span class="line">-u：输出cpu使用情况和统计信息</span><br><span class="line">-v：显示索引节点、文件和其他内核表的状态</span><br><span class="line">-w：显示交换分区的状态</span><br><span class="line">-x：显示给定进程的装</span><br><span class="line">-r：报告内存利用率的统计信息</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@test ~]# sar -u 3 4</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">09:18:58 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">09:19:01 PM     all      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">09:19:04 PM     all      0.00      0.00      0.17      0.00      0.00     99.83</span><br><span class="line">09:19:07 PM     all      0.00      0.00      0.17      0.00      0.00     99.83</span><br><span class="line">09:19:10 PM     all      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">Average:        all      0.00      0.00      0.08      0.00      0.00     99.92</span><br><span class="line"><span class="meta">#</span><span class="bash"> 每间隔3秒钟统计一次总共统计4次</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %user：显示用户进程消耗的CPU 时间百分比。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %nice：显示运行正常进程所消耗的CPU 时间百分比。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %system：显示系统进程消耗的CPU时间百分比。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %iowait：显示IO等待所占用的CPU时间百分比</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %steal：显示在内存相对紧张的环境下pagein强制对不同的页面进行的steal操作 。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %idle：显示CPU处在空闲状态的时间百分比。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果系统CPU整体利用率不高，而应用响应缓慢，可能是在一个多CPU的系统中，程序使用了单线程的原因。单线程只使用一个CPU，导致这个CPU占用率为100%，无法处理其它请求，而其它的CPU却闲置，这就导致了整体CPU使用率不高，而应用缓慢现象的发生。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在以上的显示当中，主要看%iowait和%idle，%iowait过高表示存在I/O瓶颈，即磁盘IO无法满足业务需求，如果%idle过低表示CPU使用率比较严重，需要结合内存使用等情况判断CPU是否瓶颈。</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -P 1 3 3</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:36:03 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">11:36:06 PM       1      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">11:36:09 PM       1      0.00      0.00      0.33      0.00      0.00     99.67</span><br><span class="line">11:36:12 PM       1      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">Average:          1      0.00      0.00      0.11      0.00      0.00     99.89</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用-P选项指定监控1号CPU信息，每3秒显示一次，一共显示3次</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -u -o /tmp/1.txt 2 3</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:37:52 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">11:37:54 PM     all      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">11:37:56 PM     all      0.00      0.00      0.25      0.00      0.00     99.75</span><br><span class="line">11:37:58 PM     all      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">Average:        all      0.00      0.00      0.08      0.00      0.00     99.92</span><br><span class="line"><span class="meta">#</span><span class="bash"> 保存监控文件，保存后的文件是二进制的，无法使用vim和cat直接打开</span></span><br><span class="line">[root@test ~]# sar -u -f /tmp/1.txt </span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:37:52 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">11:37:54 PM     all      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">11:37:56 PM     all      0.00      0.00      0.25      0.00      0.00     99.75</span><br><span class="line">11:37:58 PM     all      0.00      0.00      0.00      0.00      0.00    100.00</span><br><span class="line">Average:        all      0.00      0.00      0.08      0.00      0.00     99.92</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从二进制文件读取</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -q</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">09:13:34 PM       LINUX RESTART</span><br><span class="line"></span><br><span class="line">09:20:01 PM   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked</span><br><span class="line">09:30:01 PM         0       113      0.00      0.01      0.01         0</span><br><span class="line">09:40:01 PM         0       113      0.08      0.03      0.02         0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看平均负载</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> runq-sz：运行队列的长度（等待运行的进程数，每核的CP不能超过3个）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> plist-sz：进程列表中的进程（processes）和线程数（threads）的数量</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ldavg-1：最后1分钟的CPU平均负载，即将多核CPU过去一分钟的负载相加再除以核心数得出的平均值，5分钟和15分钟以此类推</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ldavg-5：最后5分钟的CPU平均负载</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ldavg-15：最后15分钟的CPU平均负载</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -r</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">09:13:34 PM       LINUX RESTART</span><br><span class="line"></span><br><span class="line">09:20:01 PM kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty</span><br><span class="line">09:30:01 PM    765604    234116     23.42      2108     77200    268076      8.66     83636     62712         0</span><br><span class="line">09:40:01 PM    765664    234056     23.41      2108     77212    268076      8.66     83944     62428         0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看内存使用情况</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kbmemfree：空闲的物理内存大小</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kbmemused：使用中的物理内存大小</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %memused：物理内存使用率</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kbbuffers：内核中作为缓冲区使用的物理内存大小，kbbuffers和kbcached:这两个值就是free命令中的buffer和cache. </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kbcached：缓存的文件大小</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kbcommit：保证当前系统正常运行所需要的最小内存，即为了确保内存不溢出而需要的最少内存（物理内存+Swap分区）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commit 这个值是kbcommit与内存总量（物理内存+swap分区）的一个百分比的值</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -W</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">09:13:34 PM       LINUX RESTART</span><br><span class="line"></span><br><span class="line">09:20:01 PM  pswpin/s pswpout/s</span><br><span class="line">09:30:01 PM      0.00      0.00</span><br><span class="line">09:40:01 PM      0.00      0.00</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看系统swap分区的统计信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pswpin/s：每秒从交换分区到系统的交换页面（swap page）数量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pswpott/s：每秒从系统交换到swap的交换页面（swap page）的数量</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -b</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">09:13:34 PM       LINUX RESTART</span><br><span class="line"></span><br><span class="line">09:20:01 PM       tps      rtps      wtps   bread/s   bwrtn/s</span><br><span class="line">09:30:01 PM      0.08      0.00      0.08      0.00      1.18</span><br><span class="line">09:40:01 PM      0.09      0.00      0.09      0.00      1.12</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看I/O和传递速率的统计信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tps：磁盘每秒钟的IO总数，等于iostat中的tps</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rtps：每秒钟从磁盘读取的IO总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wtps：每秒钟从写入到磁盘的IO总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bread/s：每秒钟从磁盘读取的块总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bwrtn/s：每秒钟此写入到磁盘的块总数</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -dp 2 2</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:44:35 PM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">11:44:37 PM       sda      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"><span class="meta">#</span><span class="bash"> sar –d组合，可以对系统的磁盘IO做一个基本的统计</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DEV 磁盘设备的名称，如果不加-p，会显示dev253-0类似的设备名称，因此加上-p显示的名称更直接</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tps：每秒I/O的传输总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rd_sec/s：每秒读取的扇区的总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wr_sec/s：每秒写入的扇区的总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> avgrq-sz：平均每次次磁盘I/O操作的数据大小（扇区）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> avgqu-sz：磁盘请求队列的平均长度</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> await：平均每次设备I/O操作等待时间（毫秒）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> svctm：平均每次设备I/O操作的服务时间（毫秒）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %util：一秒钟有百分之几的时间用于I/O操作</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对磁盘IO性能评判标准：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 正常svctm应小于await值，而svctm和磁盘性能有关，CPU、内存负荷也会对svctm值造成影响，过多的请求也会间接的导致svctm值的增加。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> await值取决svctm和I/O队列长度以及I/O请求模式，如果svctm的值与await很接近，表示几乎没有I/O等待，磁盘性能很好，如果await的值远高于svctm的值，则表示I/O队列等待太长，系统上运行的应用程序将变慢，此时可以通过更换更快的硬盘来解决问题。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> %util：衡量磁盘I/O重要指标，如%util接近100%，表示磁盘产生的I/O请求太多，I/O系统已经满负荷工作，该磁盘可能存在瓶颈。可优化程序或者 通过更换 更高、更快的磁盘。</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -v</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">09:13:34 PM       LINUX RESTART</span><br><span class="line"></span><br><span class="line">09:20:01 PM dentunusd   file-nr  inode-nr    pty-nr</span><br><span class="line">09:30:01 PM      8571      1088     17484         1</span><br><span class="line">09:40:01 PM      8574      1120     17481         1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进程、inode、文件和锁表状态</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dentunusd：在缓冲目录条目中没有使用的条目数量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> file-nr：被系统使用的文件句柄数量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> inode-nr：已经使用的索引数量 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pty-nr：使用的pty数量</span></span><br><span class="line">================================================================================</span><br><span class="line">这里面的索引和文件句柄值不是ulimit -a查看到的值，而是sysctl.conf里面定义的和内核相关的值， max-file表示系统级别的能够打开的文件句柄的数量， 而ulimit -n控制进程级别能够打开的文件句柄的数量，可以使用sysctl  -a | grep inode和sysctl  -a | grep file查看，具体含义如下：</span><br><span class="line"></span><br><span class="line">file-max中指定了系统范围内所有进程可打开的文件句柄的数量限制(系统级别， kernel-level)。 （The value in file-max denotes the maximum number of file handles that the Linux kernel will allocate）。当收到"Too many open files in system"这样的错误消息时， 就应该增加这个值了。</span><br><span class="line">[root@test ~]# cat /proc/sys/fs/file-max</span><br><span class="line">95823</span><br><span class="line">[root@test ~]# echo 100000 &gt; /proc/sys/fs/file-max</span><br><span class="line">或者</span><br><span class="line">[root@test ~]# echo ""fs.file-max=65535" &gt;&gt; /etc/sysctl.conf</span><br><span class="line">[root@test ~]# sysctl -p</span><br><span class="line">file-nr 可以查看系统中当前打开的文件句柄的数量。 他里面包括3个数字： 第一个表示已经分配了的文件描述符数量， 第二个表示空闲的文件句柄数量， 第三个表示能够打开文件句柄的最大值（跟file-max一致）。  内核会动态的分配文件句柄， 但是不会再次释放他们（这个可能不适应最新的内核了， 在我的file-nr中看到第二列一直为0， 第一列有增有减）	</span><br><span class="line">man bash， 找到说明ulimit的那一节：提供对shell及其启动的进程的可用资源（包括文件句柄， 进程数量， core文件大小等）的控制。 这是进程级别的， 也就是说系统中某个session及其启动的每个进程能打开多少个文件描述符， 能fork出多少个子进程等... 当达到上限时， 会报错"Too many open files"或者遇上Socket/File: Can’t open so many files等</span><br><span class="line">================================================================================</span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -n DEV 1 1</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:52:46 PM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</span><br><span class="line">11:52:47 PM     ens35      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">11:52:47 PM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">11:52:47 PM     ens33      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"><span class="meta">#</span><span class="bash"> 每间隔1秒统计一次，总计统计1次</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sar -n选项使用6个不同的开关：DEV，EDEV，NFS，NFSD，SOCK，IP，EIP，ICMP，EICMP，TCP，ETCP，UDP，SOCK6，IP6，EIP6，ICMP6，EICMP6和UDP6 ，DEV显示网络接口信息，EDEV显示关于网络错误的统计数据，NFS统计活动的NFS客户端的信息，NFSD统计NFS服务器的信息，SOCK显示套接字信息，ALL显示所有5个开关。它们可以单独或者一起使用。 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IFACE：本地网卡接口的名称</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rxpck/s：每秒钟接受的数据包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> txpck/s：每秒钟发送的数据库</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rxKB/S：每秒钟接受的数据包大小，单位为KB</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> txKB/S：每秒钟发送的数据包大小，单位为KB</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rxcmp/s：每秒钟接受的压缩数据包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> txcmp/s：每秒钟发送的压缩包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rxmcst/s：每秒钟接收的多播数据包  </span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -n EDEV 1 1</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:55:30 PM     IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s</span><br><span class="line">11:55:31 PM     ens35      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">11:55:31 PM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">11:55:31 PM     ens33      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计网络设备通信失败信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IFACE：网卡名称</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rxerr/s：每秒钟接收到的损坏的数据包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> txerr/s：每秒钟发送的数据包错误数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> coll/s：当发送数据包时候，每秒钟发生的冲撞（collisions）数，这个是在半双工模式下才有</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rxdrop/s：当由于缓冲区满的时候，网卡设备接收端每秒钟丢掉的网络包的数目</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> txdrop/s：当由于缓冲区满的时候，网络设备发送端每秒钟丢掉的网络包的数目</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> txcarr/s：当发送数据包的时候，每秒钟载波错误发生的次数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rxfram：在接收数据包的时候，每秒钟发生的帧对其错误的次数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rxfifo：在接收数据包的时候，每秒钟缓冲区溢出的错误发生的次数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> txfifo：在发生数据包 的时候，每秒钟缓冲区溢出的错误发生的次数</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -n SOCK 1 1    </span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:57:03 PM    totsck    tcpsck    udpsck    rawsck   ip-frag    tcp-tw</span><br><span class="line">11:57:04 PM       568         3         4         0         0         0</span><br><span class="line">Average:          568         3         4         0         0         0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计socket连接信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> totsck：当前被使用的socket总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tcpsck：当前正在被使用的TCP的socket总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> udpsck：当前正在被使用的UDP的socket总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rawsck：当前正在被使用于RAW的skcket总数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span>-frag：当前的IP分片的数目</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tcp-tw：TCP套接字中处于TIME-WAIT状态的连接数量</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# sar -n TCP 1 3</span><br><span class="line">Linux 3.10.0-693.el7.x86_64 (test)      01/16/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:59:25 PM  active/s passive/s    iseg/s    oseg/s</span><br><span class="line">11:59:26 PM      0.00      0.00      0.00      0.00</span><br><span class="line">11:59:27 PM      0.00      0.00      1.00      1.00</span><br><span class="line">11:59:28 PM      0.00      0.00      1.00      1.00</span><br><span class="line">Average:         0.00      0.00      0.67      0.67</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP连接的统计</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active/s：新的主动连接</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> passive/s：新的被动连接</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> iseg/s：接受的段</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> oseg/s：输出的段</span></span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line">sar -n 使用总结</span><br><span class="line">-n DEV ： 网络接口统计信息。</span><br><span class="line">-n EDEV ： 网络接口错误。</span><br><span class="line">-n IP ： IP数据报统计信息。</span><br><span class="line">-n EIP ： IP错误统计信息。</span><br><span class="line">-n TCP ： TCP统计信息。</span><br><span class="line">-n ETCP ： TCP错误统计信息。</span><br><span class="line">-n SOCK ： 套接字使用。</span><br><span class="line">================================================================================</span><br><span class="line"></span><br><span class="line">常用命令</span><br><span class="line">sar -b 5 5：IO传送速率</span><br><span class="line">sar -B 5 5：页交换速率</span><br><span class="line">sar -c 5 5：进程创建的速率</span><br><span class="line">sar -d 5 5：块设备的活跃信息</span><br><span class="line">sar -n DEV 5 5：网路设备的状态信息</span><br><span class="line">sar -n SOCK 5 5：SOCK的使用情况</span><br><span class="line">sar -n ALL 5 5：所有的网络状态信息</span><br><span class="line">sar -P ALL 5 5：每颗CPU的使用状态信息和IOWAIT统计状态 </span><br><span class="line">sar -q 5 5：队列的长度（等待运行的进程数）和负载的状态</span><br><span class="line">sar -r 5 5：内存和swap空间使用情况</span><br><span class="line">sar -R 5 5：内存的统计信息（内存页的分配和释放、系统每秒作为BUFFER使用内存页、每秒被cache到的内存页）</span><br><span class="line">sar -u 5 5：CPU的使用情况和IOWAIT信息（同默认监控）</span><br><span class="line">sar -v 5 5 ：inode, file and other kernel tablesd的状态信息</span><br><span class="line">sar -w 5 5 ：每秒上下文交换的数目</span><br><span class="line">sar -W 5 5：SWAP交换的统计信息(监控状态同iostat 的si so)</span><br><span class="line">sar -x 2906 5 5：显示指定进程(2906)的统计信息，信息包括：进程造成的错误、用户级和系统级用户CPU的占用情况、运行在哪颗CPU上</span><br><span class="line">sar -y 5 5：TTY设备的活动状态</span><br><span class="line">sar将结果输出到文件(-o)和读取记录信息(-f)</span><br></pre></td></tr></table></figure>
<h3 id="netstat命令"><a href="#netstat命令" class="headerlink" title="netstat命令"></a>netstat命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">功能说明：显示网络状态。</span><br><span class="line">语　　法：netstat [-acCeFghilMnNoprstuvVwx] [-A&lt;网络类型&gt;][--ip]</span><br><span class="line">补充说明：利用netstat指令可让你得知整个Linux系统的网络情况。</span><br><span class="line">参　　数：</span><br><span class="line">-a 或--all：显示所有连线中的Socket。</span><br><span class="line">-A ：&lt;网络类型&gt;或–&lt;网络类型&gt; 列出该网络类型连线中的相关地址。</span><br><span class="line">-c或--continuous：持续列出网络状态。</span><br><span class="line">-C或--cache：显示路由器配置的快取信息。</span><br><span class="line">-e或--extend：显示网络其他相关信息。</span><br><span class="line">-F或--fib：显示FIB。</span><br><span class="line">-g或--groups：显示多重广播功能群组组员名单。</span><br><span class="line">-h或--help：在线帮助。</span><br><span class="line">-i或--interfaces：显示网络界面信息表单。</span><br><span class="line">-l或--listening：显示监控中的服务器的Socket。</span><br><span class="line">-M或--masquerade：显示伪装的网络连线。</span><br><span class="line">-n或--numeric：直接使用IP地址，而不通过域名服务器。</span><br><span class="line">-N或--netlink或--symbolic：显示网络硬件外围设备的符号连接名称。</span><br><span class="line">-o或--timers：显示计时器。</span><br><span class="line">-p或--programs：显示正在使用Socket的程序识别码和程序名称。</span><br><span class="line">-r或--route：显示 Routing Table。</span><br><span class="line">-s或--statistice：显示网络工作信息统计表。</span><br><span class="line">-t或--tcp：显示TCP 传输协议的连线状况。</span><br><span class="line">-u或--udp：显示UDP传输协议的连线状况。</span><br><span class="line">-v或--verbose：显示指令执行过程。</span><br><span class="line">-V或--version：显示版本信息。</span><br><span class="line">-w或--raw：显示RAW传输协议的连线状况。</span><br><span class="line">-x或--unix：此参数的效果和指定”-A unix”参数相同。</span><br><span class="line">–ip或--inet：此参数的效果和指定”-A inet”参数相同。</span><br><span class="line"></span><br><span class="line">网络连接状态详解</span><br><span class="line">共有12中可能的状态，前面11种是按照TCP连接建立的三次握手和TCP连接断开的四次挥手过程来描述的。</span><br><span class="line">1. LISTEN：首先服务端需要打开一个socket进行监听，状态为LISTEN。/* The socket is listening for incoming connections. 侦听来自远方TCP端口的连接请求*/</span><br><span class="line">2. SYN_SENT：客户端通过应用程序调用connect进行active open。于是客户端tcp发送一个SYN以请求建立一个连接。之后状态置为SYN_SENT。/*The socket is actively attempting to establish a connection. 在发送连接请求后等待匹配的连接请求 */</span><br><span class="line">3. SYN_RECV：服务端应发出ACK确认客户端的 SYN，同时自己向客户端发送一个SYN。之后状态置为SYN_RECV。/* A connection request has been received from the network. 在收到和发送一个连接请求后等待对连接请求的确认 */</span><br><span class="line">4. ESTABLISHED：代表一个打开的连接，双方可以进行或已经在数据交互了。/* The socket has an established connection. 代表一个打开的连接，数据可以传送给用户 */</span><br><span class="line">5. FIN_WAIT1：主动关闭(active close)端应用程序调用close，于是其TCP发出FIN请求主动关闭连接，之后进入FIN_WAIT1状态。/* The socket is closed, and the connection is shutting down. 等待远程TCP的连接中断请求，或先前的连接中断请求的确认 */</span><br><span class="line">6. CLOSE_WAIT：被动关闭(passive close)端TCP接到FIN后，就发出ACK以回应FIN请求(它的接收也作为文件结束符传递给上层应用程序)，并进入CLOSE_WAIT。/* The remote end has shut down, waiting for the socket to close. 等待从本地用户发来的连接中断请求 */</span><br><span class="line">7. FIN_WAIT2：主动关闭端接到ACK后，就进入了 FIN-WAIT-2 。/* Connection is closed, and the socket is waiting for a shutdown from the remote end. 从远程TCP等待连接中断请求 */</span><br><span class="line">8. LAST_ACK:：被动关闭端一段时间后，接收到文件结束符的应用程序将调用CLOSE关闭连接。这导致它的TCP也发送一个 FIN，等待对方的ACK。就进入了LAST-ACK 。/* The remote end has shut down, and the socket is closed. Waiting for acknowledgement. 等待原来发向远程TCP的连接中断请求的确认 */</span><br><span class="line">9. TIME_WAIT：在主动关闭端接收到FIN后，TCP 就发送ACK包，并进入TIME-WAIT状态。/* The socket is waiting after close to handle packets still in the network.等待足够的时间以确保远程TCP接收到连接中断请求的确认 */</span><br><span class="line">10. CLOSING: 比较少见。/* Both sockets are shut down but we still don’t have all our data sent. 等待远程TCP对连接中断的确认 */</span><br><span class="line">11. CLOSED：被动关闭端在接受到ACK包后，就进入了closed的状态。连接结束。/* The socket is not being used. 没有任何连接状态 */</span><br><span class="line">12. UNKNOWN：未知的Socket状态。/* The state of the socket is unknown. */</span><br><span class="line"></span><br><span class="line">SYN： (同步序列编号，Synchronize Sequence Numbers)该标志仅在三次握手建立TCP连接时有效。表示一个新的TCP连接请求。</span><br><span class="line">ACK：(确认编号，Acknowledgement Number)是对TCP请求的确认标志，同时提示对端系统已经成功接收所有数据。</span><br><span class="line">FIN： (结束标志，FINish)用来结束一个TCP回话。但对应端口仍处于开放状态，准备接收后续数据。</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@test ~]# netstat -a</span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有端口</span></span><br><span class="line">[root@test ~]# netstat -at</span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有TCP端口</span></span><br><span class="line">[root@test ~]# netstat -au</span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有UDP端口</span></span><br><span class="line">[root@test ~]# netstat -l</span><br><span class="line"><span class="meta">#</span><span class="bash"> 只显示监听端口</span></span><br><span class="line">[root@test ~]# netstat -lt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示监听TCP端口</span></span><br><span class="line">[root@test ~]# netstat -lu</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示监听UDP端口</span></span><br><span class="line">[root@test ~]# netstat -lx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示监听UNIX端口</span></span><br><span class="line">[root@test ~]# netstat -s</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示所有端口的统计信息</span></span><br><span class="line">[root@test ~]# netstat -st</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示所有TCP的统计信息</span></span><br><span class="line">[root@test ~]# netstat -su</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示所有UDP的统计信息</span></span><br><span class="line">[root@test ~]# netstat -p</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示 PID 和进程名称</span></span><br><span class="line">[root@test ~]# netstat -r</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">default         bogon           0.0.0.0         UG        0 0          0 ens33</span><br><span class="line">172.16.106.0    0.0.0.0         255.255.255.0   U         0 0          0 ens35</span><br><span class="line">192.168.1.0     0.0.0.0         255.255.255.0   U         0 0          0 ens33</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示核心路由信息</span></span><br><span class="line">[root@test ~]# netstat -rn</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">0.0.0.0         192.168.1.1     0.0.0.0         UG        0 0          0 ens33</span><br><span class="line">172.16.106.0    0.0.0.0         255.255.255.0   U         0 0          0 ens35</span><br><span class="line">192.168.1.0     0.0.0.0         255.255.255.0   U         0 0          0 ens33</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示数字格式，不查询主机名称</span></span><br><span class="line">[root@test ~]# netstat -c</span><br><span class="line"><span class="meta">#</span><span class="bash"> netstat 将每隔一秒输出网络信息</span></span><br><span class="line">[root@test ~]# netstat -ie</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示网络接口列表详细信息，结果如ifconfig</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# netstat -ant|grep "192.168.1.14:22"|awk '&#123;print $5&#125;'|sort|uniq -c|sort -nr|head -20</span><br><span class="line">      1 192.168.1.9:51292</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看连接某服务端口最多的的IP地址。uniq的-c或--count选项是在每列旁边显示该行重复出现的次数。</span></span><br><span class="line"></span><br><span class="line">[root@test ~]# netstat -nat |awk '&#123;print $6&#125;'|sort|uniq -c|sort -rn</span><br><span class="line">      4 LISTEN</span><br><span class="line">      1 Foreign</span><br><span class="line">      1 ESTABLISHED</span><br><span class="line">      1 established)</span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP各种状态列表</span></span><br></pre></td></tr></table></figure>
<h3 id="系统连接状态"><a href="#系统连接状态" class="headerlink" title="系统连接状态"></a>系统连接状态</h3><h4 id="查看TCP连接状态"><a href="#查看TCP连接状态" class="headerlink" title="查看TCP连接状态"></a>查看TCP连接状态</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">netstat -nat |awk '&#123;print $6&#125;'|sort|uniq -c|sort -rn</span><br><span class="line">netstat -n | awk  '/^tcp/ &#123;++S[$NF]&#125;;END &#123;for(a in S) print a, S[a]&#125;'</span><br><span class="line">netstat -n | awk '/^tcp/ &#123;++state[$NF]&#125;; END &#123;for(key in state) print key,"\t",state[key]&#125;'</span><br><span class="line">netstat -n | awk '/^tcp/ &#123;++arr[$NF]&#125;;END &#123;for(k in arr) print k,"\t",arr[k]&#125;'</span><br><span class="line">netstat -n |awk '/^tcp/ &#123;print $NF&#125;'|sort|uniq -c|sort -rn</span><br><span class="line">netstat -ant | awk '&#123;print $NF&#125;' | grep -v '[a-z]' | sort | uniq -c</span><br></pre></td></tr></table></figure>
<h4 id="查找请求数请20个IP（常用于查找攻击来源）"><a href="#查找请求数请20个IP（常用于查找攻击来源）" class="headerlink" title="查找请求数请20个IP（常用于查找攻击来源）"></a>查找请求数请20个IP（常用于查找攻击来源）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -anlp|grep 80|grep tcp|awk '&#123;print $5&#125;'|awk -F: '&#123;print $1&#125;'|sort|uniq -c|sort -nr|head -n20</span><br><span class="line">netstat -ant |awk '/:80/&#123;split($5,ip,':');++A[ip[1]]&#125;END&#123;for(i in A) print A[i],i&#125;' |sort -rn|head -n20</span><br></pre></td></tr></table></figure>
<h4 id="用tcpdump嗅探80端口的访问看看谁最高"><a href="#用tcpdump嗅探80端口的访问看看谁最高" class="headerlink" title="用tcpdump嗅探80端口的访问看看谁最高"></a>用tcpdump嗅探80端口的访问看看谁最高</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# tcpdump -i ens33 -tnn dst port 80 -c 1000 | awk -F"." '&#123;print $1"."$2"."$3"."$4&#125;' | sort | uniq -c | sort -nr |head -20</span><br></pre></td></tr></table></figure>
<h4 id="查找较多time-wait连接"><a href="#查找较多time-wait连接" class="headerlink" title="查找较多time_wait连接"></a>查找较多time_wait连接</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -n|grep TIME_WAIT|awk '&#123;print $5&#125;'|sort|uniq -c|sort -rn|head -n20</span><br></pre></td></tr></table></figure>
<h4 id="找查较多的SYN连接"><a href="#找查较多的SYN连接" class="headerlink" title="找查较多的SYN连接"></a>找查较多的SYN连接</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an | grep SYN | awk '&#123;print $5&#125;' | awk -F: '&#123;print $1&#125;' | sort | uniq -c | sort -nr | more</span><br></pre></td></tr></table></figure>
<h4 id="根据端口列进程PID"><a href="#根据端口列进程PID" class="headerlink" title="根据端口列进程PID"></a>根据端口列进程PID</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ntlp | grep 80 | awk '&#123;print $7&#125;' | cut -d/ -f1</span><br></pre></td></tr></table></figure>
<h3 id="网站日志分析（Apache）"><a href="#网站日志分析（Apache）" class="headerlink" title="网站日志分析（Apache）"></a>网站日志分析（Apache）</h3><h4 id="获得访问前10位的ip地址"><a href="#获得访问前10位的ip地址" class="headerlink" title="获得访问前10位的ip地址"></a>获得访问前10位的ip地址</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat access.log|awk '&#123;print $1&#125;'|sort|uniq -c|sort -nr|head -10</span><br><span class="line">cat access.log|awk '&#123;counts[$(11)]+=1&#125;; END &#123;for(url in counts) print counts[url], url&#125;'</span><br></pre></td></tr></table></figure>
<h4 id="访问次数最多的文件或页面-取前20"><a href="#访问次数最多的文件或页面-取前20" class="headerlink" title="访问次数最多的文件或页面,取前20"></a>访问次数最多的文件或页面,取前20</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log|awk '&#123;print $11&#125;'|sort|uniq -c|sort -nr|head -20</span><br></pre></td></tr></table></figure>
<h4 id="列出传输最大的几个exe文件（分析下载站的时候常用）"><a href="#列出传输最大的几个exe文件（分析下载站的时候常用）" class="headerlink" title="列出传输最大的几个exe文件（分析下载站的时候常用）"></a>列出传输最大的几个exe文件（分析下载站的时候常用）</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log |awk '($7~/\.exe/)&#123;print $10 " " $1 " " $4 " " $7&#125;'|sort -nr|head -20</span><br></pre></td></tr></table></figure>
<h4 id="列出输出大于200000byte-约200kb-的exe文件以及对应文件发生次数"><a href="#列出输出大于200000byte-约200kb-的exe文件以及对应文件发生次数" class="headerlink" title="列出输出大于200000byte(约200kb)的exe文件以及对应文件发生次数"></a>列出输出大于200000byte(约200kb)的exe文件以及对应文件发生次数</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log |awk '($10 &gt; 200000 &amp;&amp; $7~/\.exe/)&#123;print $7&#125;'|sort -n|uniq -c|sort -nr|head -100</span><br></pre></td></tr></table></figure>
<h4 id="如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面"><a href="#如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面" class="headerlink" title="如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面"></a>如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log |awk '($7~/\.php/)&#123;print $NF " " $1 " " $4 " " $7&#125;'|sort -nr|head -100</span><br></pre></td></tr></table></figure>
<h4 id="列出最最耗时的页面-超过60秒的-的以及对应页面发生次数"><a href="#列出最最耗时的页面-超过60秒的-的以及对应页面发生次数" class="headerlink" title="列出最最耗时的页面(超过60秒的)的以及对应页面发生次数"></a>列出最最耗时的页面(超过60秒的)的以及对应页面发生次数</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log |awk '($NF &gt; 60 &amp;&amp; $7~/\.php/)&#123;print $7&#125;'|sort -n|uniq -c|sort -nr|head -100</span><br></pre></td></tr></table></figure>
<h4 id="列出传输时间超过-30-秒的文件"><a href="#列出传输时间超过-30-秒的文件" class="headerlink" title="列出传输时间超过 30 秒的文件"></a>列出传输时间超过 30 秒的文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log |awk '($NF &gt; 30)&#123;print $7&#125;'|sort -n|uniq -c|sort -nr|head -20</span><br></pre></td></tr></table></figure>
<h4 id="统计网站流量（G"><a href="#统计网站流量（G" class="headerlink" title="统计网站流量（G)"></a>统计网站流量（G)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log |awk '&#123;sum+=$10&#125; END &#123;print sum/1024/1024/1024&#125;'</span><br></pre></td></tr></table></figure>
<h4 id="统计404的连接"><a href="#统计404的连接" class="headerlink" title="统计404的连接"></a>统计404的连接</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '($9 ~/404/)' access.log | awk '&#123;print $9,$7&#125;' | sort</span><br></pre></td></tr></table></figure>
<h4 id="统计http-status"><a href="#统计http-status" class="headerlink" title="统计http status"></a>统计http status</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat access.log |awk '&#123;counts[$(9)]+=1&#125;; END &#123;for(code in counts) print code, counts[code]&#125;'</span><br><span class="line">cat access.log |awk '&#123;print $9&#125;'|sort|uniq -c|sort -rn</span><br></pre></td></tr></table></figure>
<h4 id="蜘蛛分析"><a href="#蜘蛛分析" class="headerlink" title="蜘蛛分析"></a>蜘蛛分析</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/tcpdump -i eth0 -l -s 0 -w - dst port 80 | strings | grep -i user-agent | grep -i -E 'bot|crawler|slurp|spider'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是哪些蜘蛛在抓取内容</span></span><br></pre></td></tr></table></figure>
<h4 id="网站日分析Squid"><a href="#网站日分析Squid" class="headerlink" title="网站日分析Squid"></a>网站日分析Squid</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat squid_access.log.tar.gz| awk '&#123;print $10,$7&#125;' |awk 'BEGIN&#123;FS="[ /]"&#125;&#123;trfc[$4]+=$1&#125;END&#123;for(domain in trfc)&#123;printf "%s\t%d\n",domain,trfc[domain]</span><br></pre></td></tr></table></figure>
<h3 id="查看数据库执行的sql"><a href="#查看数据库执行的sql" class="headerlink" title="查看数据库执行的sql"></a>查看数据库执行的sql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 -s 0 -l -w - dst port 3306 | strings | egrep -i 'SELECT|UPDATE|DELETE|INSERT|SET|COMMIT|ROLLBACK|CREATE|DROP|ALTER|CALL'</span><br></pre></td></tr></table></figure>
<h3 id="系统Debug分析"><a href="#系统Debug分析" class="headerlink" title="系统Debug分析"></a>系统Debug分析</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">strace -p pid</span><br><span class="line"><span class="meta">#</span><span class="bash"> 调试命令</span></span><br><span class="line"></span><br><span class="line">gdb -p pid</span><br><span class="line"><span class="meta">#</span><span class="bash"> 跟踪指定进程的PID</span></span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/性能监控/" rel="tag"># 性能监控</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/13/shellScript语法及使用方法/" rel="next" title="shellScript语法及使用方法">
                <i class="fa fa-chevron-left"></i> shellScript语法及使用方法
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/17/tomcat部署/" rel="prev" title="tomcat部署">
                tomcat部署 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            本站概要
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ruopu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">130</span>
                    <span class="site-state-item-name">文章</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">28</span>
                    <span class="site-state-item-name">分類</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">100</span>
                    <span class="site-state-item-name">標籤</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#CPU查看"><span class="nav-number">1.</span> <span class="nav-text">CPU查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内存查看"><span class="nav-number">2.</span> <span class="nav-text">内存查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#磁盘查看"><span class="nav-number">3.</span> <span class="nav-text">磁盘查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他参数"><span class="nav-number">4.</span> <span class="nav-text">其他参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uptime命令"><span class="nav-number">5.</span> <span class="nav-text">uptime命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PS命令"><span class="nav-number">6.</span> <span class="nav-text">PS命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#top命令"><span class="nav-number">7.</span> <span class="nav-text">top命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iostat命令"><span class="nav-number">8.</span> <span class="nav-text">iostat命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vmstat命令"><span class="nav-number">9.</span> <span class="nav-text">vmstat命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sar命令"><span class="nav-number">10.</span> <span class="nav-text">sar命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#netstat命令"><span class="nav-number">11.</span> <span class="nav-text">netstat命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统连接状态"><span class="nav-number">12.</span> <span class="nav-text">系统连接状态</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#查看TCP连接状态"><span class="nav-number">12.1.</span> <span class="nav-text">查看TCP连接状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查找请求数请20个IP（常用于查找攻击来源）"><span class="nav-number">12.2.</span> <span class="nav-text">查找请求数请20个IP（常用于查找攻击来源）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用tcpdump嗅探80端口的访问看看谁最高"><span class="nav-number">12.3.</span> <span class="nav-text">用tcpdump嗅探80端口的访问看看谁最高</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查找较多time-wait连接"><span class="nav-number">12.4.</span> <span class="nav-text">查找较多time_wait连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#找查较多的SYN连接"><span class="nav-number">12.5.</span> <span class="nav-text">找查较多的SYN连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根据端口列进程PID"><span class="nav-number">12.6.</span> <span class="nav-text">根据端口列进程PID</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网站日志分析（Apache）"><span class="nav-number">13.</span> <span class="nav-text">网站日志分析（Apache）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#获得访问前10位的ip地址"><span class="nav-number">13.1.</span> <span class="nav-text">获得访问前10位的ip地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问次数最多的文件或页面-取前20"><span class="nav-number">13.2.</span> <span class="nav-text">访问次数最多的文件或页面,取前20</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#列出传输最大的几个exe文件（分析下载站的时候常用）"><span class="nav-number">13.3.</span> <span class="nav-text">列出传输最大的几个exe文件（分析下载站的时候常用）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#列出输出大于200000byte-约200kb-的exe文件以及对应文件发生次数"><span class="nav-number">13.4.</span> <span class="nav-text">列出输出大于200000byte(约200kb)的exe文件以及对应文件发生次数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面"><span class="nav-number">13.5.</span> <span class="nav-text">如果日志最后一列记录的是页面文件传输时间，则有列出到客户端最耗时的页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#列出最最耗时的页面-超过60秒的-的以及对应页面发生次数"><span class="nav-number">13.6.</span> <span class="nav-text">列出最最耗时的页面(超过60秒的)的以及对应页面发生次数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#列出传输时间超过-30-秒的文件"><span class="nav-number">13.7.</span> <span class="nav-text">列出传输时间超过 30 秒的文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#统计网站流量（G"><span class="nav-number">13.8.</span> <span class="nav-text">统计网站流量（G)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#统计404的连接"><span class="nav-number">13.9.</span> <span class="nav-text">统计404的连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#统计http-status"><span class="nav-number">13.10.</span> <span class="nav-text">统计http status</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#蜘蛛分析"><span class="nav-number">13.11.</span> <span class="nav-text">蜘蛛分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#网站日分析Squid"><span class="nav-number">13.12.</span> <span class="nav-text">网站日分析Squid</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看数据库执行的sql"><span class="nav-number">14.</span> <span class="nav-text">查看数据库执行的sql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统Debug分析"><span class="nav-number">15.</span> <span class="nav-text">系统Debug分析</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruopu</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
