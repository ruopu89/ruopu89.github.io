<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="清除日志的三种方法1231. echo &amp;gt; test.log 或 echo &quot;&quot; &amp;gt; test.log2. &amp;gt;test.log3. cat /dev/null &amp;gt; test.log Shell脚本执行方式 当shell脚本以非交互的方式运行时，它会先查找环境变量ENV，该变量指定了一个环境文件（通常是.bashrc），然后从该环境变量文件开始执行，当读取了ENV文件后，SH">
<meta name="keywords" content="ShellScript语法">
<meta property="og:type" content="article">
<meta property="og:title" content="shellScript语法及使用方法">
<meta property="og:url" content="http://yoursite.com/2019/01/13/shellScript语法及使用方法/index.html">
<meta property="og:site_name" content="ruopu&#39;s blog">
<meta property="og:description" content="清除日志的三种方法1231. echo &amp;gt; test.log 或 echo &quot;&quot; &amp;gt; test.log2. &amp;gt;test.log3. cat /dev/null &amp;gt; test.log Shell脚本执行方式 当shell脚本以非交互的方式运行时，它会先查找环境变量ENV，该变量指定了一个环境文件（通常是.bashrc），然后从该环境变量文件开始执行，当读取了ENV文件后，SH">
<meta property="og:locale" content="zh-TW">
<meta property="og:updated_time" content="2019-03-20T07:53:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shellScript语法及使用方法">
<meta name="twitter:description" content="清除日志的三种方法1231. echo &amp;gt; test.log 或 echo &quot;&quot; &amp;gt; test.log2. &amp;gt;test.log3. cat /dev/null &amp;gt; test.log Shell脚本执行方式 当shell脚本以非交互的方式运行时，它会先查找环境变量ENV，该变量指定了一个环境文件（通常是.bashrc），然后从该环境变量文件开始执行，当读取了ENV文件后，SH">






  <link rel="canonical" href="http://yoursite.com/2019/01/13/shellScript语法及使用方法/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>shellScript语法及使用方法 | ruopu's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-TW">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ruopu's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切換導航欄">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首頁</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />標籤</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分類</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />歸檔</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜尋</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜尋..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/13/shellScript语法及使用方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">shellScript语法及使用方法
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-01-13 21:02:43" itemprop="dateCreated datePublished" datetime="2019-01-13T21:02:43+08:00">2019-01-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-03-20 15:53:25" itemprop="dateModified" datetime="2019-03-20T15:53:25+08:00">2019-03-20</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Shell/" itemprop="url" rel="index"><span itemprop="name">Shell</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             閱讀次數： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="清除日志的三种方法"><a href="#清除日志的三种方法" class="headerlink" title="清除日志的三种方法"></a>清除日志的三种方法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. echo &gt; test.log 或 echo "" &gt; test.log</span><br><span class="line">2. &gt;test.log</span><br><span class="line">3. cat /dev/null &gt; test.log</span><br></pre></td></tr></table></figure>
<h3 id="Shell脚本执行方式"><a href="#Shell脚本执行方式" class="headerlink" title="Shell脚本执行方式"></a>Shell脚本执行方式</h3><blockquote>
<p>当shell脚本以非交互的方式运行时，它会先查找环境变量ENV，该变量指定了一个环境文件（通常是.bashrc），然后从该环境变量文件开始执行，当读取了ENV文件后，SHELL才开始执行shell脚本中的内容。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. bash script-name或sh script-name（推荐使用）；没有执行权限也可以执行。</span><br><span class="line">2. path/script-name或./script-name（当前路径 下执行脚本）</span><br><span class="line">3. source script-name或. script-name</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意“.”点号；使用<span class="built_in">source</span>或点号来加载或读入脚本，然后，依次执行指定shell脚本文件son.sh中的所有语句。这些语句将作为当前父shell脚本father.sh进程的一部分运行。因此，使用<span class="built_in">source</span>或点号可以将son.sh自身脚本中的变量的值或函数等的返回值传递到当前的父shell脚本father.sh中使用。这就是在脚本中使用点或<span class="built_in">source</span>加载文件的意义，为使用加载的文件中的内容可被当前脚本使用。这是第三种方法与前两种的最大区别。</span></span><br><span class="line">全局环境变量：/etc/profile、/etc/profile.d、/etc/bashrc</span><br><span class="line">用户环境变量：./bash_profile、.bashrc</span><br><span class="line">例：</span><br><span class="line">[root@template sh]# vim tesh1.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">userdir=`pwd`</span><br><span class="line">[root@template sh]# chmod +x tesh1.sh </span><br><span class="line">[root@template sh]# bash tesh1.sh </span><br><span class="line">[root@template sh]# echo $userdir</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 没有执行结果</span></span><br><span class="line">[root@template sh]# . tesh1.sh </span><br><span class="line">[root@template sh]# echo $userdir</span><br><span class="line">/root/sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用<span class="built_in">source</span>或点号执行后，再用<span class="built_in">echo</span>命令执行才有结果。用<span class="built_in">source</span>或点号执行才能将变量加载到当前环境变量。</span></span><br></pre></td></tr></table></figure>
<h3 id="shell脚本开发基本规范及习惯"><a href="#shell脚本开发基本规范及习惯" class="headerlink" title="shell脚本开发基本规范及习惯"></a>shell脚本开发基本规范及习惯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1. 开头指定脚本解释器</span><br><span class="line">2. 开头加版本版权等信息</span><br><span class="line">    #Date: 16:29 2012-3-30	时间</span><br><span class="line">    #Authou: oldboy	作者</span><br><span class="line">    #Mail：aaaa@qq.com	联系方式</span><br><span class="line">    #Function：this scripts function is ...	脚本的功能是什么 </span><br><span class="line">    #Version： 1.1	脚本的版本号</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可配置vim编辑文件时自动加上以上信息，方法是修改~/.vimrc配置文件</span></span><br><span class="line">3. 脚本中不用中文件注释</span><br><span class="line">4. 脚本以.sh为扩展名</span><br><span class="line">5. 代码书写优秀习惯</span><br><span class="line">    1. 成对内容的一次写出来，防止挂失</span><br><span class="line">    2. []中括号两端要有空格</span><br><span class="line">    3. 流程控制语句一次书写完</span><br><span class="line">        if 条件内容</span><br><span class="line">        then</span><br><span class="line">            内容</span><br><span class="line">        fi</span><br><span class="line">6. 通过缩进让代码易读</span><br></pre></td></tr></table></figure>
<h3 id="变量分类"><a href="#变量分类" class="headerlink" title="变量分类"></a>变量分类</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">* 变量分两类：环境变量（全局变量）和局部变量</span><br><span class="line"></span><br><span class="line">* 环境变量可以在命令中设置，但用户退出时这些变量值也会丢失，因此最好在用户家目录下的.bash_profile文件中或全局设置/etc/bashrc，/etc/profile文件或者/etc/profile.d中定义。将环境变量放入profile文件中，每次用户登录时这些变量值都将被初始化。</span><br><span class="line"></span><br><span class="line">* 有一些环境变量，比如HOME、PATH、SHELL、UID、USER等，在用户登录之前就已经被/bin/login程序设置好了。通常环境变量定义并保存在用户家目录下的.bash_profile文件中</span><br><span class="line"></span><br><span class="line">* PS1环境变量定义用户登录后的提示符如[\u@\h \W]$，\u表示用户名，\h表示主机名，\W表示路径</span><br><span class="line"></span><br><span class="line">TMOUT＝3600，此变量表示多久不操作就退出终端</span><br><span class="line">UID＝0，此变量表示用户的UID</span><br><span class="line">USER＝root，此变量表示当前用户的用户名</span><br><span class="line">HISTFILESIZE=50，历史文件能包含的最大行数</span><br><span class="line">HISTSIZE=50，记录在命令行历史文件中的命令行数</span><br><span class="line">HISTFILE=/root/.bash_history，历史记录文件的全路径 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 上面的环境变量都可以加到/etc/profile文件中，加入后用<span class="built_in">source</span>或点号加载生效。</span></span><br><span class="line"></span><br><span class="line">*  设置环境变量要在给环境变量赋值后或设置变量时用export命令。带-x选项的declare内置命令也可以完成同样的功能。（注意：输出变量时不要在变量名前加$）</span><br><span class="line">1. export 变量名＝value</span><br><span class="line">2. 变量名＝value --&gt; export 变量名</span><br><span class="line">3. declare -x 变量名＝value</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以查看/etc/profile文件中是如何定义变量的</span></span><br><span class="line">用unset 变量名取消环境变量，变量名前不要加$符号。如果要永久生效，也要写到/etc/profile中。</span><br><span class="line"></span><br><span class="line">* 局部变量</span><br><span class="line">变量名＝value</span><br><span class="line">变量名＝'value'</span><br><span class="line">变量名="value"</span><br><span class="line">shell中变量名的要求：一般是字母，数字，下划线组成。字母开头</span><br><span class="line"></span><br><span class="line">* 自定义变量建议</span><br><span class="line">1. 纯数字（不带空格），定义方式可以不加引号（单或双）</span><br><span class="line">2. 没特殊情况，字符串一般用双引号定义，特别是多个字符串中间有空格时</span><br><span class="line">3. 变量内容需要原样输出时，要用单引号''</span><br><span class="line"></span><br><span class="line">* 变量命名规范</span><br><span class="line">1. 变量命名要统一，使用全部大写字母</span><br><span class="line">2. 避免无含义字符或数字</span><br><span class="line"><span class="meta">#</span><span class="bash"> 看/etc/init.d/<span class="built_in">functions</span>脚本中如何定义变量</span></span><br><span class="line"></span><br><span class="line">* 把命令定义为变量，就是将命令的执行结果给变量，用反引号或$()括起命令即可。</span><br><span class="line">tar zcf etc_$&#123;cmd&#125;_oldboy.tar.gz /etc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里cmd是自定义的变量，但如果要这样使用，要用大括号括起，因为如果不括起，系统就不能分辨出哪个是变量，可以会找<span class="variable">$cmd_oldboy</span>，这会执行错误。</span></span><br></pre></td></tr></table></figure>
<h3 id="位置变量"><a href="#位置变量" class="headerlink" title="位置变量"></a>位置变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">0：获取当前执行的shell脚本的文件名</span></span><br><span class="line"><span class="meta">$</span><span class="bash">n：获取当前执行的shell脚本的第n个参数</span></span><br><span class="line"><span class="meta">$</span><span class="bash">*：获取当前shell的所有参数，将所有的命令行参数视为单个字符</span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="comment">#：获取当前shell命令行中参数的总个数</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">!：执行上一个指令的PID</span></span><br><span class="line"><span class="meta">$</span><span class="bash">?：获取执行结果返回值</span></span><br><span class="line">        执行结果返回值的意义：</span><br><span class="line">        0：正确执行</span><br><span class="line">        2：权限拒绝</span><br><span class="line">        1－125：表示运行失败</span><br><span class="line">        126：找到该命令了，但是无法执行</span><br><span class="line">        127：未找到要运行的命令</span><br><span class="line">        &gt;128：命令被系统强制结束</span><br><span class="line"><span class="meta">$</span><span class="bash">$：获取当前shell的进程号（PID）</span></span><br><span class="line"><span class="meta">$</span><span class="bash">_：在此之前执行的命令或脚本的最后一个参数</span></span><br><span class="line"><span class="meta">$</span><span class="bash">@：这个程序的所有参数，如<span class="string">"<span class="variable">$1</span>"</span> <span class="string">"<span class="variable">$2</span>"</span> <span class="string">"<span class="variable">$3</span>"</span>...</span></span><br><span class="line">=======================================================================================</span><br><span class="line"><span class="meta">$</span><span class="bash">*与 <span class="variable">$@</span>区别</span></span><br><span class="line"><span class="meta">$</span><span class="bash">*：将所有的命令行所有参数视为单个字符串，等同于“<span class="variable">$1</span><span class="variable">$2</span><span class="variable">$3</span>”</span></span><br><span class="line"><span class="meta">$</span><span class="bash">@：将命令行每个参数视为单独的字符串，等同于<span class="string">"<span class="variable">$1</span>"</span><span class="string">"<span class="variable">$2</span>"</span><span class="string">"<span class="variable">$3</span>"</span>。这是将参数传递给其他程序的最佳 方式，因为他会促使所有内嵌在每个参数里的任何空白。</span></span><br><span class="line">=======================================================================================</span><br><span class="line">例：</span><br><span class="line">sh n.sh "1 2 3"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用引号括起的部分表示一个参数。</span></span><br><span class="line"></span><br><span class="line">basename：获取名称，也就是最后的一段</span><br><span class="line">dirname：获取文件所在路径，也就是最后一段前面的内容</span><br></pre></td></tr></table></figure>
<h3 id="常用内部命令"><a href="#常用内部命令" class="headerlink" title="常用内部命令"></a>常用内部命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">echo</span><br><span class="line"></span><br><span class="line">exec</span><br><span class="line"></span><br><span class="line">eval</span><br><span class="line"></span><br><span class="line">export</span><br><span class="line"></span><br><span class="line">readonly</span><br><span class="line"></span><br><span class="line">read</span><br><span class="line"></span><br><span class="line">shift</span><br><span class="line"><span class="meta">#</span><span class="bash"> 按如下方式重新命名所有的位置参数变量，即<span class="variable">$2</span>成为<span class="variable">$1</span>，<span class="variable">$3</span>成为<span class="variable">$2</span>...在程序中每使用一次<span class="built_in">shift</span>语句，都使所有的位置参数依次向左移动一个位置，并使位置参数<span class="variable">$#</span>减1，直到减到0为止。可以查看ssh-copy-id脚本是如何使用<span class="built_in">shift</span>的</span></span><br><span class="line"></span><br><span class="line">wait</span><br><span class="line"></span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">点</span><br></pre></td></tr></table></figure>
<h3 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">* 判断读取字符串的值</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var&#125;：变量var的值, 与<span class="variable">$var</span>相同</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var-DEFAULT&#125;：如果var没有被声明, 那么就以<span class="variable">$DEFAULT</span>作为其值 *</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var:-DEFAULT&#125;：如果var没有被声明, 或者其值为空, 那么就以<span class="variable">$DEFAULT</span>作为其值 *</span></span><br><span class="line">例</span><br><span class="line">[root@template sh]# echo $&#123;bbb-'ok'&#125;</span><br><span class="line">ok</span><br><span class="line">[root@template sh]# echo $bbb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> bbb没有被声明过</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var=DEFAULT&#125;：如果var没有被声明, 那么就以<span class="variable">$DEFAULT</span>作为其值 *</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var:=DEFAULT&#125;：如果var没有被声明, 或者其值为空, 那么就以<span class="variable">$DEFAULT</span>作为其值 *</span></span><br><span class="line">例</span><br><span class="line">[root@template sh]# echo $&#123;abc='ok'&#125;</span><br><span class="line">ok</span><br><span class="line">[root@template sh]# echo $abc</span><br><span class="line">ok</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var+OTHER&#125;：如果var声明了, 那么其值就是<span class="variable">$OTHER</span>, 否则就为null字符串</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var:+OTHER&#125;：如果var被设置了, 那么其值就是<span class="variable">$OTHER</span>, 否则就为null字符串</span></span><br><span class="line"> 	 </span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var?ERR_MSG&#125;：如果var没被声明, 那么就打印<span class="variable">$ERR_MSG</span> *</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;var:?ERR_MSG&#125;：如果var没被设置, 那么就打印<span class="variable">$ERR_MSG</span> *</span></span><br><span class="line"> 	 </span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;!varprefix*&#125;：匹配之前所有以varprefix开头进行声明的变量</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;!varprefix@&#125;：匹配之前所有以varprefix开头进行声明的变量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$&#123;!varprefix*&#125;</span>与<span class="variable">$&#123;!varprefix@&#125;</span>相似，可以通过变量名前缀字符，搜索已经定义的变量,无论是否为空值。</span></span><br><span class="line">例</span><br><span class="line">[root@template sh]# var1=11;var2=22;var3=33</span><br><span class="line">[root@template sh]# echo $var1</span><br><span class="line">11</span><br><span class="line">[root@template sh]# echo $var2</span><br><span class="line">22</span><br><span class="line">[root@template sh]# echo $var3</span><br><span class="line">33</span><br><span class="line">[root@template sh]# echo $&#123;!v@&#125;</span><br><span class="line">var1 var2 var3</span><br><span class="line">[root@template sh]# echo $&#123;!v*&#125;</span><br><span class="line">var1 var2 var3</span><br><span class="line"></span><br><span class="line">* 字符串操作</span><br><span class="line">	* 截取长度</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;<span class="comment">#string&#125;：$string的长度</span></span></span><br><span class="line"></span><br><span class="line">	* 截取字符串</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string:position&#125;：在<span class="variable">$string</span>中, 从位置<span class="variable">$position</span>开始提取子串</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string:position:length&#125;：在<span class="variable">$string</span>中, 从位置<span class="variable">$position</span>开始提取长度为<span class="variable">$length</span>的子串</span></span><br><span class="line"> 	 </span><br><span class="line"> 	 * 删除子串</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string<span class="comment">#substring&#125;：从变量$string的开头, 删除最短匹配$substring的子串</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string<span class="comment">##substring&#125;：从变量$string的开头, 删除最长匹配$substring的子串</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string%substring&#125;：从变量<span class="variable">$string</span>的结尾, 删除最短匹配<span class="variable">$substring</span>的子串</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string%%substring&#125;：从变量<span class="variable">$string</span>的结尾, 删除最长匹配<span class="variable">$substring</span>的子串</span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;变量名<span class="comment">#substring正则表达式&#125;：从字符串开头开始配备substring，删除匹配上的表达式。</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;变量名%substring正则表达式&#125;：从字符串结尾开始配备substring，删除匹配上的表达式。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$&#123;test##*/&#125;</span>,<span class="variable">$&#123;test%/*&#125;</span> 分别是得到文件名，或者目录地址最简单方法。 	 </span></span><br><span class="line"></span><br><span class="line"> 	 * 字符串替换</span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string/substring/replacement&#125;：使用<span class="variable">$replacement</span>, 来代替第一个匹配的<span class="variable">$substring</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string//substring/replacement&#125;：使用<span class="variable">$replacement</span>, 代替所有匹配的<span class="variable">$substring</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string/<span class="comment">#substring/replacement&#125;：如果$string的前缀匹配$substring, 那么就用$replacement来代替匹配到的$substring</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">&#123;string/%substring/replacement&#125;：如果<span class="variable">$string</span>的后缀匹配<span class="variable">$substring</span>, 那么就用<span class="variable">$replacement</span>来代替匹配到的<span class="variable">$substring</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">"* <span class="variable">$substring</span>"</span> 可以是一个正则表达式。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$&#123;变量/查找/替换值&#125;</span> 一个“/”表示替换第一个，”//”表示替换所有,当查找中出现了：”/”请加转义符”\/”表示。</span></span><br><span class="line">例</span><br><span class="line">[root@template sh]# num=oldboy5343</span><br><span class="line">[root@template sh]# echo "$&#123;num//[0-9]/&#125;" </span><br><span class="line">oldboy</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这是使用空来代替oldboy5343中的所有数字，所以取的值只有字母</span></span><br><span class="line">[root@template sh]# echo "$&#123;num//[0-9]/a&#125;"</span><br><span class="line">oldboyaaaa</span><br></pre></td></tr></table></figure>
<h3 id="变量的数值计算"><a href="#变量的数值计算" class="headerlink" title="变量的数值计算"></a>变量的数值计算</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line">* (())用法：此方法很常用，且效率高。执行简单的整数运算，只需将特定的算术表达式用"$((算术运算表达式))"。shell的算术运算符号都置于"$((算术运算表达式))"的语法中。这一语法如同双引号功能，除了内嵌双引号无需转义。</span><br><span class="line">=======================================================================================</span><br><span class="line">运算符</span><br><span class="line">++  --：增加及减少，可前置也可放在结尾。放在开头表示先自增或自减再赋值，放在结尾表示先赋值再自增或自减。变量话前，先输出变量值，变量在后，就是先运算后输出变量的值。</span><br><span class="line">+ - ! ~	：一元的正号与负号；逻辑与位的取反</span><br><span class="line">* / %：乘法、除法、与取余</span><br><span class="line">+ -	：加法、减法</span><br><span class="line">&lt; &lt;= &gt; &gt;=：比较符号</span><br><span class="line">== !=：判断相等与不相等</span><br><span class="line">&lt;&lt; &gt;&gt;：向左位移、向右位移</span><br><span class="line">&amp;：位的AND</span><br><span class="line">^：位的异或</span><br><span class="line">｜：位的或</span><br><span class="line">&amp;&amp;：逻辑的AND</span><br><span class="line">||：逻辑的OR</span><br><span class="line">?：条件表达式</span><br><span class="line">= += -= *= /= %= &amp;= ^=</span><br><span class="line">&lt;&lt;=  &gt;&gt;=  \=：赋值运算符</span><br><span class="line">=======================================================================================</span><br><span class="line">例</span><br><span class="line">[root@template sh]# echo $((3&gt;2))</span><br><span class="line">1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断，如果是真就输出1，假输出0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 括号两边有几个空格不敏感，也可以没有</span></span><br><span class="line">[root@template sh]# echo $((3&gt;8))</span><br><span class="line">0</span><br><span class="line">[root@template sh]# ((a=1+2**3-4%3))</span><br><span class="line"><span class="meta">#</span><span class="bash"> **是幂，表示几次方</span></span><br><span class="line">[root@template sh]# echo $a</span><br><span class="line">8</span><br><span class="line">[root@template sh]# b=$((1+2**3-4%3))</span><br><span class="line">[root@template sh]# echo $b</span><br><span class="line">8</span><br><span class="line">[root@template sh]# echo $((1+2**3-4%3))</span><br><span class="line">8</span><br><span class="line">[root@template sh]# echo $((a+=1))</span><br><span class="line">9</span><br><span class="line"><span class="meta">#</span><span class="bash"> a++表示先赋值再自增1、++a表示先自增1再赋值、a--与--a同理</span></span><br><span class="line">[root@template sh]# echo $((100*(100+1)/2))</span><br><span class="line">5050</span><br><span class="line">[root@template sh]# echo $((1000*(1000+1)/2))</span><br><span class="line">500500</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从1加到100的计算公式是n*(n+1)/2，只要从1开始，间隔为1的相加计算都可以用此公式</span></span><br><span class="line">[root@template sh]# echo $((1.1+1))</span><br><span class="line">-bash: 1.1+1: syntax error: invalid arithmetic operator (error token is ".1+1")</span><br><span class="line"><span class="meta">#</span><span class="bash"> 双括号中只能使用整数，不能使用小数</span></span><br><span class="line"></span><br><span class="line">例：使用传参的方式对两个变量进行计算</span><br><span class="line">[root@template sh]# vim test2.sh</span><br><span class="line">echo "a-b=$(($a-$b))"</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">a=$1</span><br><span class="line">b=$2</span><br><span class="line">echo "a-b=$(($a-$b))"</span><br><span class="line">echo "a+b=$(($a+$b))"</span><br><span class="line">echo "a*b=$(($a*$b))"</span><br><span class="line">echo "a/b=$(($a/$b))"</span><br><span class="line">echo "a**b=$(($a**$b))"</span><br><span class="line">echo "a%b=$(($a%$b))"</span><br><span class="line">[root@template sh]# chmod +x test2.sh </span><br><span class="line">[root@template sh]# bash test2.sh 5 2</span><br><span class="line">a-b=3</span><br><span class="line">a+b=7</span><br><span class="line">a*b=10</span><br><span class="line">a/b=2</span><br><span class="line">a**b=25</span><br><span class="line"><span class="meta">a%</span><span class="bash">b=1</span></span><br><span class="line"></span><br><span class="line">* []的用法，$[算术运算表达式]，与$((算术运算表达式))相同</span><br><span class="line"></span><br><span class="line">* let命令的用法</span><br><span class="line">格式：</span><br><span class="line">	let 赋值表达式</span><br><span class="line">	let i=$[$i+1]</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 这里不加<span class="built_in">let</span>也可以，因为有中括号了</span></span><br><span class="line">	let i++</span><br><span class="line">	let i+=1</span><br><span class="line">	</span><br><span class="line">例</span><br><span class="line">[root@template sh]# i=2</span><br><span class="line">[root@template sh]# let i=i+9</span><br><span class="line">[root@template sh]# echo $i</span><br><span class="line">11</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">let</span> i=i+8等同于((i=i+8))，但双括号效率更高</span></span><br><span class="line"></span><br><span class="line">例：利用let计数监控web服务状态</span><br><span class="line">[root@template sh]# vim web.sh </span><br><span class="line">ServerMonitor() &#123;</span><br><span class="line">   timeout=10</span><br><span class="line">   fails=0</span><br><span class="line">   success=0</span><br><span class="line">   while true;do</span><br><span class="line">        /usr/bin/wget --timeout=$timeout --tries=1 http://192.168.1.24 -q -O /de</span><br><span class="line">v/null</span><br><span class="line">        if [ $? -ne 0 ];then</span><br><span class="line">           let fails+=1</span><br><span class="line">           success=0</span><br><span class="line">        else</span><br><span class="line">           fail=0</span><br><span class="line">           let success=1</span><br><span class="line">        fi</span><br><span class="line">        if [ $success -eq 1 ];then</span><br><span class="line">           exit 0</span><br><span class="line">        fi</span><br><span class="line">        if [ $fails -ge 2 ];then</span><br><span class="line">           Critical="web应用服务故障"</span><br><span class="line">           echo $Critical </span><br><span class="line">        fi</span><br><span class="line">        sleep 10</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line">ServerMonitor</span><br><span class="line"><span class="meta">#</span><span class="bash"> 探测主页，之后判断，如果返回值不是0，fails变量就自增1，否则success变量就等于1。再判断success变量是否等于1,如果等于1，如果是，就正常退出，返回0。再判断fails变量是否大于等于2,如果是就定义一个变量Critical，并显示变量值。最后，每10秒检查一次。</span></span><br><span class="line"></span><br><span class="line">* expr命令用法</span><br><span class="line"><span class="meta">#</span><span class="bash"> expr命令一般用于整数值，但也可用于字符串，用来求表达式变量的值，同时expr也是一个手工命令行计算器。</span></span><br><span class="line">语法：</span><br><span class="line">	expr Expression</span><br><span class="line">例</span><br><span class="line">[root@template sh]# expr 2 + 2</span><br><span class="line">4</span><br><span class="line"><span class="meta">#</span><span class="bash"> 运算符两侧必须有空格</span></span><br><span class="line">[root@template sh]# expr 2 - 2</span><br><span class="line">0</span><br><span class="line">[root@template sh]# expr 2 \* 2</span><br><span class="line">4</span><br><span class="line"><span class="meta">#</span><span class="bash"> 乘号要转义</span></span><br><span class="line">[root@template sh]# expr 2 / 2 </span><br><span class="line">1</span><br><span class="line">[root@template sh]# expr 3 % 2</span><br><span class="line">1</span><br><span class="line">[root@template sh]# i=0</span><br><span class="line">[root@template sh]# i=`expr $i + 1`</span><br><span class="line">[root@template sh]# echo $i</span><br><span class="line">1</span><br><span class="line"><span class="meta">#</span><span class="bash"> expr在循环中可用于增量计算。首先，循环初始化为0，然后循环值加1，反引号的用法为命令替代。最其本的一种是从(expr)命令接受输出并将之放入循环变量</span></span><br><span class="line">[root@template sh]# expr $[2+3]</span><br><span class="line">5</span><br><span class="line"><span class="meta">#</span><span class="bash"> expr如果加上$[]后，运算符两侧就不用空格了。运算符两侧必须为整数</span></span><br><span class="line"></span><br><span class="line">例：ssh-copy-id脚本中使用expr命令</span><br><span class="line">if expr "$1" : ".*\.pub";then</span><br><span class="line"><span class="meta">#</span><span class="bash"> 冒号两侧一样要有空格</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置结果可能为expr id_dsa.pub:<span class="string">".*\.pub"</span>，匹配*.pub格式的文件如果是则为真。如：</span></span><br><span class="line">[root@template sh]# expr ~/.ssh/id_rsa.pub : ".*\.pub"</span><br><span class="line">21</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果为真就会打印出字符数，假就显示0</span></span><br><span class="line">[root@template sh]# expr ~/.ssh/id_rsa.pub : ".*\.pub" &amp;&amp; echo 1||echo 0</span><br><span class="line">21</span><br><span class="line">1</span><br><span class="line">[root@template sh]# expr ~/.ssh/id_rsa.p : ".*\.pub" &amp;&amp; echo 1||echo 0  </span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断文件或字符串的扩展名</span></span><br><span class="line"></span><br><span class="line">例：判断变量是否为整数</span><br><span class="line">[root@template sh]# vim expr.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">read -p "Pls input: " a</span><br><span class="line">expr $a + 0 &amp;&gt; /dev/null</span><br><span class="line">[ $? -eq 0 ] &amp;&amp; echo int || echo chars</span><br><span class="line"></span><br><span class="line">例：计算字符串的长度</span><br><span class="line">[root@template sh]# chars=`seq -s " " 100`      </span><br><span class="line"><span class="meta">#</span><span class="bash"> -s选项表示指定分隔符，上面是以空格为分隔符。默认是回车。</span></span><br><span class="line">[root@template sh]# echo $&#123;#chars&#125;              </span><br><span class="line">291</span><br><span class="line">[root@template sh]# echo $(expr length "$chars")</span><br><span class="line">291</span><br><span class="line"></span><br><span class="line">* $[]的用法与(())一样，效果也一样</span><br><span class="line">[root@template sh]# echo $((2-2))</span><br><span class="line">0</span><br><span class="line">[root@template sh]# echo $[2-2]</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<h3 id="read命令"><a href="#read命令" class="headerlink" title="read命令"></a>read命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">可以使用read命令从标准输入获得参数</span><br><span class="line">语法：</span><br><span class="line">	read [参数] [变量名]</span><br><span class="line">常用选项：</span><br><span class="line">	-p prompt：设置提示信息</span><br><span class="line">	-t timeout：设置输入等待时间，单位默认为秒</span><br><span class="line">例</span><br><span class="line">[root@template sh]# read -p "pls input two number: " a b</span><br><span class="line">pls input two number: 1 2   </span><br><span class="line">或</span><br><span class="line">[root@template sh]# echo -n "pls input two number: ";read a b</span><br><span class="line">pls input two number: 4 3</span><br><span class="line">[root@template sh]# echo $a</span><br><span class="line">4</span><br><span class="line">[root@template sh]# echo $b</span><br><span class="line">3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这两种方式都可以使用<span class="built_in">read</span>获得参数</span></span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim read.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">read -t 10 -p "Pls input two number: " a b</span><br><span class="line">echo "a-b=$(($a-$b))"</span><br><span class="line">echo "a+b=$(($a+$b))"</span><br><span class="line">echo "a*b=$(($a*$b))"</span><br><span class="line">echo "a/b=$(($a/$b))"</span><br><span class="line">echo "a**b=$(($a**$b))"</span><br><span class="line">echo "a%b=$(($a%$b))"</span><br><span class="line"></span><br><span class="line">[root@template sh]# vim read1.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">echo -n "Pls input two number"</span><br><span class="line">read a b</span><br><span class="line">echo "a-b=$(($a-$b))"</span><br><span class="line">echo "a+b=$(($a+$b))"</span><br><span class="line">echo "a*b=$(($a*$b))"</span><br><span class="line">echo "a/b=$(($a/$b))"</span><br><span class="line">echo "a**b=$(($a**$b))"</span><br><span class="line">echo "a%b=$(($a%$b))"</span><br></pre></td></tr></table></figure>
<h3 id="条件测试"><a href="#条件测试" class="headerlink" title="条件测试"></a>条件测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">* 测试语句</span><br><span class="line">条件测试语法</span><br><span class="line">1. test &lt;测试表达式&gt;</span><br><span class="line">2. [&lt;测试表达式&gt;]</span><br><span class="line">3. [[&lt;测试表达式&gt;]]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 格式1和格式2是一样的，只是写法不同。格式3为扩展的<span class="built_in">test</span>命令。在[[]]中可以使用通配符进行模式匹配。&amp;&amp;、||、&gt;、&lt;等操作符，但不能用于[]中。对整数进行关系运算，也可以使用shell的算术运算符(())</span></span><br><span class="line"></span><br><span class="line">* 文件测试操作符</span><br><span class="line">-f 文件：若文件存在且为普通文件则为真</span><br><span class="line">-d 文件：若文件存在且为目录则为真</span><br><span class="line">-s 文件：若文件存在且不为空（文件大小非0）则为真</span><br><span class="line">-e 文件：若文件存在则为真，要与-f区别，-f只判断是否为普通文件</span><br><span class="line">-r 文件：若文件可读则为真</span><br><span class="line">-w 文件：若文件可写则为真</span><br><span class="line">-x 文件：若文件可执行则为真</span><br><span class="line">-L 文件：若文件存在且为链接文件则为真</span><br><span class="line">f1 -nt f2：若文件f1比f2新则为真</span><br><span class="line">f1 -ot f2：若文件f1比f2旧则为真</span><br><span class="line"></span><br><span class="line">例：test</span><br><span class="line">[root@template sh]# test -f file &amp;&amp; echo true||echo false  </span><br><span class="line">false</span><br><span class="line">[root@template sh]# test -f expr.sh &amp;&amp; echo true||echo false    </span><br><span class="line">true</span><br><span class="line">[root@template sh]# test ! -f file &amp;&amp; echo true||echo false</span><br><span class="line">true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用!号可以取反</span></span><br><span class="line"></span><br><span class="line">例：[]</span><br><span class="line">[root@template sh]# [ -f file ] &amp;&amp; echo true || echo false</span><br><span class="line">false</span><br><span class="line">[root@template sh]# [ ! -f file ] &amp;&amp; echo true || echo false</span><br><span class="line">true</span><br><span class="line"></span><br><span class="line">例：[[]]</span><br><span class="line">[root@template sh]# [[ -f file ]] &amp;&amp; echo true || echo false  </span><br><span class="line">false</span><br><span class="line">[root@template sh]# [[ ! -f file ]] &amp;&amp; echo true || echo false</span><br><span class="line">true</span><br><span class="line">[root@template sh]# [[ -f file &amp;&amp; -f expr.sh ]] &amp;&amp; echo true || echo false</span><br><span class="line">false</span><br><span class="line">[root@template sh]# [[ ! -f file &amp;&amp; -f expr.sh ]] &amp;&amp; echo true || echo false</span><br><span class="line">true</span><br></pre></td></tr></table></figure>
<h3 id="字符串及整数操作符"><a href="#字符串及整数操作符" class="headerlink" title="字符串及整数操作符"></a>字符串及整数操作符</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">字符串测试操作符的作用：比较两个字符串是否相同、字符串长度是否为零，字符串是否为NULL（bash区分零长度字符串与空字符串）等。</span><br><span class="line">=比较两个字符串是相同，与==等价，如if[ "$a" = "$b" ]，其中$a这样的变量最好用""括起来，因为如果中间有空格，*等符号就可能出错了，也可以用[ "$&#123;a&#125;" = "$&#123;b&#125;" ]这样的方法。!=比较两个字符串是否相同，不同则为真</span><br><span class="line">* 字符串测试操作符</span><br><span class="line">-z "字符串"：若串长度为0则为真</span><br><span class="line">-n "字符串"：若串长度不为0则为真</span><br><span class="line">"串1"="串2"：若串1等于串2则为真，也可以使用==代替=</span><br><span class="line">"串1"!="串2"：若串1不等于串2则为真</span><br></pre></td></tr></table></figure>
<p>整数二元比较操作符</p>
<table>
<thead>
<tr>
<th>在[]中使用的比较符</th>
<th>在(())和[[]]中使用的比较符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-eq</td>
<td>==</td>
<td>equal</td>
</tr>
<tr>
<td>-ne</td>
<td>!=</td>
<td>not equal</td>
</tr>
<tr>
<td>-gt</td>
<td>&gt;</td>
<td>greater than</td>
</tr>
<tr>
<td>-ge</td>
<td>&gt;=</td>
<td>greater equal</td>
</tr>
<tr>
<td>-lt</td>
<td>&lt;</td>
<td>less thean</td>
</tr>
<tr>
<td>-le</td>
<td>&lt;=</td>
<td>less equal</td>
</tr>
</tbody>
</table>
<p><strong>在[]中也可以使用&gt;、&lt;、=号，但&gt;、&lt;号要转义</strong></p>
<h3 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h3><p>逻辑连接符</p>
<table>
<thead>
<tr>
<th>在[]中使用的逻辑操作符</th>
<th>在[[]]中使用的逻辑操作符</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>&amp;&amp;</td>
<td style="text-align:left">与，两端都为真，则为真</td>
</tr>
<tr>
<td>-o</td>
<td>\</td>
<td style="text-align:left">\</td>
<td></td>
<td>或，两端有一端为真则为真</td>
</tr>
<tr>
<td>!</td>
<td>!</td>
<td style="text-align:left">非，相反则为真</td>
</tr>
</tbody>
</table>
<h3 id="单级与多级菜单"><a href="#单级与多级菜单" class="headerlink" title="单级与多级菜单"></a>单级与多级菜单</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@template ~]# vim menu.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">menu() &#123;</span><br><span class="line">   cat &lt;&lt; END</span><br><span class="line">   1. [install lamp]</span><br><span class="line">   2. [install lnmp]</span><br><span class="line">   3. [install nfs]</span><br><span class="line">   4. [install rsync]</span><br><span class="line">   Pls input the num that you want:</span><br><span class="line">END</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试中，如果将END改为EOF会报错，内容如下：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> menu.sh: line 14: warning: here-document at line 4 delimited by end-of-file (wanted `EOF<span class="string">')</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> menu.sh: line 15: syntax error: unexpected end of file</span></span><br><span class="line">read a</span><br><span class="line">[ $a -eq 1 ] &amp;&amp; &#123;</span><br><span class="line">cat &lt;&lt; END</span><br><span class="line">[1. install apache]</span><br><span class="line">[2. install mysql]</span><br><span class="line">[3. install php]</span><br><span class="line">END</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">menu</span><br><span class="line">read b</span><br><span class="line">echo "You selected $b"</span><br><span class="line">[root@template ~]# bash menu.sh </span><br><span class="line">   1. [install lamp]</span><br><span class="line">   2. [install lnmp]</span><br><span class="line">   3. [install nfs]</span><br><span class="line">   4. [install rsync]</span><br><span class="line">   Pls input the num that you want:</span><br><span class="line">1</span><br><span class="line">[1. install apache]</span><br><span class="line">[2. install mysql]</span><br><span class="line">[3. install php]</span><br><span class="line">1</span><br><span class="line">You selected 1</span><br></pre></td></tr></table></figure>
<h3 id="if条件语句"><a href="#if条件语句" class="headerlink" title="if条件语句"></a>if条件语句</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line">* if条件单分支</span><br><span class="line">语法：</span><br><span class="line">if [条件]</span><br><span class="line">	then</span><br><span class="line">		指令</span><br><span class="line">fi</span><br><span class="line">或</span><br><span class="line">if [条件];then</span><br><span class="line">	指令</span><br><span class="line">fi</span><br><span class="line">特殊写法：if [ -f "$file" ];then echo 1;fi，相当于：[ -f "$file" ] &amp;&amp; echo 1</span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim if.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">cur_free=`free -m|awk '/buffers\// &#123;print $NF&#125;'`</span><br><span class="line">chars="current memory is $cur_free"</span><br><span class="line">if [ $cur_free -lt 900 ];then</span><br><span class="line">   echo $chars</span><br><span class="line">fi</span><br><span class="line">[root@template sh]# chmod +x if.sh </span><br><span class="line">[root@template sh]# ./if.sh</span><br><span class="line">current memory is 855</span><br><span class="line"></span><br><span class="line">* 双分支、多分支if语句</span><br><span class="line">双分支语法：</span><br><span class="line">if [条件];then</span><br><span class="line">   指令</span><br><span class="line">else</span><br><span class="line">	指令</span><br><span class="line">fi</span><br><span class="line">多分支语法：</span><br><span class="line">if [条件];then</span><br><span class="line">   指令</span><br><span class="line">elif [条件];then</span><br><span class="line">	指令</span><br><span class="line">else</span><br><span class="line">	指令</span><br><span class="line">fi</span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim if1.sh      </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">a=$1</span><br><span class="line">b=$2</span><br><span class="line">if [ $# -ne 2 ];then</span><br><span class="line">   echo "Usage: sh $0 num1 num2"</span><br><span class="line">   exit 1</span><br><span class="line">fi</span><br><span class="line">[ -n "`echo $1|sed 's/[0-9]//g'`" ] &amp;&amp; echo "first parameter must num" &amp;&amp; exit 1</span><br><span class="line">[ -n "`echo $2|sed 's/[0-9]//g'`" ] &amp;&amp; echo "second parameter must num" &amp;&amp; exit 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里是要显示输入的内容，将内容传给sed命令，sed命令将数字部分都替换为空，再对这个显示的值做字符串长度的计算，如果不是0就要提示应该输入数字，不然就退出。</span></span><br><span class="line">if [ $a -gt $b ];then</span><br><span class="line">   echo "yes,$a &gt; $b"</span><br><span class="line">elif [ $a -eq $b ];then</span><br><span class="line">   echo "yes,$a = $b"</span><br><span class="line">else</span><br><span class="line">   echo "yes,$a &lt; $b"</span><br><span class="line">fi</span><br><span class="line">[root@template sh]# bash if1.sh 99 89</span><br><span class="line">yes,99 &gt; 89</span><br><span class="line">[root@template sh]# bash if1.sh 99 99</span><br><span class="line">yes,99 = 99</span><br><span class="line">[root@template sh]# bash if1.sh 69 99 </span><br><span class="line">yes,69 &lt; 99</span><br><span class="line"></span><br><span class="line">例：检查mysql是否启动</span><br><span class="line">[root@template sh]# vim check_db.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">portNum=`netstat -lnt|grep 3306|wc -l`</span><br><span class="line">if [ $portNum -eq 1 ];then</span><br><span class="line">   echo "db is running"</span><br><span class="line">else</span><br><span class="line">   service mysqld start</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="bash"> 脚本的名称中最好不要包括要查询的服务的名称，如这里就是mysql</span></span><br><span class="line"></span><br><span class="line">例：检查mysql是否启动，更完整 </span><br><span class="line">[root@template sh]# vim check1_db.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">LogPath=/tmp/mysql.log</span><br><span class="line">portNum=`netstat -lnt|grep 3306|wc -l`</span><br><span class="line">mysqlProcessNum=`ps -ef|grep mysqld|grep -v grep|wc -l`</span><br><span class="line">if [ $portNum -eq 1 ] &amp;&amp; [ $mysqlProcessNum -eq 2 ];then</span><br><span class="line">   echo "db is running"</span><br><span class="line">else</span><br><span class="line">   /etc/init.d/mysqld start</span><br><span class="line">   sleep 10</span><br><span class="line">   portNum=`netstat -lnt|grep 3306|wc -l`</span><br><span class="line">   mysqlProcessNum=`ps -ef|grep mysqld|grep -v grep|wc -l`</span><br><span class="line">   if [ $portNum -ne 1 ] &amp;&amp; [ $mysqlProcessNum -ne 2 ];then</span><br><span class="line">        while true;do</span><br><span class="line">           killall mysqld &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">           [ $? -ne 0 ] &amp;&amp; break</span><br><span class="line">           sleep 1</span><br><span class="line">        done</span><br><span class="line">        /etc/init.d/mysqld start &gt;&gt; $LogPath &amp;&amp; status="successful" || status="failure"</span><br><span class="line">        mail -s "mysql startup status is $status" root@localost &lt; $LogPath</span><br><span class="line">   fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例：检查mysql是否启动，利用mysql帐号登录测试</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">LogPath=/tmp/mysql.log</span><br><span class="line">mysql -uroot -p'centos' -S /var/lib/mysql/mysql.sock -e "select version();" &gt;&amp; /dev/null</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里的用户名与密码一定要正确，不然也会执行失败，使下面判断mysql为未启动状态。</span></span><br><span class="line">if [ $? -eq 0 ];then</span><br><span class="line">   echo "db is running"</span><br><span class="line">else</span><br><span class="line">   /etc/init.d/mysqld start &gt; $LogPath</span><br><span class="line">   sleep 10</span><br><span class="line">   mysql -uroot -p'centos' -S /var/lib/mysql/mysql.sock -e "select version();" &gt;&amp; /dev/null</span><br><span class="line">   if [ $? -ne 0 ];then</span><br><span class="line">        while true;do</span><br><span class="line">           killall mysqld &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">           [ $? -ne 0 ] &amp;&amp; break</span><br><span class="line">           # 这里只检查killall命令执行是否正确，如果正确就跳出循环。个人认为还应该加上检查进程是否存在更准确</span><br><span class="line">           sleep 1</span><br><span class="line">        done</span><br><span class="line">        /etc/init.d/mysqld start &gt;&gt; $LogPath &amp;&amp; status="successful" || status="failure"</span><br><span class="line">        mail -s "mysql startup status is $status" root@localost &lt; $LogPath</span><br><span class="line">   fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例：检查mysql是否启动的php脚本</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="meta">   $</span><span class="bash">link_id=mysql_connect(<span class="string">'localhost'</span>,<span class="string">'root'</span>,<span class="string">'centos'</span>) or mysql_error();</span></span><br><span class="line">   if ($link_id) &#123;</span><br><span class="line">       echo "mysql successful !";</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">       echo mysql_error();</span><br><span class="line">   &#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">监控mysql数据库是否异常的多种方法</span><br><span class="line">1. 根据mysql端口号监控mysql(本地)</span><br><span class="line">2. 根据mysql进程监控mysql(本地)。只能本地监控，进程在服务可能不正常，如：负载很高，CPU很高，连接数满了，另外，进程也可以远程监控，如通过ssh key，expect</span><br><span class="line">3. 通过mysql客户端命令及用户帐户连接mysql，然后根据返回命令状态或返回内容确认mysql是否正常（本地和远程连接判断）。必须要有mysql客户端，要有数据库的帐号与密码及连接数据库主机授权。</span><br><span class="line">4. 通过php/java程序url方式监控mysql，此方法最接近用户访问，效果最好。报警的最佳方式不是服务是否开启了，而是网站的用户是否还能正常访问</span><br><span class="line">5. 以上四种方法的综合运用</span><br><span class="line"></span><br><span class="line">例：本地监控web服务</span><br><span class="line">[root@template sh]# vim check_web.sh     </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">HttpPortNum=`netstat -tln|grep 80|wc -l`</span><br><span class="line">if [ $HttpPortNum -ge 1 ];then</span><br><span class="line">   echo "web is running"</span><br><span class="line">else</span><br><span class="line">   echo "web is not running"</span><br><span class="line">   /etc/init.d/nginx start</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例：远程监控web服务</span><br><span class="line">[root@template sh]# vim check1_web.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">HttpPortNum=`nmap 192.168.1.24 -p 80|grep open|wc -l`</span><br><span class="line">if [ $HttpPortNum -ge 1 ];then</span><br><span class="line">   echo "web is running"</span><br><span class="line">else</span><br><span class="line">   echo "web is not running"</span><br><span class="line">   /etc/init.d/nginx start</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例：通过url地址远程监控web服务</span><br><span class="line">[root@template sh]# vim check2_web.sh             </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">wget -T 10 -q --spider http://192.168.1.24 &gt; /dev/null</span><br><span class="line"><span class="meta">#</span><span class="bash"> -T表示超时时间，-q表示静默模式，--spider表示爬虫</span></span><br><span class="line">if [ $? -eq 0 ];then</span><br><span class="line">   echo "web is running"</span><br><span class="line">else</span><br><span class="line">   echo "web is not running"</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例：通过状态码查看服务是否启动</span><br><span class="line">[root@template sh]# vim check3_web.sh    </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">[ -f /etc/init.d/functions ] &amp;&amp; . /etc/init.d/functions</span><br><span class="line">httpCode=`curl -I -s 192.168.1.24|head -1|cut -d" " -f2`</span><br><span class="line">if [ "$httpCode" == "200" ];then</span><br><span class="line">   action "nginx is running" /bin/true</span><br><span class="line"><span class="meta">   #</span><span class="bash"> action是调用<span class="built_in">functions</span>函数</span></span><br><span class="line">else</span><br><span class="line">   action "nginx is not running" /bin/false</span><br><span class="line">   sleep 1</span><br><span class="line">   /etc/init.d/nginx start</span><br><span class="line">   action "nginx is started" /bin/true</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">例：使用传参的方式查看服务是否启动</span><br><span class="line">[root@template sh]# vim check4_web.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">if [ $# -ne 2 ];then</span><br><span class="line">   echo "Usage: $0 ip port "</span><br><span class="line">fi</span><br><span class="line">PortNum=`nmap $1 -p $2 |grep open|wc -l`</span><br><span class="line">if [ $PortNum -eq 1 ];then</span><br><span class="line">   echo "$1 $2 is open"</span><br><span class="line">else</span><br><span class="line">   echo "$1 $2 is closed"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h3 id="case条件语句"><a href="#case条件语句" class="headerlink" title="case条件语句"></a>case条件语句</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">语法</span><br><span class="line">case "字符串变量" in</span><br><span class="line">	值1) 指令 ...</span><br><span class="line">	;;</span><br><span class="line">	值2) 指令 ...</span><br><span class="line">	;;</span><br><span class="line">	*) 指令 ...</span><br><span class="line">	;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">[root@template sh]# vim plus_color.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">new_chars() &#123;</span><br><span class="line">RED_COLOR='\E[1;31m'</span><br><span class="line">GREEN_COLOR='\E[1;32m'</span><br><span class="line">YELLOW_COLOR='\E[1;33m'</span><br><span class="line">BLUE_COLOR='\E[1;34m'</span><br><span class="line">PINK_COLOR='\E[1;35m'</span><br><span class="line">RES='\E[0m'</span><br><span class="line"></span><br><span class="line">if [ $# -ne 2 ];then</span><br><span class="line">   echo "Usage $0 content &#123;red|yellow|blue|green&#125;"</span><br><span class="line">   exit</span><br><span class="line">fi</span><br><span class="line">case "$2" in</span><br><span class="line">   red|RED)</span><br><span class="line">        echo -e "$&#123;RED_COLOR&#125;$1$&#123;RES&#125;"</span><br><span class="line">   ;;</span><br><span class="line">   yellow|YELLOW)</span><br><span class="line">        echo -e "$&#123;YELLOW_COLOR&#125;$1$&#123;RES&#125;"</span><br><span class="line">   ;;</span><br><span class="line">   green|GREEN)</span><br><span class="line">        echo -e "$&#123;GREEN_COLOR&#125;$1$&#123;RES&#125;"</span><br><span class="line">   ;;</span><br><span class="line">   blue|BLUE)</span><br><span class="line">        echo -e "$&#123;BLUE_COLOR&#125;$1$&#123;RES&#125;"</span><br><span class="line">   ;;</span><br><span class="line">   pink|PINK)</span><br><span class="line">        echo -e "$&#123;PINK_COLOR&#125;$1$&#123;RES&#125;"</span><br><span class="line">   ;;</span><br><span class="line">   *)</span><br><span class="line">        echo "Usage $0 content &#123;red|yellow|blue|green&#125;"</span><br><span class="line">   ;;</span><br><span class="line">esac</span><br><span class="line">&#125;</span><br><span class="line">new_chars abc red</span><br><span class="line">new_chars abc yellow</span><br><span class="line">new_chars abc green</span><br><span class="line">new_chars abc blue</span><br><span class="line">new_chars abc pink</span><br><span class="line"></span><br><span class="line">例：利用case语句启动web服务</span><br><span class="line">[root@template sh]# vim nginx</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">nginx="/etc/init.d/nginx"</span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">case "$1" in</span><br><span class="line">   start)</span><br><span class="line">        $nginx start &gt;&amp; /dev/null</span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; action "nginx is started" /bin/true ||\</span><br><span class="line">        action "nginx is started" /bin/false</span><br><span class="line">   ;;</span><br><span class="line">   stop)</span><br><span class="line">        $nginx stop &gt;&amp; /dev/null</span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; action "nginx is stoped" /bin/true ||\</span><br><span class="line">        action "nginx is stoped" /bin/false</span><br><span class="line">   ;;</span><br><span class="line">   restart)</span><br><span class="line">        $nginx restart &gt;&amp; /dev/null</span><br><span class="line">        [ $? -eq 0 ] &amp;&amp; action "nginx is restarted" /bin/true ||\</span><br><span class="line">        action "nginx is restarted" /bin/false</span><br><span class="line">   ;;</span><br><span class="line">   *)</span><br><span class="line">        echo "Usage: $0 &#123;start|stop|restart&#125;"</span><br><span class="line">        exit</span><br><span class="line">   ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<h3 id="while语句"><a href="#while语句" class="headerlink" title="while语句"></a>while语句</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line">语法</span><br><span class="line">while 条件;do</span><br><span class="line">	指令</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 条件满足就退出</span></span><br><span class="line"></span><br><span class="line">while读文件方式</span><br><span class="line">方式一</span><br><span class="line">exec &lt; FILE</span><br><span class="line">sum=0</span><br><span class="line">while read line</span><br><span class="line">do</span><br><span class="line">	cmd</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">方式二</span><br><span class="line">cat $&#123;FILE_PATH&#125; | while read line</span><br><span class="line">do</span><br><span class="line">	cmd</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">方式三</span><br><span class="line">while read line</span><br><span class="line">do</span><br><span class="line">	cmd</span><br><span class="line">done &lt; FILE</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim while1.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">while true;do</span><br><span class="line">   uptime</span><br><span class="line">   sleep 2</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">while</span> <span class="literal">true</span>表示永远为真，是死循环</span></span><br><span class="line">[root@template sh]# vim while2.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">while [ 1 ];do</span><br><span class="line">   uptime</span><br><span class="line">   usleep 1000000</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里的条件为[ 1 ]，也是死循环的意思。usllep是使用微秒为单位</span></span><br><span class="line"></span><br><span class="line">=======================================================================================</span><br><span class="line">ctrl+z：暂停执行当前脚本或任务</span><br><span class="line">bg：把当前脚本或任务放到后台执行</span><br><span class="line">fg：把当前脚本或任务拿到前台执行，如果有多个任务，可以fg加任务编号调出，如fg 1</span><br><span class="line">jobs：查看执行的脚本或任务</span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim while3.sh     </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">i=1</span><br><span class="line">sum=0</span><br><span class="line">while ((i &lt;= 100));do</span><br><span class="line">   ((sum=sum+i))</span><br><span class="line">   ((i++))</span><br><span class="line">done</span><br><span class="line">echo $sum</span><br><span class="line"></span><br><span class="line">例：循环竖向打印10-1，使用双小括号</span><br><span class="line">[root@template sh]# vim while4.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">i=10</span><br><span class="line">while ((i&gt;0));do</span><br><span class="line">   echo $i</span><br><span class="line">   ((i--))</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">例：循环竖向打印10-1，使用双中括号</span><br><span class="line">[root@template sh]# vim while5.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">i=10</span><br><span class="line">while [[ $i&gt;0 ]];do</span><br><span class="line">   echo $i</span><br><span class="line">   ((i--))</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用双中括号时必须使用<span class="variable">$i</span>，而不能用i</span></span><br><span class="line"></span><br><span class="line">例：循环竖向打印10-1，使用单中括号</span><br><span class="line">[root@template sh]# vim while6.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">i=10</span><br><span class="line">while [ $i -gt 0 ];do</span><br><span class="line">   echo $i</span><br><span class="line">   ((i--))</span><br><span class="line"><span class="meta">   #</span><span class="bash"> 这里也可以写为<span class="built_in">let</span> i--或i=$[<span class="variable">$i</span>-1]，中括号中不能写成i--这样的形式。</span></span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用单中括号时，<span class="keyword">while</span>的比较运算符要使用-gt的形式，或使用\&gt;的形式，也就是使用大于号时要转义</span></span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">[root@template sh]# vim while7.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">read -t 20 -p "pls input the num: " i</span><br><span class="line">while ((--i));do</span><br><span class="line"><span class="meta">#</span><span class="bash"> 当i为0时就会退出循环</span></span><br><span class="line">   echo $i</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">例：测试负载均衡是否平均分配到了节点</span><br><span class="line">[root@template sh]# vim while8.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">while true;do</span><br><span class="line">   curl -I -s http://www.test.com|head -1</span><br><span class="line">   sleep 10</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">例：数组方法</span><br><span class="line">[root@template sh]# vim check_url.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">url_list=(</span><br><span class="line">http://www.baidu.com</span><br><span class="line">http://www.sina.com</span><br><span class="line">http://www.sohu.com</span><br><span class="line">http://192.168.1.24</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">wait_time() &#123;</span><br><span class="line">   echo -n "3秒后，执行此操作"</span><br><span class="line">   for ((i=0;i&lt;3;i++));do</span><br><span class="line">        echo -n ".";sleep 1</span><br><span class="line">   done</span><br><span class="line">   echo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_url() &#123;</span><br><span class="line">   wait_time</span><br><span class="line">   echo 'check url...'</span><br><span class="line">   for ((i=0;i&lt;`echo $&#123;#url_list[*]&#125;`;i++));do</span><br><span class="line">        judge=($(curl -I -s $&#123;url_list[$i]&#125;|head -1|tr "\r" "\n"))</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里还是将结果当作一个数组传给judge变量，下面对数组的各值做判断。       </span></span><br><span class="line">        if [[ "$&#123;judge[1]&#125;" == '200' &amp;&amp; "$&#123;judge[2]&#125;" == 'OK' ]];then</span><br><span class="line">        # 这里的问题是只以200状态码与OK为正常，如果是301也是正常的，但这里就会判断为不正常。</span><br><span class="line">           action "$&#123;url_list[$i]&#125;" /bin/true</span><br><span class="line">        else</span><br><span class="line">           action "$&#123;url_list[$i]&#125;" /bin/false</span><br><span class="line">        fi</span><br><span class="line">   done</span><br><span class="line">&#125;</span><br><span class="line">check_url</span><br><span class="line">=======================================================================================</span><br><span class="line">curl命令</span><br><span class="line">-I/--head：只显示响应报文首部信息</span><br><span class="line">-s/--silent：静音模式。不输出任何东西</span><br><span class="line">-o/--output：把输出写到一个文件中，这是保存网页的方法</span><br><span class="line">-w/--write-out [format]：如 -w %&#123;http_code&#125;可以取得网页的状态码。</span><br><span class="line">例</span><br><span class="line">curl -o /dev/null -s -w %&#123;http_code&#125; www.linux.com</span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line">例：读日志文件，计算其中所有行的日志各元素的访问字节数的总和</span><br><span class="line">[root@template sh]# vim while9.sh    </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">sum=0</span><br><span class="line">while read line;do</span><br><span class="line">   size=`echo $line|awk '&#123;print $10&#125;'`</span><br><span class="line"><span class="meta">   #</span><span class="bash"> 以空格为分隔符，日志的第10段是访问数据的大小</span></span><br><span class="line">   [ "$size" == "-" ] &amp;&amp; continue</span><br><span class="line">   ((sum=sum+$size))</span><br><span class="line">done &lt; /var/log/nginx/access.log</span><br><span class="line">echo $sum</span><br></pre></td></tr></table></figure>
<h3 id="until语句"><a href="#until语句" class="headerlink" title="until语句"></a>until语句</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法</span><br><span class="line">until 条件;do</span><br><span class="line">	指令</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 条件不满足就退出，until应用场合不多见</span></span><br></pre></td></tr></table></figure>
<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">语法</span><br><span class="line">for 变量名 in 变量取值列表</span><br><span class="line">do</span><br><span class="line">	指令</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在此结构中<span class="string">"in 变量取值列表"</span>可省略，省略时相当于<span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span>，使用<span class="keyword">for</span> i 就相当于使用<span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"<span class="variable">$@</span>"</span> </span></span><br><span class="line"></span><br><span class="line">for ((exp1;exp2;exp3))</span><br><span class="line">do</span><br><span class="line">	指令</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim for1.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">size=`awk '&#123;print $10&#125;' $1`</span><br><span class="line">sum=0</span><br><span class="line">for num in $size;do</span><br><span class="line">   [ -n "$num" -a "$num" = "$&#123;num//[^0-9]/&#125;" ] || continue</span><br><span class="line"><span class="meta">   #</span><span class="bash"> 这里要判断一下，<span class="variable">$sum</span>是否不为空，再判断，替换了<span class="variable">$num</span>中开头的数字后，<span class="variable">$num</span>是否等于<span class="variable">$num</span>，如果等于，说明这里有字母，就退出本轮循环。</span></span><br><span class="line">   ((sum=$num+sum))</span><br><span class="line">done</span><br><span class="line">echo "Log size: $sum bytes=`echo $(($sum/1024))`KB"</span><br><span class="line">[root@template sh]# ./for1.sh /var/log/nginx/access.log </span><br><span class="line">Log size: 139959 bytes=136KB</span><br><span class="line"></span><br><span class="line">另一种方法</span><br><span class="line">[root@template sh]# echo `awk '&#123;print $10&#125;' /var/log/nginx/access.log|grep -v -|tr "\n" "+"|sed 's/3698+$/3698/'`|bc</span><br><span class="line">139959</span><br><span class="line"></span><br><span class="line">例：批量改名</span><br><span class="line">[root@template sh]# vim for2.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">for filename in `ls *.jpg`;do</span><br><span class="line">   mv $filename `echo $filename|cut -d . -f1`.git</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">例：乘法表</span><br><span class="line">[root@template sh]# vim for3.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">for i in `seq 9`;do</span><br><span class="line">   for j in `seq 9`;do</span><br><span class="line">        [ $j -le $i ] &amp;&amp; echo -en "$j * $i = `expr $i \* $j` \c"</span><br><span class="line">        # -n表示不换行输出，-e表示激活转义字符，\c表示最后不加上换行符号</span><br><span class="line">   done</span><br><span class="line">   echo " "</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">例：访问十次页面</span><br><span class="line">[root@template sh]# vim for4.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">for ((i=0;i&lt;=10;i++));do</span><br><span class="line">   curl http://192.168.1.24/index1.html</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="取随机数的方法"><a href="#取随机数的方法" class="headerlink" title="取随机数的方法"></a>取随机数的方法</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">方法一</span><br><span class="line">[root@template sh]# echo $RANDOM</span><br><span class="line">9066</span><br><span class="line"></span><br><span class="line">方法二</span><br><span class="line">[root@template sh]# openssl rand -base64 8</span><br><span class="line">sT9rgkzhDKQ=</span><br><span class="line">[root@template sh]# openssl rand -base64 10</span><br><span class="line">dK5aymAlYRlJxA==</span><br><span class="line"></span><br><span class="line">方法三</span><br><span class="line">[root@template sh]# date +%s%N</span><br><span class="line">1547475685362659766</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过时间获取随机数</span></span><br><span class="line"></span><br><span class="line">方法四</span><br><span class="line">[root@template sh]# head /dev/urandom | cksum </span><br><span class="line">3543804650 1922</span><br><span class="line"><span class="meta">#</span><span class="bash"> /dev/random设备，存储着系统当前运行的环境的实时数据。它可以看作是系统某个时候，唯一值数据，因此可以用作随机数元数据。/dev/urandom这个设备数据与random里面一样，只是，它是非阻塞的随机数发生器，读取操作不会产生阻塞。</span></span><br><span class="line"></span><br><span class="line">方法五</span><br><span class="line">[root@template sh]# cat /proc/sys/kernel/random/uuid </span><br><span class="line">9794b963-3311-483e-aa9b-ace2df623d07</span><br><span class="line"></span><br><span class="line">方法六</span><br><span class="line">[root@template sh]# yum install -y expect</span><br><span class="line">[root@template sh]# mkpasswd -l 8</span><br><span class="line"><span class="meta">E&gt;</span><span class="bash">jC45ut</span></span><br><span class="line"></span><br><span class="line">[root@template sh]# cat /proc/sys/kernel/random/uuid | md5sum | cut -c 1-9</span><br><span class="line">c1baddd2e</span><br><span class="line"><span class="meta">#</span><span class="bash"> 上面的命令得到随机数后都通过md5sum再计算一次得到一个数字，到通过cut命令取指定长度的数字。cut的-c选项就是仅显示行中指定范围的字符</span></span><br></pre></td></tr></table></figure>
<h3 id="break、continue、exit对比"><a href="#break、continue、exit对比" class="headerlink" title="break、continue、exit对比"></a>break、continue、exit对比</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>break n</td>
<td>n表示跳出循环的层数，如果省略n表示跳出整个循环</td>
</tr>
<tr>
<td>continue n</td>
<td>n表示退出到第n层继续循环，如果省略n表示跳过本次循环，忽略本次循环的接任代码，进入循环的下一次循环</td>
</tr>
<tr>
<td>exit n</td>
<td>退出当前shell程序，终止整个shell脚本，并返回n。n也可以省略。</td>
</tr>
<tr>
<td>return</td>
<td>与exit相似，在函数中使用，用于跳出函数</td>
</tr>
</tbody>
</table>
<h3 id="shell函数"><a href="#shell函数" class="headerlink" title="shell函数"></a>shell函数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">语法</span><br><span class="line">简单的语法：</span><br><span class="line">函数名() &#123;</span><br><span class="line">    指令</span><br><span class="line">    return n</span><br><span class="line">&#125;</span><br><span class="line">规范的语法：</span><br><span class="line">function 函数名() &#123;</span><br><span class="line">    指令</span><br><span class="line">    return n</span><br><span class="line">&#125;</span><br><span class="line">调用函数：</span><br><span class="line">1. 直接执行函数名即可。注意，不需要带小括号</span><br><span class="line">例：函数名</span><br><span class="line">2. 带参数的函数执行方法：</span><br><span class="line">例：函数名 参数1 参数2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在函数体中的位置参数(<span class="variable">$1</span>、<span class="variable">$2</span>、<span class="variable">$3</span>、<span class="variable">$#</span>、$*、$?、<span class="variable">$@</span>)都可以是函数</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 父脚本的参数则临时地被函数参数所掩盖或隐藏</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$0</span>比较特殊，它仍然是父脚本的名称</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 函数一定要在调用之前定义并加载</span></span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim func1.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">if [ $# -ne 1 ];then</span><br><span class="line">   echo "error" &amp;&amp; exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">Check_Url() &#123;</span><br><span class="line">   curl -I -s $1|head -1 &amp;&amp; return 0||return 1</span><br><span class="line">&#125;</span><br><span class="line">Check_Url $1</span><br><span class="line"><span class="meta">#</span><span class="bash"> Check_Url后的<span class="variable">$1</span>是命令行的第一个参数，curl中的<span class="variable">$1</span>是函数的第一个参数。这两个<span class="variable">$1</span>的作用是不一样的</span></span><br><span class="line"></span><br><span class="line">例：生产环境批量检查web服务是否正常并且发送相关邮件</span><br><span class="line">[root@template sh]# vim check_service.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">RETVAL=0</span><br><span class="line">FAILCOUNT=0</span><br><span class="line">SCRIPTS_PATH="/root/sh"</span><br><span class="line">MAIL_GROUP="root@localhost"</span><br><span class="line">LOG_FILE="/tmp/web_check.log"</span><br><span class="line">GetUrlStatus() &#123;</span><br><span class="line">   for ((i=1;i&lt;=3;i++));do</span><br><span class="line">        wget -T 10 --tries=1 --spider http://$&#123;1&#125; &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">        [ $? -ne 0 ] &amp;&amp; let FAILCOUNT+=1</span><br><span class="line">   done</span><br><span class="line"><span class="meta">   #</span><span class="bash"> 访问三次页面，如果返回值不是0，变量FAILCOUNT就自增1。</span></span><br><span class="line">   if [ $FAILCOUNT -gt 1 ];then</span><br><span class="line">        RETVAL=1</span><br><span class="line">        NowTime=`date +"%m-%d %H:%M:%S"`</span><br><span class="line">        SC="http://$&#123;1&#125; service is error,$&#123;NowTime&#125;."</span><br><span class="line">        echo "send to : $MAIL_USER, Title: $SUBJECT_CONTENT" &gt; $LOG_FILE</span><br><span class="line">        for MAIL_USER in $MAIL_GROUP;do</span><br><span class="line">           mail -s "$SC" $MAIL_USER &lt; $LOG_FILE</span><br><span class="line">        done</span><br><span class="line">   else</span><br><span class="line">        RETVAL=0</span><br><span class="line">   fi</span><br><span class="line">   return $RETVAL</span><br><span class="line"><span class="meta">   #</span><span class="bash"> 判断变量FAILCOUNT是否大于1，如果大于1,就发邮件，并记入日志文件，并将变量RETVAL的值改为1，否则RETVAL的值是0，RETVAL的值就是返回码，退出函数。</span></span><br><span class="line">&#125;</span><br><span class="line">[ ! -d "$SCRIPTS_PATH" ] &amp;&amp; mkdir -p $SCRIPTS_PATH</span><br><span class="line">[ ! -f "$SCRIPTS_PATH"/domain.list ] &amp;&amp; &#123;</span><br><span class="line">cat &gt; $SCRIPTS_PATH/domain.list &lt;&lt; END</span><br><span class="line">www.baidu.com</span><br><span class="line">www.sohu.com</span><br><span class="line">192.168.1.24</span><br><span class="line">END</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断变量SCRIPTS_PATH指定的目录是否存在，不存在就创建，再判断变量SCRIPTS_PATH中的domain.list文件是否存在，不存在就创建，其中是网页地址。</span></span><br><span class="line">for URL in `cat $SCRIPTS_PATH/domain.list`;do</span><br><span class="line">   echo -n "checking $URL: "</span><br><span class="line">   GetUrlStatus $URL &amp;&amp; echo ok || echo no</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 循环检查domain.list文件中的网址，将变量URL的值给GetUrlStatus函数，在GetUrlStatus函数中由<span class="variable">$1</span>接收。如果返回值是0就显示ok，否则显示no</span></span><br><span class="line">[root@template sh]# bash check_service.sh   </span><br><span class="line">checking www.baidu.com: ok</span><br><span class="line">checking www.sohu.com: ok</span><br><span class="line">checking 192.168.1.24: no</span><br><span class="line">You have new mail in /var/spool/mail/root</span><br></pre></td></tr></table></figure>
<h3 id="优化linux系统"><a href="#优化linux系统" class="headerlink" title="优化linux系统"></a>优化linux系统</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. 安装系统时精简安装包，最小化安装</span><br><span class="line">2. 配置国内高速yum源</span><br><span class="line">3. 禁用开机不需要启动的服务</span><br><span class="line">4. 优化系统内核参数，/etc/sysctl.conf</span><br><span class="line">5. 增加系统文件描述符、堆栈等配置</span><br><span class="line">6. 有外网IP的机器要开启配置防火墙，仅对外开启需要提供服务的端口，配置或关闭selinux</span><br><span class="line">7. 清除无用的默认系统帐户或组（非必须）</span><br><span class="line">8. 锁定敏感文件，如/etc/passwd（非必须）</span><br><span class="line">9. 配置服务器和互联网时间同步</span><br><span class="line">10. 配置sudo对普通用户权限精细控制</span><br><span class="line">11. 把以上10点写成一键优化脚本</span><br></pre></td></tr></table></figure>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">方法一</span><br><span class="line">array=(value1 value2 value3 ...)</span><br><span class="line">echo $&#123;#array[@]&#125;</span><br><span class="line">echo $&#123;#array[*]&#125;</span><br><span class="line">echo $&#123;#array[0]&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 计算数组中的共有几个值</span></span><br><span class="line">echo $&#123;array[*]&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出数组中的所有值</span></span><br><span class="line">echo $&#123;array[0]&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出数组中的某个值，数组的下标从0开始</span></span><br><span class="line">array[3]=4</span><br><span class="line"><span class="meta">#</span><span class="bash"> 给某个数组下标赋值</span></span><br><span class="line">array[0]=abc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 给已有的数组下标修改值</span></span><br><span class="line">unset array</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除整个数组</span></span><br><span class="line">unset array[0]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除数组中某个下标的值</span></span><br><span class="line">echo $&#123;array[@]:1:3&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从第几个元素开始截取，截取几个</span></span><br><span class="line">array=($&#123;array[@]/5/6&#125;)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将第5个元素的值改为6</span></span><br><span class="line">echo $&#123;array[@]#o&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从左开始最短匹配删除</span></span><br><span class="line">echo $&#123;array[@]#fo&#125;</span><br><span class="line">echo $&#123;array[@]%t*e&#125;</span><br><span class="line">echo $&#123;array[@]%%t*e&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 数组也是变量，因此也适合于变量的子串处理的功能应用。</span></span><br><span class="line"></span><br><span class="line">方法二</span><br><span class="line">array=([1]=one [2]=two [3]=three)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义下标与值</span></span><br><span class="line"></span><br><span class="line">方法三</span><br><span class="line">array[0]=a array[1]=b array[2]=c </span><br><span class="line"></span><br><span class="line">方法四</span><br><span class="line">declare -a array</span><br><span class="line"></span><br><span class="line">方法五</span><br><span class="line">array=($(ls))</span><br></pre></td></tr></table></figure>
<h3 id="trap信号"><a href="#trap信号" class="headerlink" title="trap信号"></a>trap信号</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">trap使用信号的方法</span><br><span class="line">trap命令用于指定在接收到信号后将要采取的行动。trap命令的一种常见用途是在脚本程序被中断时完成清理工作。历史上，shell总是用数字来代表信号，而新的脚本程序应该使用的名字，它们保存在用#include命令包含进来的signal.h头文件中，在使用信号名时需要省略SIG前缀。你可以在命令提示符下输入命令trap -l来查看信号编号及其关联的名称。</span><br><span class="line">脚本程序通常是以从上到下的顺序解释执行的，所以必须在你想保护的那部分代码以前指定trap命令。</span><br><span class="line">如果要重置桔某个信号的处理条件到其默认值，只需简单的将command设置为-。如果要忽略某个信号，就把command设置为空字符串''，一个不带参数的trap命令将列出当前设置的信号及其行动的清单。exit命令后传输就是就是这个信号的代码</span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@template ~]# trap "" 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 屏蔽ctrl+c信号 </span></span><br><span class="line">[root@template ~]# trap ":" 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 恢复ctrl+c信号 </span></span><br><span class="line">[root@template ~]# trap "echo -n 'you are typing ctrl+c'" 2 </span><br><span class="line">[root@template ~]# ^Cyou are typing ctrl+c</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置一个提示，当输入指定信号时就会提示</span></span><br><span class="line">[root@template ~]# trap "" HUP INT QUIT TSTP TERM</span><br><span class="line"><span class="meta">#</span><span class="bash"> 屏蔽多个信号</span></span><br><span class="line">[root@template ~]# trap ":" HUP INT QUIT TSTP TERM</span><br><span class="line"><span class="meta">#</span><span class="bash"> 恢复多个信号 </span></span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim showdate.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">trap 'echo “you go…”;exit 1' INT</span><br><span class="line">while :; do</span><br><span class="line">    date</span><br><span class="line">    sleep 2</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span><span class="bash"> 捕捉到信號，顯示命令。要想用ctrl+c退出，要在<span class="built_in">echo</span> you go后加&amp;&amp; <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line">例</span><br><span class="line">[root@template sh]# vim ping.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">NET=192.168.1</span><br><span class="line">FILE=`mktemp /tmp/file.XXXXX`</span><br><span class="line">clearup() &#123;</span><br><span class="line">   echo “quit…”</span><br><span class="line">   rm -f $FILE</span><br><span class="line">   exit 1</span><br><span class="line">&#125;</span><br><span class="line">trap 'clearup' INT</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试发现，只要有退出码，就可以使用ctrl+c退出脚本。如上面的退出码是<span class="built_in">exit</span> 1。如果注释了上面的函数，再使用ctrl+c退出时只能退出当前ping的命令，脚本会继续ping下一个地址。</span></span><br><span class="line">for I in &#123;200..254&#125;; do</span><br><span class="line">   if ping -c 1 -W 1 $NET.$I &amp;&gt; /dev/null; then</span><br><span class="line">      echo “$NET.$I is up .” | tee &gt;&gt; $FILE</span><br><span class="line">   else</span><br><span class="line">      echo “$NET.$I is down”</span><br><span class="line">   fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ShellScript语法/" rel="tag"># ShellScript语法</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/08/redis命令/" rel="next" title="redis命令">
                <i class="fa fa-chevron-left"></i> redis命令
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/15/linux性能监控命令/" rel="prev" title="linux性能监控命令">
                linux性能监控命令 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            本站概要
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ruopu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">158</span>
                    <span class="site-state-item-name">文章</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">分類</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">123</span>
                    <span class="site-state-item-name">標籤</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#清除日志的三种方法"><span class="nav-number">1.</span> <span class="nav-text">清除日志的三种方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shell脚本执行方式"><span class="nav-number">2.</span> <span class="nav-text">Shell脚本执行方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shell脚本开发基本规范及习惯"><span class="nav-number">3.</span> <span class="nav-text">shell脚本开发基本规范及习惯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#变量分类"><span class="nav-number">4.</span> <span class="nav-text">变量分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#位置变量"><span class="nav-number">5.</span> <span class="nav-text">位置变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用内部命令"><span class="nav-number">6.</span> <span class="nav-text">常用内部命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串操作"><span class="nav-number">7.</span> <span class="nav-text">字符串操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#变量的数值计算"><span class="nav-number">8.</span> <span class="nav-text">变量的数值计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#read命令"><span class="nav-number">9.</span> <span class="nav-text">read命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件测试"><span class="nav-number">10.</span> <span class="nav-text">条件测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串及整数操作符"><span class="nav-number">11.</span> <span class="nav-text">字符串及整数操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#逻辑操作符"><span class="nav-number">12.</span> <span class="nav-text">逻辑操作符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单级与多级菜单"><span class="nav-number">13.</span> <span class="nav-text">单级与多级菜单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#if条件语句"><span class="nav-number">14.</span> <span class="nav-text">if条件语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#case条件语句"><span class="nav-number">15.</span> <span class="nav-text">case条件语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#while语句"><span class="nav-number">16.</span> <span class="nav-text">while语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#until语句"><span class="nav-number">17.</span> <span class="nav-text">until语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for循环"><span class="nav-number">18.</span> <span class="nav-text">for循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#取随机数的方法"><span class="nav-number">19.</span> <span class="nav-text">取随机数的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#break、continue、exit对比"><span class="nav-number">20.</span> <span class="nav-text">break、continue、exit对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shell函数"><span class="nav-number">21.</span> <span class="nav-text">shell函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#优化linux系统"><span class="nav-number">22.</span> <span class="nav-text">优化linux系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数组"><span class="nav-number">23.</span> <span class="nav-text">数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trap信号"><span class="nav-number">24.</span> <span class="nav-text">trap信号</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruopu</span>

  

  

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_pv">
    本站总访问量: <span id="busuanzi_value_site_pv"></span>次
  </span>
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.0</div>





        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="訪客總數">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="總瀏覽次數">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
