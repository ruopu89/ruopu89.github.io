<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="安装12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364[root@test ~]# yum install -y redis[root@test ~]# rpm -ql redis/etc/logrotate.d">
<meta name="keywords" content="redis命令">
<meta property="og:type" content="article">
<meta property="og:title" content="redis命令">
<meta property="og:url" content="http://yoursite.com/2019/01/08/redis命令/index.html">
<meta property="og:site_name" content="ruopu&#39;s blog">
<meta property="og:description" content="安装12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364[root@test ~]# yum install -y redis[root@test ~]# rpm -ql redis/etc/logrotate.d">
<meta property="og:locale" content="zh-TW">
<meta property="og:updated_time" content="2019-01-09T10:18:48.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis命令">
<meta name="twitter:description" content="安装12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364[root@test ~]# yum install -y redis[root@test ~]# rpm -ql redis/etc/logrotate.d">






  <link rel="canonical" href="http://yoursite.com/2019/01/08/redis命令/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>redis命令 | ruopu's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-TW">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ruopu's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切換導航欄">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首頁</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />標籤</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分類</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />歸檔</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜尋</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜尋..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/08/redis命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">redis命令
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2019-01-08 09:34:35" itemprop="dateCreated datePublished" datetime="2019-01-08T09:34:35+08:00">2019-01-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2019-01-09 18:18:48" itemprop="dateModified" datetime="2019-01-09T18:18:48+08:00">2019-01-09</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             閱讀次數： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# yum install -y redis</span><br><span class="line">[root@test ~]# rpm -ql redis</span><br><span class="line">/etc/logrotate.d/redis</span><br><span class="line">/etc/redis-sentinel.conf</span><br><span class="line">/etc/redis.conf</span><br><span class="line">/etc/systemd/system/redis-sentinel.service.d</span><br><span class="line">/etc/systemd/system/redis-sentinel.service.d/limit.conf</span><br><span class="line">/etc/systemd/system/redis.service.d</span><br><span class="line">/etc/systemd/system/redis.service.d/limit.conf</span><br><span class="line">/usr/bin/redis-benchmark：评估redis性能</span><br><span class="line">/usr/bin/redis-check-aof：检测工具</span><br><span class="line">/usr/bin/redis-check-rdb：检测工具</span><br><span class="line">/usr/bin/redis-cli</span><br><span class="line">/usr/bin/redis-sentinel</span><br><span class="line">/usr/bin/redis-server：主程序</span><br><span class="line">/usr/lib/systemd/system/redis-sentinel.service</span><br><span class="line">/usr/lib/systemd/system/redis.service</span><br><span class="line">/usr/libexec/redis-shutdown</span><br><span class="line">...</span><br><span class="line">/var/lib/redis：数据存储目录</span><br><span class="line">/var/log/redis</span><br><span class="line">/var/run/redis</span><br><span class="line">[root@test ~]# systemctl start redis</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">[root@test ~]# ss -tln</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">LISTEN      0      128    127.0.0.1:6379                    *:*  </span><br><span class="line"><span class="meta">#</span><span class="bash"> 监听127地址的6379端口，要监听在所有地址，需要认证，只有密码，没有用户名</span></span><br><span class="line">[root@test ~]# redis-cli -h localhost -p 6379</span><br><span class="line"><span class="meta">#</span><span class="bash"> 连接本机的redis，-h指定地址，-p指定端口，-a指定密码，连接本机时不用密码</span></span><br><span class="line">localhost:6379&gt; SELECT 0</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换数据库，数据库以数字表示，默认是16个库，0－15</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">help</span> @&lt;group&gt;可查看一组命令的使用格式；<span class="built_in">help</span> &lt;<span class="built_in">command</span>&gt;可查看单个命令的使用方法；<span class="built_in">help</span> &lt;tab&gt;可切换命令组；</span></span><br><span class="line">localhost:6379&gt; help @list</span><br><span class="line">localhost:6379&gt; SET name tom</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置健为name，值为tom</span></span><br><span class="line">localhost:6379&gt; GET name</span><br><span class="line">"tom"</span><br><span class="line">localhost:6379&gt; APPEND name brown</span><br><span class="line">(integer) 8</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在name的值后追加值brown</span></span><br><span class="line">localhost:6379&gt; GET name</span><br><span class="line">"tombrown"</span><br><span class="line">localhost:6379&gt; STRLEN name</span><br><span class="line">(integer) 8</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看name值有多长</span></span><br><span class="line">localhost:6379&gt; SET count 0</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置一个计数器叫count，值为0</span></span><br><span class="line">localhost:6379&gt; INCR count</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> count计数器的值加1</span></span><br><span class="line">localhost:6379&gt; INCRBY count 10</span><br><span class="line">(integer) 11</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在count计数器上加10</span></span><br><span class="line">localhost:6379&gt; DECR count</span><br><span class="line">(integer) 10</span><br><span class="line"><span class="meta">#</span><span class="bash"> 计数器减1</span></span><br><span class="line">localhost:6379&gt; DECRBY count 3</span><br><span class="line">(integer) 7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 计数器减3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 先进先出FIFO(First IN First Out)，后进先出</span></span><br></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">* 查看配置语法</span><br><span class="line">redis 127.0.0.1:6379&gt; CONFIG GET CONFIG_SETTING_NAME</span><br><span class="line">例 </span><br><span class="line">localhost:6379&gt; CONFIG GET loglevel</span><br><span class="line">1) "loglevel"</span><br><span class="line">2) "notice"</span><br><span class="line"></span><br><span class="line">localhost:6379&gt; CONFIG GET *</span><br><span class="line">  1) "dbfilename"</span><br><span class="line">  2) "dump.rdb"</span><br><span class="line">  3) "requirepass"</span><br><span class="line">  ...</span><br><span class="line"><span class="meta">  #</span><span class="bash"> 使用 * 号获取所有配置项</span></span><br><span class="line">  </span><br><span class="line">  * 编辑配置</span><br><span class="line">  语法</span><br><span class="line">  redis 127.0.0.1:6379&gt; CONFIG SET CONFIG_SETTING_NAME NEW_CONFIG_VALUE</span><br><span class="line">  例</span><br><span class="line">  localhost:6379&gt; CONFIG SET loglevel "notice"</span><br><span class="line"> OK</span><br><span class="line"> </span><br><span class="line">[root@test ~]# vim /etc/redis.conf</span><br><span class="line">    daemonize no</span><br><span class="line"><span class="meta">	#</span><span class="bash"> Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程</span></span><br><span class="line"></span><br><span class="line">    pidfile /var/run/redis.pid</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 当Redis以守护进程方式运行时，Redis默认会把pid写入/var/run/redis.pid文件，可以通过pidfile指定</span></span><br><span class="line"></span><br><span class="line">    port 6379</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定Redis监听端口，默认端口为6379</span></span><br><span class="line"></span><br><span class="line">    bind 127.0.0.1</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 绑定的主机地址</span></span><br><span class="line"></span><br><span class="line">    timeout 300</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 当客户端闲置多长时间后关闭连接，如果指定为0，表示关闭该功能</span></span><br><span class="line"></span><br><span class="line">    loglevel verbose</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为verbose</span></span><br><span class="line"></span><br><span class="line">    logfile stdout</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 日志记录方式，默认为标准输出，如果配置Redis为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给/dev/null</span></span><br><span class="line"></span><br><span class="line">    databases 16</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 设置数据库的数量，默认数据库为0，可以使用SELECT &lt;dbid&gt;命令在连接上指定数据库id</span></span><br><span class="line"></span><br><span class="line">    save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span></span><br><span class="line">    # Redis默认配置文件中提供了三个条件：</span><br><span class="line">    # save 900 1</span><br><span class="line">    # save 300 10</span><br><span class="line">    # save 60 10000</span><br><span class="line">    # 分别表示900秒（15分钟）内有1个更改，300秒（5分钟）内有10个更改以及60秒内有10000个更改。</span><br><span class="line"></span><br><span class="line">    rdbcompression yes</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大</span></span><br><span class="line"></span><br><span class="line">    dbfilename dump.rdb</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定本地数据库文件名，默认值为dump.rdb</span></span><br><span class="line"></span><br><span class="line">    dir ./</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定本地数据库存放目录</span></span><br><span class="line"></span><br><span class="line">    slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 设置当本机为slav服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步</span></span><br><span class="line"></span><br><span class="line">    masterauth &lt;master-password&gt;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 当master服务设置了密码保护时，slav服务连接master的密码</span></span><br><span class="line"></span><br><span class="line">    requirepass foobared</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 设置Redis连接密码，如果配置了连接密码，客户端在连接Redis时需要通过AUTH &lt;password&gt;命令提供密码，默认关闭</span></span><br><span class="line"></span><br><span class="line">    maxclients 128</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 设置同一时间最大客户端连接数，默认无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息</span></span><br><span class="line"></span><br><span class="line">    maxmemory &lt;bytes&gt;</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，当此方法处理后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区</span></span><br><span class="line"></span><br><span class="line">    appendonly no</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为redis本身同步数据文件是按上面save条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为no</span></span><br><span class="line"></span><br><span class="line">     appendfilename appendonly.aof</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定更新日志文件名，默认为appendonly.aof</span></span><br><span class="line"></span><br><span class="line">    appendfsync everysec</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定更新日志条件，共有3个可选值： </span></span><br><span class="line">    # no：表示等操作系统进行数据缓存同步到磁盘（快） </span><br><span class="line">    # always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全） </span><br><span class="line">    # everysec：表示每秒同步一次（折中，默认值）</span><br><span class="line"> </span><br><span class="line">     vm-enabled no</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定是否启用虚拟内存机制，默认值为no，简单的介绍一下，VM机制将数据分页存放，由Redis将访问量较少的页即冷数据swap到磁盘上，访问多的页面由磁盘自动换出到内存中</span></span><br><span class="line"></span><br><span class="line">     vm-swap-file /tmp/redis.swap</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 虚拟内存文件路径，默认值为/tmp/redis.swap，不可多个Redis实例共享</span></span><br><span class="line"></span><br><span class="line">     vm-max-memory 0</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 将所有大于vm-max-memory的数据存入虚拟内存,无论vm-max-memory设置多小,所有索引数据都是内存存储的(Redis的索引数据就是keys),也就是说,当vm-max-memory设置为0的时候,其实是所有value都存在于磁盘。默认值为0</span></span><br><span class="line"></span><br><span class="line">     vm-page-size 32</span><br><span class="line"><span class="meta">	#</span><span class="bash"> Redis swap文件分成了很多的page，一个对象可以保存在多个page上面，但一个page上不能被多个对象共享，vm-page-size是要根据存储的数据大小来设定的，作者建议如果存储很多小对象，page大小最好设置为32或者64bytes；如果存储很大的对象，则可以使用更大的page，如果不确定，就使用默认值</span></span><br><span class="line"></span><br><span class="line">     vm-pages 134217728</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 设置swap文件中的page数量，由于页表（一种表示页面空闲或使用的bitmap）是在放在内存中的，在磁盘上每8个pages将消耗1byte的内存。</span></span><br><span class="line"></span><br><span class="line">     vm-max-threads 4</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 设置访问swap文件的线程数,最好不要超过机器的核数,如果设置为0,那么所有对swap文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为4</span></span><br><span class="line"></span><br><span class="line">    glueoutputbuf yes</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启</span></span><br><span class="line"></span><br><span class="line">    hash-max-zipmap-entries 64</span><br><span class="line">    hash-max-zipmap-value 512</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</span></span><br><span class="line"></span><br><span class="line">    activerehashing yes</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 指定是否激活重置哈希，默认为开启</span></span><br><span class="line"></span><br><span class="line">    include /path/to/local.conf</span><br><span class="line">    # 指定包含其它的配置文件，可以在同一主机上多个Redis实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件</span><br></pre></td></tr></table></figure>
<h3 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">localhost:6379&gt; LPUSH weekdays Mon Tue</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 追加一个weekdays队列，但从右进，值是Mon Tue</span></span><br><span class="line">localhost:6379&gt; LINDEX weekdays 0</span><br><span class="line">"Tue"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看队列最左侧的索引值，显示Tue</span></span><br><span class="line">localhost:6379&gt; LRANGE weekdays 0 1</span><br><span class="line">1) "Tue"</span><br><span class="line">2) "Mon"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取列表指定范围内的元素</span></span><br><span class="line">localhost:6379&gt; RPUSH weekdays Wed Thu</span><br><span class="line">(integer) 4</span><br><span class="line"><span class="meta">#</span><span class="bash"> 向weekdays队列中追加值Wed和Thu</span></span><br><span class="line">localhost:6379&gt; LINDEX weekdays 3</span><br><span class="line">"Thu"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看索引为3的值。因为是从0开始编号的，所以第3个是Thu</span></span><br><span class="line">localhost:6379&gt; LRANGE weekdays 0 5</span><br><span class="line">1) "Tue"</span><br><span class="line">2) "Mon"</span><br><span class="line">3) "Wed"</span><br><span class="line">4) "Thu"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取列表指定范围内的元素</span></span><br><span class="line">localhost:6379&gt; LPOP weekdays</span><br><span class="line">"Tue"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从weekdays队列最左侧删除数据</span></span><br><span class="line">localhost:6379&gt; RPOP weekdays</span><br><span class="line">"Thu"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从weekdays队列最右侧删除数据</span></span><br><span class="line">localhost:6379&gt; LINSERT weekdays BEFORE Wed Fri</span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在Wed前插入数据Fri。BEFORE在指定元素前插入数据，AFTER是在指定元素之后插入数据</span></span><br><span class="line">localhost:6379&gt; LINDEX weekdays 1</span><br><span class="line">"Fri"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示Fri，因为上面将Fri插入在了原来索引为1的Web前</span></span><br><span class="line">localhost:6379&gt; LRANGE weekdays 0 10</span><br><span class="line">1) "Mon"</span><br><span class="line">2) "Fri"</span><br><span class="line">3) "Wed"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取列表指定范围内的元素</span></span><br></pre></td></tr></table></figure>
<h3 id="hash（哈希）"><a href="#hash（哈希）" class="headerlink" title="hash（哈希）"></a>hash（哈希）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">localhost:6379&gt; HSET stu1 name tom</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 定义一个名字叫stu1的表name名字叫tom</span></span><br><span class="line">localhost:6379&gt; HSET stu1 age 17</span><br><span class="line">(integer) 1</span><br><span class="line">localhost:6379&gt; HMSET stu1 gender Male major Kuihua</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> HMSET可以设置多个下标，gender和major是下标，Male和Kuihua是值</span></span><br><span class="line">localhost:6379&gt; HKEYS stu1</span><br><span class="line">1) "name"</span><br><span class="line">2) "age"</span><br><span class="line">3) "gender"</span><br><span class="line">4) "major"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看stu1的下标的名字</span></span><br><span class="line">localhost:6379&gt; HVALS stu1</span><br><span class="line">1) "tom"</span><br><span class="line">2) "17"</span><br><span class="line">3) "Male"</span><br><span class="line">4) "Kuihua"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看下标的值</span></span><br><span class="line">localhost:6379&gt; HDEL stu1 major</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除stu1的下标major</span></span><br><span class="line">localhost:6379&gt; HKEYS stu1</span><br><span class="line">1) "name"</span><br><span class="line">2) "age"</span><br><span class="line">3) "gender"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看下标</span></span><br><span class="line">localhost:6379&gt; HLEN stu1</span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看key上有几个元素</span></span><br><span class="line">localhost:6379&gt; HSTRLEN stu1 name</span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看name元素有几个字节</span></span><br></pre></td></tr></table></figure>
<h3 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">localhost:6379&gt; SADD tom lucy lily hanmeimei</span><br><span class="line">(integer) 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建一个集合叫tom，tom后的是他的好友的名字</span></span><br><span class="line">localhost:6379&gt; SADD jerry lucy obama trump</span><br><span class="line">(integer) 3</span><br><span class="line">localhost:6379&gt; SINTER tom jerry</span><br><span class="line">1) "lucy"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看tom和jerry的交集</span></span><br><span class="line">localhost:6379&gt; SUNION tom jerry</span><br><span class="line">1) "lucy"</span><br><span class="line">2) "lily"</span><br><span class="line">3) "hanmeimei"</span><br><span class="line">4) "trump"</span><br><span class="line">5) "obama"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看tom和jerry的并集</span></span><br><span class="line">localhost:6379&gt; SDIFF tom jerry</span><br><span class="line">1) "lily"</span><br><span class="line">2) "hanmeimei"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看差集，tom有的而jerry没有朋友的名字</span></span><br><span class="line">localhost:6379&gt; SDIFF jerry tom</span><br><span class="line">1) "trump"</span><br><span class="line">2) "obama"</span><br><span class="line">localhost:6379&gt; SMEMBERS tom</span><br><span class="line">1) "lily"</span><br><span class="line">2) "lucy"</span><br><span class="line">3) "hanmeimei"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看tom集合的所有元素</span></span><br><span class="line">localhost:6379&gt; SMEMBERS jerry</span><br><span class="line">1) "trump"</span><br><span class="line">2) "obama"</span><br><span class="line">3) "lucy"</span><br><span class="line">localhost:6379&gt; SUNIONSTORE friends tom jerry</span><br><span class="line">(integer) 5</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看并集并保存，保存的键名叫friends</span></span><br><span class="line">localhost:6379&gt; SMEMBERS friends</span><br><span class="line">1) "lucy"</span><br><span class="line">2) "lily"</span><br><span class="line">3) "hanmeimei"</span><br><span class="line">4) "trump"</span><br><span class="line">5) "obama"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看</span></span><br></pre></td></tr></table></figure>
<h3 id="sorted-set（有序集合）"><a href="#sorted-set（有序集合）" class="headerlink" title="sorted set（有序集合）"></a>sorted set（有序集合）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">localhost:6379&gt; ZADD colors 1 red 2 blue 8 green 5 gray</span><br><span class="line">(integer) 4</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建一个叫colors的集合。添加时提示“OOM <span class="built_in">command</span> not allowed when used memory &gt; <span class="string">'maxmemory'</span>”，是因为配置文件中设置了maxmemory的值，现在已经达到了上限，所以报错。</span></span><br><span class="line">localhost:6379&gt; ZCARD colors</span><br><span class="line">(integer) 4</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看colors有几个成员</span></span><br><span class="line">localhost:6379&gt; ZSCORE colors green</span><br><span class="line">"8"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看成员green的分数</span></span><br><span class="line">localhost:6379&gt; ZCOUNT colors 2 6</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计一个范围分数的成员个数</span></span><br><span class="line">localhost:6379&gt; ZRANGE colors 0 5</span><br><span class="line">1) "red"</span><br><span class="line">2) "blue"</span><br><span class="line">3) "gray"</span><br><span class="line">4) "green"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回所指范围内的值</span></span><br><span class="line">localhost:6379&gt; ZRANK colors gray</span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看元素的索引是几</span></span><br></pre></td></tr></table></figure>
<h3 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a>发布订阅</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">localhost:6379&gt; SUBSCRIBE military</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) "subscribe"</span><br><span class="line">2) "military"</span><br><span class="line">3) (integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 订阅频道，这时会停留在频道中</span></span><br><span class="line">再打开一个窗口连接redis</span><br><span class="line">[root@test ~]# redis-cli -h localhost</span><br><span class="line">localhost:6379&gt; PUBLISH military caoxian</span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 向military频道中发布一条信息</span></span><br><span class="line">回到之前的窗口，这时会显示刚发布的信息</span><br><span class="line">localhost:6379&gt; SUBSCRIBE military finance</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) "subscribe"</span><br><span class="line">2) "military"</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) "subscribe"</span><br><span class="line">2) "finance"</span><br><span class="line">3) (integer) 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在第一个窗口重新订阅两个频道</span></span><br><span class="line">到新窗口重新发布信息</span><br><span class="line">localhost:6379&gt; PUBLISH finance bitcorn</span><br><span class="line">(integer) 1</span><br><span class="line">回到之前的窗口</span><br><span class="line">[root@test ~]# redis-cli -h localhost -p 6379</span><br><span class="line">localhost:6379&gt; SUBSCRIBE military finance</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) "subscribe"</span><br><span class="line">2) "military"</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) "subscribe"</span><br><span class="line">2) "finance"</span><br><span class="line">3) (integer) 2</span><br><span class="line">1) "message"</span><br><span class="line">2) "finance"</span><br><span class="line">3) "bitcorn"</span><br></pre></td></tr></table></figure>
<h3 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# vim /etc/redis.conf</span><br><span class="line">requirepass mageedu</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置密码为mageedu</span></span><br><span class="line">[root@test ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; GET name</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这时是不能使用的，要密码</span></span><br><span class="line">127.0.0.1:6379&gt; AUTH mageedu</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 给密码</span></span><br><span class="line">127.0.0.1:6379&gt; GET name</span><br><span class="line">"tombrown"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这时就能得到数据了</span></span><br><span class="line">127.0.0.1:6379&gt; INFO Server</span><br><span class="line"><span class="meta">#</span><span class="bash"> Server</span></span><br><span class="line">redis_version:3.2.12</span><br><span class="line">redis_git_sha1:00000000</span><br><span class="line">redis_git_dirty:0</span><br><span class="line">redis_build_id:7897e7d0e13773f</span><br><span class="line">redis_mode:standalone</span><br><span class="line">os:Linux 3.10.0-693.el7.x86_64 x86_64</span><br><span class="line">arch_bits:64</span><br><span class="line">multiplexing_api:epoll</span><br><span class="line">gcc_version:4.8.5</span><br><span class="line">process_id:2591</span><br><span class="line">run_id:af2243e0cf36e57e000b383901b8c832530fc91e</span><br><span class="line">tcp_port:6379</span><br><span class="line">uptime_in_seconds:74</span><br><span class="line">uptime_in_days:0</span><br><span class="line">hz:10</span><br><span class="line">lru_clock:3412915</span><br><span class="line">executable:/usr/bin/redis-server</span><br><span class="line">config_file:/etc/redis.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看服务器信息</span></span><br><span class="line">127.0.0.1:6379&gt; INFO</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有信息</span></span><br><span class="line">127.0.0.1:6379&gt; INFO Clients</span><br><span class="line"><span class="meta">#</span><span class="bash"> Clients</span></span><br><span class="line">connected_clients:1</span><br><span class="line">client_longest_output_list:0</span><br><span class="line">client_biggest_input_buf:0</span><br><span class="line">blocked_clients:0</span><br><span class="line">127.0.0.1:6379&gt; INFO Memory</span><br><span class="line"><span class="meta">#</span><span class="bash"> Memory</span></span><br><span class="line">used_memory:814480</span><br><span class="line">used_memory_human:795.39K</span><br><span class="line">used_memory_rss:5947392</span><br><span class="line">used_memory_rss_human:5.67M</span><br><span class="line">used_memory_peak:815328</span><br><span class="line">used_memory_peak_human:796.22K</span><br><span class="line">total_system_memory:1023713280</span><br><span class="line">total_system_memory_human:976.29M</span><br><span class="line">used_memory_lua:37888</span><br><span class="line">used_memory_lua_human:37.00K</span><br><span class="line">maxmemory:0</span><br><span class="line">maxmemory_human:0B</span><br><span class="line">maxmemory_policy:noeviction</span><br><span class="line">mem_fragmentation_ratio:7.30</span><br><span class="line">mem_allocator:jemalloc-3.6.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 内存信息，其中的maxmemory_policy:noeviction表示最大内存用尽后的策略，noeviction表示不处理，新数据就没法存了。还可以使用内存的淘汰策略</span></span><br><span class="line">localhost:6379&gt; CLIENT LIST</span><br><span class="line">id=2 addr=127.0.0.1:44490 fd=5 name= age=216 idle=44 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=client</span><br><span class="line">id=3 addr=127.0.0.1:44492 fd=6 name= age=10 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=client</span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示所有连接上服务器的客户端</span></span><br></pre></td></tr></table></figure>
<h3 id="测试：修改配置文件"><a href="#测试：修改配置文件" class="headerlink" title="测试：修改配置文件"></a>测试：修改配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@test ~]# vim /etc/redis.conf</span><br><span class="line">    #######INCLUDES##############</span><br><span class="line">    //包含段</span><br><span class="line"><span class="meta">	#</span><span class="bash"><span class="comment">####NETWORK#########</span></span></span><br><span class="line">	bind	0.0.0.0</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 监听所有地址</span></span><br><span class="line">	protected-mode	yes</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 是否工作在保护模式，无论监听哪个地址，都只能本机连接。不使用监听地址和认证功能此项才生效</span></span><br><span class="line">	prot  6379	</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 监听端口</span></span><br><span class="line">	timeout 0		</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 客户端空闲超时时间，超时就与客户端断开连接</span></span><br><span class="line">	tcp-keepalive 300		</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 客户端与服务器tcp连接保持时长</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"><span class="comment">#####SECURITY#######</span></span></span><br><span class="line">	requirepass   mageedu		</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 认证密码</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"><span class="comment">#######LIMITS######</span></span></span><br><span class="line">	maxclients  10000		</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 最大并发连接数</span></span><br><span class="line">	maxmemory 		</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 最大内存。最好手动设置</span></span><br><span class="line">	maxmemory-policy 		</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 内存淘汰策略；noeviction不启用淘汰机制；</span></span><br><span class="line">	maxmemory-samples 5		</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 淘汰的样本数量，每次找5个并淘汰1个</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"><span class="comment">#####SLOW LOG#####</span></span></span><br><span class="line">	slowlog-log-slower-than 10000	</span><br><span class="line"><span class="meta">	#</span><span class="bash"> 慢查询的时间，微秒</span></span><br><span class="line">[root@test ~]# systemctl restart redis</span><br><span class="line">* 换一台主机</span><br><span class="line">[root@test ~]# redis-cli -h 192.168.1.14</span><br><span class="line">192.168.1.14:6379&gt; GET name</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">192.168.1.14:6379&gt; auth mageedu</span><br><span class="line">OK</span><br><span class="line">192.168.1.14:6379&gt; get name</span><br><span class="line">"tombrown"</span><br></pre></td></tr></table></figure>
<h3 id="实时配置"><a href="#实时配置" class="headerlink" title="实时配置"></a>实时配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG GET requirepass</span><br><span class="line">1) "requirepass"</span><br><span class="line">2) "mageedu"</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET requirepass 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET requirepass</span><br><span class="line">1) "requirepass"</span><br><span class="line">2) "123456"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将密码从mageedu改为123456</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG REWRITE</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将内存中的数据覆盖配置文件中的值</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET appendonly yes</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动AOF功能.这是为了让数据在写入内存时就记入日志，防止断电时数据丢失</span></span><br><span class="line">[root@test ~]# vim /etc/redis.conf </span><br><span class="line">requirepass "123456"</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置文件中有两条配置了</span></span><br><span class="line">[root@test ~]# ls /var/lib/redis/</span><br><span class="line">appendonly.aof  dump.rdb</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这时有.aof的文件了</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG RESETSTAT</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重置INFO命令输出的数据</span></span><br></pre></td></tr></table></figure>
<h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 准备三台主机，node1-3，第一台为主节点，后两台为从节点</span></span><br><span class="line"></span><br><span class="line">* node1 192.168.1.14</span><br><span class="line">[root@node1 ~]# vim /etc/redis.conf</span><br><span class="line">	bind 0.0.0.0</span><br><span class="line">	requirepass "123456"</span><br><span class="line">[root@node1 ~]# systemctl restart redis</span><br><span class="line"></span><br><span class="line">* node2、3 192.168.1.15 192.168.1.13</span><br><span class="line">[root@node2 ~]# vim /etc/redis.conf</span><br><span class="line">	bind 0.0.0.0</span><br><span class="line">	requirepass "123456"</span><br><span class="line">[root@node2 ~]# systemctl start redis</span><br><span class="line">[root@node2 ~]# ss -tln</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">LISTEN      0      128         *:6379                    *:* </span><br><span class="line">127.0.0.1:6379&gt; SLAVEOF 192.168.1.14 6379</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 指明主节点地址和端口就可以了</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET masterauth 123456</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置主节点的认证密码</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG REWRITE</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 写入配置文件</span></span><br><span class="line">=======================================================================================</span><br><span class="line">也可以直接写入配置文件</span><br><span class="line">[root@node3 ~]# vim /etc/redis.conf</span><br><span class="line">slaveof 192.168.1.14 6379</span><br><span class="line">masterauth "123456"</span><br><span class="line">=======================================================================================</span><br><span class="line"></span><br><span class="line">* node1 192.168.1.14</span><br><span class="line">127.0.0.1:6379&gt; INFO Replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=192.168.1.15,port=6379,state=online,offset=197,lag=1</span><br><span class="line">slave1:ip=192.168.1.13,port=6379,state=online,offset=197,lag=0</span><br><span class="line">master_repl_offset:197</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:2</span><br><span class="line">repl_backlog_histlen:196</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到两个从节点</span></span><br><span class="line"></span><br><span class="line">* node2 192.168.1.15</span><br><span class="line">127.0.0.1:6379&gt; GET name</span><br><span class="line">"tombrown"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到有信息了</span></span><br><span class="line"></span><br><span class="line">* node3 192.168.1.13</span><br><span class="line">127.0.0.1:6379&gt; GET name</span><br><span class="line">"tombrown"</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS jerry</span><br><span class="line">1) "lucy"</span><br><span class="line">2) "obama"</span><br><span class="line">3) "trump"</span><br><span class="line"><span class="meta">#</span><span class="bash"> node3上也可以查询到信息了</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET slave-read-only</span><br><span class="line">1) "slave-read-only"</span><br><span class="line">2) "yes"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看从节点的配置是否为只读。只有当前节点为从节点时才有效。可以通过CONFIG SET slave-read-only no来设置此项为yes或no</span></span><br><span class="line">127.0.0.1:6379&gt; SET hikey hellothere</span><br><span class="line">(error) READONLY You can't write against a read only slave.</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在从节点上是不可以设置数据的，有错误提示</span></span><br></pre></td></tr></table></figure>
<h3 id="redis-sentinel"><a href="#redis-sentinel" class="headerlink" title="redis-sentinel"></a>redis-sentinel</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 准备三台主机，node1：192.168.1.14，node2：192.168.1.15，node3：192.168.1.13</span></span><br><span class="line"></span><br><span class="line">* 三台主机</span><br><span class="line">[root@node1 ~]# vim /etc/sudoers</span><br><span class="line"><span class="meta">	#</span><span class="bash"> Defaults requiretty</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果有此项就注释掉</span></span><br><span class="line">[root@node1 ~]# vim /etc/sudoers.d/redis</span><br><span class="line">	redis ALL=(ALL) NOPASSWD:/sbin/ip,NOPASSWD:/sbin/arping</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这是为了让redis用户使用sudo命令时不用密码也可执行ip和arping命令。因为redis-sentinel进程是以redis身份运行的，所以执行脚本时也是redis用户，但redis用户是没有权限设置本机地址的，所以要给它权限。</span></span><br><span class="line">[root@node1 ~]# vim /opt/notify_mymaster.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line">MASTER_IP=$&#123;6&#125;</span><br><span class="line">LOCAL_IP='192.168.1.14'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置为每台主机的本地地址</span></span><br><span class="line">VIP='192.168.1.10'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 虚拟IP地址不能变</span></span><br><span class="line">NETMASK='24'</span><br><span class="line">INTERFACE='ens33'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 本地地址所在的网卡</span></span><br><span class="line">if [ $&#123;MASTER_IP&#125; = $&#123;LOCAL_IP&#125; ];then</span><br><span class="line">    sudo /usr/sbin/ip addr add $&#123;VIP&#125;/$&#123;NETMASK&#125; dev $&#123;INTERFACE&#125;</span><br><span class="line">    sudo /usr/sbin/arping -q -c 3 -A $&#123;VIP&#125; -I $&#123;INTERFACE&#125;</span><br><span class="line">    exit 0</span><br><span class="line">else</span><br><span class="line">   sudo /usr/sbin/ip addr del $&#123;VIP&#125;/$&#123;NETMASK&#125; dev $&#123;INTERFACE&#125;</span><br><span class="line">   exit 0</span><br><span class="line">fi</span><br><span class="line">exit 1</span><br><span class="line">[root@node1 ~]# chmod  777 /opt/notify_mymaster.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 脚本一定要有执行权限，不然sentinel服务无法启动</span></span><br><span class="line"></span><br><span class="line">* node1</span><br><span class="line">[root@node1 ~]# /etc/redis.conf</span><br><span class="line">	bind 0.0.0.0</span><br><span class="line">[root@node1 ~]# systemctl start redis</span><br><span class="line">[root@test ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET requirepass redisqwer1234</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET masterauth redisqwer1234</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG REWRITE</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">* node2&amp;3</span><br><span class="line">[root@node1 ~]# /etc/redis.conf</span><br><span class="line">	bind 0.0.0.0</span><br><span class="line">[root@node1 ~]# systemctl start redis</span><br><span class="line">127.0.0.1:6379&gt; slaveof 192.168.1.14 6379</span><br><span class="line">OK Already connected to specified master</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET masterauth redisqwer1234</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET requirepass redisqwer1234</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG REWRITE</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里的三个节点都应该设置masterauth和requirepass的值，requirepass的值是自己作为主节点时，别人请求要用的认证密码。masterauth是与主节点通信时要用到的认证密码。也就是说，masterauth指向的密码就是requirepass设置的密码。因为三个节点都可以做主节点，所以都要设置。如果只设置一个，那么在主节点查看从节点信息时，有可能只显示一个。可在从节点查看/var/<span class="built_in">log</span>/redis/redis.conf日志，日志中会显示不能加入集群的信息</span></span><br><span class="line"></span><br><span class="line">* node1</span><br><span class="line">127.0.0.1:6379&gt; INFO replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=192.168.1.15,port=6379,state=online,offset=351,lag=0</span><br><span class="line">slave1:ip=192.168.1.13,port=6379,state=online,offset=351,lag=1</span><br><span class="line">master_repl_offset:351</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:2</span><br><span class="line">repl_backlog_histlen:350</span><br><span class="line">[root@node1 ~]# vim /etc/redis-sentinel.conf</span><br><span class="line">port 26379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">dir "/tmp"</span><br><span class="line">sentinel myid 8da3fbcd01dafcbb9558f1ac5b52406a3afd00de</span><br><span class="line">sentinel monitor mymaster 192.168.1.14 6379 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel监听主节点的地址和端口，2表示至少有几个sentinel进行选举才能通过</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 多久连接不到主节点就认为它宕机了，这是主观宕机。这里默认是30秒，可改为5000</span></span><br><span class="line">sentinel failover-timeout mymaster 60000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 故障转移多久完成不了，就进行新的转移。这个时间不要太短。这里是3分钟</span></span><br><span class="line">sentinel parallel-syncs 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 一次只给几个从节点同步。并行同步的数量</span></span><br><span class="line">sentinel auth-pass mymaster redisqwer1234</span><br><span class="line"><span class="meta">#</span><span class="bash"> 认证mymaster的主节点的密码，建议用随机字符串。如果不写此项就无法用sentinel slaves mymaster命令查看到从节点的信息</span></span><br><span class="line">sentinel config-epoch mymaster 0</span><br><span class="line">sentinel client-reconfig-script mymaster /opt/notify_mymaster.sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 故障转移时执行notify_mymaster.sh脚本。加入这一行，sentinel的client-reconfig-script在每次执行时会传递出7个参数，第6个就是主redis的地址，所以脚本中定义了MASTER_IP=<span class="variable">$&#123;6&#125;</span></span></span><br><span class="line">logfile "/var/log/redis/sentinel.log"</span><br><span class="line">supervised systemd</span><br><span class="line">sentinel leader-epoch mymaster 0</span><br><span class="line">sentinel known-slave mymaster 192.168.1.13 6379</span><br><span class="line">sentinel known-slave mymaster 192.168.1.15 6379</span><br><span class="line">sentinel current-epoch 0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 上面五行是启动sentinel后自动添加的</span></span><br><span class="line">[root@test ~]# scp /etc/redis-sentinel.conf 192.168.1.13:/etc</span><br><span class="line">[root@test ~]# scp /etc/redis-sentinel.conf 192.168.1.15:/etc</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将配置文件复制到另两个节点</span></span><br><span class="line">[root@test ~]# systemctl start redis-sentinel</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从主节点启动三个节点的服务</span></span><br><span class="line">[root@test ~]# redis-cli -h 192.168.1.14 -p 26379</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在主节点连接</span></span><br><span class="line">192.168.1.14:26379&gt; SENTINEL master mymaster</span><br><span class="line"> 1) "name"</span><br><span class="line"> 2) "mymaster"</span><br><span class="line"> 3) "ip"</span><br><span class="line"> 4) "192.168.1.14"</span><br><span class="line"> 5) "port"</span><br><span class="line"> 6) "6379"</span><br><span class="line"> 7) "runid"</span><br><span class="line"> 8) "84336d6f7ef4fddbc8d21622fabfedd6e3354817"</span><br><span class="line"> 9) "flags"</span><br><span class="line">10) "master"</span><br><span class="line">11) "link-pending-commands"</span><br><span class="line">12) "0"</span><br><span class="line">13) "link-refcount"</span><br><span class="line">14) "1"</span><br><span class="line">15) "last-ping-sent"</span><br><span class="line">16) "0"</span><br><span class="line">17) "last-ok-ping-reply"</span><br><span class="line">18) "963"</span><br><span class="line">19) "last-ping-reply"</span><br><span class="line">20) "963"</span><br><span class="line">21) "down-after-milliseconds"</span><br><span class="line">22) "5000"</span><br><span class="line">23) "info-refresh"</span><br><span class="line">24) "3142"</span><br><span class="line">25) "role-reported"</span><br><span class="line">26) "master"</span><br><span class="line">27) "role-reported-time"</span><br><span class="line">28) "1177509"</span><br><span class="line">29) "config-epoch"</span><br><span class="line">30) "0"</span><br><span class="line">31) "num-slaves"</span><br><span class="line">32) "2"		# 可以看到从节点的数量</span><br><span class="line">33) "num-other-sentinels"</span><br><span class="line">34) "0"</span><br><span class="line">35) "quorum"</span><br><span class="line">36) "2"</span><br><span class="line">37) "failover-timeout"</span><br><span class="line">38) "60000"</span><br><span class="line">39) "parallel-syncs"</span><br><span class="line">40) "1"</span><br><span class="line">41) "client-reconfig-script"</span><br><span class="line">42) "/opt/notify_mymaster.sh"</span><br><span class="line">192.168.1.14:26379&gt; SENTINEL slaves mymaster</span><br><span class="line">1)  1) "name"</span><br><span class="line">    2) "192.168.1.13:6379"</span><br><span class="line">    3) "ip"</span><br><span class="line">    4) "192.168.1.13"</span><br><span class="line">    5) "port"</span><br><span class="line">    6) "6379"</span><br><span class="line">    7) "runid"</span><br><span class="line">    8) "80bc33312e088d2238d455269493e1cb22e78576"</span><br><span class="line">    9) "flags"</span><br><span class="line">   10) "slave"</span><br><span class="line">   11) "link-pending-commands"</span><br><span class="line">   12) "0"</span><br><span class="line">   13) "link-refcount"</span><br><span class="line">   14) "1"</span><br><span class="line">   15) "last-ping-sent"</span><br><span class="line">   16) "0"</span><br><span class="line">   17) "last-ok-ping-reply"</span><br><span class="line">   18) "6"</span><br><span class="line">   19) "last-ping-reply"</span><br><span class="line">   20) "6"</span><br><span class="line">   21) "down-after-milliseconds"</span><br><span class="line">   22) "5000"</span><br><span class="line">   23) "info-refresh"</span><br><span class="line">   24) "5510"</span><br><span class="line">   25) "role-reported"</span><br><span class="line">   26) "slave"</span><br><span class="line">   27) "role-reported-time"</span><br><span class="line">   28) "1260331"</span><br><span class="line">   29) "master-link-down-time"</span><br><span class="line">   30) "0"</span><br><span class="line">   31) "master-link-status"</span><br><span class="line">   32) "ok"			# 这里的状态应该显示OK</span><br><span class="line">   33) "master-host"</span><br><span class="line">   34) "192.168.1.14"</span><br><span class="line">   35) "master-port"</span><br><span class="line">   36) "6379"</span><br><span class="line">   37) "slave-priority"</span><br><span class="line">   38) "100"</span><br><span class="line">   39) "slave-repl-offset"</span><br><span class="line">   40) "311944"</span><br><span class="line">2)  1) "name"</span><br><span class="line">    2) "192.168.1.15:6379"</span><br><span class="line">    3) "ip"</span><br><span class="line">    4) "192.168.1.15"</span><br><span class="line">    5) "port"</span><br><span class="line">    6) "6379"</span><br><span class="line">    7) "runid"</span><br><span class="line">    8) "524e2a7f1c021b610272b7d5a71629617279238d"</span><br><span class="line">    9) "flags"</span><br><span class="line">   10) "slave"</span><br><span class="line">   11) "link-pending-commands"</span><br><span class="line">   12) "0"</span><br><span class="line">   13) "link-refcount"</span><br><span class="line">   14) "1"</span><br><span class="line">   15) "last-ping-sent"</span><br><span class="line">   16) "0"</span><br><span class="line">   17) "last-ok-ping-reply"</span><br><span class="line">   18) "6"</span><br><span class="line">   19) "last-ping-reply"</span><br><span class="line">   20) "6"</span><br><span class="line">   21) "down-after-milliseconds"</span><br><span class="line">   22) "5000"</span><br><span class="line">   23) "info-refresh"</span><br><span class="line">   24) "5663"</span><br><span class="line">   25) "role-reported"</span><br><span class="line">   26) "slave"</span><br><span class="line">   27) "role-reported-time"</span><br><span class="line">   28) "1260331"</span><br><span class="line">   29) "master-link-down-time"</span><br><span class="line">   30) "0"</span><br><span class="line">   31) "master-link-status"</span><br><span class="line">   32) "ok"		# 这里的状态应该显示OK</span><br><span class="line">   33) "master-host"</span><br><span class="line">   34) "192.168.1.14"</span><br><span class="line">   35) "master-port"</span><br><span class="line">   36) "6379"</span><br><span class="line">   37) "slave-priority"</span><br><span class="line">   38) "100"</span><br><span class="line">   39) "slave-repl-offset"</span><br><span class="line">   40) "311805"</span><br><span class="line">   [root@test ~]# ip addr add 192.168.1.111/24 dev ens33</span><br><span class="line"><span class="meta">   #</span><span class="bash"> 第一次启动需要手动配置VIP地址</span></span><br><span class="line">   [root@test opt]# redis-cli -p 26379</span><br><span class="line">   127.0.0.1:26379&gt; sentinel failover mymaster</span><br><span class="line">OK</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这样可以切换主节点</span></span><br><span class="line">127.0.0.1:26379&gt; sentinel master mymaster</span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以查看切换后的主节点</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 之后可以在切换到的主节点上执行sentinel failover mymaster命令，看一下切换的结果</span></span><br><span class="line">   </span><br><span class="line">=======================================================================================</span><br><span class="line">配置方法：</span><br><span class="line">1. 所有节点设置同样的requirepass和masterauth，最后要写入配置文件</span><br><span class="line">2. 配置redis可以设置IP地址的权限</span><br><span class="line">3. 配置监控脚本</span><br><span class="line">4. 设置sentinel脚本，将sentinel脚本复制到所有节点</span><br><span class="line">5. 按顺序启动主节点与从节点的sentinel服务</span><br><span class="line"></span><br><span class="line">排错方法：</span><br><span class="line">按配置方法设置好并启动后，在主节点的sentinel中看不到从节点的信息。可以查看各节点的/var/log/redis/sentinel.log、/var/log/redis/redis.log、/var/log/messages三个日志文件，停止三个节点的sentinel服务，按顺序从主节点启动sentinel日志，再查看日志文件中的报错。</span><br><span class="line">=======================================================================================</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/redis命令/" rel="tag"># redis命令</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/08/redis概念/" rel="next" title="redis概念">
                <i class="fa fa-chevron-left"></i> redis概念
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/13/shellScript语法及使用方法/" rel="prev" title="shellScript语法及使用方法">
                shellScript语法及使用方法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            本站概要
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ruopu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">211</span>
                    <span class="site-state-item-name">文章</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">分類</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">157</span>
                    <span class="site-state-item-name">標籤</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装"><span class="nav-number">1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置"><span class="nav-number">2.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List（列表）"><span class="nav-number">3.</span> <span class="nav-text">List（列表）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hash（哈希）"><span class="nav-number">4.</span> <span class="nav-text">hash（哈希）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set（集合）"><span class="nav-number">5.</span> <span class="nav-text">Set（集合）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sorted-set（有序集合）"><span class="nav-number">6.</span> <span class="nav-text">sorted set（有序集合）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#发布订阅"><span class="nav-number">7.</span> <span class="nav-text">发布订阅</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#认证"><span class="nav-number">8.</span> <span class="nav-text">认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试：修改配置文件"><span class="nav-number">9.</span> <span class="nav-text">测试：修改配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实时配置"><span class="nav-number">10.</span> <span class="nav-text">实时配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主从复制"><span class="nav-number">11.</span> <span class="nav-text">主从复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redis-sentinel"><span class="nav-number">12.</span> <span class="nav-text">redis-sentinel</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruopu</span>

  

  

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_pv">
    本站总访问量: <span id="busuanzi_value_site_pv"></span>次
  </span>
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.0</div>





        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="訪客總數">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="總瀏覽次數">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
