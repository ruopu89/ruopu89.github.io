<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="ruopu&#39;s blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="ruopu&#39;s blog">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ruopu&#39;s blog">






  <link rel="canonical" href="http://yoursite.com/page/2/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ruopu's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-TW">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ruopu's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切換導航欄">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首頁</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />標籤</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分類</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />歸檔</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜尋</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜尋..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/05/python基础学习-面向对象(重要)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/python基础学习-面向对象(重要)/" itemprop="url">
                  python基础学习-面向对象(重要)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-03-05 20:36:18" itemprop="dateCreated datePublished" datetime="2020-03-05T20:36:18+08:00">2020-03-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="语言的分类"><a href="#语言的分类" class="headerlink" title="语言的分类"></a>语言的分类</h3><p>面向机器</p>
<p>抽象成机器指令，机器容易理解</p>
<p>代表：汇编语言</p>
<p>面向过程</p>
<p>做一件事情，排出个步骤，第一步干什么，第二步干什么，如果出现情况A，做什么处理，如果出现了情况B，做什么处理。</p>
<p>问题规模小，可以步骤化，按部就班处理。</p>
<p>代表：C语言</p>
<p>面向对象OOP</p>
<p>随着计算机需要解决的问题的规模扩大，情况越来越复杂。需要很多人、很多部门协作，面向过程编程不太适合了。</p>
<p>代表：C++、Java、Python等</p>
<h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><p>什么是面向对象呢？</p>
<p>一种认识世界、分析世界的方法论。将万事万物抽象为类。</p>
<p>类<code>class</code></p>
<p>类是抽象的概念，是万事万物的抽象，是一类事物的共同特征的集合。</p>
<p>用计算机语言来描述类，就是属性和方法的集合。</p>
<p>对象<code>instance</code>、<code>object</code></p>
<p>对象是类的具象，是一个实例。</p>
<p>对于我们每个人这个个体，都是抽象概念人类的不同的实例。</p>
<p>举例：</p>
<p>你吃鱼</p>
<p>你，就是对象；鱼，也是对象；吃就是动作</p>
<p>你是具体的人，是具体的对象。你属于人类，人类是个抽象的概念，是无数具体的个体的抽象。鱼，也是具体的对象，就是你吃的这一条具体的鱼。这条鱼属于鱼类，是无数的鱼抽象出来的概念。</p>
<p>吃，是动作，也是操作，也是方法，这个吃是你的动作，也就是人类具有的方法。如果反过来，鱼吃人。吃就是鱼类的动作了。</p>
<p>吃，这个动作，很多动物都具有的动作，人类和鱼类都属于动物类，而动物类是抽象的概念，是动物都有吃的动作，但是吃法不同而已。</p>
<p>你驾驶车，这个车也是车类的具体的对象（实例），驾驶这个动作是鱼类不具有的，是人类具有的方法。</p>
<p>属性，它是对象状态的抽象，用数据结构来描述。</p>
<p>操作，它是对象行为的抽象，用操作名和实现该操作的方法来描述</p>
<p>每个人都有名字、身高、体重等信息，这些信息是个人的属性，但是，这些信息不能保存在人类中，因为它是抽象的概念，不能保留具体的值。</p>
<p>而人类的实例，是具体的人，他可以存储这些具体的属性，而且可以不同人有不同的属性。</p>
<p>哲学</p>
<p>一切皆对象</p>
<p>对象是数据和操作的封装</p>
<p>对象是独立的，但是对象之间可以相互作用（这对应的是人吃鱼的例子，动作把这两个对象关联起来 ）</p>
<p>目前OOP是最接近人类认知的编程范式</p>
<h3 id="面向对象三要素"><a href="#面向对象三要素" class="headerlink" title="面向对象三要素"></a>面向对象三要素</h3><ol>
<li>封装<ul>
<li>组装：将数据和操作组装到一起。</li>
<li>隐藏数据：对外只暴露一些接口，通过接口访问对象。比如驾驶员使用汽车，不需要了解汽车的构造细节，只需要知道使用什么部件怎么驾驶就行，踩了油门就能跑，可以不了解后面的机动原理。</li>
</ul>
</li>
<li>继承<ul>
<li>多复用，继承来的就不用自己写了</li>
<li>多继承少修改，OCP（Open-closed Principle），使用继承来改变，来体现个性</li>
</ul>
</li>
<li>多态<ul>
<li>面向对象编程最灵活的地方，动态绑定</li>
</ul>
</li>
</ol>
<p>人类就是封装：</p>
<p>人类继承自动物类，孩子继承父母特征。分为单一继承、多继承；</p>
<p>多态，继承自动物类的人类、猫类的操作“吃”不同</p>
<h3 id="Python的类"><a href="#Python的类" class="headerlink" title="Python的类"></a>Python的类</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span>:</span></span><br><span class="line">    语句块</span><br></pre></td></tr></table></figure>
<ol>
<li>必须使用<code>class</code>关键字</li>
<li>类名必须是用大驼峰命名</li>
<li>类定义完成后，就产生了一个类对象，绑定到了标识符<code>ClassName</code>上</li>
</ol>
<p>举例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="string">"""A example class"""</span>   <span class="comment"># 文档字符串</span></span><br><span class="line">    x = <span class="string">'abc'</span>  <span class="comment"># 类属性，不是对象的属性，对象的属性指的是类的实例的属性</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span>  <span class="comment"># 类属性foo，也是方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'My Class'</span></span><br><span class="line">    </span><br><span class="line">print(MyClass.x)</span><br><span class="line">print(MyClass.foo)</span><br><span class="line">print(MyClass.__doc__)</span><br></pre></td></tr></table></figure>
<h3 id="类对象及类属性"><a href="#类对象及类属性" class="headerlink" title="类对象及类属性"></a>类对象及类属性</h3><ul>
<li>类对象，类的定义就会生成一个类对象</li>
<li>类的属性，类定义中的变量和类中定义的方法都是类的属性</li>
<li>类变量，上例中<code>x</code>是类<code>MyClass</code>的变量</li>
</ul>
<p><code>MyClass</code>中，<code>x</code>、<code>foo</code>都是类的属性，<code>__doc__</code>也是类的属性</p>
<p><code>foo</code>方法是类的属性，如同<code>吃</code>是人类的方法，但是每一个具体的人才能吃东西，也就是说<code>吃</code>是人的实例才能调用的方法</p>
<p><code>foo</code>是方法对象<code>method</code>，不是普通的函数对象<code>function</code>了，它一般要求至少有一个参数。第一个参数可以是<code>self</code>（<code>self</code>只是个惯用标识符，可以换名字），这个参数位置就留给了<code>self</code>。</p>
<p><code>self</code>指代当前实例本身</p>
<p>问题</p>
<p>上例中，类是谁？实例是谁？</p>
<h4 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = MyClass()  <span class="comment"># 实例化</span></span><br></pre></td></tr></table></figure>
<p>使用上面的语法，在类对象名称后面加上一个括号，就调用类的实例化方法，完成实例化。实例化就真正创建一个该类的对象（实例）。例如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tom = Person()</span><br><span class="line">jerry = Person()</span><br></pre></td></tr></table></figure>
<p>上面的<code>tom</code>、<code>jerry</code>都是<code>Person</code>类的实例，通过实例化生成了2个实例。</p>
<p>每次实例化后获得的实例，是不同的实例，即使是使用同样的参数实例化，也得到不一样的对象。</p>
<p>Python类实例化后，会自动调用 <code>__init__</code>方法。这个方法第一个参数必须留给<code>self</code>，其它参数随意。</p>
<h4 id="init-方法"><a href="#init-方法" class="headerlink" title="__init__方法"></a><code>__init__</code>方法</h4><p><code>MyClass()</code>实际上调用的是<code>__init__(self)</code>方法，可以不定义，如果没有定义会在实例化后隐式调用。</p>
<p>作用：对实例进行初始化</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class MyClass:</span><br><span class="line">def __init__(self):</span><br><span class="line">	print('init')</span><br><span class="line">	</span><br><span class="line">print(MyClass)   # 不会调用</span><br><span class="line">print(MyClass())   # 调用__init__</span><br><span class="line">a = MyClass()   # 调用__init__</span><br></pre></td></tr></table></figure>
<p>初始化函数可以有多个参数，请注意第一个位置必须是self，例如<code>__init__(self, name, age)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">showage</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&#123;&#125; is &#123;&#125;'</span>.format(self.name, self.age))</span><br><span class="line">        </span><br><span class="line">tom = Person(<span class="string">'Tom'</span>, <span class="number">20</span>)   <span class="comment"># 实例化</span></span><br><span class="line">jerry = Person(<span class="string">'Je'</span>, <span class="number">25</span>)</span><br><span class="line">print(tom.name, jerry.age)</span><br><span class="line">jerry.age += <span class="number">1</span></span><br><span class="line">print(jerry.age)</span><br><span class="line">jerry.showage()</span><br><span class="line">输出：</span><br><span class="line">Tom <span class="number">25</span></span><br><span class="line"><span class="number">26</span></span><br><span class="line">Jerry <span class="keyword">is</span> <span class="number">26</span></span><br></pre></td></tr></table></figure>
<p>注意：<code>__init__()</code>方法不能有返回值，也就是只能是None</p>
<h4 id="实例对象instance"><a href="#实例对象instance" class="headerlink" title="实例对象instance"></a>实例对象<code>instance</code></h4><p>类实例化后一定会获得一个对象，就是实例对象</p>
<p>上例中的<code>tom</code>、<code>jerry</code>就是<code>Person</code>类的实例</p>
<p><code>__init__</code>方法的第一参数<code>self</code>就是指代某一个实例。</p>
<p>类实例化后，得到一个实例对象（实例对象就是上面说的类的对象），实例对象会绑定方法，调用方法时采用<code>jerry.showage()</code>的方式。但是函数签名是<code>showage(self)</code>，少传一个参数<code>self</code>吗？</p>
<p>这个<code>self</code>就是<code>jerry</code>，Python会把方法的调用者作为第一参数<code>self</code>的实参传入。</p>
<p><code>self.name</code>就是<code>jerry</code>对象的<code>name</code>，<code>name</code>是保存在了<code>jerry</code>对象上，而不是<code>Person</code>类上。所以，称为实例变量。</p>
<h4 id="self"><a href="#self" class="headerlink" title="self"></a><code>self</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'self in init = &#123;&#125;'</span>.format(id(self)))</span><br><span class="line">        </span><br><span class="line">c = MyClass()   <span class="comment"># 会调用__init__</span></span><br><span class="line">print(<span class="string">'c = &#123;&#125;'</span>.format(id(c)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印结果为</span></span><br><span class="line">self <span class="keyword">in</span> init = <span class="number">139837178141328</span></span><br><span class="line">c = <span class="number">139837178141328</span></span><br></pre></td></tr></table></figure>
<p>上例说明，<code>self</code>就是调用者，就是<code>c</code>对应的实例对象。</p>
<p><code>self</code>这个名字只是一个惯例，它可以修改，但是请不要修改，否则影响代码的可读性</p>
<p>看打印的结果，思考一下执行的顺序，为什么？</p>
<h3 id="实例变量和类变量"><a href="#实例变量和类变量" class="headerlink" title="实例变量和类变量"></a>实例变量和类变量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    age = <span class="number">3</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        </span><br><span class="line"><span class="comment"># tom = Person('Tom', 20)</span></span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)   <span class="comment"># 实例化、初始化</span></span><br><span class="line">jerry = Person(<span class="string">'Jerry'</span>)</span><br><span class="line"></span><br><span class="line">print(tom.name, tom.age)</span><br><span class="line">print(jerry.name, jerry.age)</span><br><span class="line">print(Person.age)</span><br><span class="line"><span class="comment"># print(Person.name)</span></span><br><span class="line">Person.age = <span class="number">30</span></span><br><span class="line">print(Person.age, tom.age, jerry.age)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行结果</span></span><br><span class="line">Tom <span class="number">3</span></span><br><span class="line">Jerry <span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">30</span> <span class="number">30</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>
<p>实例变量是每一个实例自己的变量，是自己独有的；类变量是类的变量，是类的所有实例共享的属性和方法</p>
<table>
<thead>
<tr>
<th>特殊属性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>__name__</code></td>
<td>对象名</td>
</tr>
<tr>
<td><code>__class__</code></td>
<td>对象的类型</td>
</tr>
<tr>
<td><code>__dict__</code></td>
<td>对象的属性的字典</td>
</tr>
<tr>
<td><code>__qualname__</code></td>
<td>类的限定名</td>
</tr>
</tbody>
</table>
<p>注意：</p>
<p>Python中每一种对象都拥有不同的属性。函数、类都是对象，类的实例也是对象。</p>
<p>举例</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    age = <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        </span><br><span class="line">print(<span class="string">'---------class------------'</span>)</span><br><span class="line">print(Person.__class__)</span><br><span class="line">print(sorted(Person.__dict__.items()), end=<span class="string">'\n\n'</span>)   <span class="comment"># 属性字典</span></span><br><span class="line"></span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)</span><br><span class="line">print(<span class="string">'----------instance tom-----------'</span>)</span><br><span class="line">print(tom.__class__)</span><br><span class="line">print(sorted(tom.__dict__.items()), end=<span class="string">'\n\n'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"-------------tom's class--------------"</span>)</span><br><span class="line">print(tom.__class__.__name__)</span><br><span class="line">print(sorted(tom.__class__.__dict__.items()), end=<span class="string">'\n\n'</span>)</span><br><span class="line">输出：</span><br><span class="line">---------<span class="class"><span class="keyword">class</span>-------------</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">type</span>'&gt;</span></span><br><span class="line">[('__dict__', &lt;attribute '__dict__' of 'Person' objects&gt;), ('__doc__', None), ('__init__', &lt;function Person.__init__ at 0x7f8b8f126550&gt;), ('__module__', '__main__'), ('__weakref__', &lt;attribute '__weakref__' of 'Person' objects&gt;), ('age', 3)]</span><br><span class="line"></span><br><span class="line">----------instance tom------------------</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">Person</span>'&gt;</span></span><br><span class="line"><span class="class">[<span class="params">(<span class="string">'name'</span>, <span class="string">'Tom'</span>)</span>]</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">--------------------<span class="title">tom</span>'<span class="title">s</span> <span class="title">class</span>----------------------</span></span><br><span class="line"><span class="class"><span class="title">Person</span></span></span><br><span class="line">[('__dict__', &lt;attribute '__dict__' of 'Person' objects&gt;), ('__doc__', None), ('__init__', &lt;function Person.__init__ at 0x7f8b8f126550&gt;), ('__module__', '__main__'), ('__weakref__', &lt;attribute '__weakref__' of 'Person' objects&gt;), ('age', 3)]</span><br></pre></td></tr></table></figure>
<p>上例中，可以看到类属性保存在类的<code>__dict__</code>中，实例属性保存在实例的<code>__dict__</code>中，如果从实例访问类的属性，就需要借助<code>__class__</code>找到所属的类</p>
<p>有了上面知识，再看下面的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    age = <span class="number">3</span></span><br><span class="line">    height = <span class="number">170</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        </span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)   <span class="comment"># 实例化、初始化</span></span><br><span class="line">jerry = Person(<span class="string">'Jerry'</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">Person.age = <span class="number">30</span></span><br><span class="line">print(Person.age, tom.age, jerry.age)   <span class="comment"># 输出什么结果</span></span><br><span class="line"></span><br><span class="line">print(Person.height, tom.height, jerry.height)   <span class="comment"># 输出什么结果</span></span><br><span class="line">jerry.height = <span class="number">175</span></span><br><span class="line">print(Person.height, tom.height, jerry.height)   <span class="comment"># 输出什么结果</span></span><br><span class="line"></span><br><span class="line">tom.height += <span class="number">10</span></span><br><span class="line">print(Person.height, tom.height, jerry.height)   <span class="comment"># 输出什么结果</span></span><br><span class="line"></span><br><span class="line">Person.height += <span class="number">15</span></span><br><span class="line">print(Person.height, tom.height, jerry.height)   <span class="comment"># 输出什么结果</span></span><br><span class="line"></span><br><span class="line">Person.weight += <span class="number">70</span></span><br><span class="line">print(Person.weight, tom.weight, jerry.weight)   <span class="comment"># 输出什么结果</span></span><br><span class="line"></span><br><span class="line">print(tom.__dict__[<span class="string">'height'</span>])</span><br><span class="line">print(tom.__dict__[<span class="string">'weight'</span>])   <span class="comment"># 可以吗</span></span><br><span class="line">输出：</span><br><span class="line"><span class="number">30</span> <span class="number">18</span> <span class="number">20</span></span><br><span class="line"><span class="number">170</span> <span class="number">170</span> <span class="number">170</span></span><br><span class="line"><span class="number">170</span> <span class="number">170</span> <span class="number">175</span></span><br><span class="line"><span class="number">170</span> <span class="number">180</span> <span class="number">175</span></span><br><span class="line"><span class="number">185</span> <span class="number">180</span> <span class="number">175</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/home/shouyu/PycharmProjects/test/面向对象.py"</span>, line <span class="number">91</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    Person.weight += <span class="number">70</span></span><br><span class="line">AttributeError: type object <span class="string">'Person'</span> has no attribute <span class="string">'weight</span></span><br></pre></td></tr></table></figure>
<p>总结</p>
<p>是类的，也是这个类所有实例的，其实例都可以访问到；是实例的，就是这个实例自己的，通过类访问不到。</p>
<p>类变量是属于类的变量，这个类的所有实例可以共享这个变量。</p>
<p>实例可以动态的给自己增加一个属性。<code>实例.__dict__[变量名]</code>和<code>实例.变量名</code>都可以访问到。</p>
<p>实例的同名变量会隐藏这个类变量，或者说是覆盖了这个类变量。这就像上例中用<code>jerry.height = 175</code>，这样就用jerry的<code>height</code>覆盖了类中的<code>height</code>的值</p>
<p>实例属性的查找顺序</p>
<p>指的是实例使用<code>.</code>来访问属性，会先找自己的<code>__dict__</code>，如果没有，然后通过属性<code>__class__</code>找到自己的类，再去类的<code>__dict__</code>中找</p>
<p>注意，如果实例使用<code>__dict_[变量名]</code>访问变量，将不会按照上面的查找顺序找变量了，这是指明使用字典的key查找，不是属性查找。</p>
<p>一般来说，类变量使用全大写来命名</p>
<h3 id="装饰一个类"><a href="#装饰一个类" class="headerlink" title="装饰一个类"></a>装饰一个类</h3><p>回顾，什么是高阶函数？什么是装饰器函数？</p>
<p>思考，如何装饰一个类？</p>
<p>需求，为一个类通过装饰，增加一些类属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加类变量</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_name</span><span class="params">(name, cls)</span>:</span></span><br><span class="line">    cls.NAME = name   <span class="comment"># 动态增加类属性</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 改进成装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_name</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(cls)</span>:</span></span><br><span class="line">        cls.NAME = name</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@add_name('Tom')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    AGE = <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">print(Person.NAME)</span><br><span class="line">输出：</span><br><span class="line">Tom</span><br></pre></td></tr></table></figure>
<p>之所以能够装饰，本质上是为类对象动态的添加了一个属性，而Person这个标识符指向这个类对象。</p>
<h3 id="类方法和静态方法"><a href="#类方法和静态方法" class="headerlink" title="类方法和静态方法"></a>类方法和静态方法</h3><p>前面的例子中定义的<code>__init__</code>等方法，这些方法本身都是类的属性，第一个参数必须是<code>self</code>，而<code>self</code>必须指向一个对象，也就是类必须实例化之后，由实例来调用这个方法。</p>
<h4 id="普通函数"><a href="#普通函数" class="headerlink" title="普通函数"></a>普通函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">normal_method</span><span class="params">()</span>:</span>   <span class="comment"># 可以吗？</span></span><br><span class="line">        print(<span class="string">'normal'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 如何调用</span></span><br><span class="line">Person.normal_method()   <span class="comment"># 可以吗？</span></span><br><span class="line">Person().normal_method()   <span class="comment"># 可以吗？这里传报错的原因是，在定义的类中并没有self，Person()表示实例化，所以实例并没有normal_method方法，所以报错</span></span><br><span class="line"></span><br><span class="line">print(Person.__dict__)</span><br><span class="line">输出：</span><br><span class="line">normal</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/home/shouyu/PycharmProjects/test/面向对象.py"</span>, line <span class="number">117</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    Person().normal_method()</span><br><span class="line">TypeError: normal_method() takes <span class="number">0</span> positional arguments but <span class="number">1</span> was given</span><br></pre></td></tr></table></figure>
<p><code>Person.normal_method()</code></p>
<p>可以，因为这个方法只是被Person这个名词空间管理的一个普通的方法，<code>normal_method</code>只是<code>Person</code>的一个属性而已。</p>
<p>由于<code>normal_method</code>在定义的时候没有指定<code>self</code>，所以不能完成实例对象的绑定，不能用<code>Person().normal_method()</code>调用。</p>
<p>注意：虽然语法是对的，但是，没有人这么用，也就是说禁止这么写</p>
<h4 id="类方法"><a href="#类方法" class="headerlink" title="类方法"></a>类方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">class_method</span><span class="params">(cls)</span>:</span>   <span class="comment"># cls是什么</span></span><br><span class="line">        print(<span class="string">'class = &#123;0.__name__&#125;(&#123;0&#125;)'</span>.format(cls))</span><br><span class="line"><span class="comment"># cls就是类对象，类对象就是0，所以可以调用0.__name__。(&#123;0&#125;)中，括号是字符串，也就是打印一个括号，&#123;0&#125;是占位符，占位符显示类对象打印出来的一长串东西</span></span><br><span class="line">        cls.HEIGHT = <span class="number">170</span></span><br><span class="line">        </span><br><span class="line">Person.class_method()</span><br><span class="line">print(Person.__dict__)</span><br><span class="line">输出：</span><br><span class="line">class = Person(&lt;class '__main__.Person'&gt;)</span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'class_method'</span>: &lt;classmethod object at <span class="number">0x7fc4283d1a90</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'HEIGHT'</span>: <span class="number">170</span>&#125;</span><br></pre></td></tr></table></figure>
<p>类方法</p>
<ol>
<li><p>在类定义中，使用<code>@classmethod</code>装饰器修饰的方法</p>
</li>
<li><p>必须至少有一个参数，且第一个参数留给了<code>cls</code>，<code>cls</code>指代调用者即类对象自身</p>
</li>
<li><p><code>cls</code>这个标识符可以是任意合法名称，但是为了易读，请不要修改</p>
</li>
<li><p>通过<code>cls</code>可以直接操作类的属性</p>
<p>注意：无法通过<code>cls</code>操作类的实例。为什么？</p>
</li>
</ol>
<p>类方法，类似于C++、Java中的静态方法</p>
<h4 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">class_method</span><span class="params">(cls)</span>:</span>   <span class="comment"># cls是什么</span></span><br><span class="line">        print(<span class="string">'class = &#123;0.__name__&#125;(&#123;0&#125;)'</span>.format(cls))</span><br><span class="line">        cls.HEIGHT = <span class="number">170</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">static_methd</span><span class="params">()</span>:</span></span><br><span class="line">        print(Person.HEIGHT)</span><br><span class="line">        </span><br><span class="line">Person.class_method()</span><br><span class="line">Person.static_methd()</span><br><span class="line">print(Person.__dict__)</span><br><span class="line">输出：</span><br><span class="line">class = Person(&lt;class '__main__.Person'&gt;)</span><br><span class="line"><span class="number">170</span></span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'class_method'</span>: &lt;classmethod object at <span class="number">0x7f4247ddda90</span>&gt;, <span class="string">'static_methd'</span>: &lt;staticmethod object at <span class="number">0x7f4247df75b0</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'HEIGHT'</span>: <span class="number">170</span>&#125;</span><br></pre></td></tr></table></figure>
<p>静态方法</p>
<ol>
<li><p>在类定义中，使用@staticmethod装饰器修饰的方法</p>
</li>
<li><p>调用时，不会隐式的传入参数</p>
<p>静态方法，只是表明这个方法属于这个名词空间。函数归在一起，方便组织管理。</p>
</li>
</ol>
<h4 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h4><p>类可以定义这么多种方法，究竟如何调用它们？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">normal_method</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'normal'</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"&#123;&#125;'s method"</span>.format(self))</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">class_method</span><span class="params">(cls)</span>:</span>   <span class="comment"># cls是什么</span></span><br><span class="line">        print(<span class="string">'class = &#123;0.__name__&#125;(&#123;0&#125;)'</span>.format(cls))</span><br><span class="line">        cls.HEIGHT = <span class="number">170</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">static_methd</span><span class="params">()</span>:</span></span><br><span class="line">        print(Person.HEIGHT)</span><br><span class="line">        </span><br><span class="line">print(<span class="string">'~~~~~~类访问'</span>)</span><br><span class="line">print(<span class="number">1</span>, Person.normal_method())   <span class="comment"># 可以吗</span></span><br><span class="line"><span class="comment"># print(2, Person.method())   # 可以吗。这里不可以，因为这是实例的方法</span></span><br><span class="line">print(<span class="number">3</span>, Person.class_method())   <span class="comment"># 可以吗</span></span><br><span class="line">print(<span class="number">4</span>, Person.static_methd)   <span class="comment"># 可以吗</span></span><br><span class="line">print(Person.__dict__)</span><br><span class="line">print(<span class="string">'~~~~~~实例访问'</span>)</span><br><span class="line">print(<span class="string">'tom-----'</span>)</span><br><span class="line">tom = Person()</span><br><span class="line"><span class="comment"># print(1, tom.normal_method())   # 可以吗。这里不可以，因为normal_method不是实例的方法</span></span><br><span class="line">print(<span class="number">2</span>, tom.method())   <span class="comment"># 可以吗</span></span><br><span class="line">print(<span class="number">3</span>, tom.class_method())   <span class="comment"># 可以吗</span></span><br><span class="line">print(<span class="number">4</span>, tom.static_methd())   <span class="comment"># 可以吗</span></span><br><span class="line">print(<span class="string">'jerry-----'</span>)</span><br><span class="line">jerry = Person()</span><br><span class="line"><span class="comment"># print(1, jerry.normal_method())   # 可以吗。这里不可以，因为normal_method不是实例的方法</span></span><br><span class="line">print(<span class="number">2</span>, jerry.method())   <span class="comment"># 可以吗</span></span><br><span class="line">print(<span class="number">3</span>, jerry.class_method())   <span class="comment"># 可以吗</span></span><br><span class="line">print(<span class="number">4</span>, jerry.static_methd())   <span class="comment">#  可以吗</span></span><br><span class="line">输出：</span><br><span class="line">~~~~~~~~~~类访问</span><br><span class="line">normal</span><br><span class="line"><span class="number">1</span> <span class="keyword">None</span></span><br><span class="line">class = Person(&lt;class '__main__.Person'&gt;)</span><br><span class="line"><span class="number">3</span> <span class="keyword">None</span></span><br><span class="line"><span class="number">170</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">None</span></span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'normal_method'</span>: &lt;function Person.normal_method at <span class="number">0x7fe2e6af1550</span>&gt;, <span class="string">'method'</span>: &lt;function Person.method at <span class="number">0x7fe2e6af15e0</span>&gt;, <span class="string">'class_method'</span>: &lt;classmethod object at <span class="number">0x7fe2e6b54a90</span>&gt;, <span class="string">'static_method'</span>: &lt;staticmethod object at <span class="number">0x7fe2e6b795b0</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'HEIGHT'</span>: <span class="number">170</span>&#125;</span><br><span class="line">~~~~~~~~~~实例访问</span><br><span class="line">tom------------</span><br><span class="line">&lt;__main__.Person object at <span class="number">0x7fe2e6b6e8b0</span>&gt;<span class="string">'s method</span></span><br><span class="line"><span class="string">2 None</span></span><br><span class="line"><span class="string">class = Person(&lt;class '</span>__main__.Person<span class="string">'&gt;)</span></span><br><span class="line"><span class="string">3 None</span></span><br><span class="line"><span class="string">170</span></span><br><span class="line"><span class="string">4 None</span></span><br><span class="line"><span class="string">jerry-----------</span></span><br><span class="line"><span class="string">&lt;__main__.Person object at 0x7fe2e6bb7580&gt;'</span>s method</span><br><span class="line"><span class="number">2</span> <span class="keyword">None</span></span><br><span class="line">class = Person(&lt;class '__main__.Person'&gt;)</span><br><span class="line"><span class="number">3</span> <span class="keyword">None</span></span><br><span class="line"><span class="number">170</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">None</span></span><br><span class="line"><span class="comment"># 这是先执行类方法中的print函数，再执行调用的print函数，所以会先输出170再输出4 None</span></span><br></pre></td></tr></table></figure>
<p>类几乎可以调用所有内部定义的方法，但是调用<code>普通的方法</code>时会报错，原因是第一参数必须是类的实例。</p>
<p>实例也几乎可以调用所有的方法，<code>普通的函数</code>的调用一般不可能出现，因为不允许这么定义。</p>
<p>总结：</p>
<p>类除了普通方法都可以调用，普通方法需要对象的实例作为第一参数。</p>
<p>实例可以调用所有类中定义的方法（包括类方法、静态方法），普通方法传入实例自身，静态方法和类方法需要找到实例的类。</p>
<h3 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h3><h4 id="私有（Private）属性"><a href="#私有（Private）属性" class="headerlink" title="私有（Private）属性"></a>私有（Private）属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">growup</span><span class="params">(self, i=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> i &lt; <span class="number">150</span>:   <span class="comment"># 控制逻辑</span></span><br><span class="line">            self.age += i</span><br><span class="line">            </span><br><span class="line">p1 = Person(<span class="string">'tom'</span>)</span><br><span class="line">p1.growup(<span class="number">20</span>)   <span class="comment"># 正常的范围</span></span><br><span class="line">print(p1.age)</span><br><span class="line">p1.age = <span class="number">160</span>   <span class="comment"># 超过了范围，并绕过了控制逻辑</span></span><br><span class="line">print(p1.age)</span><br><span class="line">输出：</span><br><span class="line"><span class="number">38</span></span><br><span class="line"><span class="number">160</span></span><br></pre></td></tr></table></figure>
<p>上例，本来是想通过方法控制属性，但是由于属性在外部可以访问，或者说可见，就可以直接绕过方法，直接修改这个属性。</p>
<p>Python提供了私有属性可以解决这个问题</p>
<p>私有属性</p>
<p>使用双下划线开头的属性名，就是私有属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">growup</span><span class="params">(self, i=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> i &lt; <span class="number">150</span>:   <span class="comment"># 控制逻辑</span></span><br><span class="line">            self.__age += i</span><br><span class="line">            </span><br><span class="line">p1 = Person(<span class="string">'tom'</span>)</span><br><span class="line">p1.growup(<span class="number">20</span>)   <span class="comment"># 正常的范围</span></span><br><span class="line">print(p1.__age)   <span class="comment"># 可以吗。不可以，会报错</span></span><br></pre></td></tr></table></figure>
<p>通过实验可以看出，外部已经访问不到<code>__age</code>了，<code>age</code>根本就没有定义，更是访问不到。那么，如何访问这个私有变量<code>__age</code>呢？</p>
<p>使用方法来访问</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">growup</span><span class="params">(self, i=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> i &lt; <span class="number">150</span>:   <span class="comment"># 控制逻辑</span></span><br><span class="line">            self.__age += i</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line">    </span><br><span class="line">print(Person(<span class="string">'tom'</span>).getage())</span><br><span class="line">输出：</span><br><span class="line"><span class="number">18</span></span><br></pre></td></tr></table></figure>
<h4 id="私有变量的本质"><a href="#私有变量的本质" class="headerlink" title="私有变量的本质"></a>私有变量的本质</h4><p>外部访问不到，能够动态增加一个<code>__age</code>呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">growup</span><span class="params">(self, i=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> i &lt; <span class="number">150</span>:   <span class="comment"># 控制逻辑</span></span><br><span class="line">            self.__age += i</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line">    </span><br><span class="line">p1 = Person(<span class="string">'tom'</span>)</span><br><span class="line">p1.growup(<span class="number">20</span>)   <span class="comment"># 正常的范围</span></span><br><span class="line"><span class="comment"># print(p1.__age)   # 访问不到</span></span><br><span class="line">p1.__age = <span class="number">28</span></span><br><span class="line">print(p1.__age)</span><br><span class="line">print(p1.getage())</span><br><span class="line"><span class="comment"># 为什么年龄不一样？__age没有覆盖吗？</span></span><br><span class="line">print(p1.__dict__)</span><br><span class="line">输出：</span><br><span class="line"><span class="number">28</span></span><br><span class="line"><span class="number">38</span></span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'Tom'</span>, <span class="string">'_Person__age'</span>: <span class="number">38</span>, <span class="string">'__age'</span>: <span class="number">28</span>&#125;</span><br></pre></td></tr></table></figure>
<p>秘密都在<code>__dict__</code>中，里面是<code>{&#39;__age&#39;:28,&#39;_Person_age&#39;:38,&#39;name&#39;:&#39;tom&#39;}</code></p>
<p>私有变量的本质：</p>
<p>类定义的时候，如果声明一个实例变量的时候，使用双下划线，Python解释器会将其改名，转换名称为<code>_类名_变量名</code>的名称，所以用原来的名字访问不到了。</p>
<p>知道了这个名字，能否直接修改呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">growup</span><span class="params">(self, i=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> i &lt; <span class="number">150</span>:</span><br><span class="line">            self.__age += i</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line">    </span><br><span class="line">p1 = Person(<span class="string">'tom'</span>)</span><br><span class="line">p1.growup(<span class="number">20</span>)   <span class="comment"># 正常的范围</span></span><br><span class="line"><span class="comment"># print(p1.__age)</span></span><br><span class="line">p1.__age = <span class="number">28</span></span><br><span class="line">print(p1.__age)</span><br><span class="line">print(p1.getage())</span><br><span class="line"><span class="comment"># 为什么年龄不一样？__age没覆盖吗？</span></span><br><span class="line">print(p1.__dict__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接修改私有变量</span></span><br><span class="line">p1._Person__age = <span class="number">15</span></span><br><span class="line">print(p1.getage())</span><br><span class="line">print(p1.__dict__)</span><br><span class="line">输出：</span><br><span class="line"><span class="number">15</span></span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'Tom'</span>, <span class="string">'_Person__age'</span>: <span class="number">15</span>, <span class="string">'__age'</span>: <span class="number">28</span>&#125;</span><br></pre></td></tr></table></figure>
<p>从上例可以看出，知道了私有变量的新名称，就可以直接从外部访问到，并可以修改它。</p>
<h4 id="保护变量"><a href="#保护变量" class="headerlink" title="保护变量"></a>保护变量</h4><p>在变量名前使用一个下划线，称为保护变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self._age = age</span><br><span class="line">        </span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)</span><br><span class="line">print(tom._age)</span><br><span class="line">print(tom.__dict__)</span><br><span class="line">输出：</span><br><span class="line"><span class="number">18</span></span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'Tom'</span>, <span class="string">'_age'</span>: <span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，这个<code>_age</code>属性根本就没有改变名称，和普通的属性一样，解释器不做任何特殊处理。这只是开发者共同的约定，看见这种变量，就如同私有变量，不要直接使用。</p>
<h4 id="私有方法"><a href="#私有方法" class="headerlink" title="私有方法"></a>私有方法</h4><p>参照保护变量、私有变量，使用单下划线、双下划线命名方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self._age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getname</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._age</span><br><span class="line">    </span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)</span><br><span class="line">print(tom._getname())   <span class="comment"># _getname没改名</span></span><br><span class="line">print(tom.__getage())   <span class="comment"># 无此属性</span></span><br><span class="line">print(tom.__dict__)</span><br><span class="line">print(tom.__class__.__dict__)</span><br><span class="line">print(tom._Person__getage())   <span class="comment"># __getage改名了</span></span><br><span class="line">输出：</span><br><span class="line">Tom</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'Tom'</span>, <span class="string">'_age'</span>: <span class="number">18</span>&#125;</span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__init__'</span>: &lt;function Person.__init__ at <span class="number">0x7fa7d0a34550</span>&gt;, <span class="string">'_getname'</span>: &lt;function Person._getname at <span class="number">0x7fa7d0a345e0</span>&gt;, <span class="string">'_Person__getage'</span>: &lt;function Person.__getage at <span class="number">0x7fa7d0a34670</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line"><span class="number">18</span></span><br></pre></td></tr></table></figure>
<h4 id="私有方法的本质"><a href="#私有方法的本质" class="headerlink" title="私有方法的本质"></a>私有方法的本质</h4><p>单下划线的方法只是开发者之间的约定，解释器不做任何改变。</p>
<p>双下划线的方法，是私有方法，解释器会改名，改名策略和私有变量相同，<code>_类名__方法名</code>。方法变量都在类的<code>__dict__</code>中可以找到。</p>
<h4 id="私有成员的总结"><a href="#私有成员的总结" class="headerlink" title="私有成员的总结"></a>私有成员的总结</h4><p>在Python中使用<code>_</code>单下划线或者<code>__</code>双下划线来标识一个成员被保护或者被私有化隐藏起来。但是，不管使用什么样的访问控制，都不能真正的阻止用户修改类的成员。Python中没有绝对的安全的保护成员或者私有成员。</p>
<p>因此，前导的下划线只是一种警告或者提醒，请遵守这个约定。除非真有必要，不要修改或者使用保护成员或者私有成员，更不要修改它们。</p>
<h3 id="补丁"><a href="#补丁" class="headerlink" title="补丁"></a>补丁</h3><p>可以通过修改或者替换类的成员。使用者调用的方式没有改变，但是，类提供的功能可能已经改变了。</p>
<p>猴子补丁（Monkey Patch）：</p>
<p>在运行时，对属性、方法、函数等进行动态替换。</p>
<p>其目的往往是为了通过替换、修改来增强、扩展原有代码的能力。</p>
<p>黑魔法，慎用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test1.py</span></span><br><span class="line"><span class="keyword">from</span> test2 <span class="keyword">import</span> Person</span><br><span class="line"><span class="keyword">from</span> test3 <span class="keyword">import</span> get_score</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">monkeypatch4Person</span><span class="params">()</span>:</span></span><br><span class="line">    Person.get_score = get_score</span><br><span class="line"><span class="comment"># 用test3.py中的get_score替换test2.py中的同名方法    </span></span><br><span class="line">monkeypatch4Person()   <span class="comment"># 打补丁</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(Person().get_score())</span><br><span class="line">  </span><br><span class="line">输出：</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'Person'</span>, <span class="string">'English'</span>: <span class="number">88</span>, <span class="string">'Chinese'</span>: <span class="number">90</span>, <span class="string">'History'</span>: <span class="number">85</span>&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># test2.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_score</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># connect to mysql</span></span><br><span class="line">        ret = &#123;<span class="string">'English'</span>:<span class="number">78</span>, <span class="string">'Chinese'</span>:<span class="number">86</span>, <span class="string">'History'</span>:<span class="number">82</span>&#125;</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    </span><br><span class="line"><span class="comment"># test3.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_score</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> dict(name=self.__class__.__name__,English=<span class="number">88</span>, Chinese=<span class="number">90</span>, History=<span class="number">85</span>)</span><br></pre></td></tr></table></figure>
<p>上例中，假设<code>Person</code>类<code>get_score</code>方法是从数据库拿数据，但是测试的时候，不方便。</p>
<p>使用猴子补丁，替换了<code>get_score</code>方法，返回模拟的数据。</p>
<h3 id="属性装饰器"><a href="#属性装饰器" class="headerlink" title="属性装饰器"></a>属性装饰器</h3><p>一般好的设计是：把实例的属性保护起来，不让外部直接访问，外部使用<code>getter</code>读取属性和<code>setter</code>方法设置属性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_age</span><span class="params">(self, age)</span>:</span></span><br><span class="line">        self.__age = age  <span class="comment"># 通过设置与初始化同名的属性覆盖初始化的属性</span></span><br><span class="line">        </span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)</span><br><span class="line">print(tom.age())</span><br><span class="line">tom.set_age(<span class="number">20</span>)</span><br><span class="line">print(tom.age()) </span><br><span class="line">输出：</span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>通过<code>age</code>和<code>set_age</code>方法操作属性。</p>
<p>有没有简单的方式呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @age.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(self, age)</span>:</span></span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @age.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># del self.__age</span></span><br><span class="line">        print(<span class="string">'del'</span>)</span><br><span class="line">        </span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)</span><br><span class="line">print(tom.age)</span><br><span class="line">tom.age = <span class="number">20</span></span><br><span class="line">print(tom.age)</span><br><span class="line"><span class="keyword">del</span> tom.age   <span class="comment"># 使用del调用上面定义的@age.deleter下的方法</span></span><br><span class="line">输出：</span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="keyword">del</span></span><br></pre></td></tr></table></figure>
<p>特别注意：使用<code>property</code>装饰器的时候这三个方法同名</p>
<p><code>property</code>装饰器</p>
<p>后面跟的函数名就是以后的属性名，属性名指的就是方法名称。它就是<code>getter</code>。这个必须有，有了它至少是只读属性</p>
<p><code>setter</code>装饰器</p>
<p>与属性名同名，且接收2个参数，第一个是<code>self</code>，第二个是将要赋值的值。有了它，属性可写</p>
<p><code>deleter</code>装饰器</p>
<p>可以控制是否删除属性。很少用。</p>
<p><code>property</code>装饰器必须在前，<code>setter</code>、<code>deleter</code>装饰器在后。</p>
<p><code>property</code>装饰器能通过简单的方式，把对方法的操作变成对属性的访问，并起到了一定隐藏效果</p>
<p>其它的写法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setage</span><span class="params">(self, age)</span>:</span></span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># del self.__age</span></span><br><span class="line">        print(<span class="string">'del'</span>)</span><br><span class="line">        </span><br><span class="line">    age = property(getage, setage, delage, <span class="string">'age property'</span>)</span><br><span class="line">    </span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)</span><br><span class="line">print(tom.age)</span><br><span class="line">tom.age = <span class="number">20</span></span><br><span class="line">print(tom.age)</span><br><span class="line"><span class="keyword">del</span> tom.age</span><br><span class="line">输出：</span><br><span class="line"><span class="number">18</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="keyword">del</span></span><br></pre></td></tr></table></figure>
<p>还可以如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    age = property(<span class="keyword">lambda</span> self:self.__age)</span><br><span class="line">    </span><br><span class="line">tom = Person(<span class="string">'Tom'</span>)</span><br><span class="line">print(tom.age)</span><br></pre></td></tr></table></figure>
<h3 id="对象的销毁"><a href="#对象的销毁" class="headerlink" title="对象的销毁"></a>对象的销毁</h3><p>类中可以定义<code>__del__</code>方法，称为析构函数（方法）。</p>
<p>作用：销毁类的实例的时候调用，以释放占用的资源。其中就放些清理资源的代码，比如释放连接。</p>
<p>注意这个方法不能引起对象的真正销毁，只是对象销毁的时候会自动调用它。</p>
<p>使用<code>del</code>语句删除实例，引用计数减1。当引用计数为0时，会自动调用<code>__del__</code>方法。</p>
<p>由于Python实现了垃圾回收机制，不能确定对象何时执行垃圾回收。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'delete &#123;&#125;'</span>.format(self.name))</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    tom = Person(<span class="string">'tom'</span>)</span><br><span class="line">    tom.__del__()</span><br><span class="line">    tom.__del__()</span><br><span class="line">    tom.__del__()</span><br><span class="line">    tom.__del__()</span><br><span class="line">    print(<span class="string">'=========start========='</span>)</span><br><span class="line">    tom2 = tom</span><br><span class="line">    tom3 = tom2</span><br><span class="line">    print(<span class="number">1</span>, <span class="string">'del'</span>)</span><br><span class="line">    <span class="keyword">del</span> tom</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    print(<span class="number">2</span>, <span class="string">'del'</span>)</span><br><span class="line">    <span class="keyword">del</span> tom2</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">'~~~~~~~~~~~~~~~~~~'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">del</span> tom3   <span class="comment"># 注释一下看看效果</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">'================end'</span>)</span><br><span class="line">    </span><br><span class="line">test()</span><br></pre></td></tr></table></figure>
<p>由于垃圾回收对象销毁时，才会真正清理对象，还会在之前自动调用<code>__del__</code>方法，除非你明确知道自己的目的，建议不要手动调用这个方法。</p>
<h3 id="方法重载（overload）"><a href="#方法重载（overload）" class="headerlink" title="方法重载（overload）"></a>方法重载（overload）</h3><p>在其他面向对象的高级语言中，都有重载的概念。</p>
<p>所谓重载，就是同一个方法名，但是参数数量、类型不一样，就是同一个方法的重载。</p>
<p>Python没有重载！</p>
<p>Python不需要重载！</p>
<p>Python中，方法（函数）定义中，形参非常灵活，不需要指定类型（就算指定了也只是一个说明而非约束），参数个数也不固定（可变参数）。一个函数的定义可以实现很多种不同形式实参的调用。所以Python不需要方法重载。</p>
<p>或者说Python本身就实现了其它语言的重载。</p>
<h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p>面向对象的三要素之一，封装Encapsulation</p>
<p>封装</p>
<p>将数据和操作组织到类中，即属性和方法</p>
<p>将数据隐藏起来，给使用者提供操作（方法）。使用者通过操作就可以获取或者修改数据。</p>
<p><code>getter</code>和<code>setter</code>。</p>
<p>通过访问控制，暴露适当的数据和操作给用户，该隐藏的隐藏起来，例如保护成员或私有成员。</p>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><ol>
<li>随机整数生成类</li>
</ol>
<p>可以指定一批生成的个数，可以指定数值的范围，可以调整每批生成数字的个数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常规实现如下</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 普通类实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomGen</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    1. 解决随机数边界问题</span></span><br><span class="line"><span class="string">    2. 随机数生成</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start=<span class="number">1</span>, stop=<span class="number">100</span>, count=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.start = start</span><br><span class="line">        self.stop = stop</span><br><span class="line">        self.count = count</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self, start=<span class="number">1</span>, stop=<span class="number">100</span>, count=<span class="number">10</span>)</span>:</span></span><br><span class="line">    	<span class="keyword">return</span> [random.randint(start, stop) <span class="keyword">for</span> x <span class="keyword">in</span> range(count)]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 2 作为工具类来实现，提供类方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomGen</span>:</span> </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(cls, start=<span class="number">1</span>, stop=<span class="number">100</span>, count=<span class="number">10</span>)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> [random.randint(start, stop) <span class="keyword">for</span> x <span class="keyword">in</span> range(count)]</span><br><span class="line"><span class="comment"># 传参有两种方式，一种是初始化的时候，另一种是随机生成函数的时候。这种类方法就是随机生成时传参，因为用不着初始化了，所以去掉了__init__，因为用不着保留参数，所以用不着对象的了，就可以直接使用类方法。上面的类因为需要初始化，所以参数会被记在实例属性中。如果写成静态方法，还可以取消cls。</span></span><br></pre></td></tr></table></figure>
<p>随机整数生成类，可以指定一批生成的个数，可以指定数值的范围，可以调整每批生成数字的个数。</p>
<p>使用生成器实现，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 笔记</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, count=<span class="number">10</span>, start=<span class="number">1</span>, stop=<span class="number">100</span>)</span>:</span></span><br><span class="line">        self.count = count</span><br><span class="line">        self.start = start</span><br><span class="line">        self.stop = stop</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.count):</span><br><span class="line">            <span class="keyword">yield</span> random.randint(self.start, self.stop)</span><br><span class="line">            </span><br><span class="line">rg = RandomGenerator()</span><br><span class="line">gen = rg.generate()   <span class="comment"># 因为rg.generate()是生成器，所以要给一个变量</span></span><br><span class="line">print(next(gen))   <span class="comment"># 这样只能打印一个随机数</span></span><br><span class="line">====================================================================================</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, count=<span class="number">10</span>, start=<span class="number">1</span>, stop=<span class="number">100</span>)</span>:</span></span><br><span class="line">        self.count = count</span><br><span class="line">        self.start = start</span><br><span class="line">        self.stop = stop</span><br><span class="line">        self._gen = self._generate()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">yield</span> random.randint(self.start, self.stop)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> [next(self._gen) <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.count)]</span><br><span class="line"></span><br><span class="line">rg = RandomGenerator(<span class="number">20</span>,<span class="number">1</span>,<span class="number">1000</span>)</span><br><span class="line">print(rg.generate())</span><br><span class="line">====================================================================================</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, count=<span class="number">10</span>, start=<span class="number">1</span>, stop=<span class="number">100</span>)</span>:</span></span><br><span class="line">        self.count = count</span><br><span class="line">        self.start = start</span><br><span class="line">        self.stop = stop</span><br><span class="line">        self._gen = self._generate()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">yield</span> [random.randint(self.start, self.stop) <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.count)]</span><br><span class="line"><span class="comment"># 这一行会一次性生成一批数据，数据的数量根据self.count的数量决定的，self.count是通过下面的generate中的count传入的。实际就是看实例的dict中保存的count是什么，如果generate中没有定义count，那么实例的dict中保存的就是初始化的count，如果generate中定义了count，就会覆盖初始化的count。</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self,count)</span>:</span></span><br><span class="line">        self.count = count   <span class="comment"># 因为要向_generate方法中传入count的数据，使用这个count控制打印的个数。如果这里不写count参数，那么就要由初始化处决定count的数量。初始化的地方如果设置了count的值，也可以控制打印的数量，只是不太合逻辑。这里这样写是在改变实例的属性，所以当上面的生成器再执行到self.count时，就会被改变了</span></span><br><span class="line">        <span class="keyword">return</span> next(self._gen)  <span class="comment"># 这一步的next()是找生成器对象要数据，生成器对象self._gen会去找生成器_generate()，这时就会把这里的self.count传入到生成器中</span></span><br><span class="line"></span><br><span class="line">rg = RandomGenerator()</span><br><span class="line">print(rg.generate(<span class="number">5</span>))</span><br><span class="line">====================================================================================</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用生成器实现 1</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start=<span class="number">1</span>, stop=<span class="number">100</span>, patch=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.start = start</span><br><span class="line">        self.stop = stop</span><br><span class="line">        self.patch = patch</span><br><span class="line">        self._gen = self._generate()  <span class="comment"># 在这里定义是因为这个生成器对象只需要创建一次。_generate()在创建的时候如果不存在，会到类上找这个方法。而且这句放在最后是最安全的，因为要先把参数都赋值才能执行_generate方法，按顺序执行，最后把这句放在最后。在生成实例时，调用_generate方法时会返回一个生成器对象，并把结果给self._gen，只是还没有用。之后用generate()方法就可以操作这个生成器对象了</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">yield</span> random.randint(self.start, self.stop)</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self, count=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> count &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> [next(self._gen) <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.patch)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> [next(self._gen) <span class="keyword">for</span> _ <span class="keyword">in</span> range(count)]</span><br><span class="line">        </span><br><span class="line">a = RandomGenerator()</span><br><span class="line">print(a.generate())</span><br><span class="line">print(a.generate(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成器另一种实现</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start=<span class="number">1</span>, stop=<span class="number">100</span>, patch=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.start = start</span><br><span class="line">        self.stop = stop</span><br><span class="line">        self.patch = patch</span><br><span class="line">        self._gen = self._generate()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">yield</span> [random.randint(self.start, self.stop) <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.patch)]</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self, count=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> count &gt; <span class="number">0</span>:</span><br><span class="line">            self.patch = count</span><br><span class="line">        <span class="keyword">return</span> next(self._gen)</span><br><span class="line">    </span><br><span class="line">a = RandomGenerator()</span><br><span class="line">print(a.generate())</span><br><span class="line">print(a.generate(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用property</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomGenerator</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start=<span class="number">1</span>, stop=<span class="number">100</span>, patch=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.start = start</span><br><span class="line">        self.stop = stop</span><br><span class="line">        self.patch = patch</span><br><span class="line">        self._gen = self._generate()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">yield</span> [random.randint(self.start, self.stop) <span class="keyword">for</span> _ <span class="keyword">in</span> range(self.patch)]</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> next(self._gen)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">patch</span><span class="params">(self)</span>:</span>  <span class="comment"># 这里定义的方法名称与初始化的名称一样，是为了覆盖初始化的数据。因为这里的调用就是self.patch，和初始化中的一样。方法的返回值self._patch才是实例dict中保存的内容，实例dict中不会保存patch。这里就是利用相同的调用方法，用return的属性覆盖了原来的属性，_patch是自定义的，可以是任何值。也可以写成def abc(self): return self.patch，这样也可以改变初始化的patch值，也就是return的属性与初始化的属性是一样的也可以。</span></span><br><span class="line">        <span class="keyword">return</span> self._patch</span><br><span class="line">    <span class="comment"># 返回值中必须用_patch，或者说不能和这个方法本身的名字重复，不然就会变成递归调用，无法执行。</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @patch.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">patch</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self._patch = value</span><br><span class="line">      </span><br><span class="line">    <span class="comment"># 按照课上讲授的方法，还是应该写成下面这样。方法名称是自定义的，而返回的属性是上面定义过的，修改的也是上面定义过的属性</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_patch</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.patch</span><br><span class="line"></span><br><span class="line"><span class="meta">    @_patch.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_patch</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.patch = value</span><br><span class="line">        </span><br><span class="line">a = RandomGenerator()</span><br><span class="line">print(a.generate())</span><br><span class="line">a.patch = <span class="number">5</span></span><br><span class="line">print(a.generate())</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>打印坐标</li>
</ol>
<p>使用上题中的类，随机生成20个数字，两两配对形成二维坐标系的坐标，把这些坐标组织起来，并打印输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 笔记</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&#123;&#125;:&#123;&#125;'</span>.format(self.x, self.y)</span><br><span class="line"><span class="comment"># 在使用强制类型转换时就会用到__str__()，如果想打印，python内部机制是用__repr__</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span>  <span class="comment"># __repr__是将数据表现成什么样子，不然下面的print方法打印的是地址，而不是数据</span></span><br><span class="line">        retrun <span class="string">'&#123;&#125;:&#123;&#125;'</span>.format(self.x, self.y)</span><br><span class="line"><span class="comment"># 因为下面是将列表解析式给了lst1，然后在打印时print会迭代列表中的内容打印出来，但Point是自定义的类，print不知道怎么打印，所以会打印地址。所以要用这个__repr__方法说明打印的格式</span></span><br><span class="line"></span><br><span class="line">lst1 = [Point(x,y) <span class="keyword">for</span> x,y <span class="keyword">in</span> zip(rg.generate(<span class="number">10</span>), rg.generate(<span class="number">10</span>))]</span><br><span class="line">print(lst1)</span><br><span class="line"><span class="comment"># points = [Point(*v) for v in zip(RandomGenerator(10).generate(),RandomGenerator(10).generate())] 这样也可以</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> lst1:  <span class="comment">#也可以这样打印，因为lst1是Point的对象，所以有两个值</span></span><br><span class="line">    print(p.x, p.y)  <span class="comment"># 如果没有使用__str__或__repr__时，可以使用这种方法打印</span></span><br><span class="line">====================================================================================</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        </span><br><span class="line">points = [Point(x,y) <span class="keyword">for</span> x,y <span class="keyword">in</span> zip(RandomGenerator(<span class="number">10</span>).generate(),RandomGenerator(<span class="number">10</span>).generate())]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> points:</span><br><span class="line">    print(<span class="string">'&#123;&#125;:&#123;&#125;'</span>.format(p.x, p.y))</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>车辆信息</li>
</ol>
<p>记录车的品牌mark、颜色color、价格price、速度speed等特征，并实现增加车辆信息、显示全部车辆信息的功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 笔记</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mark, speed, color, price)</span>:</span></span><br><span class="line">        self.mark = mark</span><br><span class="line">        self.speed = speed</span><br><span class="line">        self.color = color</span><br><span class="line">        self.price = price</span><br><span class="line">    <span class="comment"># 如果要修改车辆信息，最后在Car中定义方法，因为数据在哪方法就在哪    </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarInfo</span>:</span></span><br><span class="line">   <span class="comment"># lst = []   # 把信息的组合放在列表中</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.lst = []   <span class="comment"># 因为是实例的，所以要加self。在实例化后才有这个列表</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addcar</span><span class="params">(self, car:Car)</span>:</span></span><br><span class="line">        self.lst.append(car)  <span class="comment"># 把car的属性信息放到列表中</span></span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getall</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="comment"># 数据在哪方法就在哪，因为方法是用来操作数据的。所以这里要遍历信息，要把放法加在信息上。</span></span><br><span class="line">		<span class="keyword">return</span> self.lst  <span class="comment"># 打印格式用format</span></span><br><span class="line"></span><br><span class="line">ci = CarInfo()</span><br><span class="line">car = Car(<span class="string">'audi'</span>, <span class="number">400</span>, <span class="string">'red'</span>, <span class="number">100</span>)   <span class="comment"># 颜色最好定义成数字，不然输入会混乱</span></span><br><span class="line">ci.addcar(car)</span><br><span class="line">ci.getall()</span><br><span class="line">====================================================================================</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>:</span>   <span class="comment"># 记录单一车辆</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, mark, speed, color, price)</span>:</span></span><br><span class="line">        self.mark = mark</span><br><span class="line">        self.speed = speed</span><br><span class="line">        self.color = color</span><br><span class="line">        self.price = price</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarInfo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.info = []</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addcar</span><span class="params">(self, car:Car)</span>:</span></span><br><span class="line">        self.info.append(car)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getall</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.info</span><br><span class="line">    </span><br><span class="line">ci = CarInfo()</span><br><span class="line">car = Car(<span class="string">'audi'</span>, <span class="number">400</span>, <span class="string">'red'</span>, <span class="number">100</span>)</span><br><span class="line">ci.addcar(car)</span><br><span class="line"></span><br><span class="line">ci.getall()   <span class="comment"># 返回所有数据，此时再实现格式打印</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>实现温度的处理</li>
</ol>
<p><img src="/images/python面向对象/实现温度处理.png" alt=""></p>
<p>思路</p>
<p>假定一般情况下，使用摄氏度为单位，传入温度值。</p>
<p>如果不给定摄氏度，一定会把温度值转换到摄氏度。</p>
<p>温度转换方法可以使用实例的方法，也可以使用类方法，使用类方法的原因是，为了不创建对象，就可以直接进行温度转换计算，这个类设计像个温度工具类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 笔记</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temperature</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, t, unit=<span class="string">'c'</span>)</span>:</span></span><br><span class="line">        self._c = <span class="keyword">None</span></span><br><span class="line">        self._f = <span class="keyword">None</span></span><br><span class="line">        self._k = <span class="keyword">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> unit == <span class="string">'k'</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> unit == <span class="string">'f'</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._c = t</span><br><span class="line">            </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c</span><span class="params">(self)</span>:</span>    <span class="comment"># 摄氏度</span></span><br><span class="line">        <span class="keyword">return</span> self._c</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">k</span><span class="params">(self)</span>:</span>   <span class="comment"># 开氏温度</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span>   <span class="comment"># 华氏温度</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 温度转换</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c2f</span><span class="params">(cls, c)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">9</span>*c/<span class="number">5</span> + <span class="number">32</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2c</span><span class="params">(cls, f)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>*(f<span class="number">-32</span>)/<span class="number">9</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c2k</span><span class="params">(cls, c)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> c + <span class="number">273.15</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">k2c</span><span class="params">(cls, k)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> k - <span class="number">273.15</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2k</span><span class="params">(cls, f)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.c2k(cls.f2c(f))</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">k2f</span><span class="params">(cls, k)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.c2f(cls.k2c(k))</span><br></pre></td></tr></table></figure>
<p>进一步完善未完成代码，如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temperature</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, t, unit=<span class="string">'c'</span>)</span>:</span></span><br><span class="line">        self._c = <span class="keyword">None</span></span><br><span class="line">        self._f = <span class="keyword">None</span></span><br><span class="line">        self._k = <span class="keyword">None</span></span><br><span class="line">   </span><br><span class="line">        <span class="keyword">if</span> unit == <span class="string">'k'</span>:</span><br><span class="line">            self._k = t</span><br><span class="line">            self._c = self.k2c(t)</span><br><span class="line">        <span class="keyword">elif</span> unit == <span class="string">'f'</span>:</span><br><span class="line">            self._f = t</span><br><span class="line">            self._c = self.f2c(t)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._c = t</span><br><span class="line"> <span class="comment">#     开始只有报错温度，其他两个是空的           </span></span><br><span class="line"><span class="meta">    @property      # 因为只为了转换，所以只提供只读属性，不提供写的</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c</span><span class="params">(self)</span>:</span>    <span class="comment"># 摄氏度</span></span><br><span class="line">        <span class="keyword">return</span> self._c</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">k</span><span class="params">(self)</span>:</span>   <span class="comment"># 开氏温度。这里要开氏温度，初始化一定能保证摄氏温度是有的，所以这里把摄氏温度转成开氏温度就可以了。开氏温度计算好了就不用再计算了</span></span><br><span class="line">        <span class="keyword">if</span> self._k <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            self._k = self.c2k(self._c)</span><br><span class="line">        <span class="keyword">return</span> self._k</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span>   <span class="comment"># 华氏温度，这里一样要计算华氏温度，这是为了节约计算资源</span></span><br><span class="line">        <span class="keyword">if</span> self._f <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            self._f = self.c2f(self._c)</span><br><span class="line">        <span class="keyword">return</span> self._f</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 温度转换</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c2f</span><span class="params">(cls, c)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">9</span>*c/<span class="number">5</span> + <span class="number">32</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2c</span><span class="params">(cls, f)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>*(f<span class="number">-32</span>)/<span class="number">9</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">c2k</span><span class="params">(cls, c)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> c + <span class="number">273.15</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">k2c</span><span class="params">(cls, k)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> k - <span class="number">273.15</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2k</span><span class="params">(cls, f)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.c2k(cls.f2c(f))</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">k2f</span><span class="params">(cls, k)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.c2f(cls.k2c(k))</span><br><span class="line">    </span><br><span class="line">print(Temperature.c2f(<span class="number">40</span>))</span><br><span class="line">print(Temperature.c2k(<span class="number">40</span>))</span><br><span class="line">print(Temperature.f2c(<span class="number">104.0</span>))</span><br><span class="line">print(Temperature.k2c(<span class="number">313.15</span>))</span><br><span class="line">print(Temperature.k2f(<span class="number">313.15</span>))</span><br><span class="line">print(Temperature.f2k(<span class="number">104</span>))</span><br><span class="line"><span class="comment"># 上面这些print都是工具，下面两个是当属性装饰器来用，设计应该是这样的。</span></span><br><span class="line">t = Temperature(<span class="number">37</span>)</span><br><span class="line">print(t.c, t.k, t.f)</span><br><span class="line"></span><br><span class="line">t = Temperature(<span class="number">300</span>, <span class="string">'k'</span>)</span><br><span class="line">print(t.c, t.k, t.f)</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>模拟购物车购物</li>
</ol>
<p>思路</p>
<p>购物车购物，分解得到两个对象<code>购物车</code>、<code>物品</code>，一个操作<code>购买</code>。</p>
<p>购买不是购物车的行为，其实是人的行为，但是对于购物车来说就是<code>增加add</code>。</p>
<p>商品有很多种类，商品的属性多种多样，怎么解决？</p>
<p>购物车可以加入很多不同的商品，如何实现？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拿到需求先区分出对象有哪些，这是一个抽象类的过程。之后分析类之间是如何作用的，每个类自身有什么特点。如果是工具，就可以写成类方法或静态方法，与实例无关。如果要为用户保存一些数据进来，并且实例可能发生变化，这时就要做成实例属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Color</span>:</span></span><br><span class="line">    RED = <span class="number">0</span>   <span class="comment"># 计算机喜欢用数字，所以这里这样定义，用衣使用时就用x.RED就可以了</span></span><br><span class="line">    BLUE = <span class="number">1</span></span><br><span class="line">    GREEN = <span class="number">2</span></span><br><span class="line">    GOLDEN = <span class="number">3</span></span><br><span class="line">    BLACK = <span class="number">4</span></span><br><span class="line">    OTHER =<span class="number">1000</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span>:</span>  <span class="comment"># Item在电商中指商品</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span>   <span class="comment"># 商品名和价格应该给位置参数，这两个是必须的，所以要写成位置参数</span></span><br><span class="line">        self.__spec = kwargs</span><br><span class="line"><span class="comment"># 实例属性不确定，不知道传入的dict中是否有其他的，所以定义一个__spec把传进来的属性保存起来。实例中一些配置信息就和商品信息混起来了，所以这时就提出一个_spec变量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(sorted(self.__spec.items()))</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cart</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span>   <span class="comment"># 容器最好也实例化</span></span><br><span class="line">        self.items = []</span><br><span class="line"><span class="comment"># 购物车就是一个容器，如何把容器弄的像一个字典一样，一个办法是从字典继承。另一个是如何把items暴露出去给别人用</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">additem</span><span class="params">(self, item:Item)</span>:</span>  <span class="comment"># 这里加商品</span></span><br><span class="line">        self.items.append(item)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getallitems</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.items</span><br><span class="line">    </span><br><span class="line">mycart = Cart()</span><br><span class="line">myphone = Item(mark=<span class="string">'Huawei'</span>, color=Color.GOLDEN, memory=<span class="string">'4G'</span>)</span><br><span class="line">mycart.additem(myphone)</span><br><span class="line"></span><br><span class="line">mycar = Item(mark=<span class="string">'Red Flag'</span>, color=Color.BLACK, year=<span class="number">2017</span>)</span><br><span class="line">mycart.additem(mycar)</span><br><span class="line"></span><br><span class="line">print(mycart.getallitems())</span><br></pre></td></tr></table></figure>
<p>注意，以上代码只是一个非常简单的一个实现，生产环境实现购物车的增删改查，要考虑很多。</p>
<h3 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h3><p>一切皆对象，如果都是对象，拿到的都是内存地址，都是引用，创建多个abc，内存中只会有一个abc，其他都是引用。创建列表时都会再次创建新列表，不要把列表放在函数中，函数多次调用会创建多个列表，如果只想要一份的话，就把列表放到函数外面</p>
<p>抽象是数据与动作的集合，对计算机来说数据称为属性，动作称为方法，有些地方把方法也叫函数。对象是抽象出来为实体服务的，如果拿出来对应就只能对应群体中的一个个体，这个个体就具有你所说的属性和方法，但属性可能是空白，因为虽然具体化了，但还没有把数据传给它。属性就是状态，状态就是数据，它是对象状态的抽象，因为属性最后放在类里面，而类是个抽象概念，所以属性也是个抽象概念。保存属性用数据结构。操作是个动作，这就是方法，实际上就是函数</p>
<p>写类时先想清楚有几个对象，然后把最核心的动作和数据抽象出来就行了。类定义完成后，这个类对象就产生了，类本身也是对象，这里区分一下类对象和类的对象，类对象指这是一个类，这个类本身也是个对象；类的对象指的是类的实例，实体。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="string">"""A example class"""</span>   <span class="comment"># 文档字符串</span></span><br><span class="line">    x = <span class="string">'abc'</span>  <span class="comment"># 类属性，不是对象的属性，对象的属性指的是类的实例的属性</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span>  </span><br><span class="line">		<span class="keyword">return</span> <span class="string">"MyClass foo"</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">print(MyClass.x)</span><br><span class="line">print(MyClass.foo)</span><br><span class="line">print(MyClass.__doc__)</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="string">"""this is a class"""</span></span><br><span class="line">    x = <span class="number">123</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(id(self))</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line">	    <span class="comment"># print(self.x)  </span></span><br><span class="line">      </span><br><span class="line"><span class="comment"># 类属性foo，也是方法。foo是个标识符，在定义一个函数后，这个函数标识符会对应到一个创建出来的函数</span></span><br><span class="line"><span class="comment"># 对象上，也就是foo这个标识符会对应到一个函数对象上。foo这个标识符属于MyClass类的属性，只是这</span></span><br><span class="line"><span class="comment"># 个属性是个标识符，并对应到了一个函数对象上，这个函数对象在类中叫方法。也就是这个标识符对应到一</span></span><br><span class="line"><span class="comment"># 个方法上去了，并且它也是属性。</span></span><br><span class="line"><span class="comment"># self是参数，下面print(MyClass.foo)中没有调用参数，没有传实参，所以可以打印出来。</span></span><br><span class="line"><span class="comment"># print(MyClass.foo)中要看的是函数对象或叫方法对象，并没有调用它，如果要调用时括号中就不能是</span></span><br><span class="line"><span class="comment"># 类类型，也就是不能是self本身，调用时参数要用类的实例，如果写成print(MyClass.foo())就是错的</span></span><br><span class="line"><span class="comment"># 了，但去掉print(self.x)中的.x，在pycham中可以执行，如果使用print(MyClass.foo(1))，那么</span></span><br><span class="line"><span class="comment"># 1就会被传入到类中，并调用1.x，因为1没有x属性，所以会报错。print(MyClass.foo)就是调用类类型</span></span><br><span class="line">        </span><br><span class="line">print(MyClass)</span><br><span class="line">print(MyClass.__name__)</span><br><span class="line">print(MyClass.x)   <span class="comment"># 通过类的名称找到自己的属性，x是MyClass的属性。.点表示找下面成员的</span></span><br><span class="line">print(MyClass.foo)   <span class="comment"># 这并不是调用foo，而是找MyClass这个类中的标识符foo，这个标识符对应一个方法，这个方法是个函数，这个函数本身是对象，所以对象一定有内存地址，下面显示的就是对象和内存地址。x也是对象，只是它是一个常量123，常量是固定放在一个位置的，只是对高级语言来说，如数字、字符串等，能显示就显示内容，不会显示内存地址。如果要查看常量的内存地址，用id()查看。可以在类中找到foo，说明这个标识是属于类的，这个标识符指向的方法也就属于这个类。定义完的类，本身就是个对象，这就是类对象。类也是个实体，它是类类型的对象，也就是类的类型就是类类型。因为标识符指向了一个方法，这个方法在内存中已经生成了，所以我们可以看到内存地址</span></span><br><span class="line">print(MyClass.__doc__)  </span><br><span class="line">print(type(MyClass))   <span class="comment"># 类的类型是类类型，也就是type类型。MyClass是type的实例</span></span><br><span class="line">输出：</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">MyClass</span>'&gt;   </span></span><br><span class="line"><span class="class"># <span class="title">__main__</span>表示模块，这个类就是在这个<span class="title">__main__</span>模块中运行的。也就是当前<span class="title">Python</span>环境中运行</span></span><br><span class="line"><span class="class"><span class="title">MyClass</span>   # 拿出<span class="title">MyClass</span>类中的名字</span></span><br><span class="line"><span class="class">123</span></span><br><span class="line"><span class="class">&lt;<span class="title">function</span> <span class="title">MyClass</span>.<span class="title">foo</span> <span class="title">at</span> 0<span class="title">x7f8e81eec550</span>&gt;  # <span class="title">print</span><span class="params">(MyClass.foo)</span>输出结果</span></span><br><span class="line"><span class="class"><span class="title">this</span> <span class="title">is</span> <span class="title">a</span> <span class="title">class</span>   # 打印类中的文档</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">type</span>'&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">x</span>是<span class="title">MyClass</span>的变量，<span class="title">foo</span>也可以是<span class="title">MyClass</span>的变量，类的变量和类的属性指的是一个意思，所以<span class="title">x</span>和<span class="title">foo</span>也是<span class="title">MyClass</span>的属性，变量才能绑定到方法上。实际都是属于类的标识符，如果不属于类，就不能用类来调用它们、访问它们</span></span><br><span class="line"><span class="class">类里面的方法不能叫<span class="title">function</span>，在<span class="title">Python</span>中叫<span class="title">method</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">print</span><span class="params">(<span class="string">'下面就是实例的东西了'</span>)</span></span></span><br><span class="line">a = MyClass()   </span><br><span class="line"><span class="comment"># 实例化，初始化。实例化表示从人类变成了人，初始化表示给人数据，如名字等，为对象赋一些基本特征，</span></span><br><span class="line"><span class="comment"># 也就是赋初值的过程。实例化后就可以拿到一个具体的对象或实例了，之后就可以把这个实例赋给一个标识</span></span><br><span class="line"><span class="comment"># 符或变量了，这个变量（在这里就是mycls）对应着内存中的一个地址，那个地址放了实例化后的对象</span></span><br><span class="line">print(a.foo())</span><br><span class="line">print(a.x)   <span class="comment"># 实例也可以拿类属性 </span></span><br><span class="line">print(a.foo)</span><br><span class="line">print(<span class="string">'=============='</span>)</span><br><span class="line">print(id(a))</span><br><span class="line">输出：</span><br><span class="line">下面就是实例的东西了</span><br><span class="line"><span class="number">139819469043120</span></span><br><span class="line"><span class="number">123</span>   <span class="comment"># 这是print(self.x)打印出来的</span></span><br><span class="line"><span class="keyword">None</span>   <span class="comment"># 因为上面的foo函数中没有return，所以这里返回了None</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line">&lt;bound method MyClass.foo of &lt;__main__.MyClass object at <span class="number">0x7fd39a48c5b0</span>&gt;&gt;   </span><br><span class="line"><span class="comment"># print(a.foo)输出结果，这里显示的是MyClass，这是MyClass对象地址，MyClass的对象就是a，这个</span></span><br><span class="line"><span class="comment"># 是a的地址。上面print(MyClass.foo)打印的是函数对象地址。这里MyClass.foo的地址并没有打印。</span></span><br><span class="line"><span class="comment"># 这里的bound表示把foo()这个方法绑定给了a这个实例了。原来的标识符定义在类上，现在有个具体的对象</span></span><br><span class="line"><span class="comment"># 出来了，就把这个方法绑定给这个对象，这样foo()方法第一个默认的self参数就不用写了，a.foo()就相</span></span><br><span class="line"><span class="comment"># 当于把a当参数传给了MyClass中foo(self)的self</span></span><br><span class="line">==============</span><br><span class="line"><span class="number">139819469043120</span></span><br><span class="line">&lt;__main__.MyClass object at <span class="number">0x7fd6fd155a90</span>&gt;</span><br><span class="line"><span class="comment"># 最后两行是foo返回的值，一个是foo方法中print的返回值，一个是return的返回值</span></span><br><span class="line">***</span><br><span class="line">方法是属于类的属性，但是类的实例是对象，对象可以调用这个方法。常用的方法如下</span><br><span class="line">print(MyClass.x)</span><br><span class="line">a = MyClass()</span><br><span class="line">print(a.foo())</span><br><span class="line">print(a.x)  </span><br><span class="line">***</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="string">"""this is a class"""</span></span><br><span class="line">    x = <span class="number">123</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span>   <span class="comment"># 初始化</span></span><br><span class="line">        <span class="comment"># pass   # 默认是空语句，什么都不做。下面就是不使用</span></span><br><span class="line">        print(<span class="string">'init'</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"foo = &#123;&#125;"</span>.format(self.x)</span><br><span class="line">    </span><br><span class="line">a = MyClass()   </span><br><span class="line"><span class="comment"># 实例化，初始化。这是先用new方法构建出一个实例，这个实例是裸着的，这就需要初始化</span></span><br><span class="line">print(a.foo())</span><br><span class="line">输出：</span><br><span class="line">init</span><br><span class="line">foo = <span class="number">123</span></span><br><span class="line">****</span><br><span class="line">__init__(self)方法指的就是构造器或构造方法或初始化方法，初始化的发生时机在类的构建完发生，发生之后就不会再初始化了，也不会再构建了，除非再新建一个对象出来。</span><br><span class="line">****</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.name = <span class="string">'tom'</span>   <span class="comment"># self指的就是当前创建的实例本身，这样定义，所有实例的name都将是tom</span></span><br><span class="line">    </span><br><span class="line">a = Person</span><br><span class="line">b = Person</span><br><span class="line">print(a.name, b.name)</span><br><span class="line">输出：</span><br><span class="line">tom tom</span><br><span class="line">==================================================================</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line">    x = <span class="string">'abc'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">    </span><br><span class="line">a = Person(<span class="string">'tom'</span>)</span><br><span class="line">b = Person(<span class="string">'jerry'</span>)</span><br><span class="line">print(a.name, b.name)</span><br><span class="line">print(a.x, b.x)   <span class="comment"># 类是共用的，x是常量，不会变</span></span><br><span class="line">输出：</span><br><span class="line">tom jerry</span><br><span class="line">abc abc</span><br><span class="line">====================================================================</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line">    x = <span class="string">'abc'</span>   <span class="comment"># 这是类的属性或叫类属性</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name   </span><br><span class="line"><span class="comment"># 这是对象的属性或叫实例属性。以self开头的就是实例的。self的问题就是不判断传入的类型</span></span><br><span class="line">    </span><br><span class="line">a = Person(<span class="string">'tom'</span>)</span><br><span class="line">b = Person(<span class="string">'tom'</span>)</span><br><span class="line"><span class="comment"># print(a.name, b.name)</span></span><br><span class="line"><span class="comment"># print(a.x, b.x) </span></span><br><span class="line">print(a == b)  <span class="comment"># 这是两个不同的对象，这是两个不同的变量</span></span><br><span class="line">print(a <span class="keyword">is</span> b)</span><br><span class="line">输出：</span><br><span class="line"><span class="keyword">False</span></span><br><span class="line"><span class="keyword">False</span></span><br><span class="line">====================================================================</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line">    x = <span class="string">'abc'</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.y = age   </span><br><span class="line"><span class="comment"># y是实例的属性，实例的属性可以换位置，属性也是变量名，将它对应到age上，调用时用y就可以了，属性</span></span><br><span class="line"><span class="comment"># 与调用时的名称要一样，上面的__init__()的括号中只是函数的定义，这里的self.y中的y才是要调用的</span></span><br><span class="line"><span class="comment"># 变量名。self.y是一个限定，y是self的实例变量</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self, x, y)</span>:</span> </span><br><span class="line"><span class="comment"># 这里也可以加参数，这里的x和y与上面定义的x没有关系，也与self.y没有关系，这是传入的参数</span></span><br><span class="line"><span class="comment"># 对于一个方法来讲，它处理的数据可以与这个类本身没有关系，可以与当前实例也没有关系。self.x就叫与</span></span><br><span class="line"><span class="comment"># 当前实例有关系。上面的x和y与当前类和实例都没有关系。因为当前实例没有这个东西，只是对这个东西进</span></span><br><span class="line"><span class="comment"># 行加工处理。这就像method函数，送进去一个值可以返回一个绝对值，这个返回的值与method没有关系，</span></span><br><span class="line"><span class="comment"># 不属于它的类也不属于它的实例，它只是对数据进行了加工处理 </span></span><br><span class="line">        print(self.name, self.y)  <span class="comment"># 这是一种形式上的调用，要用实参来替换</span></span><br><span class="line">    	self.y = x   <span class="comment"># 这就是将初始化中的self.y改成了传入的x的值</span></span><br><span class="line">        Person.x = x   <span class="comment"># 改变Person类的x属性的值</span></span><br><span class="line">    </span><br><span class="line">a = Person(<span class="string">'tom'</span>)</span><br><span class="line">b = Person(<span class="string">'tom'</span>, <span class="number">20</span>)</span><br><span class="line">print(a.y, b.y)</span><br><span class="line">a.show(<span class="number">100</span>, <span class="string">'a'</span>)</span><br><span class="line">b.show(<span class="number">200</span>, <span class="string">'b'</span>)</span><br><span class="line">print(Person.x)</span><br><span class="line">a.y = <span class="number">200</span>   <span class="comment"># 外部修改类内部的变量</span></span><br><span class="line">输出：</span><br><span class="line"><span class="number">18</span> <span class="number">18</span></span><br><span class="line">tom <span class="number">18</span> <span class="number">100</span> a</span><br><span class="line">tom <span class="number">20</span> <span class="number">200</span> b</span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>实例叫instance</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line">    x = <span class="string">'abc'</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.y = age   </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self, x, y)</span>:</span> </span><br><span class="line">        print(self.name, self.y)  </span><br><span class="line">    	self.y = x   </span><br><span class="line">        Person.x = x  </span><br><span class="line">    </span><br><span class="line">a = Person(<span class="string">'tom'</span>)</span><br><span class="line">b = Person(<span class="string">'jerry'</span>, <span class="number">20</span>)</span><br><span class="line">print(a.__class__, b.__class__)</span><br><span class="line">print(a.__class__.__qualname__, a.__class__.__name__)   </span><br><span class="line"><span class="comment"># __qualname__是限定名，限定名是类才会有的东西在类的实例上是调用不到的。类是类类型的实例，也就是</span></span><br><span class="line"><span class="comment"># 说这是类类型的属性。__name__也一样。文件的名称就是模块的名称，如test.py，上面是在__main__模</span></span><br><span class="line"><span class="comment"># 块中运行的，这里省掉了。__qualname__限定名不等于__name__，它们是有差异的</span></span><br><span class="line">print(isinstance(a, a.__class__))   <span class="comment"># 查看a是不是a.__class__类型。b也是这种类型</span></span><br><span class="line">print(int.__class__)  <span class="comment"># int本身也是个类型</span></span><br><span class="line">print(isinstance(b, int.__class__))</span><br><span class="line">print(Person.__dict__)  <span class="comment"># 打印类的属性，类中定义的都是类的属性</span></span><br><span class="line">print(a.__dict__)  </span><br><span class="line"><span class="comment"># 打印对象属性。对象上没有方法，对象方法没必要定义在对象里，因为大家的操作是一样的，所以定义在了类</span></span><br><span class="line"><span class="comment"># 里，只是数据不一样了。函数（方法）只有一份，只是参数不一样了。所以方法属于类属性。这个字典中的</span></span><br><span class="line"><span class="comment"># show是一个function，如果再加一个括号就可以调用了</span></span><br><span class="line">print(b.__dict__)  <span class="comment"># 对于对象来说，自己拥有一个字典，存着自己的数据，这叫个性化</span></span><br><span class="line">print(a.__dict__[<span class="string">'name'</span>])</span><br><span class="line">输出：</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">Person</span>'&gt; &lt;<span class="title">class</span> '<span class="title">__main__</span>.<span class="title">Person</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">Person</span> <span class="title">Person</span>  </span></span><br><span class="line"><span class="class"><span class="title">True</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">type</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">False</span></span></span><br><span class="line">&#123;'__module__': '__main__', 'x': 'abc', '__init__': &lt;function Person.__init__ at 0x7fdc1d2d3550&gt;, 'show': &lt;function Person.show at 0x7fdc1d2d35e0&gt;, '__dict__': &lt;attribute '__dict__' of 'Person' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'Person' objects&gt;, '__doc__': None&#125;</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'tom'</span>, <span class="string">'y'</span>: <span class="number">18</span>&#125;</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'jerry'</span>, <span class="string">'y'</span>: <span class="number">20</span>&#125;</span><br><span class="line">tom</span><br><span class="line">================================================================</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    age = <span class="number">3</span></span><br><span class="line">    height = <span class="number">170</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        </span><br><span class="line">tom = Person(<span class="string">'tom'</span>)</span><br><span class="line">jerry = Person(<span class="string">'jerry'</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">Person.age = <span class="number">30</span>   <span class="comment"># 这是一种限定，限定在Person类中使用age这个变量</span></span><br><span class="line">print(Person.age, tom.age, jerry.age)</span><br><span class="line">print(Person.__dict__, tom.__dict__, jerry.__dict__, sep=<span class="string">'\n'</span>)</span><br><span class="line">print(Person.height, tom.height, jerry.height)</span><br><span class="line">Person.height += <span class="number">20</span></span><br><span class="line">print(Person.height, tom.height, jerry.height)</span><br><span class="line">print(Person.__dict__, tom.__dict__, jerry.__dict__, sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment"># 到目前为止tom和jerry中还没有新key</span></span><br><span class="line">tom.height = <span class="number">168</span>   <span class="comment"># 赋值即定义，在这个实例上定义一个height</span></span><br><span class="line">print(Person.height, tom.height, jerry.height)</span><br><span class="line">print(Person.__dict__, tom.__dict__, jerry.__dict__, sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment"># 这时tom中添加了一个新key</span></span><br><span class="line">jerry.height += <span class="number">30</span>   <span class="comment"># 开始jerry没有height，它会到Person中拿这个属性再加上30。这样定义破坏了封装</span></span><br><span class="line">print(Person.height, tom.height, jerry.height)</span><br><span class="line"><span class="comment"># 先查找自己的字典，自己的字典没有就到类字典中找，如果还是没有就报找不到。如果自己有就不找类的了。</span></span><br><span class="line"><span class="comment"># 先找自己再找自己的类</span></span><br><span class="line">print(Person.__dict__, tom.__dict__, jerry.__dict__, sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="comment"># jerry现在也有了新key</span></span><br><span class="line">Person.weight = <span class="number">70</span>   <span class="comment"># 在类上添加一个新属性</span></span><br><span class="line">print(Person.weight, tom.weight, jerry.weight)</span><br><span class="line"></span><br><span class="line">print(Person.__dict__[<span class="string">'weight'</span>])  <span class="comment"># 这没问题，可以找到</span></span><br><span class="line">print(tom.__dict__[<span class="string">'weight'</span>])  <span class="comment"># 这样不行，会报找不到key</span></span><br><span class="line">pritn(tom.weight)  <span class="comment"># 这样没问题，会到类里找</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tom.__class__.__dict__ 等价于 Person.__dict__</span></span><br><span class="line">输出：</span><br><span class="line"><span class="number">30</span> <span class="number">18</span> <span class="number">20</span></span><br><span class="line"><span class="number">170</span> <span class="number">170</span> <span class="number">170</span></span><br><span class="line"><span class="number">190</span> <span class="number">190</span> <span class="number">190</span></span><br><span class="line"><span class="number">190</span> <span class="number">168</span> <span class="number">190</span></span><br><span class="line"><span class="number">190</span> <span class="number">168</span> <span class="number">220</span></span><br></pre></td></tr></table></figure>
<p>装饰一个类，这和类装饰器不同，类装饰器是指一个类就是装饰别人的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 装饰器有嵌套函数，嵌套函数与高阶函数有关，形参或返回值是函数就是高阶函数</span></span><br><span class="line"><span class="comment"># def setnameproperty(cls, name):</span></span><br><span class="line"><span class="comment">#     cls.NAME = name  </span></span><br><span class="line"><span class="comment"># 装饰器从这个函数得来</span></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setnameproperty</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(cls)</span>:</span></span><br><span class="line">        cls.NAME = name   <span class="comment"># 这里动态增加了一个类属性并赋值为'MY CLASS'</span></span><br><span class="line">        <span class="keyword">return</span> cls  </span><br><span class="line"><span class="comment"># 这里要返回cls是因为MyClass = wrapper(cls)，MyClass被当作cls传入到wrapper中，所以要返回，</span></span><br><span class="line"><span class="comment"># 得到 MyClass = cls，如果不返回，就成了MyClass = None。如果像上面定义的</span></span><br><span class="line"><span class="comment"># setnameproperty(cls, name)，就不需要返回了，因为直接就改了</span></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@setnameproperty('MY CLASS')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span>  </span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(MyClass.__dict__)</span><br><span class="line">输出：</span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'MyClass'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'MyClass'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>, <span class="string">'NAME'</span>: <span class="string">'MY CLASS'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加入装饰器@setnameproperty('MY CLASS')后，其下面如果是类的话，它会把标识符抽（上例中是</span></span><br><span class="line"><span class="comment"># MyClass）取出来，这个标识符指向了一个对象，不管这个对象是类对象还是函数对象，拿来后就放到这个装</span></span><br><span class="line"><span class="comment"># 饰器函数中，它会先对装饰器函数求值，也就是setnameproperty('MY CLASS')，将'MY CLASS'当作</span></span><br><span class="line"><span class="comment"># name参数传入函数，这会返回wrapper函数，也就是说</span></span><br><span class="line"><span class="comment"># @setnameproperty('MY CLASS')等于@wrapper，这就是语法糖了。这个语法糖会把他下面的函数抽取</span></span><br><span class="line"><span class="comment"># 出来当作参数，这也是唯一参数，这个语法糖只能接受一个参数。@wrapper会把它下面函数的标识符</span></span><br><span class="line"><span class="comment"># MyClass拿到，放到wrapper函数中当作cls传入，再给MyClass添加功能后，再返回去。返回的MyClass</span></span><br><span class="line"><span class="comment"># 类还是原来的类</span></span><br></pre></td></tr></table></figure>
<p>类方法与静态方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="string">"""this is a class"""</span></span><br><span class="line">    x = <span class="number">123</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span>   <span class="comment"># 初始化</span></span><br><span class="line">        print(<span class="string">'init'</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"foo = &#123;&#125;"</span>.format(self.x)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span>   <span class="comment"># 不建议这样使用</span></span><br><span class="line">        print(<span class="string">'bar'</span>)</span><br><span class="line">        </span><br><span class="line">a = MyClass()  <span class="comment"># 实例化，初始化</span></span><br><span class="line">print(a.foo())</span><br><span class="line"></span><br><span class="line">MyClass.bar()</span><br><span class="line">print(MyClass.__dict__)</span><br><span class="line">a.bar()   <span class="comment"># 这会报错</span></span><br><span class="line">输出：</span><br><span class="line">init</span><br><span class="line">foo = <span class="number">123</span></span><br><span class="line">bar</span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__doc__'</span>: <span class="string">'this is a class'</span>, <span class="string">'x'</span>: <span class="number">123</span>, <span class="string">'__init__'</span>: &lt;function MyClass.__init__ at <span class="number">0x7fc1540c7550</span>&gt;, <span class="string">'foo'</span>: &lt;function MyClass.foo at <span class="number">0x7fc1540c75e0</span>&gt;, <span class="string">'bar'</span>: &lt;function MyClass.bar at <span class="number">0x7fc1540c7670</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'MyClass'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'MyClass'</span> objects&gt;&#125; </span><br><span class="line"><span class="comment"># 这里bar和foo都是function</span></span><br><span class="line">=============================================================</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="string">"""this is a class"""</span></span><br><span class="line">    xxx = <span class="string">'XXX'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"foo"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span>   <span class="comment"># 不建议这样使用</span></span><br><span class="line">        print(<span class="string">'bar'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @classmethod   </span></span><br><span class="line"><span class="comment"># 类方法，当调用这个方法时，会将类的名称当第一个参数给cls。类方法与普通方法的区别，如果用了这个装</span></span><br><span class="line"><span class="comment"># 饰器，它下面的第一个参数就不再是实例本身了，而是实例对应的类本身了。它是属于这个类的。如下面</span></span><br><span class="line"><span class="comment"># def clsmtd(cls, *, a)中的就是cls了，而不是self</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clsmtd</span><span class="params">(cls, *, a)</span>:</span>   </span><br><span class="line"><span class="comment"># cls是自动加上的，这是第一位置参数，不能变。有类就可以调用类方法</span></span><br><span class="line">        print(<span class="string">'&#123;&#125;.xxx=&#123;&#125;'</span>.format(cls.__name__, cls.xxx))</span><br><span class="line"><span class="comment"># 在这里不能直接调用实例的属性</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @staticmethod   </span></span><br><span class="line"><span class="comment"># 静态方法。这和上面的bar()方法差不多，如果要用这种方法，建议使用这种静态方法。</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">staticmtd</span><span class="params">(x)</span>:</span>   <span class="comment"># 这样定义可以，不会传第一个位置参数，但还是可以有参数</span></span><br><span class="line">        print(<span class="string">'static'</span>)</span><br><span class="line">        MyClass   <span class="comment"># 要在静态方法里取类，就用这种方法</span></span><br><span class="line">        </span><br><span class="line">a = MyClass()  <span class="comment"># 实例化，初始化</span></span><br><span class="line">a.foo()</span><br><span class="line"></span><br><span class="line">MyClass.bar()</span><br><span class="line">print(MyClass.__dict__)</span><br><span class="line">MyClass.clsmtd()</span><br><span class="line">a.clsmtd()   </span><br><span class="line"><span class="comment"># 因为a实例中没有clsmtd，所以会到类中找。这相当于传入一个a.__class__给cls。这条等价于</span></span><br><span class="line"><span class="comment"># a.__class__.clsmtd()</span></span><br><span class="line">MyClass.staticmtd()</span><br><span class="line">a.staticmtd()  <span class="comment"># 这样是可以调用的，不会传第一个位置参数</span></span><br><span class="line">MyClass.clsmtd(a=MyClass())  <span class="comment"># 一般不会这样做</span></span><br><span class="line">MyClass().clsmtd()  <span class="comment"># MyClass()表示实例化出一个对象，只是没有名字 </span></span><br><span class="line">输出：</span><br><span class="line">foo</span><br><span class="line">bar</span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__doc__'</span>: <span class="string">'this is a class'</span>, <span class="string">'xxx'</span>: <span class="string">'XXX'</span>, <span class="string">'foo'</span>: &lt;function MyClass.foo at <span class="number">0x7f10e5f7e550</span>&gt;, <span class="string">'bar'</span>: &lt;function MyClass.bar at <span class="number">0x7f10e5f7e5e0</span>&gt;, <span class="string">'clsmtd'</span>: &lt;classmethod object at <span class="number">0x7f10e5fe1a90</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'MyClass'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'MyClass'</span> objects&gt;&#125;</span><br><span class="line">MyClass.xxx=XXX</span><br><span class="line">MyClass.xxx=XXX</span><br><span class="line">static</span><br><span class="line">static</span><br></pre></td></tr></table></figure>
<p>访问控制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age  <span class="comment"># 在前面加两个下划线就把对象属性隐藏了。后面有下划线说明是特殊方法</span></span><br><span class="line">        <span class="comment"># 因为是实例属性，所以只有在实例中才能找到</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">growup</span><span class="params">(self, incr=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt; incr &lt; <span class="number">150</span>:</span><br><span class="line">            self.__aget += incr</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age  <span class="comment"># 内部可以访问隐藏属性</span></span><br><span class="line">    </span><br><span class="line">tom = Person(<span class="string">'tom'</span>)</span><br><span class="line">tom.growup(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># print(tom.age)  # 因为是隐藏属性，所以这里访问不了__age属性</span></span><br><span class="line">print(tom.getage())  <span class="comment"># 这样就可以访问隐藏属性了</span></span><br><span class="line">print(Person.__dict__)</span><br><span class="line">print(tom.__dict__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代码不要写成下面这样的方式</span></span><br><span class="line">tom._Person__age = <span class="number">200</span>  <span class="comment"># 这时类中的检查函数就没用了，还是可以改隐藏属性的值</span></span><br><span class="line">print(tom.getage())</span><br><span class="line"></span><br><span class="line">tom.age = <span class="number">300</span>   <span class="comment"># 这样是新增一个属性，与类中的__age没有关系</span></span><br><span class="line">print(tom.getage())</span><br><span class="line">print(tom.age)</span><br><span class="line"></span><br><span class="line">print(tom.__dict__)</span><br><span class="line">输出：</span><br><span class="line"><span class="number">20</span></span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__init__'</span>: &lt;function Person.__init__ at <span class="number">0x7f88d8859550</span>&gt;, <span class="string">'growup'</span>: &lt;function Person.growup at <span class="number">0x7f88d88595e0</span>&gt;, <span class="string">'getage'</span>: &lt;function Person.getage at <span class="number">0x7f88d8859670</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'tom'</span>, <span class="string">'_Person__age'</span>: <span class="number">20</span>&#125;  <span class="comment"># 这里可以看到隐藏的属性__age是改了名字</span></span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure>
<p>保护变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age=<span class="number">18</span>)</span>:</span></span><br><span class="line">        self._name = name</span><br><span class="line">        self.__age = age </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__growup</span><span class="params">(self, incr=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt; incr &lt; <span class="number">150</span>:</span><br><span class="line">            self.__aget += incr</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getage</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__age  <span class="comment"># 内部可以访问隐藏属性</span></span><br><span class="line">    </span><br><span class="line">tom = Person(<span class="string">'tom'</span>)</span><br><span class="line"><span class="comment"># tom.growup(2)</span></span><br><span class="line">print(Person.__dict__)  <span class="comment"># 查看是否有__growup方法，也变成了_Person__growup</span></span><br><span class="line">print(tom.getage())  </span><br><span class="line">tom._name = <span class="string">'jerry'</span>   <span class="comment"># 可以改变保护变量的值，还可以打印，不会被改名</span></span><br><span class="line">print(tom._name)</span><br><span class="line"><span class="comment"># print(Person.__dict__)</span></span><br><span class="line">print(tom.__dict__)</span><br><span class="line">输出：</span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__init__'</span>: &lt;function Person.__init__ at <span class="number">0x7fbb17fca550</span>&gt;, <span class="string">'_Person__growup'</span>: &lt;function Person.__growup at <span class="number">0x7fbb17fca5e0</span>&gt;, <span class="string">'getage'</span>: &lt;function Person.getage at <span class="number">0x7fbb17fca670</span>&gt;, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'Person'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line"><span class="number">18</span></span><br><span class="line">jerry</span><br><span class="line">&#123;<span class="string">'_name'</span>: <span class="string">'jerry'</span>, <span class="string">'_Person__age'</span>: <span class="number">20</span>&#125;</span><br><span class="line"><span class="comment"># 保护变量是Python开发者的共同约定，它不属于解释器管理，所以可以改变。但约定是不要改变。方法有自</span></span><br><span class="line"><span class="comment"># 己的作用域，类也有自己的作用域。从外面无法访问里面的东西，所以要加类名或实例名，称为限定名</span></span><br></pre></td></tr></table></figure>
<p>猴子补丁</p>
<p>解释器运行时才会执行动态替换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在test2模块中定义</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span>  <span class="title">__init__</span><span class="params">(self, chinese, english, history)</span>:</span></span><br><span class="line">        self. chinese = chinese</span><br><span class="line">        self.eng = english</span><br><span class="line">        self.his = history</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getscore</span><span class="params">(self)</span>:</span>   <span class="comment"># 取成绩</span></span><br><span class="line">        <span class="keyword">return</span> (self.chinese, self.eng, self.his)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># stu = Person()</span></span><br><span class="line"><span class="comment"># stu.getscore()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 换另一个模块test3修改上面的类</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getscrore</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> dict(chi=self.chinese, eng=self.eng, his=self.his)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再换一个模块test1，运行用</span></span><br><span class="line"><span class="keyword">from</span> test3 <span class="keyword">import</span> getscrore   <span class="comment"># 把补丁导入</span></span><br><span class="line"><span class="keyword">from</span> test2 <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">monkeypatch4Person</span><span class="params">()</span>:</span>   <span class="comment"># 一般不会只写下面一行，需要定义一个函数，使用时调用</span></span><br><span class="line">	Person.getscore = getscrore   </span><br><span class="line"><span class="comment"># 把Person类中的getscore方法替换为getscrore方法。前面要替换的方法要与类相关，或与对象相关，现</span></span><br><span class="line"><span class="comment"># 在是要对Person类改变属性，如果不是对类改变属性是没有必要的，因为方法是定义在类上的，在类的dict</span></span><br><span class="line"><span class="comment"># 里面。对象的dict里看到的只有自己的数据。这样定义后，当student1调用getscore时，相当于调用</span></span><br><span class="line"><span class="comment"># getscrore</span></span><br><span class="line"></span><br><span class="line">student1 = Person(<span class="number">80</span>, <span class="number">90</span>, <span class="number">88</span>)</span><br><span class="line">print(student1.getscore())</span><br><span class="line"></span><br><span class="line">monkeypatch4Person()</span><br><span class="line">student2 = Person(<span class="number">88</span>, <span class="number">99</span>, <span class="number">100</span>)  <span class="comment"># 只有student2才会是打了补丁的</span></span><br><span class="line">print(student2.getscore())</span><br><span class="line">输出：</span><br><span class="line">(<span class="number">80</span>, <span class="number">90</span>, <span class="number">88</span>)</span><br><span class="line">(<span class="string">'his'</span>: <span class="number">88</span>, <span class="string">'chi'</span>: <span class="number">80</span>, <span class="string">'eng'</span>: <span class="number">90</span>)   <span class="comment"># 这是打了补丁后的输出</span></span><br></pre></td></tr></table></figure>
<p>属性装饰器与对象的销毁</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 属性装饰器是为了隐藏实例属性，所以暴露另一个方法来操作隐藏的属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, chinese, english, history)</span>:</span></span><br><span class="line">        self._chinese = chinese</span><br><span class="line">        self._eng = english</span><br><span class="line">        self.__his = history</span><br><span class="line"><span class="comment"># 实例的属性是私有的，所以最好隐藏，如果想给别人用，要用def的方法把方法暴露给别人    </span></span><br><span class="line"><span class="comment"># 在写一个类的初始化函数的时候，就应该对未来的实例的属性，应该加上下划线或双下划线。因为这些属性是</span></span><br><span class="line"><span class="comment"># 私有的，如果它想把这些属性给别人用，请它暴露出方法给别人用。有下划线就表示不想被直接使用，所以要</span></span><br><span class="line"><span class="comment"># 用一个方法把它暴露出去</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gethis</span><span class="params">(self)</span>:</span>   <span class="comment"># 取历史成绩。这是__his这个属性的getter</span></span><br><span class="line">        <span class="keyword">return</span> self.__his</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sethis</span><span class="params">(self, value)</span>:</span>   <span class="comment"># 修改历史成绩</span></span><br><span class="line">        self.__his = value</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># def geteng(self):   </span></span><br><span class="line"><span class="comment"># 这只有一个getter属性，这被称为只读属性。上面的属性可以读写。只能写不能读的属性一般没什么用，最</span></span><br><span class="line"><span class="comment"># 少应该可读。</span></span><br><span class="line">    <span class="comment">#    retrun self._eng</span></span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">seteng</span><span class="params">(self, v)</span>:</span> <span class="comment"># setter</span></span><br><span class="line">        self._eng = v  <span class="comment"># 这里根据下面的property做调整</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property   # 属性装饰器</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">chinese</span><span class="params">(self)</span>:</span> </span><br><span class="line"><span class="comment"># 加了属性装饰器，这个方法就可以当一个变量用或属性用。只读属性。这里的方法叫什么名字，下面的</span></span><br><span class="line"><span class="comment"># setter和deleter也要叫什么名字。定义这个函数就是为了隐藏_chinese属性，使用chinese方法。当访</span></span><br><span class="line"><span class="comment"># 问chinese方法时，就会返回self._chinese的属性值</span></span><br><span class="line">        <span class="keyword">return</span> self._chinese  </span><br><span class="line"><span class="comment"># 看到return就应该想到是否可以改成匿名函数lambda</span></span><br><span class="line"><span class="comment"># 这个装饰器可以把它下面的方法变成一个像属性的东西让你来访问它，就是在使用方法时不用加括号了，这就</span></span><br><span class="line"><span class="comment"># 相当于在调用这个方法，调用这个方法后它就会把这个方法的返回值返回回来给print函数用。这就相当于</span></span><br><span class="line"><span class="comment"># 上面的geteng方法。</span></span><br><span class="line"><span class="meta">	@chinese.setter  </span></span><br><span class="line"><span class="comment"># 这个意思是把下面的方法作为chinese的setter，setter就是set的那个东西，它就是一个属性的设置器，</span></span><br><span class="line"><span class="comment"># chinese指的是上面@property下面定义的chinese方法。写属性。当赋值时，解释器知道是要调用</span></span><br><span class="line"><span class="comment"># setter的，调用setter时就会把值当value传入，这样就改变了self._chinese的值</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">chinese</span><span class="params">(self, value)</span>:</span>  <span class="comment"># set需要两个参数</span></span><br><span class="line">        self._chinese = value</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @chinese.deleter   # 删除，少用</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">chinese</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="comment"># del self._chinese</span></span><br><span class="line">    	print(<span class="string">'del chinese'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 下面是另一种方式的属性装饰器</span></span><br><span class="line">    eng = property(<span class="keyword">lambda</span> self:self._eng, seteng)  </span><br><span class="line"><span class="comment"># 括号里只需要函数名就可以了，定义了seteng后，下面就可以给eng赋值了</span></span><br><span class="line">    </span><br><span class="line">student1 = Person(<span class="number">80</span>,<span class="number">90</span>,<span class="number">88</span>)</span><br><span class="line">print(student1.gethis())  <span class="comment"># 在外面不要直接拿实例的属性，而是使用一个方法</span></span><br><span class="line">print(student1.chinese)  <span class="comment"># 把一个方法当属性来用</span></span><br><span class="line">student1.chinese = <span class="number">100</span></span><br><span class="line">print(student1.chinese)</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> student1.chinese</span><br><span class="line"></span><br><span class="line">print(student1.eng)  <span class="comment"># 调用eng方法</span></span><br><span class="line">student1.eng = <span class="number">110</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/05/阿里云直播服务使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/05/阿里云直播服务使用/" itemprop="url">
                  阿里云直播服务使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-03-05 13:47:49" itemprop="dateCreated datePublished" datetime="2020-03-05T13:47:49+08:00">2020-03-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/阿里云/" itemprop="url" rel="index"><span itemprop="name">阿里云</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="时移（回看）功能"><a href="#时移（回看）功能" class="headerlink" title="时移（回看）功能"></a>时移（回看）功能</h4><ol>
<li>start和end组合，会有开始跟结束，但不能控制进度条，这种组合是直播的方式，ts列表不全。</li>
</ol>
<p>例：<a href="https://gehua-edu-broadcast.beijingcloud.com.cn/app-ghedu/stream-ghedu.m3u8?auth_key=1591973719-0-0-0870ae5e5e1fee09537732fec10c7d0b&amp;aliyunols=on&amp;lhs_start_human_s_8=20200304213010&amp;lhs_end_human_s_8=20200304213510" target="_blank" rel="noopener">https://gehua-edu-broadcast.beijingcloud.com.cn/app-ghedu/stream-ghedu.m3u8?auth_key=1591973719-0-0-0870ae5e5e1fee09537732fec10c7d0b&amp;aliyunols=on&amp;lhs_start_human_s_8=20200304213010&amp;lhs_end_human_s_8=20200304213510</a></p>
<ol start="2">
<li>offset向前偏移，会直到直播结束</li>
</ol>
<p>例：<a href="https://gehua-edu-broadcast.beijingcloud.com.cn/app-ghedu/stream-ghedu.m3u8?auth_key=1591973719-0-0-0870ae5e5e1fee09537732fec10c7d0b&amp;aliyunols=on&amp;lhs_offset_unix_s_0=60" target="_blank" rel="noopener">https://gehua-edu-broadcast.beijingcloud.com.cn/app-ghedu/stream-ghedu.m3u8?auth_key=1591973719-0-0-0870ae5e5e1fee09537732fec10c7d0b&amp;aliyunols=on&amp;lhs_offset_unix_s_0=60</a></p>
<p>这个是相对时间的位移，表示从当前时刻前60s开始播放。</p>
<ol start="3">
<li>只有start，也会到直播结束。</li>
</ol>
<p>例：<a href="https://gehua-edu-broadcast.beijingcloud.com.cn/app-ghedu/stream-ghedu.m3u8?auth_key=1591973719-0-0-0870ae5e5e1fee09537732fec10c7d0b&amp;aliyunols=on&amp;lhs_start_human_s_8=20200304231510" target="_blank" rel="noopener">https://gehua-edu-broadcast.beijingcloud.com.cn/app-ghedu/stream-ghedu.m3u8?auth_key=1591973719-0-0-0870ae5e5e1fee09537732fec10c7d0b&amp;aliyunols=on&amp;lhs_start_human_s_8=20200304231510</a></p>
<p>这个是绝对时间的位移，表示从20200304231510时刻开始播放。</p>
<ol start="4">
<li>不要live的话，可以选择start和vodend组合。这会返回完整的ts列表的</li>
</ol>
<p>例：<a href="https://gehua-edu-broadcast.beijingcloud.com.cn/app-ghedu/stream-ghedu.m3u8?auth_key=1591973719-0-0-0870ae5e5e1fee09537732fec10c7d0b&amp;aliyunols=on&amp;lhs_start_human_s_8=20200304231610&amp;lhs_vodend_human_s_8=20200304231810" target="_blank" rel="noopener">https://gehua-edu-broadcast.beijingcloud.com.cn/app-ghedu/stream-ghedu.m3u8?auth_key=1591973719-0-0-0870ae5e5e1fee09537732fec10c7d0b&amp;aliyunols=on&amp;lhs_start_human_s_8=20200304231610&amp;lhs_vodend_human_s_8=20200304231810</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/03/阿里云ECS主机使用curl命令访问URL异常/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/03/03/阿里云ECS主机使用curl命令访问URL异常/" itemprop="url">
                  阿里云ECS主机使用curl命令访问URL异常
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-03-03 19:39:24" itemprop="dateCreated datePublished" datetime="2020-03-03T19:39:24+08:00">2020-03-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/阿里云/" itemprop="url" rel="index"><span itemprop="name">阿里云</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>用户使用阿里云ECS主机，通过阿里NAT服务联网，当使用<code>curl --location --request GET &#39;http://chygdxw.cn/gehua/2020/02/19/C7C4F31F-B4DD-41DE-9964-2EF967FFA7C9_SDV_0.mp4&#39;</code>会提示：Recv failure: Connection reset by peer。使用一台绑定弹性公网IP的主机访问正常</p>
<h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><p>阿里帮助解决，原因为：对端（指服务端）有发送分片报文，SNAT（指阿里NAT服务）是不支持IP分片包的，因为没法对他进行五元组（指源IP、源端口、协议、目标IP、目标端口）的分类，映射到session上，EIP没有session，所以会有问题。NAT网关的SNAT不支持IP分片。需要服务端发送完整的报文。分片报文是到目标才进行重组，但是经过snat，后端有多个ECS，无法到达准确的ECS。所谓分片就是将一个报文分片成2个或多个报文发送。比较明显的特点是分片的报文的源目端口是缺少的，只有在最后一个分片上才有源目端口</p>
<p><img src="/images/ali分片报文发送/分片报文发送1.png" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/26/转：使用-tmux-创建你的梦想主控台/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/26/转：使用-tmux-创建你的梦想主控台/" itemprop="url">
                  转：使用 tmux 创建你的梦想主控台
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-02-26 22:39:53" itemprop="dateCreated datePublished" datetime="2020-02-26T22:39:53+08:00">2020-02-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/基础/" itemprop="url" rel="index"><span itemprop="name">基础</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用-tmux-创建你的梦想主控台"><a href="#使用-tmux-创建你的梦想主控台" class="headerlink" title="使用 tmux 创建你的梦想主控台"></a>使用 tmux 创建你的梦想主控台</h1><p>原文：<a href="https://linux.cn/article-11900-1.html" target="_blank" rel="noopener">https://linux.cn/article-11900-1.html</a></p>
<p>作者：<a href="https://opensource.com/article/20/1/tmux-console" target="_blank" rel="noopener">Kevin Sonney</a></p>
<p>译者： <a href="https://linux.cn/lctt/" target="_blank" rel="noopener">LCTT</a> <a href="https://linux.cn/lctt/wxy" target="_blank" rel="noopener">Xingyu.Wang</a></p>
<p>| 2020-02-16 22:08      </p>
<blockquote>
<p>使用 tmux 可以做很多事情，尤其是在将 tmuxinator 添加到其中时。在我们的二十篇系列文章的第十五期中查看它们，以在 2020 年实现开源生产力的提高。</p>
</blockquote>
<p>去年，我在 19 天里给你介绍了 19 个新（对你而言）的生产力工具。今年，我换了一种方式：使用你在使用或者还没使用的工具，构建一个使你可以在新一年更加高效的环境。</p>
<h3 id="使用-tmux-和-tmuxinator-全部放到主控台上"><a href="#使用-tmux-和-tmuxinator-全部放到主控台上" class="headerlink" title="使用 tmux 和 tmuxinator 全部放到主控台上"></a>使用 tmux 和 tmuxinator 全部放到主控台上</h3><p>到目前为止，在本系列文章中，我已经撰写了有关单个应用程序和工具的文章。从今天开始，我将把它们放在一起进行全面设置以简化操作。让我们从命令行开始。为什么使用命令行？简而言之，在命令行上工作可以使我能够从运行 SSH 的任何位置访问许多这些工具和功能。我可以 SSH 进入我的一台个人计算机，并在工作计算机上运行与我的个人计算机上所使用的相同设置。我要使用的主要工具是 <a href="https://github.com/tmux/tmux" target="_blank" rel="noopener">tmux</a>。</p>
<p>大多数人都只使用了 tmux 非常基础的功能，比如说在远程服务器上打开 tmux，然后启动进程，也许还会打开第二个会话以查看日志文件或调试信息，然后断开连接并在稍后返回。但是其实你可以使用 tmux 做很多工作。</p>
<p><img src="/images/tmux/tmux1.png" alt=""></p>
<p><em>tmux</em></p>
<p>首先，如果你有一个已有的 tmux 配置文件，请对其进行备份。tmux 的配置文件是 <code>~/.tmux.conf</code>。将其移动到另一个目录，例如 <code>~/tmp</code>。现在，用 Git 克隆 <a href="https://github.com/gpakosz/.tmux" target="_blank" rel="noopener">Oh My Tmux</a> 项目。从该克隆目录中将 <code>.tmux.conf</code> 符号链接到你的家目录，并复制该克隆目录中的 <code>.tmux.conf.local</code> 文件到家目录中以进行调整：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">mkdir ~/tmp</span><br><span class="line">mv ~/<span class="selector-class">.tmux</span><span class="selector-class">.conf</span> ~/tmp/</span><br><span class="line">git clone https:<span class="comment">//github.com/gpakosz/.tmux.git</span></span><br><span class="line">ln -s ~/.tmux/<span class="selector-class">.tmux</span><span class="selector-class">.conf</span> ./</span><br><span class="line">cp ~/.tmux/<span class="selector-class">.tmux</span><span class="selector-class">.conf</span><span class="selector-class">.local</span> ./</span><br></pre></td></tr></table></figure>
<p><code>.tmux.conf.local</code> 文件包含了本地设置和覆盖的设置。例如，我稍微更改了默认颜色，然后启用了 <a href="https://github.com/powerline/powerline" target="_blank" rel="noopener">Powerline</a> 分隔线。下面的代码段仅显示了我更改过的内容：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tmux_conf_theme_24b_colour</span>=<span class="literal">true</span></span><br><span class="line"><span class="attribute">tmux_conf_theme_focused_pane_bg</span>=<span class="string">'default'</span></span><br><span class="line"><span class="attribute">tmux_conf_theme_pane_border_style</span>=fat</span><br><span class="line"><span class="attribute">tmux_conf_theme_left_separator_main</span>=<span class="string">'\uE0B0'</span></span><br><span class="line"><span class="attribute">tmux_conf_theme_left_separator_sub</span>=<span class="string">'\uE0B1'</span></span><br><span class="line"><span class="attribute">tmux_conf_theme_right_separator_main</span>=<span class="string">'\uE0B2'</span></span><br><span class="line"><span class="attribute">tmux_conf_theme_right_separator_sub</span>=<span class="string">'\uE0B3'</span></span><br><span class="line"><span class="comment">#tmux_conf_battery_bar_symbol_full='◼'</span></span><br><span class="line"><span class="comment">#tmux_conf_battery_bar_symbol_empty='◻'</span></span><br><span class="line"><span class="attribute">tmux_conf_battery_bar_symbol_full</span>=<span class="string">'♥'</span></span><br><span class="line"><span class="attribute">tmux_conf_battery_bar_symbol_empty</span>=<span class="string">'·'</span></span><br><span class="line"><span class="attribute">tmux_conf_copy_to_os_clipboard</span>=<span class="literal">true</span></span><br><span class="line"><span class="builtin-name">set</span> -g mouse on</span><br></pre></td></tr></table></figure>
<p>请注意，你不需要安装 Powerline，你只需要支持 Powerline 符号的字体即可。我在与控制台相关的所有内容中几乎都使用 <a href="https://www.nerdfonts.com/" target="_blank" rel="noopener">Hack Nerd Font</a>，因为它易于阅读并且具有许多有用的额外符号。你还会注意到，我打开了操作系统剪贴板支持和鼠标支持。</p>
<p>现在，当 tmux 启动时，底部的状态栏会以吸引人的颜色提供更多信息。<code>Ctrl</code> + <code>b</code> 仍然是输入命令的 “引导” 键，但其他一些进行了更改。现在水平拆分（顶部/底部）窗格为 <code>Ctrl</code> + <code>b</code> + <code>-</code>，垂直拆分为 <code>Ctrl</code> + <code>b</code> + <code>_</code>。启用鼠标模式后，你可以单击以在窗格之间切换，并拖动分隔线以调整其大小。打开新窗口仍然是 <code>Ctrl</code> + <code>b</code> + <code>n</code>，你现在可以单击底部栏上的窗口名称在它们之间进行切换。同样，<code>Ctrl</code> + <code>b</code> + <code>e</code> 将打开 <code>.tmux.conf.local</code> 文件以进行编辑。退出编辑器时，tmux 将重新加载配置，而不会重新加载其他任何内容。这很有用。</p>
<p>到目前为止，我仅对功能和视觉显示进行了一些简单的更改，并增加了鼠标支持。现在，我将它设置为以一种有意义的方式启动我想要的应用程序，而不必每次都重新定位和调整它们的大小。为此，我将使用 <a href="https://github.com/tmuxinator/tmuxinator" target="_blank" rel="noopener">tmuxinator</a>。tmuxinator 是 tmux 的启动器，它允许你指定和管理布局以及使用 YAML 文件自动启动应用程序。要使用它，请启动 tmux 并创建要在其中运行程序的窗格。然后，使用 <code>Ctrl</code> + <code>b</code> + <code>n</code> 打开一个新窗口，并执行 <code>tmux list-windows</code>。你将获得有关布局的详细信息。</p>
<p><img src="/images/tmux/tmux4.png" alt=""></p>
<p><em>tmux layout information</em></p>
<p>请注意上面代码中的第一行，我在其中设置了四个窗格，每个窗格中都有一个应用程序。保存运行时的输出以供以后使用。现在，运行 <code>tmuxinator new 20days</code> 以创建名为 “20days” 的布局。这将显示一个带有默认布局文件的文本编辑器。它包含很多有用的内容，我建议你阅读所有选项。首先输入上方的布局信息以及所需的应用程序：</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># /Users/ksonney/.config/tmuxinator/20days.yml</span><br><span class="line">name: 20days</span><br><span class="line">root: ~/</span><br><span class="line">windows:</span><br><span class="line">	-<span class="ruby"> <span class="symbol">mail:</span>      </span></span><br><span class="line"><span class="ruby">	   <span class="symbol">layout:</span> d9da,<span class="number">208</span>x6<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>[<span class="number">208</span>x26,<span class="number">0</span>,<span class="number">0</span>&#123;<span class="number">104</span>x26,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">103</span>x26,<span class="number">105</span>,<span class="number">0</span>,<span class="number">5</span>&#125;,<span class="number">208</span>x33,<span class="number">0</span>,<span class="number">27</span>&#123;<span class="number">104</span>x33,<span class="number">0</span>,<span class="number">27</span>,<span class="number">1</span>,<span class="number">103</span>x33,<span class="number">105</span>,<span class="number">27</span>,<span class="number">4</span>&#125;]] @0      </span></span><br><span class="line"><span class="ruby">	   <span class="symbol">panes:</span>        </span></span><br><span class="line"><span class="ruby">	      - alot        </span></span><br><span class="line"><span class="ruby">	      - abook        </span></span><br><span class="line"><span class="ruby">	      - ikhal        </span></span><br><span class="line"><span class="ruby">	      - todo.sh ls +<span class="number">20</span>days</span></span><br></pre></td></tr></table></figure>
<p>注意空格缩进！与 Python 代码一样，空格和缩进关系到文件的解释方式。保存该文件，然后运行 <code>tmuxinator 20days</code>。你应该会得到四个窗格，分别是 <a href="https://opensource.com/article/20/1/organize-email-notmuch" target="_blank" rel="noopener">alot</a> 邮件程序、<a href="https://opensource.com/article/20/1/sync-contacts-locally" target="_blank" rel="noopener">abook</a>、ikhal（交互式 <a href="https://opensource.com/article/20/1/open-source-calendar" target="_blank" rel="noopener">khal</a> 的快捷方式）以及 <a href="https://opensource.com/article/20/1/open-source-to-do-list" target="_blank" rel="noopener">todo.txt</a> 中带有 “+20days” 标签的任何内容。</p>
<p><img src="/images/tmux/tmux6.png" alt=""></p>
<p><em>sample layout launched by tmuxinator</em></p>
<p>你还会注意到，底部栏上的窗口标记为 “Mail”。你可以单击该名称（以及其他命名的窗口）以跳到该视图。漂亮吧？我在同一个文件中还设置了名为 “Social” 的第二个窗口，包括 <a href="https://opensource.com/article/20/1/open-source-reddit-client" target="_blank" rel="noopener">Tuir</a>、<a href="https://opensource.com/article/20/1/open-source-rss-feed-reader" target="_blank" rel="noopener">Newsboat</a>、连接到 <a href="https://opensource.com/article/20/1/open-source-chat-tool" target="_blank" rel="noopener">BitlBee</a> 的 IRC 客户端和 <a href="https://opensource.com/article/20/1/tweet-terminal-rainbow-stream" target="_blank" rel="noopener">Rainbow Stream</a>。</p>
<p>tmux 是我跟踪所有事情的生产力动力之源，有了 tmuxinator，我不必在不断调整大小、放置和启动我的应用程序上费心。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/24/Kafka-Eagle使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/24/Kafka-Eagle使用/" itemprop="url">
                  Kafka Eagle使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-02-24 19:32:56" itemprop="dateCreated datePublished" datetime="2020-02-24T19:32:56+08:00">2020-02-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/消息队列/" itemprop="url" rel="index"><span itemprop="name">消息队列</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>Kafka Eagle为kafka集群监控第三方工具</p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">下载地址：http://download.kafka-eagle.org/，选择Direct File Download下载即可。</span><br><span class="line">wget https://github.com/smartloli/kafka-eagle-bin/archive/v1.4.4.tar.gz</span><br><span class="line">tar xf v1.4.4.tar.gz</span><br><span class="line">mv kafka-eagle-bin-1.4.4/kafka-eagle-web-1.4.4-bin.tar.gz ./</span><br><span class="line">tar xf kafka-eagle-web-1.4.4-bin.tar.gz -C /usr/local</span><br><span class="line">cd /usr/local/</span><br><span class="line">ln -sv kafka-eagle-web-1.4.4/ kafka-eagle</span><br><span class="line">cd kafka-eagle</span><br><span class="line">vim conf/system-config.properties</span><br><span class="line">kafka.eagle.zk.cluster.alias=cluster1,cluster2 # 集群别名，为下面配置使用。多个集群用逗号分隔</span><br><span class="line">cluster1.zk.list=dc-kafka01:2181,dc-kafka02:2181,dc-kafka03:2181 # zookeeper地址</span><br><span class="line">cluster2.zk.list=dc-control01:2181,dc-control02:2181,dc-control03:2181</span><br><span class="line">cluster1.kafka.eagle.broker.size=20</span><br><span class="line">cluster2.kafka.eagle.broker.size=20</span><br><span class="line">kafka.zk.limit.size=25  # 	Kafka Eagle Zookeeper客户端的最大连接数。</span><br><span class="line">kafka.eagle.webui.port=8048  # 监听端口</span><br><span class="line">cluster1.kafka.eagle.offset.storage=kafka</span><br><span class="line">cluster2.kafka.eagle.offset.storage=kafka</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里如果是zk，表示存储在zookeeper中的Kafka偏移量。如果是kafka，表示存储在kafka主题中的Kafka偏移量。</span></span><br><span class="line">kafka.eagle.metrics.charts=true # 启用监控趋势图</span><br><span class="line">kafka.eagle.metrics.retain=30</span><br><span class="line">kafka.eagle.sql.topic.records.max=5000</span><br><span class="line">kafka.eagle.sql.fix.error=true</span><br><span class="line">kafka.eagle.topic.token=keadmin</span><br><span class="line">cluster1.kafka.eagle.sasl.enable=false</span><br><span class="line">cluster1.kafka.eagle.sasl.protocol=SASL_PLAINTEXT</span><br><span class="line">cluster1.kafka.eagle.sasl.mechanism=PLAIN</span><br><span class="line">cluster2.kafka.eagle.sasl.enable=false</span><br><span class="line">cluster2.kafka.eagle.sasl.protocol=SASL_PLAINTEXT</span><br><span class="line">cluster2.kafka.eagle.sasl.mechanism=PLAIN</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试发现，可以不加集群的别名。直接使用kafka.eagle.sasl.enable，也就是去掉前面的别名，这样只写三行就可以了。</span></span><br><span class="line">kafka.eagle.driver=org.sqlite.JDBC</span><br><span class="line">kafka.eagle.url=jdbc:sqlite:/usr/local/kafka-eagle/db/ke.db</span><br><span class="line">kafka.eagle.username=root</span><br><span class="line">kafka.eagle.password=centos</span><br><span class="line"><span class="meta">#</span><span class="bash"> 参考：https://blog.csdn.net/qq_33696779/article/details/88655560</span></span><br><span class="line"></span><br><span class="line">yum install -y java-1.8.0-openjdk-devel.x86_64 </span><br><span class="line">vim /etc/profile</span><br><span class="line">export KE_HOME=/usr/local/kafka-eagle</span><br><span class="line">export JAVA_HOME=/usr</span><br><span class="line">. /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装java，设置环境变量</span></span><br><span class="line">cd /usr/local/kafka-eagle/bin/</span><br><span class="line">chmod +x ke.sh</span><br><span class="line">./ke.sh start</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动kafka-eagle就是安装，如果没有问题，会提示登录地址与登录用户名和密码</span></span><br></pre></td></tr></table></figure>
<p>查看消息堆积数</p>
<p><img src="/images/kafka-eagle/消息堆积查看1.png" alt=""></p>
<p><img src="/images/kafka-eagle/消息堆积查看2.png" alt=""></p>
<p>大屏查看</p>
<p><img src="/images/kafka-eagle/大屏1.png" alt=""></p>
<p><img src="/images/kafka-eagle/大屏2.png" alt=""></p>
<p>切换不同集群</p>
<p><img src="/images/kafka-eagle/集群切换.png" alt=""></p>
<p>或者在首页的右上角也可以调整</p>
<p><img src="/images/kafka-eagle/集群切换2.png" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/21/zabbix自定义脚本监控/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/21/zabbix自定义脚本监控/" itemprop="url">
                  zabbix自定义脚本监控
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-02-21 16:48:37" itemprop="dateCreated datePublished" datetime="2020-02-21T16:48:37+08:00">2020-02-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/监控/" itemprop="url" rel="index"><span itemprop="name">监控</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Zabbix-Server中运行脚本"><a href="#Zabbix-Server中运行脚本" class="headerlink" title="Zabbix Server中运行脚本"></a>Zabbix Server中运行脚本</h4><p>在实际环境中，你可能无法在监控设备中安装标准的Zabbix agent收集监控数据，通过Externalchecks监控方式，可以在Zabbix server上执行脚本或二进制程序收集监控数据。</p>
<p>在使用这种方式前，需要在zabbix-server.conf配置文件中定义脚本或程序的路径，设置正确的权限能够让Zabbix执行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/zabbix/zabbix-server.conf</span><br><span class="line">ExternalScripts=/usr/lib/zabbix/externalscripts</span><br></pre></td></tr></table></figure>
<p>ExternalScripts 可以使用系统标准的路径，你也可以指定其他路径。在这里我们可以把脚本或程序放在这里，并设置相应的权限。</p>
<p>使用External checks时需要注意以下几点：</p>
<ul>
<li>在Key语法中支持多个逗号分隔的参数。</li>
<li>在脚本命令中支持用户定义的宏变量。</li>
<li>External checks通过标准输出（STDOUT）将错误返回，可以在触发器中进行管理。</li>
<li>支持多行的返回值。</li>
</ul>
<p>通过External checks可以完成很复杂的监控任务，但是在实际环境中使用时要注意服务器性能的问题，每一次脚本执行时需要Zabbix server启动一个进程，当有很多脚本运行时会降低Zabbix server的性能。</p>
<h4 id="Zabbix-agent中运行脚本"><a href="#Zabbix-agent中运行脚本" class="headerlink" title="Zabbix agent中运行脚本"></a>Zabbix agent中运行脚本</h4><p>UserParameter是在agent配置文件中定义的。语法如下：</p>
<p><code>UserParameter=&lt;key&gt;,&lt;command&gt;</code></p>
<p>User parameter由两部分组成，一部分是Key，在这里定义的Key在Zabbix server前端页面中创建item时会用到，并且在引用这个Key的主机中名称必须是唯一的，Key的名称中我们可以使用点或下划线，但不能有空格或其他特殊字符。另一部分是command，是一个可执行的命令或脚本。</p>
<p>在User parameter中定义key时，我们也可以设定参数，这些参数可以传递给命令或脚本。语法是：</p>
<p><code>UserParameter=key[*],command</code></p>
<p>[<em>]表示可以传递多个参数，对应[</em>]中参数的位置，在command中可以使用$1,$2,$3 …$9来引用参数，$0代表command本身。如果在使用的命令行中引用$2这种参数，那就需要变成$$2，例如：awk ‘{print $$2}’，在这种情况下$$2实际上引用的是$2参数。另外，像$2这些参数你即使用双引号（”）或单引号（‘）括起来，它也会正常解析相应位置的参数。在监控页面定义监控项的名字时也可以用$1…$9引用这里的参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">UserParameter=ping,echo 1</span><br><span class="line">总是返回1。</span><br><span class="line"></span><br><span class="line">UserParameter=ping[*],echo $1</span><br><span class="line">ping[0] 将返回 '0'；ping[aaa] 将返回 'aaa'。</span><br><span class="line"></span><br><span class="line">UserParameter=mysql.ping,mysqladmin–uroot -p&lt;password&gt; ping | grep -c alive</span><br><span class="line">如果MySQL运行正常返回1，否则返回0。</span><br><span class="line"></span><br><span class="line">UserParameter=mysql.ping[*],mysqladmin-u$1 -p$2 ping | grep -c alive</span><br><span class="line">mysql.ping[zabbix,our_password] 会把用户名和密码传递到命令行中参数引用的位置。</span><br><span class="line"></span><br><span class="line">UserParameter=wc[*],grep -c"$2" $1</span><br><span class="line">wc[/etc/services,zabbix]，计算在services文件中包含zabbix的行数，在这里$2用双引号括起来后，在命令行中还是会正确引用相应位置的参数。</span><br></pre></td></tr></table></figure>
<p>通常的做法是：</p>
<ol>
<li>编辑zabbix_agentd.conf配置文件，配置UserParameter选项。比如：</li>
</ol>
<p><code>UserParameter= process.number[*], ps -e |grep $1 | wc -l</code></p>
<ol start="2">
<li>使用zabbix-agentd -t 测试定义的UserParameter</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zabbix_agentd -t process.number[httpd]</span><br><span class="line"></span><br><span class="line">process.number                     [t|8]</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>保存agent 配置文件，重启agent.</li>
</ol>
<p><code>systemctl restart zabbix-agent.service</code></p>
<ol start="4">
<li>使用zabbix_get工具测试：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zabbix_get -s 127.0.0.1 -k process.number[httpd]</span><br><span class="line">8</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>在Zabbix server中的主机上创建一个新的监控项。类型可以是Zabbix agent或者Zabbix agent（active）。</li>
</ol>
<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/21/python基础学习-函数学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/21/python基础学习-函数学习/" itemprop="url">
                  python基础学习-函数学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-02-21 14:19:36" itemprop="dateCreated datePublished" datetime="2020-02-21T14:19:36+08:00">2020-02-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">map是python内置函数，会根据提供的函数对指定的序列做映射。</span><br><span class="line">map()函数的格式是：</span><br><span class="line">map(function,iterable,...)</span><br><span class="line"><span class="comment"># 第一个参数接受一个函数名，后面的参数接受一个或多个可迭代的序列，返回的是一个元组。</span></span><br><span class="line"></span><br><span class="line">把函数依次作用在iterable中的每一个元素上，得到一个新的元组并返回。注意，map不改变原iterable，而是返回一个新元组。</span><br><span class="line"></span><br><span class="line">***map()函数实例***</span><br><span class="line"><span class="keyword">del</span> square(x):</span><br><span class="line">    <span class="keyword">return</span> x ** <span class="number">2</span></span><br><span class="line">map(square,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"><span class="comment"># 结果如下:</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">16</span>,<span class="number">25</span>]</span><br><span class="line"></span><br><span class="line">通过使用<span class="keyword">lambda</span>匿名函数的方法使用map()函数：</span><br><span class="line">map(<span class="keyword">lambda</span> x, y: x+y,[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>],[<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>])</span><br><span class="line"><span class="comment"># 结果如下：</span></span><br><span class="line">[<span class="number">3</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">19</span>]</span><br><span class="line"></span><br><span class="line">通过<span class="keyword">lambda</span>函数使返回值是一个元组：</span><br><span class="line">map(lambdax, y : (x**y,x+y),[<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>],[<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 结果如下</span></span><br><span class="line">[(<span class="number">8</span>,<span class="number">5</span>),(<span class="number">16</span>,<span class="number">6</span>),(<span class="number">6</span>,<span class="number">7</span>)]</span><br><span class="line"></span><br><span class="line">当不传入function时，map()就等同于zip()，将多个列表相同位置的元素归并到一个元组：</span><br><span class="line">map(<span class="keyword">None</span>,[<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>],[<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 结果如下</span></span><br><span class="line">[(<span class="number">2</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">2</span>),(<span class="number">6</span>,<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">通过map还可以实现类型转换</span><br><span class="line">将元组转换为list：</span><br><span class="line">map(int,(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"><span class="comment"># 结果如下：</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">将字符串转换为list：</span><br><span class="line">map(int,<span class="string">'1234'</span>)</span><br><span class="line"><span class="comment"># 结果如下：</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">提取字典中的key，并将结果放在一个list中：</span><br><span class="line">map(int,&#123;<span class="number">1</span>:<span class="number">2</span>,<span class="number">2</span>:<span class="number">3</span>,<span class="number">3</span>:<span class="number">4</span>&#125;)</span><br><span class="line"><span class="comment"># 结果如下</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">zip() 函数用于将可迭代的对象作为参数，将对象中对应的元素打包成一个个元组，然后返回由这些元组组成的列表。</span><br><span class="line">如果各个迭代器的元素个数不一致，则返回列表长度与最短的对象相同，利用 * 号操作符，可以将元组解压为列表。</span><br><span class="line">zip 语法：</span><br><span class="line">zip([iterable, ...])</span><br><span class="line"></span><br><span class="line">***实例***</span><br><span class="line">l1=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">lt2=[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">lt3=zip(l1,lt2)</span><br><span class="line"><span class="comment">#zip()是可迭代对象，使用时必须将其包含在一个list中，方便一次性显示出所有结果</span></span><br><span class="line"><span class="comment">#print(lt3)</span></span><br><span class="line"><span class="comment">#print(list(lt3))</span></span><br><span class="line"><span class="comment">#print(dict(lt3))</span></span><br><span class="line"></span><br><span class="line">lt4=[<span class="string">'dd'</span>,<span class="string">'18'</span>,<span class="string">'183'</span>]</span><br><span class="line">lt5=[<span class="string">'name'</span>,<span class="string">'age'</span>,<span class="string">'height'</span>]</span><br><span class="line">a=zip(lt5,lt4)</span><br><span class="line">print(dict(a))</span><br><span class="line"><span class="comment">#zip()参数可以接受任何类型的序列，同时也可以有两个以上的参数;</span></span><br><span class="line"><span class="comment"># 当传入参数的长度不同时，zip能自动以最短序列长度为准进行截取</span></span><br><span class="line"></span><br><span class="line">l1, l2, l3 = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>), (<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>)</span><br><span class="line">print(list(zip(l1, l2, l3)))</span><br><span class="line">[(<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>), (<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>), (<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>)]</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">'abc'</span></span><br><span class="line">str2 = <span class="string">'def123'</span></span><br><span class="line">print(list(zip(str1, str2)))</span><br><span class="line">[(<span class="string">'a'</span>, <span class="string">'d'</span>), (<span class="string">'b'</span>, <span class="string">'e'</span>), (<span class="string">'c'</span>, <span class="string">'f'</span>)]</span><br><span class="line"></span><br><span class="line">l1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">l2 = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">l3 = zip(l1, l2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> l3:</span><br><span class="line">print(<span class="string">'for循环&#123;&#125;'</span>.format(i))</span><br><span class="line"></span><br><span class="line">l4 = [x <span class="keyword">for</span> x <span class="keyword">in</span> l3]</span><br><span class="line">print(l4)</span><br><span class="line"><span class="comment"># 因为zip返回的是迭代器，所以上面执行过循环后，这里再使用列表生成式，生成的是空列表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">l1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">l2 = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">l3 = zip(l1, l2)</span><br><span class="line"></span><br><span class="line">l4 = [x <span class="keyword">for</span> x <span class="keyword">in</span> l3]</span><br><span class="line">print(l4)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> l3:</span><br><span class="line">print(<span class="string">'for循环&#123;&#125;'</span>.format(i))</span><br><span class="line"><span class="comment">###for循环没执行，因为迭代器已经到头了</span></span><br><span class="line"><span class="comment">##Return a zip object whose .__next__() method returns a tuple where</span></span><br><span class="line"><span class="comment"># the i-th element comes from the i-th iterable argument. The .__next__()</span></span><br><span class="line"><span class="comment"># method continues until the shortest iterable in the argument sequence</span></span><br><span class="line"><span class="comment"># is exhausted and then it raises StopIteration.</span></span><br><span class="line"><span class="comment"># 返回一个zip对象，其中.__next__()方法返回一个元组</span></span><br><span class="line"><span class="comment"># 第i个元素来自第i个可迭代参数。.__next__()</span></span><br><span class="line"><span class="comment"># 方法继续执行，直到参数序列中最短的可迭代</span></span><br><span class="line"><span class="comment"># 耗尽，然后引发StopIteration。</span></span><br><span class="line"><span class="comment">#重点就是这个 “zip对象” 是一个迭代器。 迭代器只能前进，不能后退</span></span><br><span class="line"><span class="comment">#它空了，所以没有执行，空的东西怎么遍历</span></span><br></pre></td></tr></table></figure>
<h4 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dict() 函数用于创建一个字典。</span><br><span class="line">dict 语法：</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dict</span><span class="params">(**kwarg)</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">dict</span><span class="params">(mapping, **kwarg)</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">dict</span><span class="params">(iterable, **kwarg)</span></span></span><br><span class="line"><span class="class">参数说明：</span></span><br><span class="line"><span class="class">**<span class="title">kwargs</span> -- 关键字</span></span><br><span class="line"><span class="class"><span class="title">mapping</span> -- 元素的容器。</span></span><br><span class="line"><span class="class"><span class="title">iterable</span> -- 可迭代对象。</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">***实例***</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&gt;&gt;&gt;<span class="title">dict</span><span class="params">()</span>                        # 创建空字典</span></span><br><span class="line">&#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict(a=<span class="string">'a'</span>, b=<span class="string">'b'</span>, t=<span class="string">'t'</span>)     <span class="comment"># 传入关键字</span></span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="string">'a'</span>, <span class="string">'b'</span>: <span class="string">'b'</span>, <span class="string">'t'</span>: <span class="string">'t'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict(zip([<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))   <span class="comment"># 映射函数方式来构造字典</span></span><br><span class="line">&#123;<span class="string">'three'</span>: <span class="number">3</span>, <span class="string">'two'</span>: <span class="number">2</span>, <span class="string">'one'</span>: <span class="number">1</span>&#125; </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dict([(<span class="string">'one'</span>, <span class="number">1</span>), (<span class="string">'two'</span>, <span class="number">2</span>), (<span class="string">'three'</span>, <span class="number">3</span>)])    <span class="comment"># 可迭代对象方式来构造字典</span></span><br><span class="line">&#123;<span class="string">'three'</span>: <span class="number">3</span>, <span class="string">'two'</span>: <span class="number">2</span>, <span class="string">'one'</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/18/aria2安装及配置webui/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/18/aria2安装及配置webui/" itemprop="url">
                  aria2安装及配置webui
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-02-18 23:26:21" itemprop="dateCreated datePublished" datetime="2020-02-18T23:26:21+08:00">2020-02-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/网络/" itemprop="url" rel="index"><span itemprop="name">网络</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install aria2 nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装aria2与web服务器</span></span><br><span class="line">到https://github.com/ziahamza/webui-aria2下载整个项目，解压后将其中的docs文档放到/var/www/html目录下，改名为webui</span><br></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/aria2</span><br><span class="line">vim /etc/aria2/aria2.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置的RPC授权令牌, 取代 --rpc-user 和 --rpc-passwd 选项</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> token可以自己随意设置</span></span><br><span class="line">rpc-secret=44a70bf2-token93c6-96359e3e53ee</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下面是ssl证书，可以先不管</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-private-key=/etc/aria2/server.key</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-certificate=/etc/aria2/server.crt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">允许rpc</span></span><br><span class="line">enable-rpc=true</span><br><span class="line"><span class="meta">#</span><span class="bash">允许所有来源, web界面跨域权限需要</span></span><br><span class="line">rpc-allow-origin-all=true</span><br><span class="line"><span class="meta">#</span><span class="bash">允许外部访问，<span class="literal">false</span>的话只监听本地端口</span></span><br><span class="line">rpc-listen-all=true</span><br><span class="line"><span class="meta">#</span><span class="bash">RPC端口, 仅当默认端口被占用时修改</span></span><br><span class="line">rpc-listen-port=6800</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">文件保存路径, 默认为当前启动位置</span></span><br><span class="line">dir=/root/downloads</span><br><span class="line"><span class="meta">#</span><span class="bash">从会话文件中读取下载任务</span></span><br><span class="line">input-file=/etc/aria2/aria2.session</span><br><span class="line"><span class="meta">#</span><span class="bash">在Aria2退出时保存`错误/未完成`的下载任务到会话文件</span></span><br><span class="line">save-session=/etc/aria2/aria2.session</span><br><span class="line"><span class="meta">#</span><span class="bash">定时保存会话, 0为退出时才保存, 需1.16.1以上版本, 默认:0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">save-session-interval=60</span></span><br><span class="line">force-save=true</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">log</span>=/aria2log</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">log</span>-level=error</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">最大同时下载数(任务数), 路由建议值: 3</span></span><br><span class="line">max-concurrent-downloads=5</span><br><span class="line"><span class="meta">#</span><span class="bash">断点续传</span></span><br><span class="line">continue=true</span><br><span class="line"><span class="meta">#</span><span class="bash">同服务器连接数</span></span><br><span class="line">max-connection-per-server=5</span><br><span class="line"><span class="meta">#</span><span class="bash">最小文件分片大小, 下载线程数上限取决于能分出多少片, 对于小文件重要</span></span><br><span class="line">min-split-size=10M</span><br><span class="line"><span class="meta">#</span><span class="bash">单文件最大线程数, 路由建议值: 5</span></span><br><span class="line">split=10</span><br><span class="line"><span class="meta">#</span><span class="bash">下载速度限制</span></span><br><span class="line">max-overall-download-limit=0</span><br><span class="line"><span class="meta">#</span><span class="bash">单文件速度限制</span></span><br><span class="line">max-download-limit=0</span><br><span class="line"><span class="meta">#</span><span class="bash">上传速度限制</span></span><br><span class="line">max-overall-upload-limit=0</span><br><span class="line"><span class="meta">#</span><span class="bash">单文件速度限制</span></span><br><span class="line">max-upload-limit=0</span><br><span class="line"><span class="meta">#</span><span class="bash">断开速度过慢的连接</span></span><br><span class="line"><span class="meta">#</span><span class="bash">lowest-speed-limit=0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">文件缓存, 使用内置的文件缓存, 如果你不相信Linux内核文件缓存和磁盘内置缓存时使用, 需要1.16及以上版本</span></span><br><span class="line"><span class="meta">#</span><span class="bash">disk-cache=0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">另一种Linux文件缓存方式, 使用前确保您使用的内核支持此选项, 需要1.15及以上版本(?)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">enable</span>-mmap=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">文件预分配, 能有效降低文件碎片, 提高磁盘性能. 缺点是预分配时间较长</span></span><br><span class="line"><span class="meta">#</span><span class="bash">NTFS建议使用falloc, EXT3/4建议trunc, MAC 下需要注释此项所需时间 </span></span><br><span class="line"><span class="meta">#</span><span class="bash">none &lt; falloc ? trunc &lt;&lt; prealloc, falloc和trunc需要文件系统和内核支持</span></span><br><span class="line">file-allocation=prealloc</span><br><span class="line"></span><br><span class="line">aria2c --conf-path=/etc/aria2/aria2.conf -D</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在后台启动，这会监听6800端口，如果启动失败，可以去掉-D选项查看原因。一般为配置文件中的某些路径没有创建所至</span></span><br><span class="line">systemctl start nginx</span><br><span class="line">访问http://IP/webui就可以看到图形界面了</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/10/转：一文精通-crontab从入门到出坑/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/10/转：一文精通-crontab从入门到出坑/" itemprop="url">
                  转：一文精通 crontab从入门到出坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-02-10 09:03:04" itemprop="dateCreated datePublished" datetime="2020-02-10T09:03:04+08:00">2020-02-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/定时任务/" itemprop="url" rel="index"><span itemprop="name">定时任务</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一文精通-crontab从入门到出坑"><a href="#一文精通-crontab从入门到出坑" class="headerlink" title="一文精通 crontab从入门到出坑"></a>一文精通 crontab从入门到出坑</h1><p>地址：<a href="https://zhuanlan.zhihu.com/p/58719487" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/58719487</a></p>
<blockquote>
<p>这篇博文较长，涵盖了几乎所有crontab的坑。阅读时间会比较长，建议认真读完。</p>
</blockquote>
<p>此篇技术博文主要介绍的是crontab，Linux下的计划任务管理工具。涉及内容包括crontab使用配置、常见坑的分析和个人总结的错误调试方法。</p>
<p>我的理解，后台任务通常分为两种：常驻和定时。之前的文章《pm2进程管理工具使用总结》主要针对的是常驻任务。今天来谈谈crontab，主要针对的是定时任务。我的实验环境：centos7。</p>
<h2 id="介绍crontab"><a href="#介绍crontab" class="headerlink" title="介绍crontab"></a><strong>介绍crontab</strong></h2><p>crontab的服务进程名为crond，英文意为周期任务。顾名思义，crontab在Linux主要用于周期定时任务管理。通常安装操作系统后，默认已启动crond服务。crontab可理解为cron_table，表示cron的任务列表。类似crontab的工具还有at和anacrontab，但具体使用场景不同，可参见附录《让你学会Linux计划任务》一文了解更多。</p>
<p>关于crontab的用途很多，如</p>
<ul>
<li>定时系统检测；</li>
<li>定时数据采集；</li>
<li>定时日志备份；</li>
<li>定时更新数据缓存；</li>
<li>定时生成报表；<br>…<br>等等任务</li>
</ul>
<p>当然，更多使用场景是要以视具体情况而定了。毕竟是工具通常都是常用规则总结而成的产物。</p>
<p>确认crond服务已经安装与开启之后，下面开始具体说明</p>
<h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a><strong>简单示例</strong></h2><p>先来个简单示例体验一下。目标是每分钟向/tmp/time.txt文件下写入当前时间</p>
<p><strong>新建crontab任务</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ crontab -e      // 打开crontab任务编辑</span><br><span class="line">* * * * * date &gt;&gt; /tmp/time.txt</span><br></pre></td></tr></table></figure>
<p>静静等待几分钟工作如下命令查看文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/time.txt</span><br><span class="line">Do 29. Dez 22:45:01 CST 2016</span><br><span class="line">Do 29. Dez 22:46:01 CST 2016</span><br><span class="line">Do 29. Dez 22:47:01 CST 2016</span><br></pre></td></tr></table></figure>
<ul>
<li>从上面结果看出，每分钟执行了date并写入到/tmp/time.txt。</li>
</ul>
<p>简单示例演示成功。下面从细节深入说明crontab使用。</p>
<h2 id="使用选项"><a href="#使用选项" class="headerlink" title="使用选项"></a><strong>使用选项</strong></h2><p>上面的实验中使用了crontab命令的-e选项。我们来看看crontab命令中有哪些选项?</p>
<p><strong>-e 选项</strong> 表示打开当前用户的crontab任务列表配置文件。当然也可以直接打开，路径通常是在/var/spool/cron/下，文件以用户名命名，如/var/spool/cron/root。不过，采用-e方式打开，福利是可以帮助我们自动检查任务配置符合规则。</p>
<p><strong>-u 选项</strong> 指定某用户的任务列表，很好理解。比如我当前是root用户，想操作poloxue用户的任务列表。如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ crontab -u poloxue -e</span><br></pre></td></tr></table></figure>
<p><strong>-l 选项</strong> 列出某用户的所有任务列表</p>
<p><strong>-r 选项</strong> 删除某用户的所有任务列表，这个选项使用小心为上，估计也只是自己实验时玩玩而已，正常不使用。</p>
<p>crontab命令的选项中，主要使用的就是以上几个，理解比较简单。</p>
<h2 id="任务配置"><a href="#任务配置" class="headerlink" title="任务配置"></a><strong>任务配置</strong></h2><p>说完了crontab的命令选项，下面开始正题，任务列表文件如何配置？</p>
<p>首先，看下crontab任务列表配置格式，示例文件如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SHELL=/bin/bash</span><br><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAILTO=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更多细节 man 4 crontabs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计划任务定义的例子:</span></span><br><span class="line"><span class="comment"># .---------------- 分 (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- 时 (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- 日 (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- 月 (1 - 12)</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- 星期 (0 - 7) (星期日可为0或7)</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * 执行的命令</span></span><br><span class="line">* * * * * date &gt;&gt; /time.txt 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>从上面的示例文件可看出，crontab的任务列表主要由两部分组成：环境变量配置与定时任务配置。可能大家在工作中更多是只用到了任务配置部分。</p>
<h2 id="环境变量配置部分"><a href="#环境变量配置部分" class="headerlink" title="环境变量配置部分"></a><strong>环境变量配置部分</strong></h2><p>理解环境变量配置这部分可以帮助我们减少去踩一些不必要的坑。简单说明上面涉及的环境变量。</p>
<p><strong>SHELL</strong>为/bin/bash，表示使用/bin/bash解释执行命令</p>
<p><strong>PATH</strong>表示到哪些目录路径寻找命令程序，此环境变量的值说明了为什么我们在crontab中执行命令时，尽量要写命令全路径才能执行的原因。</p>
<p><strong>MAILTO</strong>变量作用是当任务执行有输出时，内容发送到哪个用户的邮箱。禁用可以设置MAILTO=””。</p>
<p>当我们在使用crontab时，发现某些定时任务不能顺利执行，但shell控制台执行成功，环境变量是否正确是我们需要首先关注的点之一。具体详情可以看后面关于环境变量坑的说明。</p>
<h2 id="定时任务配置部分"><a href="#定时任务配置部分" class="headerlink" title="定时任务配置部分"></a><strong>定时任务配置部分</strong></h2><p>这部分是crontab配置核心。</p>
<p><strong>基本配置</strong></p>
<p>如下所示配置共6列，前5列是关于执行时间配置，最后1列是具体执行命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.---------------- 分 (0 - 59)</span><br><span class="line">|  .------------- 时 (0 - 23)</span><br><span class="line">|  |  .---------- 日 (1 - 31) </span><br><span class="line">|  |  |  .------- 月 (1 - 12) </span><br><span class="line">|  |  |  |  .---- 星期 (0 - 6) (星期日可为0或7) </span><br><span class="line">|  |  |  |  | </span><br><span class="line">*  *  *  *  * 执行的命令</span><br></pre></td></tr></table></figure>
<p>第一列单位为分，表示每时第几分钟，范围为0-59；<br>第二列单位为时，表示每天第几小时，范围为0-23；<br>第三列单位为日，表示每月第几天，范围为1-31；<br>第四列单位为月，表示每年第几月，范围为1-12；<br>第五列单位为星期，表示每星期第几天，范围0-7，0与7表示星期日，其他分别为星期1-6；</p>
<p><strong>时间配置段类型</strong></p>
<p>根据时间列中值的不同设置方式，编者总结出以下五种类型：</p>
<p><strong>固定某值</strong>，指定固定值，如指定1月1日0时0分执行任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1 1 * command</span><br></pre></td></tr></table></figure>
<p>月日时分都指定了固定数值。<br>注：*在crontab中表示任意值都满足条件。</p>
<p><strong>列表值</strong>，时间值是一个列表，如指定一个月内2、12、22日零时执行任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 2,12,22 * * command</span><br></pre></td></tr></table></figure>
<p>上述日指定多个值，2号、12号和22号，以逗号分隔；</p>
<p><strong>连续范围值</strong>，时间为连续范围的值，如指定每个月1至7号零时执行任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1-7 * * command</span><br></pre></td></tr></table></figure>
<p>上述日期为连续范围的值1-7时</p>
<p><strong>步长值</strong>，根据指定数值跳跃步长确定执行时间，如指定凌晨1时开始每割3个小时0分执行一次任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 1-24/3 * * * command</span><br></pre></td></tr></table></figure>
<p>上述指定从凌晨1时每3个小时执行任务，如1点0分，4点0分，7点0分等。</p>
<p><strong>混合值</strong>，支持以上类型的组合，如指定每小时0至10分，22、33分以及0-60分钟每隔20分钟执行任务，如下</p>
<p>0-10,22,33,<em>/20 </em> <em> </em> * command</p>
<p>这里的分钟值采取了多种类型组合指定，包括连续范围值(0-7)，列表值(22,33)，步长值(*/20)。</p>
<p>说明：这几种时间配置类型是编者自己总结，希望能帮助大家更好理解。</p>
<h2 id="定时语句解析工具"><a href="#定时语句解析工具" class="headerlink" title="定时语句解析工具"></a><strong>定时语句解析工具</strong></h2><p>通常在使用crontab添加任务时，我们会依靠自己已有知识编写定时语句。当需要测试语句是否正确时，总需要一定时间等待证明其正确性。作为一名牛逼的程序员，这种方式就太不酷了。有没有一款工具，只要我们给出语句，其就能告诉具体执行时间呢？下面介绍一款老外开发的crontab在线解析工具。</p>
<p>工具地址：<a href="https://link.zhihu.com/?target=https%3A//crontab.guru/" target="_blank" rel="noopener">https://crontab.guru</a>，下面是工具的截图</p>
<p><img src="https://pic2.zhimg.com/80/v2-b9c9d6301f824594b33f408273436ae9_hd.jpg" alt="img"></p>
<p>从上面看出，我们输入的语句解析结果为每天的04：05执行任务。下面有这样一行文字“next at 2016-12-31 04:05:00”，告诉了我们最近一次的执行时间。</p>
<p>注：百度搜索“crontab在线解析”获得的工具有坑，某些语句解析结果错误。为避免大家受骗，这里提供具体地址：<a href="https://link.zhihu.com/?target=http%3A//tool.lu/crontab/" target="_blank" rel="noopener">http://tool.lu/crontab/</a></p>
<h2 id="使用有坑"><a href="#使用有坑" class="headerlink" title="使用有坑"></a><strong>使用有坑</strong></h2><p>crontab使用中常会遇到各种坑。下面列出编者在使用中曾遇到的一些问题。此处介绍两种坑，一种是基本功不足导致的配置错误，而另一种是多数人对crontab配置都存在的一个理解误区。</p>
<p><strong>整点时间设置错误</strong></p>
<p>其实这个错误不用单独说明，但是我在刚开始接触crontab时犯过，单独拿出来说明一下。<br>如设定每天3点执行一次某任务</p>
<p>下面列出错误方式，当我们听到每天3点执行一次某任务时，很多人会把重点放在3点，而忽略了执行一次的需求。下面是个错误的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* 3 * * * command</span><br></pre></td></tr></table></figure>
<p>这里会导致在三点的每分钟都会执行一次任务，也就是执行了60次。正确方式如下，每天3点0时执行任务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 3 * * * command</span><br></pre></td></tr></table></figure>
<p><strong>日与星期的关系误区</strong></p>
<p>这真的是个大误区，很多人都不知道的大误区。直接开始说明吧。首先做两个练习</p>
<p>设置任务一：每月的1-7每天零时执行某任务，答案如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1-7 * * date &gt;&gt; /tmp/date.txt</span><br></pre></td></tr></table></figure>
<p>设置任务二：每星期的星期一零时执行某任务，答案如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 * * 1 date &gt;&gt; /tmp/date.txt</span><br></pre></td></tr></table></figure>
<p>上面两个任务的设定都是正确的。下面提出第三个任务，设置每个月的第一个星期一零时执行某任务。</p>
<p>分解任务要求，首先，第一个星期就是每个月的1-7日，而星期一就是星期一。所以我们理解的crontab任务配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 1-7 * 1 date &gt;&gt; /tmp/date.txt</span><br></pre></td></tr></table></figure>
<p>下面直接使用前面介绍的在线解析工具分析此语句，如下</p>
<p><img src="https://pic1.zhimg.com/80/v2-3685380c1c54a36717aa6f17e16778b0_hd.jpg" alt="img"></p>
<p>解析结果显示语句执行时间为每月的1至7日和每星期一。可以看到最近执行时间是“next at 2017-01-01 00:00:00”，这个时间也并非星期一。这是crontab的一个特别容易误解之处，下面直接给出结论:</p>
<p>当日和星期任一列包含时，日与星期两者为并且的关系；</p>
<p>当日和星期列中不包含时，日与星期两者为或者的关系；</p>
<p>请注意，前面提到的那个百度搜索出来的工具分析结果显示的确是每月第一个星期一，这是错误的。如有朋友持怀疑态度，可自行验证，如有错误，随时告知。</p>
<h2 id="环境变量问题"><a href="#环境变量问题" class="headerlink" title="环境变量问题"></a><strong>环境变量问题</strong></h2><p>当我们刚使用crontab时，有人会告知所有命令尽量都使用绝对路径，以防错误。为什么？这就和我们下面要谈的环境变量有关了。</p>
<p>首先，获取控制台环境变量看下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ env</span><br><span class="line">XDG_SESSION_ID=10</span><br><span class="line">HOSTNAME=localhost.localdomain</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PERL_MB_OPT=--install_base /root/perl5</span><br><span class="line">USER=root</span><br><span class="line">MAIL=/var/spool/mail/root</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/local/php5/bin</span><br><span class="line">PWD=/var/mail</span><br><span class="line">SHLVL=1</span><br><span class="line">HOME=/root</span><br><span class="line">LOGNAME=root</span><br><span class="line">XDG_RUNTIME_DIR=/run/user/0 </span><br><span class="line">_=/usr/bin/env</span><br></pre></td></tr></table></figure>
<p>考虑篇幅问题，上文输出有删减。</p>
<p>然后，获取crontab环境变量信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * /usr/bin/env &gt; /tmp/env.txt</span><br></pre></td></tr></table></figure>
<p>输出结果，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/env.txt</span><br><span class="line">XDG_SESSION_ID=732</span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">USER=root</span><br><span class="line">PATH=/usr/bin:/bin</span><br><span class="line">PWD=/root</span><br><span class="line">LANG=de_DE.UTF-8</span><br><span class="line">SHLVL=1 HOME=/root</span><br><span class="line">LOGNAME=root</span><br><span class="line">XDG_RUNTIME_DIR=/run/user/0</span><br><span class="line">_=/usr/bin/en</span><br></pre></td></tr></table></figure>
<p>对比crontab与控制台输出，我们发现两者的环境变量差异很大。如果命令在控制台执行成功，而在crontab执行失败，我们需要考虑是否命令涉及的环境变量在crontab和控制台间存在差异。</p>
<p>明白crontab使用绝对路径执行命令原因了吗？我们知道命令默认查找路径是由PATH指定的。从上面输出结果可知，控制台的PATH值为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/local/php/bin</span><br></pre></td></tr></table></figure>
<p>crontab的PATH值为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/local/php/bin</span><br></pre></td></tr></table></figure>
<p>crontab的PATH值为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=/usr/bin:/bin</span><br></pre></td></tr></table></figure>
<p>/usr/local/php/bin/下面存在php命令，在控制台执行成功<br>$ php index.php<br>因在crontab的PATH变量无/usr/local/php/bin/，其执行php命令则会失败。</p>
<p>如何解决？已知哪个环境变量导致问题，可以直接在crontab配置中加入变量配置。<br>不知哪个环境变量导致问题，终极大招是引入控制台环境变量，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * source /$HOME/.bash_profile &amp;&amp; command</span><br></pre></td></tr></table></figure>
<p>当然，对于某特定环境变量或有特定的处理方式，如PATH，命令使用绝对路径亦可解决。</p>
<h2 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号%"></a><strong>特殊符号%</strong></h2><p>%在crontab是特殊符号，具体含义如下：</p>
<p>第一个%表示标准输入的开始，如下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * cat &gt;&gt; /tmp/cat.txt 2&gt;&amp;1 % stdin input</span><br></pre></td></tr></table></figure>
<p>执行成功之后，查看/tmp/cat.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/cat.txt</span><br><span class="line"> stdin input</span><br></pre></td></tr></table></figure>
<p>我们看到标准输入写入到了/tmp/cat.txt文件。理解上面示例，首先需知cat &gt;&gt; /tmp/cat.txt ，作用是将标准输入重定向至/tmp/cat.txt。</p>
<p>其余%表示换行符，示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * cat &gt;&gt; /tmp/cat_line.txt 2&gt;&amp;1 % stdin input 1 % stdin input 2 % stdin input 3</span><br></pre></td></tr></table></figure>
<p>查看输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/cat_line.txt</span><br><span class="line">stdin input 1</span><br><span class="line">stdin input 2</span><br><span class="line">stdin input 3</span><br></pre></td></tr></table></figure>
<p>可以发现这里有三行输出。那么如何解决？既然是特殊字符，自然而然就想到了使用\进行转义，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * cat &gt;&gt; /tmp/cat_special.txt 2&gt;&amp;1 % per cent is \%. 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>查看输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/cat_special.txt</span><br><span class="line">per cent is %.</span><br></pre></td></tr></table></figure>
<p>执行成功了。自此，你就顺利爬出了%特殊字符问题的坑。关于这个问题的具体说明，可以参看附录中的《Crontab and %》。</p>
<h2 id="关于输出重定向"><a href="#关于输出重定向" class="headerlink" title="关于输出重定向"></a><strong>关于输出重定向</strong></h2><p>当我们不做输出重定向时，如任务有大量输出，或许有些无法解释的问题。</p>
<p>输出写入邮件，crontab任务输出默认写入到执行用户的邮件中，如下演示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * date</span><br></pre></td></tr></table></figure>
<p>命令输出当前日期，下面查看当前用户的邮件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /var/spool/mail/$USER</span><br><span class="line">...</span><br><span class="line">Sat Dec 31 17:45:01 CST 2016</span><br></pre></td></tr></table></figure>
<p>由此可见，任务输出的日期信息写入到了用户邮件中。如任务有大量输出，会占用磁盘资源。但编者测试显示，如磁盘容量不足，任务也会执行，但输出不会写入邮件；</p>
<p>我们可以关闭邮箱功能。设置MAILTO环境变量为空。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MAILTO=&quot;&quot;</span><br><span class="line">* * * * * date</span><br></pre></td></tr></table></figure>
<p>是不是关闭邮件写入就好了？附录《Linux中的crontab与sendmail》博文表明，关闭mail功能，输出内容将写入到/var/spool/clientmqueue中，可能占满分区的inode资源，导致任务无法执行。inode资源使用情况可通过如下命令获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ df -i</span><br><span class="line">Filesystem Inodes   IUsed  IFree    IUse% Mounted on</span><br><span class="line">/dev/sda1  512000   378    511622   1%    /boot</span><br><span class="line">/dev/sda2  92672000 185351 92486649 1%    /</span><br></pre></td></tr></table></figure>
<p>抱歉！这种情况编者并未测出！但在公司的生产环境发现过未重定向则任务不执行的情况，加上后解决了问题。百度也搜索到了类似问题，如有朋友了解，欢迎指教，万分感谢。</p>
<p>当然，为了避免此类问题发生，建议任务都加上输出重定向，如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * date &gt;&gt; /dev/null/ 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>输出到/dev/null中，标准输入和标准错误都应处理。如大家对重定向有疑惑，附录中的Linux重定向的解释不错。在技术的世界，当我们不按常理做事，事情也不会按常理犯错。</p>
<h2 id="调试大招"><a href="#调试大招" class="headerlink" title="调试大招"></a><strong>调试大招</strong></h2><p>最后的福利，编者根据自己的总结而梳理出一套快速定位crontab错误的思路。两个角度：</p>
<p>一是任务是否执行</p>
<p>二看命令是否正确</p>
<h2 id="任务是否执行"><a href="#任务是否执行" class="headerlink" title="任务是否执行"></a><strong>任务是否执行</strong></h2><p>调试思路：首先，通过日志确认任务是否执行。然后，如未执行则分析定时语句。最后，定时没有问题，检查crond服务是否开启。</p>
<p>下面说明具体分析步骤。</p>
<p>调试错误，日志通常是个利器，crontab也有日志。我的服务器中crontab日志文件位置为/var/log/cron。</p>
<p><strong>查看日志</strong></p>
<p>日志中包含任务执行记录，配置错误提示，任务配置编辑重载记录，服务开启等记录。<br>下面是日志的部分内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vim /var/log/cron</span><br><span class="line">...</span><br><span class="line">Dec 31 19:17:01 localhost crond[1455]: (CRON) bad day-of-week (/var/spool/cron/root)</span><br><span class="line">Dec 31 19:17:01 localhost CROND[4409]: (root) CMD (date) ...</span><br></pre></td></tr></table></figure>
<p>这里截取了对调试比较重要的两条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dec 31 19:17:01 localhost CROND[4409]: (root) CMD (date)</span><br></pre></td></tr></table></figure>
<p>显示12月21 19时17分1秒执行了date命令。</p>
<p><strong>配置错误</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dec 31 19:17:01 localhost crond[1455]: (CRON) bad day-of-week (/var/spool/cron/root)</span><br></pre></td></tr></table></figure>
<p>上面显示/var/spool/cron/root的任务配置有错，也就是root任务配置有错。错误原因：bad day-of-week，星期配置有错。语句是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * date &gt;&gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>明显缺少了星期时间段。</p>
<p>确认定时语句，通过上面的日志分析，如任务没有执行，使用定时语句在线分析工具分析定时是否正确，非常简单。</p>
<p>确认服务开启，如果定时语句也正确，检查服务是否开启。检测命令如下</p>
<p>Systemd方式(centos7及以上)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status crond.service</span><br></pre></td></tr></table></figure>
<p>SysVinit方式(centos7以下)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service crond status</span><br></pre></td></tr></table></figure>
<p>查看命令输出，如未开启，执行如下命令开启</p>
<p>Systemd方式(centos7及以上)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start crond.service</span><br></pre></td></tr></table></figure>
<p>SysVinit方式(centos7以下)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service crond start</span><br></pre></td></tr></table></figure>
<p>确认任务成功后，如问题仍未解决，继续往下看。</p>
<h2 id="命令是否正确"><a href="#命令是否正确" class="headerlink" title="命令是否正确"></a><strong>命令是否正确</strong></h2><p>确认命令成功与否，这里总结步骤大致如下：</p>
<p>获取命令执行输出，crontab中的命令执行出错，多数人都不知道如何调试。我们知道在控制台执行命令时，可通过输出获取错误信息调试问题。这种方式在crontab同样适用，方法就是利用重新向获取输出，进行分析。示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * php /root/index.php &gt;&gt; /tmp/debug.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>这条任务总是执行失败，我们把输出重定向到/tmp/debug.log。查看debug.log，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/debug.log </span><br><span class="line">/bin/sh: php: command not found</span><br><span class="line">/bin/sh: php: command not found</span><br></pre></td></tr></table></figure>
<p>显示php命令没有找到，很明显的可以确定是环境变量的问题。这种方式定位问题非常有效。</p>
<p>具体问题具体分析。有了命令执行的输出，下面就是具体问题具体分析了。或许是前面提到的各种坑，也或许是命令本身所独有的问题。</p>
<p>调试的方法到这里就说完了。但还是实践为王，需持续总结，同时也希望大家不要在同样的坑中重复犯错。</p>
<h2 id="参考附录"><a href="#参考附录" class="headerlink" title="参考附录"></a>参考附录</h2><p><a href="https://link.zhihu.com/?target=http%3A//os.51cto.com/art/201001/176402.htm" target="_blank" rel="noopener">让你学会Linux计划任务</a><br><a href="https://link.zhihu.com/?target=http%3A//www.server110.com/sendmail/201311/3125.html" target="_blank" rel="noopener">Linux中的crontab与sendmail</a><br><a href="https://link.zhihu.com/?target=http%3A//www.hcidata.info/crontab.htm" target="_blank" rel="noopener">Crontab and %</a><br><a href="https://link.zhihu.com/?target=http%3A//www.jb51.net/os/RedHat/1120.html" target="_blank" rel="noopener">Linux重定向</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/09/转：Nginx日志配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ruopu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ruopu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/09/转：Nginx日志配置/" itemprop="url">
                  转：Nginx日志配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              

              
                
              

              <time title="創建時間：2020-02-09 21:38:00" itemprop="dateCreated datePublished" datetime="2020-02-09T21:38:00+08:00">2020-02-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新於</span>
                
                <time title="修改時間：2020-04-17 17:32:07" itemprop="dateModified" datetime="2020-04-17T17:32:07+08:00">2020-04-17</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="超详细！Nginx-日志配置实践"><a href="#超详细！Nginx-日志配置实践" class="headerlink" title="超详细！Nginx 日志配置实践"></a>超详细！Nginx 日志配置实践</h2><p>地址：<a href="https://mp.weixin.qq.com/s/MzLHXwyl8Upt4eI9IjrNBw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/MzLHXwyl8Upt4eI9IjrNBw</a></p>
<p><strong>前言</strong></p>
<p>Nginx日志对于统计、系统服务排错很有用。</p>
<p><strong>Nginx日志主要分为两种：</strong>access_log(访问日志)和error_log(错误日志)。通过访问日志我们可以得到用户的IP地址、浏览器的信息，请求的处理时间等信息。错误日志记录了访问出错的信息，可以帮助我们定位错误的原因。</p>
<p><strong>本文将详细描述一下如何配置Nginx日志。</strong></p>
<h2 id="设置access-log"><a href="#设置access-log" class="headerlink" title="设置access_log"></a><strong>设置access_log</strong></h2><p>访问日志主要记录客户端的请求。客户端向Nginx服务器发起的每一次请求都记录在这里。客户端IP，浏览器信息，referer，请求处理时间，请求URL等都可以在访问日志中得到。当然具体要记录哪些信息，你可以通过log_format指令定义。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">access_log path <span class="comment">[format <span class="comment">[buffer=size]</span> <span class="comment">[gzip<span class="comment">[=level]</span>]</span> <span class="comment">[flush=time]</span> <span class="comment">[if=condition]</span>]</span>; # 设置访问日志</span><br><span class="line">access_log off; # 关闭访问日志</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>path 指定日志的存放位置。</li>
<li>format 指定日志的格式。默认使用预定义的combined。</li>
<li>buffer 用来指定日志写入时的缓存大小。默认是64k。</li>
<li>gzip 日志写入前先进行压缩。压缩率可以指定，从1到9数值越大压缩比越高，同时压缩的速度也越慢。默认是1。</li>
<li>flush 设置缓存的有效时间。如果超过flush指定的时间，缓存中的内容将被清空。</li>
<li>if 条件判断。如果指定的条件计算为0或空字符串，那么该请求不会写入日志。</li>
</ul>
</blockquote>
<p>另外，还有一个特殊的值off。如果指定了该值，当前作用域下的所有的请求日志都被关闭。</p>
<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>可以应用access_log指令的作用域分别有http，server，location，limit_except。也就是说，在这几个作用域外使用该指令，Nginx会报错。</p>
<p>以上是access_log指令的基本语法和参数的含义。下面我们看一几个例子加深一下理解。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access_log /var/logs/nginx-<span class="keyword">access</span>.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>
<p>该例子指定日志的写入路径为/var/logs/nginx-access.log，日志格式使用默认的combined。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access_log /var/logs/nginx-access.log <span class="attribute">buffer</span>=32k gzip <span class="attribute">flush</span>=1m</span><br></pre></td></tr></table></figure>
<p>该例子指定日志的写入路径为/var/logs/nginx-access.log，日志格式使用默认的combined，指定日志的缓存大小为32k，日志写入前启用gzip进行压缩，压缩比使用默认值1，缓存数据有效时间为1分钟。</p>
<h2 id="使用log-format自定义日志格式"><a href="#使用log-format自定义日志格式" class="headerlink" title="使用log_format自定义日志格式"></a><strong>使用log_format自定义日志格式</strong></h2><p>Nginx预定义了名为combined日志格式，如果没有明确指定日志格式默认使用该格式：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">log_format</span> combined <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] '</span></span><br><span class="line">                    <span class="string">'"<span class="variable">$request</span>" <span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> '</span></span><br><span class="line">                    <span class="string">'"<span class="variable">$http_referer</span>" "<span class="variable">$http_user_agent</span>"'</span>;</span><br></pre></td></tr></table></figure>
<p>如果不想使用Nginx预定义的格式，可以通过log_format指令来自定义。</p>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log_format name [<span class="built_in">escape</span>=<span class="keyword">default</span>|json] <span class="built_in">string</span> ...;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>name 格式名称。在access_log指令中引用。</li>
<li>escape 设置变量中的字符编码方式是json还是default，默认是default。</li>
<li>string 要定义的日志格式内容。该参数可以有多个。参数中可以使用Nginx变量。</li>
</ul>
</blockquote>
<p>下面是log_format指令中常用的一些变量：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">bytes_sent</span></span><br><span class="line">发送给客户端的总字节数</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">body_bytes_sent</span></span><br><span class="line">发送给客户端的字节数，不包括响应头的大小</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">connection</span></span><br><span class="line">连接序列号</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">connection_requests</span></span><br><span class="line">当前通过连接发出的请求数量</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">msec</span></span><br><span class="line">日志写入时间，单位为秒，精度是毫秒</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">pipe</span></span><br><span class="line">如果请求是通过http流水线发送，则其值为"p"，否则为“."</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">request_length</span></span><br><span class="line">请求长度（包括请求行，请求头和请求体）</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">request_time</span></span><br><span class="line">请求处理时长，单位为秒，精度为毫秒，从读入客户端的第一个字节开始，直到把最后一个字符发送张客户端进行日志写入为止</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">status</span></span><br><span class="line">响应状态码</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">time_iso8601</span></span><br><span class="line">标准格式的本地时间,形如“2017-05-24T18:31:27+08:00”</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">time_local</span></span><br><span class="line">通用日志格式下的本地时间，如"24/May/2017:18:31:27 +0800"</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">http_referer</span></span><br><span class="line">请求的referer地址。</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">http_user_agent</span></span><br><span class="line">客户端浏览器信息。</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">remote_addr</span></span><br><span class="line">客户端IP</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">http_x_forwarded_for</span></span><br><span class="line">当前端有代理服务器时，设置web节点记录客户端地址的配置，此参数生效的前提是代理服务器也要进行相关的x_forwarded_for设置。</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">request</span></span><br><span class="line">完整的原始请求行，如 "GET / HTTP/1.1"</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">remote_user</span></span><br><span class="line">客户端用户名称，针对启用了用户认证的请求</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">request_uri</span></span><br><span class="line">完整的请求地址，如 "https://daojia.com/"</span><br></pre></td></tr></table></figure>
<p>下面演示一下自定义日志格式的使用：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">access_log</span> /var/logs/nginx-access.log main</span><br><span class="line">log_format  main  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                  <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                  <span class="string">'"<span class="variable">$http_user_agent</span>" "<span class="variable">$http_x_forwarded_for</span>"'</span>;</span><br></pre></td></tr></table></figure>
<p>我们使用log_format指令定义了一个main的格式，并在access_log指令中引用了它。假如客户端有发起请求：<a href="https://suyunfe.com/，我们看一下我截取的一个请求的日志记录" target="_blank" rel="noopener">https://suyunfe.com/，我们看一下我截取的一个请求的日志记录</a>:</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">112.195</span>.<span class="number">209.90</span> - - [<span class="number">20</span>/Feb/<span class="number">2018</span>:<span class="number">12</span>:<span class="number">12</span>:<span class="number">14</span> +<span class="number">0800</span>] </span><br><span class="line"><span class="string">"GET / HTTP/1.1"</span> <span class="number">200</span> <span class="number">190</span> <span class="string">"-"</span> <span class="string">"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) </span></span><br><span class="line">AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">63.0</span>.<span class="number">3239.132</span> Mobile Safari/<span class="number">537.36</span><span class="string">" "</span>-<span class="string">"</span></span><br></pre></td></tr></table></figure>
<p>我们看到最终的日志记录中<code>$remote_user</code>、<code>$http_referer</code>、<code>$http_x_forwarded_for</code>都对应了一个<code>-</code>，这是因为这几个变量为空。</p>
<h2 id="设置error-log"><a href="#设置error-log" class="headerlink" title="设置error_log"></a><strong>设置error_log</strong></h2><p>错误日志在Nginx中是通过error_log指令实现的。该指令记录服务器和请求处理过程中的错误信息。</p>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p>配置错误日志文件的路径和日志级别。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error_log <span class="built_in">file</span> [level];</span><br><span class="line">Default:    </span><br><span class="line">error_log logs/<span class="keyword">error</span>.<span class="built_in">log</span> <span class="keyword">error</span>;</span><br></pre></td></tr></table></figure>
<p>第一个参数指定日志的写入位置。</p>
<p>第二个参数指定日志的级别。level可以是debug, info, notice, warn, error, crit, alert,emerg中的任意值。可以看到其取值范围是按紧急程度从低到高排列的。只有日志的错误级别等于或高于level指定的值才会写入错误日志中。默认值是error。</p>
<h3 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log /<span class="built_in">var</span>/logs/nginx/nginx-<span class="built_in">error</span>.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>
<p>它可以配置在：main， http, mail, stream, server, location作用域。</p>
<p>例子中指定了错误日志的路径为：<code>/var/logs/nginx/nginx-error.log</code>，日志级别使用默认的error。</p>
<h2 id="open-log-file-cache"><a href="#open-log-file-cache" class="headerlink" title="open_log_file_cache"></a><strong>open_log_file_cache</strong></h2><p>每一条日志记录的写入都是先打开文件再写入记录，然后关闭日志文件。如果你的日志文件路径中使用了变量，如<code>access_log /var/logs/$host/nginx-access.log</code>，为提高性能，可以使用open_log_file_cache指令设置日志文件描述符的缓存。</p>
<h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open_log_file_cache <span class="attribute">max</span>=N [<span class="attribute">inactive</span>=time] [<span class="attribute">min_uses</span>=N] [<span class="attribute">valid</span>=time];</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>max 设置缓存中最多容纳的文件描述符数量，如果被占满，采用LRU算法将描述符关闭。</li>
<li>inactive 设置缓存存活时间，默认是10s。</li>
<li>min_uses 在inactive时间段内，日志文件最少使用几次，该日志文件描述符记入缓存，默认是1次。</li>
<li>valid：设置多久对日志文件名进行检查，看是否发生变化，默认是60s。</li>
<li>off：不使用缓存。默认为off。</li>
</ul>
</blockquote>
<h3 id="基本用法-2"><a href="#基本用法-2" class="headerlink" title="基本用法"></a>基本用法</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open_log_file_cache <span class="attribute">max</span>=1000 <span class="attribute">inactive</span>=20s <span class="attribute">valid</span>=1m <span class="attribute">min_uses</span>=2;</span><br></pre></td></tr></table></figure>
<p>它可以配置在http、server、location作用域中。</p>
<p>例子中，设置缓存最多缓存1000个日志文件描述符，20s内如果缓存中的日志文件描述符至少被被访问2次，才不会被缓存关闭。每隔1分钟检查缓存中的文件描述符的文件名是否还存在。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p>Nginx中通过access_log和error_log指令配置访问日志和错误日志，通过log_format我们可以自定义日志格式。如果日志文件路径中使用了变量，我们可以通过open_log_file_cache指令来设置缓存，提升性能。</p>
<p>另外，在access_log和log_format中使用了很多变量，这些变量没有一一列举出来，详细的变量信息可以参考Nginx官方文档：<a href="http://nginx.org/en/docs/varindex.html" target="_blank" rel="noopener">http://nginx.org/en/docs/varindex.html</a></p>
<blockquote>
<p>作者：antwang</p>
<p>juejin.im/post/5aa09bb3f265da238f121b6c</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一頁"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一頁"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ruopu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">224</span>
                    <span class="site-state-item-name">文章</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">分類</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">167</span>
                    <span class="site-state-item-name">標籤</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ruopu</span>

  

  

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_pv">
    本站总访问量: <span id="busuanzi_value_site_pv"></span>次
  </span>
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.0</div>





        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="訪客總數">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="總瀏覽次數">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
